<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CBDCç³»åˆ—ï¼ˆ6ï¼‰ - Ubiné¡¹ç›®é˜¶æ®µ II (DLTæŠ€æœ¯å®ç°RTGSçš„æ’é˜Ÿ/è§£é”åŠŸèƒ½ç ”ç©¶)</title>
      <link href="//articles/ubin-phase-2/"/>
      <url>//articles/ubin-phase-2/</url>
      
        <content type="html"><![CDATA[<p>Ubiné¡¹ç›®æ˜¯ç”±æ–°åŠ å¡é‡‘ç®¡å±€ï¼ˆMonetary Authority of Singapore, MASï¼‰ä¸»å¯¼çš„æ—¨åœ¨æ¢ç´¢åˆ©ç”¨DLTæŠ€æœ¯åœ¨æ”¯ä»˜/è¯åˆ¸é¢†åŸŸçš„æ¸…ç®—ç»“ç®—å¯è¡Œæ€§çš„ç ”ç©¶é¡¹ç›®ã€‚è¿™ä¸ªæ˜¯ä¸€ä¸ªè·¨åº¦å¤šå¹´å¤šé˜¶æ®µçš„é•¿æœŸé¡¹ç›®ï¼Œå§‹äº2016å¹´ï¼Œæˆªæ­¢å½“å‰å·²å®Œæˆäº†5ä¸ªé˜¶æ®µçš„å®éªŒå’Œç ”ç©¶æŠ¥å‘Šã€‚åŒæ—¶Ubiné¡¹ç›®ä¹Ÿä¸ºå¦ä¸€ä¸ªè·¨å¢ƒCBDCé¡¹ç›®Dunbaræä¾›äº†æŠ€æœ¯åŸºç¡€ã€‚å…·ä½“å¯ä»¥å‚è§MASçš„å®˜ç½‘çš„<a href="https://www.mas.gov.sg/schemes-and-initiatives/project-ubin">Ubiné¡¹ç›®</a>ä»‹ç»åŠBISçš„é¡¹ç›®ä»‹ç»ã€‚æœ¬æ–‡åªè°ˆæ—©åœ¨2017å¹´11æœˆå®Œæˆçš„é˜¶æ®µ2é‡Œçš„é˜Ÿåˆ—ç®¡ç†å’Œgridlockçš„å…³é”®ç†è§£ï¼Œä¸»è¦åŸºäºå…¶<a href="https://www.mas.gov.sg/-/media/mas/projectubin/project-ubin-phase-2-reimagining-rtgs.pdf">ç ”ç©¶æŠ¥å‘ŠProject Ubin Phase 2: Re-imagining Interbank RTGS using DLT</a>åŠ<a href="https://github.com/project-ubin">githubæºç </a>ï¼Œè™½ç„¶æ—¶é—´æ¯”è¾ƒæ—©ï¼Œä½†æ˜¯å…¶ç®—æ³•è®¾è®¡ä»å¯ä»¥å‚è€ƒï¼ŒåŒ…æ‹¬å‰ä¸€æœŸIL2é¡¹ç›®ï¼Œä¹Ÿæ˜¯æ˜ç¡®æåˆ°å‚è€ƒäº†æœ¬å®éªŒçš„å®ç°ã€‚</p><span id="more"></span><p>è¿™ä¸ªå®éªŒçš„å…³é”®è®¾è®¡ä¸»è¦åˆ†Fund chansfer, Queue mechanism, Gridlock resolutionä¸‰å¤§éƒ¨åˆ†ï¼ŒDLTæŠ€æœ¯ä¹Ÿé‡‡ç”¨äº†ä¸šç•Œæœ€æ™®éçš„Cordaï¼ŒHyperledger Fabricï¼Œä¼ä¸šçº§ä»¥å¤ªåŠQuorumä¸‰å¤§æŠ€æœ¯è·¯çº¿åˆ†åˆ«å®ç°ã€‚åŒæ—¶ï¼Œäº¤æ˜“çš„éšç§æ€§ä¹Ÿæ˜¯æ–¹æ¡ˆè®¾è®¡çš„é‡ç‚¹ã€‚ä»¥ä¸‹åˆ†æä¸‹å„è‡ªçš„æ ¸å¿ƒå®ç°ã€‚</p><h3 id="Hyperledger-Fabric"><a href="#Hyperledger-Fabric" class="headerlink" title="Hyperledger Fabric"></a>Hyperledger Fabric</h3><ol><li>åˆ©ç”¨channelç‰¹æ€§çš„å¤©ç„¶çš„éš”ç¦»æ€§ï¼Œåœ¨æ¯ä¸¤ä¸ªé“¶è¡Œä¹‹é—´å»ºç«‹åŒè¾¹äº¤æ˜“channelï¼Œä¿æŠ¤äº¤æ˜“éšç§ã€‚é“¶è¡Œå¯¹channelç»´åº¦çš„è´¦æˆ·ä»¥åŠåŒè¾¹é˜Ÿåˆ—æƒ…å†µéƒ½æ˜¯å¯è§çš„ã€‚å› æ­¤ï¼ŒåŒè¾¹çš„äº¤æ˜“å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°å‡€é¢ç»“ç®—ã€‚MASä¹Ÿæ˜¯channelçš„ä¸€ä¸ªå‚ä¸æ–¹ã€‚ä½†æ˜¯ï¼Œé‡‘é¢è¢«é”å®šåœ¨channelçº§åˆ«ä¸Šï¼Œä¸åŒchannelé—´çš„æµåŠ¨æ€§è°ƒæ‹¨ä¼šè¾ƒä¸ºé¢‘ç¹çš„å‘è¡Œ/æ³¨é”€ã€‚  </li><li>chaincodeè®°å½•çš„äº¤æ˜“çŠ¶æ€ä¸ºâ€œæ’é˜Ÿä¸­â€ï¼Œâ€œå·²å®Œæˆâ€ã€‚åŒæ–¹å¯è§ï¼Œä¸éœ€è¦ä¿ç•™ä¸¤ä¸ªç‹¬ç«‹çš„å…¥å‘å’Œå‡ºå‘é˜Ÿåˆ—ã€‚å½“å‘ç”ŸæŠµæŠ¼ï¼Œchannelé—´çš„èµ„é‡‘è°ƒæ‹¨ï¼Œæ”¶å…¥ï¼Œæ’¤é”€æ’é˜Ÿï¼Œè°ƒæ•´ä¼˜å…ˆçº§ç­‰ï¼Œä¼šè‡ªåŠ¨è§¦å‘åº”ç”¨å±‚è°ƒç”¨chaincodeè¿›è¡Œé˜Ÿåˆ—è§£æ•‘æˆ–è€…è°ƒæ•´ï¼Œä¿®æ”¹äº¤æ˜“çŠ¶æ€ã€‚è§£æ•‘é¡ºåºæŒ‰ä¼˜å…ˆçº§é«˜ä½ï¼Œå…¥é˜Ÿåˆ—ä»æ—©åˆ°æ™šã€‚</li><li>gridlockçš„è§£å†³æ–¹æ¡ˆä½¿ç”¨EAF2ç®—æ³•ã€‚é™¤äº†ä¸Šè¿°çš„åŒè¾¹äº¤æ˜“channelå¤–ï¼Œè¿˜æœ‰å…¨å±€çš„å¤šè¾¹netting channelã€‚æ¯ä¸ªé“¶è¡Œå°†å„è‡ªç›¸å…³çš„æ’é˜Ÿäº¤æ˜“æŒ‡ä»¤é›†ï¼ˆåŒ…å«æ”¶å…¥å’Œæ”¯å‡ºï¼‰æäº¤åˆ°netting channelä¸Šçš„netting chaincodeã€‚chaincodeå®ç°äº†EAF2ç®—æ³•ï¼Œä¼šå†³å®šå…¨å±€çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨netting channelä¸Šåªèƒ½çœ‹åˆ°äº¤æ˜“idï¼Œä»¥åŠæ¯ä¸ªé“¶è¡Œæ¯æ¬¡æäº¤çš„æ€»å‡€é¢ï¼Œä¸å«å…·ä½“çš„äº¤æ˜“ä¿¡æ¯ï¼Œä¿æŠ¤éšç§ã€‚æ¯ä¸€è½®gridlockä»²è£ç”±é“¶è¡Œä¸»åŠ¨è§¦å‘å’Œä¸»åŠ¨åŠ å…¥ã€‚åœ¨ä»²è£æœŸé—´å‘ç”Ÿçš„æ–°äº¤æ˜“ï¼Œä¹Ÿåº”åŠ å…¥é˜Ÿåˆ—ã€‚</li><li>EAF2ç®—æ³•éœ€è¦é“¶è¡Œè¿›è¡Œå¤šè½®äº¤äº’ã€‚å¤§è‡´æ€è·¯æ˜¯ï¼Œæ¯æ¬¡é“¶è¡ŒæŒ‰ç…§é¡ºåºè½®æµæäº¤äº¤æ˜“æŒ‡ä»¤é›†ï¼Œä¿è¯å…¶æäº¤çš„æŒ‡ä»¤é›†å¦‚æœå¾—ä»¥å…¨éƒ¨æ‰§è¡Œï¼Œç»“ç®—åå…¶è‡ªèº«çš„ä½™é¢ï¼ˆç»“ç®—é’±ä½™é¢+äº¤æ˜“å‡€é¢ï¼‰ä¸ä¸ºè´Ÿæ•°ã€‚å¦‚æœå…¶é—´é“¶è¡Œå‘è¡Œå…¨éƒ¨æ‰§è¡Œåä¸ºè´Ÿï¼Œåˆ™æŒ‰é‡‘é¢æ•°ä»å¤§åˆ°å°é€ç¬”å»æ‰æ”¯å‡ºäº¤æ˜“ç›´åˆ°ä½™é¢ä¸ºæ­£ï¼Œä¹Ÿå°±æ˜¯å°½å¯èƒ½çš„æ»¡è¶³æ›´å¤šçš„äº¤æ˜“ã€‚Bé“¶è¡Œå»æ‰çš„è¿™ç¬”æ”¯å‡ºæ˜¯Aé“¶è¡Œçš„æ”¶å…¥ï¼Œå› æ­¤Aé“¶è¡Œä¹Ÿéœ€è¦æŒ‰ç…§è¿™ä¸ªæ€è·¯é‡æ–°è¿›è¡Œè®¡ç®—ï¼Œé‡æ–°æäº¤ã€‚è¿›è€Œå¼•èµ·é“¾å¼ååº”ï¼Œç›´åˆ°æœ€åæ‰€æœ‰çš„é“¶è¡Œç»“ç®—åä½™é¢éƒ½ä¸ä¸ºè´Ÿæ•°ï¼Œå¹¶ä¸”æ¯ç¬”äº¤æ˜“åœ¨æ­¤æ¬¡ä»²è£æœŸé—´éƒ½èƒ½æ‰¾åˆ°åŒ¹é…çš„æ”¶ä»˜åŒæ–¹ã€‚ç„¶åå„é“¶è¡Œå†æŒ‰ç…§å¾—åˆ°çš„å…¨å±€è§†å›¾è¿›è¡Œæœ€ç»ˆç»“ç®—ã€‚ï¼ˆå¦‚æœå­˜åœ¨ä¸åŒä¼˜å…ˆçº§çš„äº¤æ˜“ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿæ˜¯ä¿è¯ä¼˜å…ˆçº§é«˜çš„å¾—ä»¥å…ˆç»“ç®—ï¼Œè¿˜æ˜¯ä¿è¯æœ€å¤§ç¨‹åº¦çš„è§£æ•‘é˜Ÿåˆ—ï¼Ÿå¾…åç»­ç ”ç©¶ã€‚ï¼‰</li></ol><h3 id="Quorum"><a href="#Quorum" class="headerlink" title="Quorum"></a>Quorum</h3><ol><li>ä½¿ç”¨åŒè¾¹çš„private contractæ¥è¿›è¡Œä¸¤æ–¹çš„äº¤æ˜“ï¼Œä½¿ç”¨public contractæ¥è®°å½•æ‰€æœ‰å‚ä¸æ–¹çš„ä½™é¢ã€‚åˆçº¦é‡ŒåŠ ç›éšè—ä½™é¢åé¢ï¼Œäº¤æ˜“çš„æ”¶ä»˜åŒæ–¹åŸºäºè½¬è´¦é‡‘é¢å’Œä½™é¢ä½¿ç”¨é›¶çŸ¥è¯†è¯æ˜æ¥åŒæ—¶æäº¤è¯æ®ï¼Œä¿æŠ¤éšç§ï¼ŒåŒæ—¶å…¨ç½‘å„æ–¹éªŒè¯ä¹Ÿä¿è¯äº¤æ˜“çš„æœ‰æ•ˆæ€§ï¼Œæ²¡æœ‰éæ³•çš„å‘è¡Œ/æ³¨é”€èµ„é‡‘ã€‚</li><li>é˜Ÿåˆ—ç®¡ç†ã€‚å…¨å±€çš„gridlock queueä¹Ÿè®°å½•å…¨å±€çš„æ’é˜Ÿäº¤æ˜“IDç”¨ä»¥è§¦å‘gridlockè§£é”ã€‚æ¯ä¸ªé“¶è¡Œéƒ½ç»´æŠ¤private queueï¼Œè®°å½•äº¤æ˜“çš„å…·ä½“å†…å®¹ï¼Œåªæœ‰äº¤æ˜“åŒæ–¹å¯è§ã€‚å¤´å¯¸ä¸è¶³æ—¶ï¼Œäº¤æ˜“ä¼šåŒæ—¶æäº¤åˆ°è¿™ä¸¤ä¸ªqueueï¼Œå½“é“¶è¡Œçš„æµåŠ¨æ€§å¾—åˆ°è¡¥å……æ—¶ï¼Œä½¿ç”¨æ–°å¤´å¯¸æ¥è§£æ•‘é˜Ÿåˆ—ï¼Œä¿®æ”¹queueé‡Œè®°å½•ã€‚</li><li>åŒæ ·ä½¿ç”¨EAF2ç®—æ³•ã€‚å½“gridlock queueé‡Œæ•°é‡è¾¾åˆ°é¢„è®¾çš„é˜ˆå€¼æ—¶ï¼Œè§¦å‘è¿›å…¥æ–°ä¸€è½®çš„ä»²è£ã€‚</li></ol><blockquote><p>EAF2çš„ç®—æ³•æ‰§è¡Œä½¿ç”¨åˆçº¦è¿›è¡Œè®¡ç®—ï¼Œç®—æ³•æ˜¯ç¡®å®šçš„ï¼Œå› æ­¤åˆçº¦è®¡ç®—æ˜¯å¯è¡Œçš„ã€‚è®¡ç®—å‡ºæ¥çš„ç»“æœï¼Œéœ€è¦ä¿è¯æœ€ç»ˆè§£å†³æ–¹æ¡ˆé‡Œçš„äº¤æ˜“éƒ½åŒæ—¶æ‰§è¡ŒæˆåŠŸæˆ–è€…å¤±è´¥ï¼Œæ¶‰åŠçš„é“¶è¡Œçš„ä½™é¢ä¹Ÿæ˜¯åŸå­æ€§çš„åŒæ­¥æ›´æ–°æˆåŠŸã€‚åŒæ—¶ï¼Œåˆ†å¸ƒå¼çš„ä½¿ç”¨EAF2ç®—æ³•æ—¶ï¼Œæ’é˜Ÿäº¤æ˜“éœ€è¦å¯¹æ¥æ”¶æ–¹æ˜¯å¯è§çš„ï¼Œå› ä¸ºéœ€è¦å°†æ”¶å…¥çº³å…¥è®¡ç®—ã€‚ä»è¿™ä¸ªå®éªŒä¸­å¯è§åœ¨è¿™ä¸¤ä¸ªå‰ææ¡ä»¶ä¸‹ï¼Œå»ä¸­å¿ƒåŒ–çš„LSMæ–¹æ¡ˆæ˜¯å¯ä»¥å®ç°çš„ã€‚</p></blockquote><h3 id="Corda"><a href="#Corda" class="headerlink" title="Corda"></a>Corda</h3><ol><li>å±€éƒ¨è´¦æœ¬å¤©ç„¶çš„ä¿æŠ¤éšç§ï¼›åŒæ—¶æ¯æ¬¡äº¤æ˜“äº¤æ˜“åŒæ–¹æ–°ç”Ÿæˆå¯†é’¥å¯¹ï¼ŒåŒ¿åèº«ä»½ï¼Œä¸€æ¬¡ä¸€å¯†é˜²æ­¢èº«ä»½è¿½è¸ªã€‚</li><li>å¤´å¯¸ä¸è¶³æ—¶ï¼Œåœ¨è´¦æœ¬é‡Œè®°å½•ä¸ºè´Ÿå€ºçŠ¶æ€ï¼›è´Ÿè½½çš„è¯¦ç»†ä¿¡æ¯è®°å½•åœ¨å‘èµ·æ–¹é˜Ÿåˆ—é‡Œã€‚åŒæ—¶ï¼Œå®šæ—¶è°ƒåº¦ä»»åŠ¡è§¦å‘ç»“ç®—APIï¼Œå¦‚æœå¤´å¯¸å……è¶³å°±è§£æ•‘é˜Ÿåˆ—ã€‚</li></ol><div align="right">    Goodbye 2023 <span class="github-emoji"><span>ğŸ‘‹</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f44b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> </div>]]></content>
      
      
      
        <tags>
            
            <tag> CBDC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CBDCç³»åˆ—ï¼ˆ5ï¼‰ - Inthonan-LionRocké¡¹ç›®é˜¶æ®µ II (æ‰¹å‘å‹CBDCè·¨å¢ƒæ”¯ä»˜å®éªŒé¡¹ç›®)</title>
      <link href="//articles/inthanon-lionrock-phase-2/"/>
      <url>//articles/inthanon-lionrock-phase-2/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡åŸºäºBISäº2021å¹´9æœˆå‘å¸ƒçš„Inthonan-LionRocké¡¹ç›®çš„äºŒé˜¶æ®µæŠ¥å‘Š<a href="https://www.bis.org/publ/othp40.htm">Inthanon-LionRock to mBridge: building a multi CBDC platform for international payments</a>ã€‚æœ¬é˜¶æ®µç»“æŸåï¼Œæ–°å¢äº†ä¸­å›½å¤§é™†å¤®è¡Œå’Œé˜¿è”é…‹å¤®è¡Œï¼Œé¡¹ç›®ä¹Ÿè¢«é‡æ–°å‘½åä¸ºmBridgeï¼Œä¹Ÿå°±æ˜¯ç°åœ¨ç†ŸçŸ¥çš„å¤šè¾¹å¤®è¡Œæ•°å­—è´§å¸æ¡¥é¡¹ç›®ã€‚</p><span id="more"></span><ol><li><p>äºŒé˜¶æ®µç”±ConsenSyså…¬å¸æä¾›æŠ€æœ¯æ”¯æŒï¼ŒåŒºå—é“¾æŠ€æœ¯é€‰å‹é€‰æ‹©äº†ä¼ä¸šçº§ä»¥å¤ªåŠçš„Javaå®ç°å®¢æˆ·ç«¯<a href="https://besu.hyperledger.org/">Hyperledger Besu</a>ã€‚å®˜æ–¹çš„è¯´æ³•æ˜¯<code>Hyperledger Besu was chosen, in order to assess how an Ethereum-inspired architecture could support the objectives of a single ledger multi-currency network. Features of Hyperledger Besu that were considered include privacy, flexible choice of the consensus mechanism, and support from the Hyperledger ecosystem and community</code>ã€‚ç›¸æ¯”ä¸€é˜¶æ®µçš„R3 cordaï¼Œå•é“¾çš„æ¶æ„ä½¿æ¶‰åŠå¤šå¸ç§çš„FXç­‰äº¤æ˜“çš„åŸå­æ€§æ›´å®¹æ˜“å®ç°ï¼Œè¿™ä¸€åˆ‡éƒ½é€šè¿‡é“¾ä¸Šæ™ºèƒ½åˆçº¦æ¥ä¿è¯ï¼Œä¸å†éœ€è¦ç±»ä¼¼äºå“ˆå¸Œæ—¶é—´é”ç­‰è·¨é“¾æŠ€æœ¯æ¥ä¿è¯ï¼Œç®€åŒ–æŠ€æœ¯æ¶æ„ï¼Œä»è€Œå‡å°‘åˆ†å¸ƒå¼äº‹åŠ¡çš„æ½œåœ¨é£é™©ã€‚ä½†åŒæ—¶ç”±äºæ˜¯å•é“¾ï¼Œæ‰€æœ‰å‚ä¸æ–¹çš„äº¤æ˜“æ•°æ®éƒ½åœ¨é“¾ä¸Šï¼Œå› æ­¤å¯¹äºé“¾ä¸Šæ•°æ®éšç§ä¿æŠ¤çš„è¦æ±‚æ›´é«˜ã€‚æ‰€ä»¥å¼•å…¥äº†<a href="https://github.com/Consensys/orion">Orion transaction manager</a> (<code>The nodes maintain the public state for blockchain and a corresponding private state for each privacy group.</code> åç»­å‡çº§åˆ°<code>TESSERA</code>é¡¹ç›®)ï¼Œéšç§æ•°æ®åŠ å¯†ç­¾åååœ¨orionç½‘ç»œpeer-to-peerä¼ è¾“ï¼Œäº¤æ˜“å“ˆå¸Œä¸Šé“¾ï¼›å¼•å…¥privacy groupï¼Œæ•°æ®åˆ†ç»„å¯è§ã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">There are three types of privacy groups:</span><br><span class="line">1. Public: main group for all members,</span><br><span class="line">2. Private: between central bank and each commercial bank, and</span><br><span class="line">3. Bilateral: peer-to-peer between commercial banks with the central bank as needed.</span><br></pre></td></tr></tbody></table></figure></li><li><p>è§’è‰²æƒé™ç­‰çº§ã€‚å¤®è¡Œæ˜¯éªŒè¯èŠ‚ç‚¹ï¼Œå‚ä¸å…±è¯†å‡ºå—ï¼Œå…±è¯†ç®—æ³•å¯æ’æ¿ï¼›å•†è¡Œ/å¤–æ±‡äº¤æ˜“ä¸­å¿ƒæ˜¯æ™®é€šèŠ‚ç‚¹ï¼ŒåªåŒæ­¥æ•°æ®ä¸å‚ä¸å…±è¯†ï¼Œæœ‰æäº¤äº¤æ˜“çš„æƒé™ã€‚è¿˜æœ‰ä¸€ç±»æƒé™æ˜¯åªæœ‰æŸ¥çœ‹äº¤æ˜“çš„æƒé™ï¼Œç±»ä¼¼äºåªè¯»ï¼Œé€šå¸¸æ˜¯é‡‘èç§‘æŠ€å…¬å¸ç­‰ã€‚å¤®è¡Œå¯ä»¥çœ‹åˆ°å…¶å‘è¡Œå¸ç§çš„æ‰€æœ‰äº¤æ˜“ï¼ŒåŒ…æ‹¬åœ¨å²¸å’Œç¦»å²¸çš„äº¤æ˜“ï¼›è€Œå…¶ä»–è§’è‰²åªèƒ½çœ‹åˆ°è·Ÿå…¶è‡ªèº«ç›¸å…³çš„äº¤æ˜“ã€‚å¦å¤–ï¼Œåªæœ‰å¤®è¡ŒèŠ‚ç‚¹æ‰æœ‰å‘è¡Œå’Œæ³¨é”€å…¶ç®¡è¾–å¸ç§çš„æƒé™ã€‚è¿™ä¸ªçš„æƒé™æ§åˆ¶æ˜¯åœ¨åŒºå—é“¾æœ¬èº«å®ç°çš„ï¼Œè€Œä¸æ˜¯å¤–å±‚çš„åç«¯åº”ç”¨ç­‰ã€‚è¿™é‡Œæ¶‰åŠä¸¤ç»„æ¦‚å¿µï¼Œå…±è¯†ï¼ŒéªŒè¯å‡ºå—ï¼Œè¿™ä¸ªæ˜¯åŒºå—é“¾å…±è¯†èŠ‚ç‚¹çš„èº«ä»½ï¼ŒåæŠ€æœ¯å±‚é¢ï¼›äº¤æ˜“å¯è§æ€§ï¼Œå‘è¡Œ/æ³¨é”€ï¼Œè¿™ä¸ªæ˜¯å¤®è¡Œè§’è‰²èº«ä»½ï¼Œåä¸šåŠ¡å±‚é¢ï¼Œä¾‹å¦‚å¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦æ¥æ§åˆ¶ï¼›ä¸¤è€…å¹¶ä¸å®Œå…¨é‡åˆï¼Œä½†ç°åœ¨æ–¹æ¡ˆé‡Œç»Ÿä¸€ã€‚æœ¬å®éªŒä¸­æ˜¯å¦‚ä½•å°†è¿™ä¸¤è€…æœ‰æœºæ•´åˆçš„ï¼Œæ²¡æœ‰çœ‹åˆ°è¯¦ç»†ä»‹ç»ï¼Œè¿˜æœ‰å¾…ç ”ç©¶ã€‚</p></li><li><p>Tokenåˆçº¦ä½¿ç”¨äº†ConsenSyså…¬å¸çš„<a href="https://github.com/Consensys/UniversalToken">Universal Token</a>æ ‡å‡†ï¼Œæ‰©å±•äº†ERC-20å’ŒERC-1400ï¼ˆå¢å¼ºäº†åˆè§„ç®¡ç†ï¼Œå—æ§çš„å¼ºåˆ¶æ”¯ä»˜ç­‰åŠŸèƒ½ï¼‰ï¼Œè¿™äº›æ˜¯Ethereumé¢†åŸŸé‡Œæœ€æ™®éçš„åˆçº¦è§„èŒƒï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒäº†ç°åœ¨çœŸå®ä¸–ç•Œçš„é‡‘èåœºæ™¯ã€‚</p></li><li><p>LSMæœºåˆ¶ã€‚<code>The IL2 prototype uses the hybrid model, developed to support bilateral and multilateral net settlements in centralized queues. Each central bank is responsible for facilitating the LSM within their own currenc.</code>ã€‚æ˜ç¡®äº†æµåŠ¨æ€§èŠ‚çº¦æœºåˆ¶æ˜¯åœ¨å¤®è¡Œçš„ä¸­å¿ƒåŒ–çš„é˜Ÿåˆ—é‡Œå®ç°çš„ã€‚ç›®å‰åªæ˜¯å„å¤®è¡Œå•ç‹¬è§£å†³å…¶å‘è¡Œå¸ç§çš„æµåŠ¨æ€§é—®é¢˜ï¼Œç¼ºä¹å¤šä¸ªå¸ç§é—´çš„æœ€ä¼˜åŒ–è§£å†³ã€‚å¦å¤–åœ¨é“¾ä¸Šæƒ³è¦é€šè¿‡æ™ºèƒ½åˆçº¦å®ç°LSMæœºåˆ¶ï¼Œæ—¢è¦å®ç°å¤æ‚çš„æœºåˆ¶è¾¾åˆ°æœ€ä¼˜è§£ï¼Œåˆè¦ä¿è¯æ•°æ®éšç§ï¼Œç›®å‰æ¥è¯´éš¾åº¦è¿˜æ˜¯å¾ˆå¤§çš„ã€‚<code>The central bank will periodically and automatically initiate the LSM process</code>:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The process contains four stages:</span><br><span class="line">1. Detect: The central bank asks banks to send in their pending transactions and balances for LSM planning calculations.</span><br><span class="line">2. Plan: After receiving the pending transactions and balances from the banks, the central node will calculate which transactions can be netted.</span><br><span class="line">3. Propose: With the results from the planning stage, the central bank will </span><br><span class="line">    - Send instructions of netted positions to resolve the cyclical gridlock, or </span><br><span class="line">    - Will inject liquidity in the situation of a transaction deadlock. </span><br><span class="line">4. Execute: Banks then execute the transfers.</span><br></pre></td></tr></tbody></table></figure><p>å¤®è¡Œçš„gridlockè§£å†³æ–¹æ¡ˆæ˜¯æ’ä»¶å¼çš„ï¼Œæ”¯æŒå¯æ’æ‹”ï¼Œæ–¹ä¾¿å„ä¸ªå¤®è¡Œè‡ªå·±å®šåˆ¶å¼€å‘ã€‚</p></li><li><p>æœ€åä¹Ÿæåˆ°äº†ç›®å‰çš„å‡ ä¸ªä¸è¶³å’Œç¼ºé™·</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. éšç§ï¼šIn particular, the reliance on Privacy Groups to preserve privacy across multiple jurisdictions does not allow for fully atomic PvP transactions. </span><br><span class="line">2. LSMæœºåˆ¶ï¼šIn addition, since there is no single entity or jurisdiction that can view the balance of all pending FX transactions; an optimal liquidity savings mechanism has yet to be found. </span><br><span class="line">3. æ€§èƒ½ï¼šLastly, the scalability and performance of DLT in handling large transaction volumes will need to be assessed further if more jurisdictions or currencies are added onto the platform. </span><br><span class="line">4. é£æ§ï¼šDetailed risk governance procedures will also need to be created.</span><br></pre></td></tr></tbody></table></figure></li></ol><h4 id="Ref"><a href="#Ref" class="headerlink" title="Ref."></a>Ref.</h4><blockquote><ol><li><a href="https://besu.hyperledger.org/private-networks/concepts/privacy/private-transactions/processing">Besu - Private transaction processing</a></li><li><a href="https://blog.geveo.com/Consensus-Quorum">Hyperledger Besu vs Go-Quorum</a></li><li><a href="https://blockgeeks.com/guides/quorum-a-blockchain-platform-for-the-enterprise/">What Is Quorum Blockchain? A Platform for The Enterprise</a></li><li><a href="https://zhuanlan.zhihu.com/p/179260785?utm_id=0">æ·±åº¦è§£æä¼ä¸šçº§åŒºå—é“¾è§£å†³æ–¹æ¡ˆ-Quorum</a></li></ol></blockquote><div style="width:75%;margin:auto">    <img src="/images/besu-flow.jpg">    <div style="text-align: center">å›¾1 Besuç§æœ‰äº¤æ˜“å¤„ç†æµç¨‹</div></div><ol><li>Submit a private transaction using eea_sendRawTransaction. The signed transaction includes transaction parameters specific to private transactions, including:<ul><li><code>privateFor</code> or <code>privacyGroupId</code>, which specifies the list of recipients.</li><li><code>privateFrom</code>, which specifies the sender.</li><li><code>restriction</code>, which specifies the transaction is restricted to the transaction participants.</li></ul></li><li>The JSON-RPC endpoint passes the private transaction to the Private Transaction Handler.</li><li>The Private Transaction Handler sends the private transaction to Tessera.</li><li>Tessera distributes the private transaction directly (that is, point-to-point) to the Tessera nodes specified in privateFor or belonging to the privacy group identified by privacyGroupId. All recipient Tessera nodes store the transaction. Tessera associates the stored transaction with the transaction hash and privacy group ID.</li><li>Tessera returns the transaction hash to the Private Transaction Handler.</li><li>The Private Transaction Handler creates a PMT for the private transaction. The Private Transaction Handler propagates the PMT using devP2P in the same way as any other public Ethereum transaction.</li><li>Besu mines the PMT into a block and the PMT is distributed to all Ethereum nodes in the network.</li><li>The Mainnet Transaction Processor processes the PMT in the same way as any other public transaction. On nodes containing the privacy precompile contract specified in the to attribute of the PMT, the Mainnet Transaction Processor passes the PMT to the privacy precompile contract.</li><li>The privacy precompile contract queries Tessera for the private transaction and privacy group ID using the transaction hash.</li><li>The privacy precompile contract passes the private transaction to the Private Transaction Processor. The privacy group ID specifies the private world state to use.</li><li>The Private Transaction Processor executes the transaction. The Private Transaction Processor can read and write to the private world state, and read from the public world state.</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> CBDC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CBDCç³»åˆ—ï¼ˆ4ï¼‰ - Inthonan-LionRocké¡¹ç›®é˜¶æ®µ I (æ‰¹å‘å‹CBDCè·¨å¢ƒæ”¯ä»˜å®éªŒé¡¹ç›®)</title>
      <link href="//articles/inthanon-lionrock-phase-1/"/>
      <url>//articles/inthanon-lionrock-phase-1/</url>
      
        <content type="html"><![CDATA[<p>Inthonan-LionRocké¡¹ç›®æ˜¯å¤šè¾¹å¤®è¡Œæ•°å­—è´§å¸æ¡¥é¡¹ç›®mBridgeçš„å‰èº«ï¼Œç”±BISé¦™æ¸¯åˆ›æ–°ä¸­å¿ƒï¼Œæ³°å›½å¤®è¡Œ(BOT)ï¼Œé¦™æ¸¯é‡‘ç®¡å±€(HKMA)åˆä½œå®éªŒé¡¹ç›®ï¼Œæ„åœ¨ç ”ç©¶æ‰¹å‘å‹CBDCåœ¨è·¨å¢ƒç»“ç®—ä¸­å‘æŒ¥çš„ä½œç”¨ã€‚Inthonan-LionRocké¡¹ç›®é˜¶æ®µä¸€æ—©åœ¨2019å¹´9æœˆå¯åŠ¨ï¼Œ2020å¹´1æœˆå®£å¸ƒç»“æŸï¼Œå¹¶ä¸”å‘å¸ƒäº†é¡¹ç›®çš„ç ”ç©¶æŠ¥å‘Šã€‚æœ¬åˆ†æå®Œå…¨åŸºäºBISå®˜ç½‘å…¬å¼€çš„é¡¹ç›®ç ”ç©¶æŠ¥å‘Š<a href="https://www.bis.org/publ/othp40.pdf">Inthanon-LionRock : Leveraging Distributed Ledger Technology to Increase Efficiency in Cross-Border Payments</a>ã€‚è™½ç„¶é¡¹ç›®æ—¶é—´è¾ƒä¸ºä¹…è¿œï¼Œä½†ä»æœ‰å‚è€ƒå­¦ä¹ æ„ä¹‰ã€‚</p><span id="more"></span><p>è¯¥é¡¹ç›®çš„æŠ€æœ¯å¹³å°ä¹Ÿæ˜¯é€‰æ‹©R3çš„Cordaï¼Œå› æ­¤ä¸€äº›æ–¹æ¡ˆè®¾è®¡ä¸å‰æ–‡ä»‹ç»çš„<a href="https://simplexity.cn/articles/jura-project/">Juraé¡¹ç›®</a>ç±»ä¼¼ï¼Œè€Œå®é™…ä¸Šæœ¬é¡¹ç›®è¿˜æ›´æ—©ã€‚</p><div style="width:70%;margin:auto">    <img src="/images/inthanon-lionrock-phase-1/topology.png">    <div style="text-align: center">å›¾1 æ‹“æ‰‘</div></div><hr><div style="width:70%;margin:auto">    <img src="/images/inthanon-lionrock-phase-1/case-study-model.png">    <div style="text-align: center">å›¾2 åœºæ™¯æ¡ˆä¾‹</div></div><ol><li>ä¸‰ä¸ªæŠ€æœ¯åŒæ„ï¼Œç›¸äº’éš”ç¦»å’Œç‹¬ç«‹è¿è¥çš„ç½‘ç»œã€‚å„ä¸ªç®¡è¾–åŒºæœ‰å„è‡ªçš„ç½‘ç»œï¼ˆInthanon network and LionRock networkï¼‰ï¼Œç”¨äºæœ¬å¸CBDCï¼ˆå³W-CBDCï¼‰çš„å‘è¡Œï¼Œæ³¨é”€ï¼Œä»…é™æœ¬å¸ç®¡è¾–åŒºå†…çš„é“¶è¡Œå€Ÿå…¥ã€‚â€œcorridor networkâ€ä¸“ç”¨äºè·¨å¢ƒç»“ç®—ï¼Œä½¿ç”¨ç‰¹å®šçš„token(DR, Depository Receipt)åšä»·å€¼è½¬ç§»ã€‚è¿è¡Œåœ¨corridorçš„â€œoperator nodeâ€æ˜¯ç”±BOTå’ŒHKMAè”åˆå…±åŒç®¡ç†ï¼ˆå…·ä½“åŸå› ä¸æ˜ï¼Œè€Œä¸”å¦‚ä½•åšæ“ä½œéš”ç¦»å’Œæ²»ç†ä¹Ÿæ²¡æœ‰çœ‹åˆ°æ›´å…·ä½“çš„è¯´æ˜ï¼‰ï¼Œè´Ÿè´£å‘è¡Œæ³¨é”€DR-THBå’ŒDR-HKDï¼›æä¾›æ¸…ç»“ç®—çš„æµåŠ¨æ€§èŠ‚çº¦è§£å†³æ–¹æ¡ˆï¼Œæ­»é”é—®é¢˜è§£å†³æ–¹æ¡ˆï¼›ä»¥åŠåˆè§„ç›‘ç£ã€‚å‚ä¸é“¶è¡Œåœ¨æœ¬åœ°ç½‘ç»œåŠcorridorä¸Šéƒ½æœ‰ç‹¬ç«‹éš”ç¦»èŠ‚ç‚¹ï¼Œå¯ä»¥å‘èµ·æ”¯ä»˜ï¼Œä»¥åŠç®¡ç†å„è‡ªçš„æœ¬å¸å’Œå¤–å¸çš„æµåŠ¨æ€§ã€‚</li><li>Corridoréœ€è¦ä»¥ä¸‹æœåŠ¡ã€‚W-CBDCå’ŒDR-CBDCé—´çš„å…‘æ¢ï¼›åˆè§„ç›‘ç®¡ï¼›æµåŠ¨æ€§è¡¥å……ï¼›FX board rateçš„å¹¿æ’­ã€‚å¯ä»¥ç”±å¤®è¡Œä»¥å¤–çš„è§’è‰²æä¾›ï¼ˆä¾‹å¦‚FX board rateçš„å¹¿æ’­é€šå¸¸ç”±å¤–æ±‡äº¤æ˜“æ‰€æä¾›ï¼‰ã€‚</li><li>é¡¹ç›®åŠ å…¥äº†æµåŠ¨æ€§ç®¡ç†ï¼ŒåŒ…æ‹¬æ’é˜Ÿæœºåˆ¶ï¼ˆå•†è¡ŒæµåŠ¨ä¸è¶³ï¼Œå…¶å‘èµ·äº¤æ˜“æŒ‰ç…§ä¼˜å…ˆçº§æ’é˜Ÿï¼‰ï¼Œå¤šå¸ç§æµåŠ¨æ€§èŠ‚çº¦æœºåˆ¶ï¼ˆé’ˆå¯¹gridlockåœºæ™¯ä½œå‘¨æœŸæ€§çš„è§¦å‘å‡€é¢ç»“ç®—ï¼ŒåŒ…æ‹¬å•å‘æ”¯ä»˜å’ŒFXï¼‰ï¼Œå³æ—¶æµåŠ¨æ€§è¡¥å……ï¼ˆå‡ºç°deadlockæƒ…å†µï¼Œåªèƒ½é€šè¿‡æµåŠ¨æ€§è¡¥å……çš„æ–¹å¼ã€‚æœ¬å¸æµåŠ¨æ€§å¯ä»¥é€šè¿‡æœ¬å¸ç½‘ç»œå…‘æ¢ï¼Œå¤–å¸åˆ™éœ€è¦é€šè¿‡å‘å¤–å¸æµåŠ¨æ€§æä¾›æ–¹å€Ÿå…¥å¤–å¸ï¼Œç„¶åå¿…é¡»åœ¨å½“å¤©æ—¥åˆ‡å‰å…¨é¢è¿˜æ¬¾ï¼‰ã€‚åœ¨corridorç½‘ç»œä¸Šæœ‰ä¸€ä¸ªå¤–å¸æµåŠ¨æ€§æä¾›æ–¹çš„è§’è‰²ï¼ŒæŠ€æœ¯ä¸Šæ˜¯å¯æ’æ‹”çš„æ¥å£æ–¹å¼å®ç°ï¼Œå…·ä½“ç”±å“ªä¸ªå®ä½“æ‹…ä»»å¹¶æ²¡æœ‰é™å®šå’Œè¯´æ˜ã€‚</li><li>ä¸Juraç±»ä¼¼ï¼Œå¤®è¡Œæ‰®æ¼”äº†æœ¬å¸ç½‘ç»œå’Œcorridorç½‘ç»œçš„ç½‘å…³è§’è‰²å®ç°äº’æ“ä½œï¼Œè´Ÿè´£W-CBDCå’ŒDR-CBDCçš„å…‘æ¢ã€‚è¿™é‡Œå‡è®¾å¤®è¡Œé—´æ˜¯äº’ä¿¡çš„ã€‚</li><li>FXã€‚æ”¯æŒBoard Rate, Request for Quote(RFQ), Off-Corridor Arrangementä¸‰ç§æ–¹å¼ã€‚</li><li>éšç§ã€‚äº¤æ˜“æŒ‰ç…§need-to-knowçš„å‡†åˆ™ä½œå¹¿æ’­ï¼›åœ¨æµåŠ¨æ€§èŠ‚çº¦æœºåˆ¶å†…ï¼ˆå¤šæ–¹äº¤æ˜“å‚ä¸ï¼‰ä½¿ç”¨éšç§èº«ä»½ä¿è¯åŒ¿åã€‚åœ¨Board Rateæ–¹å¼ä¸­ï¼Œç”±operatoræœé›†makersçš„ç«ä»·ï¼Œå±…ä¸­æ’®åˆäº¤æ˜“ã€‚takerç›´æ¥å’Œæœ€ç»ˆçš„makerè¿›è¡Œç‚¹å¯¹ç‚¹çš„åŒè¾¹äº¤æ˜“ï¼ŒåŒæ—¶ä¸çŸ¥é“å…¶ä»–makerçš„ä¿¡æ¯ã€‚</li><li>åˆè§„ç›‘ç®¡ã€‚æ‰€æœ‰äº¤æ˜“éƒ½å®æ—¶çš„ä¸ŠæŠ¥ï¼ˆéœ€è¦notaryèŠ‚ç‚¹è§è¯ï¼‰ï¼Œç›‘ç®¡å¯¹è±¡åŒ…æ‹¬äº†äº¤æ˜“æœ¬èº«ï¼Œé“¶è¡ŒæŒæœ‰CBDCçš„æ•°é‡ï¼ŒæŒæœ‰å‘¨æœŸç­‰ã€‚ç‰¹åˆ«æ˜¯é’ˆå¯¹æœ¬è¾–åŒºå¤–çš„æœ¬å¸æµé€šæœ‰äº†æ›´å¤šçš„ç›‘ç®¡å’Œæ§åˆ¶æ‰‹æ®µï¼Œé™ä½å¢ƒå¤–æµé€šå¯¹æœ¬å¸å¤®è¡ŒèŒèƒ½çš„å†²å‡»ã€‚</li></ol><div style="width:70%;margin:auto">    <img src="/images/inthanon-lionrock-phase-1/technical-design.png">    <div style="text-align: center">å›¾3 æŠ€æœ¯ä½“ç³»æ¶æ„</div></div><ol><li>ä»æŠ€æœ¯ä½“ç³»æ¶æ„çœ‹ï¼ŒMulti-asset Liquidity Saving Mechanism (MLSM)æµåŠ¨æ€§èŠ‚çº¦åŠŸèƒ½æ˜¯ä»¥æ’ä»¶çš„å½¢å¼è€Œå¹¶éæ™ºèƒ½åˆçº¦çš„æ–¹å¼å®ç°ï¼Œæ¨æµ‹è¿™å—æ˜¯åœ¨å¤®è¡ŒèŠ‚ç‚¹çš„åå°æœåŠ¡å®ç°ï¼ˆå› ä¸ºäº¤æ˜“ä¿¡æ¯éƒ½éœ€è¦ç»è¿‡å¤®è¡Œï¼Œåªæœ‰å¤®è¡Œæ‰æœ‰å…¨å±€çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥èŠ‚ç‚¹æ˜¯å…±åŒæ²»ç†çš„ï¼‰ã€‚æ²¡æœ‰ä½¿ç”¨æ™ºèƒ½åˆçº¦å®ç°ï¼Œä¸€ä¸ªå¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªæœºåˆ¶æ¯”è¾ƒå¤æ‚ï¼Œåœ¨é“¾ä¸Šä½¿ç”¨æ™ºèƒ½åˆçº¦æ•ˆç‡ä¸é«˜ï¼›äºŒæ˜¯è¦è¯†åˆ«äº¤æ˜“åŒæ–¹èº«ä»½ï¼ŒåŒæ—¶åˆéœ€è¦åœ¨é“¾ä¸Šä¿è¯éšç§æ€§ï¼Œè¿™ä¸ªä¸€å®šç¨‹åº¦ä¸Šæ˜¯çŸ›ç›¾çš„ã€‚</li><li>å¯ä»¥å…è®¸é™¤å¤®è¡Œå’Œå•†è¡Œå¤–çš„å®ä½“åŠ å…¥corridorã€‚ä¾‹å¦‚FX board rateçš„å¹¿æ’­æœåŠ¡ï¼Œç”±å¤–æ±‡äº¤æ˜“æ‰€æä¾›çš„è¯ï¼Œå¯ä»¥é€šè¿‡åŒæ ·cordaèŠ‚ç‚¹æ¥å…¥çš„æ–¹å¼ã€‚åŒæ—¶è¿˜æœ‰å¤–å¸æµåŠ¨æ€§æä¾›æ–¹ã€‚</li><li>æ’é˜Ÿæœºåˆ¶ã€‚ä¸ç¡®å®šæ˜¯å¦åœ¨å•†è¡Œæ’é˜Ÿï¼Œä½†ä»å‡€é¢ç»“ç®—çš„è§’åº¦çœ‹ï¼Œåœ¨å•†è¡Œæ’é˜Ÿæ— æ³•é€šè¿‡MLSMçš„æ–¹å¼è§£å†³ã€‚è‹¥åœ¨å•†è¡Œæ’é˜Ÿï¼ˆäº¤æ˜“æœªæ›¾å‘å‡ºï¼Œå¤®è¡Œç«¯/æ¸…ç»“ç®—ç»„ç»‡æ— ä»çŸ¥æ™“ï¼‰ï¼Œåˆ™åªèƒ½é è‡ªèº«è¡¥å……æµåŠ¨æ€§ï¼ˆå¯ä»¥æ˜¯å…‘æ¢æœ¬å¸W-CBDCï¼Œå€Ÿå…¥å¤–å¸ï¼Œæ”¶åˆ°å…¶ä»–å•†è¡Œä»˜æ¬¾ç­‰æ–¹å¼ï¼‰æ¥è§£ä»˜ã€‚</li></ol><h5 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h5><blockquote><ol><li>Gridlock : a situation where two or more queued transactions are resolvable with one or more net payments.</li></ol></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> CBDC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CBDCç³»åˆ—ï¼ˆ3ï¼‰ - Juraé¡¹ç›®(æ‰¹å‘å‹CBDCè·¨å¢ƒæ”¯ä»˜å®éªŒé¡¹ç›®)</title>
      <link href="//articles/jura-project/"/>
      <url>//articles/jura-project/</url>
      
        <content type="html"><![CDATA[<p>Juraé¡¹ç›®æ˜¯BISåˆ›æ–°ä¸­å¿ƒï¼ŒBank of Franceï¼ŒSwiss National Bankåœ¨2021å¹´åˆä½œå®éªŒé¡¹ç›®ï¼Œæ„åœ¨ç ”ç©¶æ‰¹å‘å‹CBDCåœ¨è·¨å¢ƒç»“ç®—ä¸­å‘æŒ¥çš„ä½œç”¨ï¼Œå¹¶åœ¨åŒå¹´12æœˆå…¬å¼€å‘å¸ƒç ”ç©¶æŠ¥å‘Šã€‚å…·ä½“å‚è§BISçš„é¡¹ç›®ä»‹ç»<a href="https://www.bis.org/publ/othp44.htm">Project Jura - Cross-border settlement using wholesale CBDC</a>ã€‚</p><div style="width:70%;margin:auto">    <img src="/images/jura-project/architecture.png">    <div style="text-align: center">å›¾1 æ‹“æ‰‘</div></div><p>é¡¹ç›®çš„ä¸»è¦æŠ€æœ¯æœåŠ¡å•†æ˜¯R3ï¼ŒæŠ€æœ¯æ¶æ„å°±é‡‡ç”¨äº†Cordaã€‚è¿™ä¸ªæ˜¯wholesale CBDCçš„åœºæ™¯ï¼ŒCordaçš„æ€§èƒ½å’Œè®¾è®¡ç†å¿µä¹Ÿç®—æ¯”è¾ƒå¥‘åˆã€‚</p><ol><li>èµ„äº§ä»£å¸åŒ–asset tokenizeã€‚å•†ä¸šç¥¨æ®Comercial Paperï¼ˆCPï¼‰ç”±DARç”Ÿæˆæ•°å­—èµ„äº§ï¼Œé€šè¿‡Gatewayï¼ˆä¹Ÿå°±æ˜¯å›¾ä¸­çš„NATIXISï¼‰mirroræ˜ å°„åˆ°å¹³å°ä¸Šï¼ŒåŒæ—¶èµ‹äºˆäº†æ‰€æœ‰è€…ç­‰å±æ€§ã€‚å¯¹åº”åˆ°Cordaé‡Œçš„æ¦‚å¿µï¼Œå°±æ˜¯stateï¼Œå¯å…³è”åˆ°å®é™…ç¯å¢ƒä¸­çš„èµ„äº§å’Œæ¡æ¬¾ç­‰ã€‚Cordaçš„è¿™ç§è®¾è®¡ï¼Œå°†wCBDCå’ŒCPåœ¨æŠ€æœ¯é€»è¾‘ä¸Šä¸€è‡´ï¼Œä½¿å¾—è¿™ä¸ªSDXæµ‹è¯•å¹³å°å¯ä»¥ç”¨ç›¸ä¼¼çš„é€»è¾‘å»æ”¯æŒPvPå’ŒDvPäº¤æ˜“ã€‚</li><li>å‘è¡Œ/èµå›ã€‚SDXå¹³å°æœ‰å‡ ç±»èŠ‚ç‚¹ï¼ŒNotary node, Issuer node, Monitor/Observer nodeç›‘ç®¡èŠ‚ç‚¹, Bank nodeã€‚å…¶ä¸­ï¼ŒIssuer nodeè·ŸRTGSå®Œæˆä¼ ç»Ÿè´¦æˆ·ä½“ç³»çš„å…‘æ¢ã€‚åœ¨ç™½çš®ä¹¦é‡Œæåˆ° â€œIn Project Jura, EUR and CHF wCBDC and the NEU CP token on the SDX test platform had no legal force, meaning that the wCBDCs did not represent a direct central bank liability.â€ è¿™ç‚¹æ„Ÿè§‰æ›´å¤šçš„æ˜¯å¼ºè°ƒ<strong>éç›´æ¥å¤®è¡Œè´Ÿå€º</strong>ï¼Œå®é™…ä¸Šæ˜¯æ˜ç¡®äº†issuerå±…ä¸­è½¬æ¢çš„å¿…è¦åœ°ä½ã€‚</li><li>ä¸åŒçš„èµ„äº§ç±»å‹é€šå¸¸å±äºå¸æ³•ç®¡è¾–åŒºï¼Œç”±ä¸åŒçš„notaryå…¬è¯äººèŠ‚ç‚¹ï¼Œé€šå¸¸ç”±è¯¥èµ„äº§ç®¡ç†å‘˜è§’è‰²æ¥æ‰¿æ‹…ï¼Œä¾‹å¦‚å•†è¡Œï¼Œæˆ–è€…æˆæƒçš„ç®¡ç†è€…ã€‚ç”±äºCordaçš„æ— éœ€å…¨å±€å¹¿æ’­å…±è¯†çš„è®¾è®¡ï¼Œå› æ­¤å•ä¸ªç§ç±»èµ„äº§çš„äº¤æ˜“æƒ…å†µï¼Œåªéœ€è¦è¯¥èµ„äº§çš„notaryè¿›è¡Œç­¾ç½²ï¼Œä¿è¯äº†è´¦æœ¬æˆ–è€…èµ„äº§ç®¡è¾–çš„ç‹¬ç«‹æ€§éš”ç¦»æ€§ã€‚ç”±äºnotaryèŠ‚ç‚¹é€šå¸¸åªæ˜¯æŠ€æœ¯æ„ä¹‰ä¸Šçš„ï¼Œä¸æˆæƒæŸ¥çœ‹å…·ä½“çš„äº¤æ˜“å†…å®¹ï¼Œé€šå¸¸å¼•å…¥ç›‘ç®¡èŠ‚ç‚¹æ¥ç›‘æ§å…·ä½“çš„äº¤æ˜“ï¼ˆä¸€ç§åŠæ³•æ˜¯åªéœ€åœ¨äº¤æ˜“è§„åˆ™ä¸Šé…ç½®æœ‰æ•ˆçš„äº¤æ˜“éœ€è¦ç›‘ç®¡èŠ‚ç‚¹ç­¾åï¼‰ã€‚</li><li>å­ç½‘åˆ’åˆ†ã€‚å„ä¸ªå¤®è¡Œå¯ä»¥ç‹¬ç«‹åˆ’åˆ†å’Œç®¡ç†å­ç½‘ï¼Œå…è®¸å•†è¡ŒèŠ‚ç‚¹æ¥å…¥å­ç½‘è¿›è¡Œä¸šåŠ¡ï¼Œå®é™…ä¸Šå°±æ˜¯å®ç°äº†å¯¹å…¶ç®¡è¾–è´§å¸çš„å‡†å…¥æœºåˆ¶ï¼Œåªæœ‰æ¥å…¥è¯¥å­ç½‘çš„å•†è¡ŒèŠ‚ç‚¹æ‰èƒ½æ‰§è¡Œè¯¥ç§èµ„äº§çš„ä¸šåŠ¡ã€‚åœ¨æœ¬æ¬¡å®éªŒçš„æ‹“æ‰‘ä¸­ï¼Œé“¶è¡ŒèŠ‚ç‚¹æ˜¯ç‰©ç†ç½‘ç»œè”é€šçš„ï¼Œè¿™åœ¨å®é™…æƒ…å†µä¸­ç”±äºç½‘ç»œç­–ç•¥ç®¡æ§ï¼Œç‰¹åˆ«æ˜¯éšç€é“¶è¡Œå€Ÿç‚¹æ•°é‡å¢åŠ ï¼Œå¾€å¾€æ˜¯ä¸å¯å…¨è”é€šçš„ã€‚ä¸€ç§æ›¿ä»£æ–¹æ¡ˆæ˜¯å‚è€ƒDARçš„ç±»ä¼¼åšæ³•ï¼Œé€šè¿‡æ¯ä¸ªå¤®è¡Œå­ç½‘å¼•å…¥Operator Nodeï¼ˆå¯ä»¥æ˜¯é€»è¾‘çš„ï¼Œä¸å…¶ä»–è§’è‰²çš„nodeï¼Œä¾‹å¦‚Observer Nodeå…±ç”¨ï¼‰ä½œä¸ºGatewayï¼ŒåŒæ—¶ä¸åŒå­ç½‘Gatewaäº’è”ï¼Œæœ¬å›½çš„å•†è¡Œåªä¸æœ¬å›½çš„Gatewayè”é€šï¼ŒæŠŠå…¨ç½‘å˜æˆé›ªèŠ±æ‹“æ‰‘ç»“æ„ã€‚è·¨å¸æ³•é¢†åŸŸçš„ï¼Œä¾‹å¦‚å¤–å¸å…‘æ¢ç­‰ï¼Œå°±éœ€è¦é€šè¿‡Gatewayä¸ä»–å›½å•†è¡Œäº¤äº’ï¼Œè¿™ç§è·¯ç”±æ–¹å¼å¯ä»¥ç”±å…¨å±€çš„ç½‘ç»œåœ°å›¾æœåŠ¡æä¾›ã€‚è¿™ç§æ–¹å¼ï¼Œä½¿å¾—æ¯ç¬”äº¤æ˜“éƒ½ç»è¿‡äº†äº¤æ˜“åŒæ–¹å¤®è¡ŒåŠäº¤æ˜“è´§å¸å¯¹çš„æ‰€å±å¤®è¡Œï¼Œæ»¡è¶³ç›‘ç®¡éœ€è¦ã€‚</li><li>DvP,PvPçš„äº¤æ˜“ï¼Œæ¶‰åŠä¸¤ç§èµ„äº§åœ¨ä¸¤ä¸ªå­ç½‘çš„å¤„ç½®ï¼Œéœ€è¦ä¸¤ç§èµ„äº§çš„notaryçš„ç­¾åèµ‹äºˆæœ‰æ•ˆæ€§ã€‚ä¸ºä¿è¯äº¤æ˜“çš„åŸå­æ€§ï¼Œå¼•å…¥äº†R3çš„dual-notary signingæœºåˆ¶ï¼Œå³å“ˆå¸Œæ—¶é—´é”ç®—æ³•ï¼ˆåœ¨å‰é¢çš„bitcoiné—ªç”µç½‘ç»œéƒ¨åˆ†æœ‰ä»‹ç»è¿‡ï¼‰ï¼Œå¸¸ç”¨çš„è·¨é“¾æ–¹æ¡ˆã€‚å…·ä½“å‚çœ‹<a href="https://www.bis.org/publ/othp44.pdf">Juraé¡¹ç›®ç™½çš®ä¹¦</a>é™„å½•éƒ¨åˆ†ã€‚</li></ol><div style="width:50%;margin:auto">    <img src="/images/jura-project/dual-notary-1.png"></div><div style="width:50%;margin:auto">    <img src="/images/jura-project/dual-notary-2.png">    <div style="text-align: center">å›¾2 dual-notary signingæœºåˆ¶</div></div>]]></content>
      
      
      
        <tags>
            
            <tag> CBDC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R3 Cordaæ¦‚å¿µç†è§£</title>
      <link href="//articles/understanding-corda/"/>
      <url>//articles/understanding-corda/</url>
      
        <content type="html"><![CDATA[<h3 id="Cordaçš„è®¾è®¡ç†å¿µ"><a href="#Cordaçš„è®¾è®¡ç†å¿µ" class="headerlink" title="Cordaçš„è®¾è®¡ç†å¿µ"></a>Cordaçš„è®¾è®¡ç†å¿µ</h3><blockquote><p><a href="https://www.finyear.com/R3-Corda-A-Distributed-Ledger-Designed-for-Financial-Services_a35855.html">R3 Corda: A Distributed Ledger Designed for Financial Services</a> : R3 CTOåœ¨2016å¹´è®¾è®¡ä¹‹åˆåˆ†äº«çš„è®¾è®¡ç†å¿µåŠå¿ƒè·¯å†ç¨‹</p></blockquote><ol><li>ä¸“é—¨é’ˆå¯¹é‡‘èåœºæ™¯å¼€å‘ï¼Œè€Œéé€šç”¨åŒºå—é“¾ã€‚å—åŒºå—é“¾æ€æƒ³çš„å½±å“ï¼Œåœ¨å¾ˆå¤šè®¾è®¡ç†å¿µä¸Šè€ƒè™‘äº†å½“å‰é‡‘èé¢†åŸŸçš„ç‰¹ç‚¹å’Œç»å…¸åœºæ™¯ã€‚<ul><li>äº¤æ˜“ä¸å†å…¨å±€å¹¿æ’­ï¼Œåªåœ¨ç›¸å…³æ–¹å¯è§ï¼›</li><li>å¼•å…¥å¯ä¿¡å…¬è¯äººæœºåˆ¶ï¼›</li><li>æ²¡æœ‰ç»å…¸çš„åŒºå—&amp;å…¨å±€ä¸€æ¡é“¾çš„è®¾è®¡ç­‰ç­‰ï¼›</li></ul></li><li>å€Ÿé‰´äº†åŒºå—é“¾ç»å…¸æ€æƒ³ï¼Œå›å½’åˆ°æœ¬è´¨ï¼šå…±è¯†ï¼Œæœ‰æ•ˆæ€§ï¼Œå”¯ä¸€æ€§ï¼Œä¸å¯ç¯¡æ”¹æ€§ï¼Œå¯éªŒè¯æ€§ã€‚<ul><li>ä½¿ç”¨å…¬è¯äººæœºåˆ¶é˜²æ­¢åŒèŠ±ï¼›</li><li>UTXOæ¨¡å‹ï¼Œä»å•çº¯çš„èµ„äº§æ‰©å±•åˆ°çŠ¶æ€ï¼›</li><li>ç­¾åæ”¾ç¯¡æ”¹æŠµèµ–ï¼›</li></ul></li></ol><p><em>æ— é“¾ä¹‹é“¾ï¼Œéé“¾ä¹‹é“¾</em>ã€‚æ›´æ°å½“åº”è¯¥å«åˆ†å¸ƒå¼è´¦æœ¬DLTã€‚åŸºäºé‡‘èé¢†åŸŸçœŸå®å­˜åœ¨çš„ä¸€äº›å‡è®¾å’Œå‰æï¼ˆä¾‹å¦‚å­˜åœ¨å¯ä¿¡å…¬è¯äººï¼‰ï¼Œæ›´åƒæ˜¯å€Ÿé‰´åŒºå—é“¾æ€æƒ³å»è§£å†³é‡‘èé¢†åŸŸçš„å®é™…é—®é¢˜ï¼Œæå‡æ•ˆç‡ã€‚</p><span id="more"></span><h3 id="Concept-amp-Model"><a href="#Concept-amp-Model" class="headerlink" title="Concept &amp; Model"></a>Concept &amp; Model</h3><h4 id="1-P2P-Network-Component"><a href="#1-P2P-Network-Component" class="headerlink" title="1. P2P Network Component"></a>1. P2P Network Component</h4><blockquote><p>â€¢ <strong><em>Nodes</em></strong>, communicating using AMQP/1.0 over TLS. Nodes use a relational database for data storage.<br>â€¢ A <strong><em>permissioning service</em></strong> that automates the process of provisioning TLS certificates.<br>â€¢ A <strong><em>network map service</em></strong> that publishes information about nodes on the network.<br>â€¢ One or more <strong><em>notary services</em></strong>. A notary may itself be distributed over multiple nodes.<br>â€¢ Zero or more <strong><em>oracle services</em></strong>. An oracle is a well known service that signs transactions if they state a fact and that fact is considered to be true. They may also optionally also provide the facts. This is how the ledger can be connected to the real world, despite being fully deterministic.</p></blockquote><ol><li><code>Network Map Service</code>ç½‘ç»œåœ°å›¾æœåŠ¡ï¼Œå‘å¸ƒæ¯ä¸ªèŠ‚ç‚¹çš„IPåœ°å€ï¼Œè¯ä¹¦åŠæä¾›æœåŠ¡æ¥å£ç­‰ã€‚èŠ‚ç‚¹å¯ä»¥è®¢é˜…ç½‘ç»œåœ°å›¾å˜æ›´äº‹ä»¶ï¼Œå¯åŠ¨æ—¶ä¸»åŠ¨æ³¨å†Œã€‚èŠ‚ç‚¹å¯ä»¥æœ¬åœ°ç¼“å­˜åœ°å›¾ï¼Œæ”¶åˆ°å…¶ä»–èŠ‚ç‚¹è¿æ¥æ—¶åŸºäºåœ°å›¾æ ¡éªŒä»¥åŠèº«ä»½ä½“ç³»æœåŠ¡ä½œæ ¡éªŒã€‚</li></ol><h4 id="2-Data-Model"><a href="#2-Data-Model" class="headerlink" title="2. Data Model"></a>2. Data Model</h4><blockquote><p>â€¢ <strong><em>State</em></strong> objects, representing an agreement between two or more parties, governed by machine-readable Contract Code. This code references, and is intended to implement, portions of human-readable Legal Prose.<br>â€¢ <strong><em>Transactions</em></strong>, which transition state objects through a lifecycle.<br>â€¢ A <strong><em>Flow</em></strong> Framework, which enables parties to coordinate actions without a central controller.</p></blockquote><ol><li>èŠ‚ç‚¹å­˜å‚¨çš„<code>State</code>å¯ä»¥æ˜¯ä»»æ„æ ¼å¼ï¼Œä¸é™å®šäºKVç»“æ„ã€‚ä¸°å¯Œäº†å…¶åœ¨é‡‘èé¢†åŸŸçš„å®é™…è¡¨è¾¾èƒ½åŠ›ï¼Œå¯ä»¥æ˜¯åŒ…å«çœŸå®çš„åˆåŒæ–‡ä»¶ç­‰ã€‚Cordaå…³æ³¨çš„æ˜¯çŠ¶æ€è½¬ç§»ï¼Œæ‰€ä»¥é™¤äº†æœ€å¼€å§‹çš„å‘è¡Œå¤–ï¼Œæ‰€æœ‰çš„åç»­çš„çŠ¶æ€è½¬ç§»éƒ½å¿…ç„¶æœ‰è¾“å…¥è¾“å‡ºã€‚</li></ol><h4 id="3-Transaction-Model"><a href="#3-Transaction-Model" class="headerlink" title="3. Transaction Model"></a>3. Transaction Model</h4><blockquote><p>â€¢ <strong><em>Input references</em></strong> : These are (hash, output index) pairs that point to the states a transaction is consuming.<br>â€¢ <strong><em>Output states</em></strong> : Each state specifies the notary for the new state, the contract(s) that define its allowed transition functions and finally the data itself.<br>â€¢ <strong><em>Attachments</em></strong> : Transactions specify an ordered list of zip file hashes. Each zip file may contain code, data, certificates or supporting documentation for the transaction. Contract code has access to the contents of the attachments when checking the transaction for validity.<br>â€¢ <strong><em>Commands</em></strong> : There may be multiple allowed output states from any given input state. For instance an asset can be moved to a new owner on the ledger, or issued, or exited from the ledger if the asset has been redeemed by the owner and no longer needs to be tracked. A command is essentially a parameter to the contract that specifies more information than is obtainable from examination of the states by themselves (e.g. data from an oracle service). Each command has an associated list of public keys. Like states, commands are object graphs.<br>â€¢ <strong><em>Signatures</em></strong> : The set of required signatures is equal to the union of the commandsâ€™ public keys.<br>â€¢ <strong><em>Type</em></strong> : Transactions can either be normal or notary-changing. The validation rules for each are different.<br>â€¢ <strong><em>Timestamp</em></strong> : When present, a timestamp defines a time range in which the transaction is considered to have occurrred.<br>â€¢ <strong><em>Summaries</em></strong> : Textual summaries of what the transaction does, checked by the involved smart contracts. This field is useful for secure signing devices.</p></blockquote><h3 id="Cordaæµç¨‹"><a href="#Cordaæµç¨‹" class="headerlink" title="Cordaæµç¨‹"></a>Cordaæµç¨‹</h3><p><img src="/images/understanding-corda/tx-flow.png" alt=""></p><ol><li>èŠ‚ç‚¹åªéœ€è¦å­˜å‚¨è·Ÿè‡ªå·±ç›¸å…³çš„ä¿¡æ¯ï¼Œè€Œä¸”ä¹Ÿåªèƒ½çœ‹åˆ°è·Ÿè‡ªå·±ç›¸å…³çš„ï¼Œä»»ä½•æ™®é€šå‚ä¸æ–¹éƒ½æ²¡æœ‰å…¨å±€è´¦æœ¬ï¼Œåªæœ‰è·Ÿè‡ªå·±ç›¸å…³çš„å±€éƒ¨è´¦æœ¬ã€‚ç›¸å¯¹äºä¼ ç»ŸåŒºå—é“¾çš„å…±äº«æ•°æ®ï¼Œæ›´å…³æ³¨äºä¿æŠ¤éšç§ã€‚èŠ‚ç‚¹Béœ€è¦éªŒè¯Açš„porposalï¼ŒéªŒè¯è¾“å…¥æœ‰æ•ˆæ€§ï¼Œä¾‹å¦‚è¯´è½¬è®©èµ„äº§çš„åœºæ™¯ï¼ŒAå½“å‰æ‰€æŒæœ‰èµ„äº§æ˜¯ç¬¬ä¸‰æ–¹Cåœ¨ä¹‹å‰çš„äº¤æ˜“é‡Œè½¬ç»™Açš„ã€‚Béœ€è¦ä¸€ç›´å›æº¯å’ŒéªŒè¯çŠ¶æ€è½¬ç§»é“¾è·¯ï¼Œä¸€ç›´åˆ°æœ€å¼€å§‹å‘è¡Œçš„èµ·å§‹ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œè¿™æ˜¯çŠ¶æ€è½¬ç§»é“¾ã€‚<code>Identity &amp; Permission Service</code>è§£å†³äº†äº¤æ˜“é“¾è·¯ä¸Šå„ä¸ªæ¶‰åŠæ–¹çš„èº«ä»½è®¤è¯é—®é¢˜ã€‚Cordaè§„å®šäº†propasalçš„å‘èµ·æ–¹éœ€è¦å­˜æœ‰è¿™äº›å†å²è®°å½•ä¾›å¯¹æ‰‹æ–¹æŸ¥è¯¢ï¼Œè§£å†³äº†æ•°æ®æ¥æºçš„é—®é¢˜ã€‚åœ¨ç±»ä¼¼äºé›¶å”®äº¤æ˜“çš„åœºæ™¯ä¸‹ï¼Œå›æº¯é“¾è·¯å¯èƒ½ä¼šå¾ˆé•¿ï¼Œå¯ä»¥é€šè¿‡<code>State re-issuance</code>å‰ªæç­‰æ–¹å¼æ¥è§£å†³ã€‚</li><li><code>Notary Pool</code>å…¬è¯äººæ± ï¼Œå…±è¯†ç®—æ³•å¯æ’æ‹”å¼ï¼Œå¯ä»¥æ˜¯BFTï¼Œä¹Ÿå¯ä»¥æ˜¯raftç­‰ã€‚æŒ‰ç…§æœ€åŸºæœ¬çš„å®šä¹‰ï¼Œå…¬è¯äººå¯ä»…ä½œä¸ºæ¶ˆé™¤äº¤æ˜“å¹¶è¡Œå†²çªï¼Œé˜²æ­¢åŒèŠ±ï¼Œä¿è¯å”¯ä¸€æ€§è¿™ä¸ªåŸºæœ¬èŒèƒ½ï¼Œä¸ä½œä¸ºå…·ä½“äº¤æ˜“çš„éªŒè¯èŠ‚ç‚¹ï¼Œå› æ­¤å°±ä¸éœ€è¦çœ‹åˆ°äº¤æ˜“çš„å…·ä½“å†…å®¹ã€‚</li><li>äº¤æ˜“ç­¾åçš„æœºåˆ¶æ˜¯å®šä¹‰åœ¨flowé‡Œï¼Œå¯ä»¥é…ç½®AND/ORç­‰å¤šç§ç»„åˆé˜ˆå€¼è§„åˆ™ï¼ˆå¤åˆç­¾åï¼‰ã€‚æ¯ä¸ªstateéƒ½æŒ‡å‘æŸä¸ªnotaryï¼Œå•ä¸ªäº¤æ˜“é‡Œä¸å…è®¸æ¶ˆè´¹ç”±ä¸åŒnotaryæ§åˆ¶çš„å¤šä¸ªstateï¼Œå› æ­¤å•ä¸ªäº¤æ˜“å°±æ²¡æœ‰å¿…è¦åè°ƒå¤šä¸ªnotaryæ¥è¾¾åˆ°åŸå­æ€§ã€‚</li></ol><h3 id="ä¸€äº›æƒ³æ³•"><a href="#ä¸€äº›æƒ³æ³•" class="headerlink" title="ä¸€äº›æƒ³æ³•"></a>ä¸€äº›æƒ³æ³•</h3><ol><li>Cordaè®¾è®¡çš„åˆè¡·å°±æ˜¯é’ˆå¯¹é“¶è¡Œåœºæ™¯ï¼Œå¯ä¿¡å…¬è¯äººèº«ä»½å¾ˆå®¹æ˜“åœ¨ç°å®ä¸­æ‰¾åˆ°å¯¹åº”çš„è§’è‰²ï¼Œä¾‹å¦‚å¤®è¡Œï¼Œç›‘ç®¡æœºæ„ç­‰ã€‚åŒæ—¶ï¼Œäº¤æ˜“çš„åˆæ³•/ç­¾åè§„åˆ™æ˜¯æœ€å¼€å§‹å®šä¹‰åœ¨flowé‡Œçš„ï¼Œå› æ­¤é™¤äº†äº¤æ˜“æ–¹ï¼Œå…¬è¯äººä¹‹å¤–å¾ˆå®¹æ˜“å¼•å…¥å…¶ä»–è§’è‰²ã€‚ä¾‹å¦‚è§„å®šä¸€ç¬”äº¤æ˜“å¿…é¡»ç»è¿‡ç›‘ç®¡èŠ‚ç‚¹ç­¾åç­‰ç­‰ï¼Œç°å®ä¸­çš„åˆè§„æ£€æŸ¥å’Œç›‘ç®¡éƒ½å®¹æ˜“å®ç°ã€‚ä½†åŒæ—¶è¿™ç§æ˜Ÿå‹æ‹“æ‰‘ç»™å…¬è¯äººå’Œç›‘ç®¡è§’è‰²èŠ‚ç‚¹çš„æ€§èƒ½åŠå®‰å…¨éƒ½æå‡ºäº†æ›´é«˜çš„è¦æ±‚ï¼ŒæŠ€æœ¯å¤„ç†ä¸å¥½å¯èƒ½ä¼šæˆä¸ºæ•´ä¸ªç½‘ç»œçš„å•ç‚¹æ•…éšœã€‚</li><li>ç›®å‰çœ‹Cordaä¸“æ³¨å’Œé€‚ç”¨çš„åœºæ™¯è¿˜æ˜¯åå‘ä½é¢‘çš„æ‰¹å‘å‹B2Bä¸šåŠ¡ã€‚å¦‚æœå°†å…¶ä½œä¸ºé›¶å”®æ€§CBDCçš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ€§èƒ½æ˜¯å¦èƒ½æ»¡è¶³æœ‰å¾…éªŒè¯ã€‚ç±»ä¼¼äºä¹‹å‰åˆ†æçš„<a href="https://simplexity.cn/articles/open-cbdc/">OpenCBDCæ–¹æ¡ˆ</a>ï¼Œè´§å¸å‘è¡Œå½“å±€ä½œä¸ºå…¬è¯äººéªŒè¯äº¤æ˜“çš„åˆæ³•æ€§ï¼Œå­˜åœ¨æ€§ï¼Œå”¯ä¸€æ€§ï¼Œä¸Cordaçš„è®¾è®¡æœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚ä½†æ­£å¦‚åœ¨ä¹‹å‰æ–‡ç« åˆ†æçš„ï¼ŒUTXOæ¨¡å‹çš„å›ºæœ‰å±€é™æ€§å¯èƒ½è¿˜æ˜¯ä¸€ä¸ªåˆ¶çº¦ã€‚</li><li>Cordaè·Ÿä¼ ç»ŸåŒºå—é“¾çš„å½¢æ€å·®åˆ«è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œé’ˆå¯¹é‡‘èåœºæ™¯è®¾è®¡æ„å‘³ç€åŒæ—¶æ”¾å¼ƒäº†å¯¹é€šç”¨åœºæ™¯çš„æ”¯æŒã€‚ä½†æ˜¯è¿™ç§å€Ÿé‰´æŠ€æœ¯åˆä¸æ‹˜æ³¥çš„åšæ³•è¿˜æ˜¯å€¼å¾—å­¦ä¹ çš„ï¼Œæ¯•ç«ŸæŠ€æœ¯æœ€ç»ˆä¹Ÿæ˜¯ä¸ºä¸šåŠ¡è€ŒæœåŠ¡çš„ã€‚æ­£å¦‚R3çš„CTOæ‰€è¯´ï¼Œâ€œEvery successful project Iâ€™ve worked on started with the requirements, not some cool piece of technology, and I was determined to bring that discipline into our work at R3.â€</li></ol><h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref."></a>Ref.</h3><blockquote><p><a href="https://corda.net/wp-content/uploads/2021/11/corda-platform-whitepaper.pdf">å®˜æ–¹æ–‡æ¡£: corda-platform-whitepaper</a><br><a href="https://corda.net/wp-content/uploads/2021/11/corda-technical-whitepaper.pdf">å®˜æ–¹æ–‡æ¡£: corda-technical-whitepaper</a>  </p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¤±è´¥ä»»åŠ¡é‡è¯•ç­–ç•¥</title>
      <link href="//articles/retry-strategy/"/>
      <url>//articles/retry-strategy/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="49acb2b8329e9f71626f8b3229696a5a84b95f535593c712a167dd6d415e4158">3175488eedc729df0c7d358c640da99e5db97a13f852973918f00ac21570e613bba0328fd65f8fc7a42e01e09b17f1c39751aa1558cda6efd11e5e96f3e1ba4bffc6e6523141a7fa348e1e936df5affe94aee38d3d5738e873b420baa60209d1b3699d1eb361d664fda238523bf2c92485a2f179e6dd8399649faf5aa13ea7eaba37307fd1743d91dc143e27430b947b1b60a15056a051702ac4a3ef8886c2afc9534517e399fe10ccacf7635fbaf7a10cd0961d40a9a839ac4293035e0cecb13190196d56ed2f3c66298bd4ab3367efce8aa6f26f70aefb286ae992851d9e7922322efdd6ebddcd9ed7f7ae6a8c2e1eac14f564797c07c516e7f97be7ac86d79387c06928bf5b5378167e9e644cbf30f667a31768bd26d0244e1c1b17e0839ea6ce3cde42c7b5dccae239eeb4acb88a60e45c05a6fecd9d15aebce0b758f45a8989cb89051617d22e2c82f64336b26ec5b1478c4f4c26824f25004e40b9335d519969ec0566d579cb39b5d6e076ba2f7022377c0c18ee301980cc0919269f2539c6e8710ebd43c76dc7ec9e7b5627742466c61ca5c1686044a02d9b5a5864c587c425f7d788966cf945819a76e11bf068378af83a2b3efa2d6149786784790e9ad463705b913a35a6291052e5346333005213f8086090036cbffbb57ad0af433ff432c1d9c1c63ff31c7ad8883636801f989449e7d4c139daa64e544e18e88b4c8565aa43b71e2721e214152aecc1e9fab6483fd4f09377b1fb4c5db29ea6306214535fa03cf3aae4617ca4915a43173459daa6db0ecc4b163fc3f8d3d528f6b9f6889bbc17824a47a51e2a3a21a0cf4cb3594fea9b3694a46fd1dff59ebd12a9bd57bb09271ff0334ff4f95d2f69c1e8680981c195a4cc8de9ff255ac111f6998229df2fe0f572e0692c78934bc67a221dd71c14360ee7bd5a186ba72bffe4a271a577b7d40ee2d53b4907aea341175d567d98d62b25bbf04e547b9466489129808f821c6543ebea707b22fc9a6d0f2144e50126763cbcb3e8d81abb3bc56cab22f9e1896545a43198822dd87ca1191fba888d34359a33e8b8d09b8753eb3bb5878e58b12cbd9cada0f9a0b4367822097f4995ca6e1cd5040d5d9f0c6b9819151bf759990825d5d32e7116574cd5778d1ed3fbb328a878984d399c8c7a2b94e73782a7d5a9a88900a4b94dd9ef5330a1dcc928752b990c6375812203f3c4c07528e58194de4b4c51c3028a997e69072f652f84f3672bd2cf8fc191d4255a5d443adfc86b1e6090213e97f1353c967646265a9faf2e193a7f016a85e4b48f9a0180e3dc74a787586875ce42ccbcded95364d487d7927ae4b98f0cfa8086b03756e2dadfbede43204d6dae690637dfe24adca1fd575bbdf330bc3f51dfa17250da09736da6205eb47c93d7273b709e38642ad1a49b1544da27ff2dab9cb480137fbf7962cc74ad26c86500133d199af4dec4cbe08e6af2893fa05883dc5fb490e55d7fcca6ca06582dabe321e759a1d66f5692075c737609e716b10a9d43a6c42ba0016be4012a1ab050d682108e8e860d27562418e6ec1d17ea7c2a53e87dd55503da81a1f6b54c4968a92670f57de64d80b56d8fa5bf1e723c171b10476347235015af9140c34b659eaebab0412abae27c448fa5558d2d44a05ddddebf1dd37c6bd6976db8c4e4b79fc187ec2c4accc03fd5d995318e1c32d8c3fd261d57a9ade04d34b2b404767381d61380aea1cf8fea23dbcfddf6877ce7488ab889313d2c9673dd50affa1487562b690b0f5011ef570c2da0889cdb2751c16e9a227b3d78c8f891261bc2a2dfa60fedc408bf6db79adb7ebe3ac3f22ff5e26bfba4dc68d822983042bc88a92f7bcf087d396d88e0de18c0dd655fb172772e0150fde0cd5362664889204b5759348df617d1b31cbafaf77fa52942294c9f11f32782cd73c8c07ea8913a1c66518c2b76f7fd84cfc23f774dc04a7f390dc2f7518d8b1ee74045b5ec17ad453a2b1129c93645c33b1ccc2bd42cc201bce0e4d72fc58f8565757df191cdc0847fd5420283dcf2c661af3784be5f3d969e89fd14bfce51cab38e7b7db1e8b60b155913f4cdf3ea2cc07a694052fd345b7d08f529b0d6093fd06cfecfacc300c73a3326273657e30b2f48503d7999462faa233d40b8b33f40176d7b59c580e44ec72515935918425cbe04f49ff4993491c5ff324170143c1dde550862958ad57dec7d45e5e4e50b1959305ff6390298be9a6d80886d3cbf2a540b797c6a4ff16a527fc5dcb720f511db3036fa668de4a73b52396e4b74250f412819a8934fee543a3cebd0974db4efa4847d764f06dc98f01bca650db0019263f562c171652a918f89b7d69166cdb1b72232f238a5420a948eef0b9cffa854ab1c3a08e8b84c6963c83bbe799c985da7feee8ce3b2cbc90b091f1d7286840dff5824695447d92ba50b6bcfed0c222b1f6a5a8e46c77aeb99f7a76ec1e3c1115c05b27b4f66dbd80484aa7b99dec149015da84ba3dcc8dcc5ca0b7f6cc88ae0a74e21bab8b300edc9a1ea89c3d1a6d7fec1eab5eeadd839e4c87b2fd26de8d06130f4aa7f891cf7e9d6db0874b98eda81eae9763ab5bcae606a02e2e0e6373439ed8c4dbfaf81d78c30f313734a0dd3ccd0e35599fcbedd8b84659bea3d881b5b5f48e9f65d53a57bca61c3e31ed0ca274618b9fdcb4c786079ea680fc8890cbcfb341094cbe57ca0f84a72a0ad3663614a80ac216ed1ebeb2bc7e8c69e23380d4fce031b44a06054df7c2f5086890e665f1f4ce6f1c4f210e8b8ea31ac42c1dabfdc709eac5cc7d7dd38ed8472fbe4608806be51bef8f841e3035fa485229275707cb3c99ebabfc0713147703257594d9a9309967cad30c794a7c92410829dda8a9b339a956b52ec14e51e095229a67784ac9684605c2b234ed1c2182dce9b585e2990afedbc94f14757b77e788a0e1b23d829408b68259c1ef6442f98cfd1dac2716b2971ab608d69101d3a015ea12c83603d3c74560feef9729a7fec2c5cb38f9a029d8b047c8404bf292df856bd534ffc6bfb7caab6f6b2246932dc014a79d0570784c58403bc31a78c4b69cb31c7b7e7693636e491cfa821feea0b4fff81fe000bdbf91ea219dc65e3a1b43fde974c682b0cf8a7d7841774fcae2fab8f0b8259b445d0cf16a81fc2c33c929b6692c1b5ba2baa68140b1340687cf0c5271f3ab6391b2f49032c7123b5b14c1e4b0082b81ad2caea9878d38248896026273946b03b287fce8c9fc68de6f23ecc33ad92fb479eaafa7e3a32386b5386bdf200b655a48e26634b0bab5c119158ec39637d607af47f21054cc8626a3b0471e1862647bfcf8d90faf7487e96562d8eef5e2c3bdfdd28c47164db11e606ae7a43c322372c22a5c418d3054b4ed882dc68ef8442465110dc0a938344b733d54ba36cabeb1e1329ed1fec3df2720ab465ed77266a4e9dcebb39967390e19578a59420acc9c0748c7e3bcd301ec7454599c8e43b9e3a7728c14fa1d51e4313a402620d5f01014b7847bb0c59bfb6301c4fb20ce971c16f385d0865a6571e9d6ad0fff91dd9d109cc0895c38e44aae195d83d35beb7adc3df8b18e87b39669230bab29a8d4a0fe228d8957c2f5149afdc8d2b60d5644d86fe350b18636eccfc709797af1a8a6a0671d16eb3716dd6d659a9081a00c937a22fd52b8b6ef06329d01354d343a9ddc2e888ff6a3c6397d434c8dff58e32b5fb48bb2f5dac2bab432290f78ae6c759cc1c7f9f1591b67e3f04f685c8e551eaa2111c7a2609c3c5a583bd9126fd02dd99c9cb3d55ce001170dde0cf9bd518eaa6ac5a2acd72e0b2b701d930db8a44f5cf07242a46f92d89de1faa5d278c9140b9d4ed68b790e2c82bc0081b2a8648bf8fcd4cc7110f1e67fb89a38205bca35cbaa6ee7f6a47bdf48116afda313e66244f4b46da2b7422cfbecc06d5997dc5d7fc523470ea89a5f70b165bf9ed6728a89f84ef3413efe46319010a9eb45259cc44dcab1a31f05a3040d43c6a86540f99f738cfdf258c9b279b617aa42cd755210948237bb781f95c6fed92d7b96daba7e6887e90043ee3803092bf68f03ea6b934cae87a58e64ac610ebb9deb02fe4c3aa3465025184c64f0392c7270cd2bb12df3ffb6baa6c96c0ee1dbb65dc6a62522b63768d06de2673644711d27c2323e30702e0c3b12742010f144846ec8349b09dbe395c16824be2e7722b03f800fab9bcbe0d7d35cd1db7c68db519d832ab04751c25ee2437873a6a0e7c8f33d21c8373b15ceb3eccd54435ae0a927a72e416fffa1985cf3b54a721c73012b7ad423d40718e91281b75acd2dc8b8ed084bad002a31847655091fe71a94b09dc7d7aec3b43ea20215d20a89fe43e560f176d3005bc89e6e044b4497d4cf91eb6dd2602a0da05b4597d8f9a0c515ed9e819bd12ce94028d6978df08b87b43c9e6104b84ef2cddf690fe9d1a1d200e56a124985f4807196eeb19723cd478441a1646bf9d1bf1500e240ceb4c3ec4b4c362e4d8283c00f6da5d96202bc09177828d2773ceff7313d2fd768d2ebbbc75d1781294c15ca2cb1c838cb887d1486d943e2a44b4a6176a691e03eb8743f19711bf929bab39a75c6572d2c471a9eb0258e62527e34e881ad35136e585b27af6b474ef81a957c7cdf5ecabfebb00d97bd8209c436dea5f8af805411508f9ab05789b6bfe79d37f37931fda6068ac37485108b7c786de4b1313c7b9502bf762302e06c596108b7341c3c5c11731576d6d6bb058b6f6e5d2937f9d8aa00af5df037d0a5164bbffe61a8be41c7e3f0bac0ee50da8322d080eef6d45cf566145d53ba2070b5d3173997e99063cdebd1a3447af0f53aa533d4276421b51e6efbc50163e61d599cd8e79f8b7cd76de79553ed7a9a2af53c7f171c8c0c20b3debc386ce341b0cc2f05e664a616acb7c63bb9d8e11e7c7b5d45e1669b73cd0c9d007e1744c21355247b1347cbdb34f43346a3a22dbc072d0d0f990c259fa4fd27470172837d6156094ff383b0cb826e30a0d039965315c961d2d528460c5a698443146bb925c141120f3a9f54e77097e634f7891eed995f82206c3ddc8e10350fb8a85a14d0f2cb54bac3a62e4a3c97a04752816be613028b7be983a4435806ca57c6259429eb9d975fd8c7035bd5290dd2cc77e0a252434ea11473dec6fc23f8b440c86429bb592214bf02eeb6f38e6c580947c35878482d4a4fd1b1cc3595feed7616c0b02229656dfa548bcb77d0353ac4cce401623e1ee0fa1dd4e18a059d6db5c25a3b43da115bf6b99609b464c731993fd1ddcb9333761810dfae2f4dcc82111b3415a13c038cdbcd78b69ac4c1e668d8a4bee0b10380bc4c7e7db7ba6d8c463a3377a21a1db0b9b61630f507605a47a432045ac74ebc91b25ab79a2786f39ec777d517cc6a9250b710e37ef5bed49126d0374430731e245afc841b64ba4761f809a08472eb48704d1f0c21e66a0a58c364d2362e4bf9956ed9529f60b357efdcd803908cfe1ffb342f516d4e3d1f112e5daade5075693642245b1b86295f0b0644d36d4ed994d6fbfc56cd9d8f5ae96d0a66dea472e907887e2d399cc85e015d7697ed30924de359e397eb042465ba5f7f5a75aeaab89eeaebea80d1bc6cb2b51bfb27d867cf5ec711f7230e81c19a52180805c9769096c77a8a7f6d321648aedc6f66f187853ef510c1ad43c14a6f8f6e89c6fd1e419e72b1e24e679c7ded4c3d4022d19523e7f545f1b6029317cf631c677ffc2de39886e60e206048acb94947a46d5e52529055a983f4918839569b624963af162cbd85e590b64f4626c7db394afbe8a742712f9f9d22f70ee1825cd3f76258103d9f08fc8af74b68aa1c90dec27d9dbfed46399437d45105d035a170b2b8f3110a7bf270cfe0da387fa2addfad40b01d92e0491929c95c2ab54fb03142e12ed4e8c0a321159fcb29ba1278a929f1be9f964837d346704d93913b1647656d8cbf812b368c030a09a4a205aacfe721836cfcecc7562cf9d901cd1852eb9fd0bb9e8b2b80cbac2ca5055b7732aed2aa2269c8e1a2d35dd029d47aa82dc403034b2e22737f93ba76f306434c3dcfaff38023858b30d5ed583f13c6748c983dd7726395da3cd0fbb7b4b0bc8bd8d42dc2c0c52315e4ae393930e0e4ab89081e9b2b0a9add20b4fbf2a3fed92d2d32ce6f2133d20b57fc33174ac915a99a7c4e86452ac82bf5101a36eb5f81b219d9ee2a4d18ac0946aea064455dc48b5c556c3edac71117637e3fcb8983e45bb1486473348e1fbdcc68dbbd34dec3c9ccea0944a6661819679a0d3082dbe288e5a88838e2d83b2b7e14684bd45e345be2d5126e2a14b8cda3257b24a53456baeb0c7a06c991d3869ad4b8447ea5791359260ccc2abe9189502651af964810a8f4e4097b09b82cc0beb8ae97d396c861d9bf9a07b4ae33893864f00240fa8b58a124936a1f5e694024454fcbb1e0d3dfd018700681ba81b4ec5be105ddfb1a284ffa40d22f5dc6a16cd87720798d7ec038584ae324dd96708f3a720d61bf6e1ddf0209617b3fdd34af374752d9bd5df1e03fe1d4bfcf874b39a4efe392526389fc2d9845fcf84f70046adbf90adfba0bcef3f3a8ed5c4d91c0a964b64a834dbfaf5482182693a59dfe626dfa658471c0e1eccd219056df172cff10ffedcd6685b863c0cfa913472aa0892ddfb085d9733cb3256bb4be78a2c969fe93dd75af1aa5a13f6e78fea6876e04e566f2cbd50fa16f3be42e556f6b23914a3a7df1bda531604f181af30023d546d97081b604d381926a92091b97a906550fa987f06a2d71bd222e977ad410eedd26dc36c898ea16ba27de6b964ca0f7cfbf39759c30899280f94eb5a98ae1a347c3ead256ff158f7403240246cce081521a735663a2049f02de63d3f6c8db4b0dd6e5ab5feb6fafd564dc450b1bea42218ea76b7882a24b8078dbf2ac630473010bccbdf3979291634e946a182d4266a1cc445043ac78f6b837513b7d0cc6bb9601de2ada09db0c1c4373e5c313bf998a50cb161719d2c8d0687c990c1b15013a666e8d166c287b2ba2ae59ef75c5af379078aee773f65c57bfb8b0cb4b603bb889617998c41cc82e9d336b9b03fc8dd653c8f5a2e2b5592278d43fb503f2979306c5038e64e426518c7374baf93f80d1055a62f7d7db21bbaba33e761eeca3abc6b92a58c582362d48f3f530b8f6a6e5c9219af1b74620724921477518beb5208a91cf6d47396bef21cdf4752cbf39c0876f85a122c7a7007d5e61a4396cc368494a50f633dc2bb2e165a5720712f142ca05b2df2bee8eb8f5076af592f8e22e0657b615e9d12807f4cc1e35b770f511b2f6d67e3caebeec218fab33aba1b8953fd29aba25536d2d58bec705cfc051b6d94700ca351c7452207891277868215dad2c4f5ec5485512c6698381f85eb8f29214164203d6da0b98f7ba3095c2321526b61ff30148a29166aea08b8086484da7033982fe12fe2ec03db6a50d1b645683d595e7e111af2fb4e58fb8d632ac5aa497156f2499424ace266582ab335b9fabff3de21f42778792a9829993260b2ca2159a00a649189254deb16e271336a2f4d72d287671eacd75d81029434dbd36c5ae81691e34e64638c8d5a38fe8c82194c296807be487e3aaa1e7b44c8628e36764c5babd7168ca03750a962f3b7ef2e615aaeb9068b10522263a17dcc6a1dd5088f5400b0e9824e5fdb7098cd1a531775744f10157b091321e247eade836546dbb34347b7364bdd83b1c0a9805eb29a803b27b273388fdb1ec3bacaeeeb50636f0f090106decbff327872bcafadd8347742a1466ad9926a4cc4540e9f08ad658be153538b9bb3099adfbcf20dd36d6d0181056be2b331714c4bfcabcf17958193f1530301a23957f2643bcb765d82e0a09300204c823f1003b2bb408d4b99d18dc7bbbaea482f8599c64617069f3f3c6feb9c2ba368df91351fa1a95c02dbc15db209a26a42a91b3b99039d1d332b6bac78af99cd3d77a66bd5f3e96090c4843c1a98948d5e2d9f40625082d3fcf9dcada2cdcc3e8a7b5322a3b67666b99f8a548244522ff24f30ee647071128451f08479237209a43e0792847acb4f927ac9debf7825213b713e638fc124d4d1c23e855e1618776361b0f279f9855d850416b63585c9a8b027095c728110366e4cc56bce8b42bc4f68ad06496daeca466c118a7af71eafd203d54271616603e68a90d96dcb200462beb9f0ea8defa02abdf743c568ead59b54742b80521bb95298d9b7c8f2d0f06afdde22a1010d0b30588c014630a656dc7fda627fd2c23af2eadae0f17aa391eefbf3ca5187ab7403c404d26c1fcfe5243ef4bca483f95ad4d261c70100ee09ed7985534db4470672f1d5c0a6ab4b3d9df91bdd5ca1b9c54855ad0f12e0a865a8df23d654655875a8c0cecff18b37d1ce9f756d8dadf4d8304c0ddc750d40aa59ba07b8ed77b41c02548a38e1004d8bd4cb48f22b6cbd441ab46a8618da2c18111b60ee16529620893acbdca8da3ea192128430fffd5d3cc00a752110c015435be338722d79b67fb7a572fa4ccf67dd0c256122d9d338993dd2c705469b8cebfa1def5eb865c4fc225ea841b31f3a2b97602815e95e99685d217d67f28a014e16e6398ef0e0f640e1a86487aaa5ec9f58082453dd34f07d89a1810bbab6038f3d4d8787f597b5f8a528175030c0b080105178196265dd9f7af895434917bcc1f8bbda560fe378714d26410b9f6a2a4c0ce11020d56f0dc7698505d9156b5a1ea4306736e76f6ed7c71240b8b22c0d2915e415bb04e5f8f3cddf952c43e14cb4dad2bac04331b1cc7b1ac73117409331e8c6f734c46f969b3fa72a7f28883f00314b780a185422930988eb88b1291590b7e3ecd97d4048120cc95cc229e13db4c7559dda8ad8788c2b862fd5d12252b23fd3d61991be1db1404b447e72f8a50cd7faa683422de24a9103f905a81f68d0e409d998dcda4fb0b4a3852675023347f934099a8b25c639b81fa4ca902091a3f0c20f17cbca0cd1eef4040d3af42180b056ece1ccfde9b9a3662cf535b5e4a7106f5195df3264556f632c5878b8181b0656fda36382d0908ae5f89737e96dea632e9d9c34a429c6c8d88d78b2eddb813a6f925a6371e9fe9cd7cca5f1b4ef757429c2a74d11e1b3eaac045da30f0dec8ea7d94af2df9a16ef9b19eea72489870d2cc142a66675b0f5933460b54b5b4679485b737e0df647f26669c56cc94712318fade6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Post is cheap, show me the password</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ™ºèƒ½åˆçº¦äº‹ä»¶ç›‘å¬çš„è§£å†³æ–¹æ¡ˆ</title>
      <link href="//articles/sc-event-listener/"/>
      <url>//articles/sc-event-listener/</url>
      
        <content type="html"><![CDATA[<p>åˆçº¦é‡Œç»å¸¸ä¼šåŒ…å«æœ‰äº‹ä»¶ï¼ˆeventå…³é”®å­—ï¼‰ï¼Œåº”ç”¨é€šè¿‡ç›‘å¬é“¾ä¸ŠæŒ‡å®šåˆçº¦çš„æŒ‡å®šäº‹ä»¶ï¼Œä»è€Œå¾—åˆ°ç›¸åº”çš„æ•°æ®è§¦å‘ç›¸åº”çš„å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„ç³»ç»Ÿä¸å†éœ€è¦é“¾ä¸‹çš„äº¤äº’ï¼ˆapiè°ƒç”¨ç­‰ï¼‰ï¼Œåœ¨è¿™é‡Œé“¾æ‰®æ¼”äº†ç±»ä¼¼æŒä¹…åŒ–çš„æ¶ˆæ¯é˜Ÿåˆ—çš„è§’è‰²ã€‚åœ¨å¤šæ•°åœºæ™¯ä¸‹ï¼Œå¯¹äºé“¾ä¸Šäº‹ä»¶ï¼Œåº”ç”¨æœ‰ç€<strong>å¯ä»¥é‡å¤è¯»ï¼Œå¯ä»¥ä»æŒ‡å®šå—å¼€å§‹è¯»ï¼Œä¸èƒ½ä¸¢å¤±äº‹ä»¶</strong>ç­‰ç­‰çš„éœ€æ±‚ã€‚åº”ç”¨ç›‘å¬æ™ºèƒ½åˆçº¦äº‹ä»¶ï¼Œå¸¸è§æœ‰ä¸»åŠ¨è½®è¯¢é“¾èŠ‚ç‚¹å’Œå‘é“¾èŠ‚ç‚¹è®¢é˜…æ¨é€çš„æ–¹å¼ã€‚å½“å•ä¸ªåº”ç”¨å­˜åœ¨å¤šä¸ªå®ä¾‹æ—¶ï¼Œéœ€è¦åœ¨å„ä¸ªå®ä¾‹é—´åè°ƒï¼Œé¿å…å¯¹åŒä¸€åˆçº¦äº‹ä»¶çš„é‡å¤å¤„ç†ã€‚åŒæ—¶ï¼Œå½“å‰ç›‘å¬å®ä¾‹ä¸€æ—¦ä¸‹çº¿ï¼Œå¯¹äºè¯¥åˆçº¦äº‹ä»¶çš„å¤„ç†éœ€è¦ç”±å…¶ä»–å®ä¾‹ä»å½“å‰ä½ç½®æ¥ç€æ¶ˆè´¹ï¼ˆåº”ç”¨éœ€è¦é¢å¤–è®¾è®¡å®ç°åè°ƒæœºåˆ¶ä¿è¯ä¸ä¸¢äº‹ä»¶ä¸é‡å¤æ¶ˆè´¹ï¼‰ã€‚æœ¬æ–¹æ¡ˆå°†äº‹ä»¶ç›‘å¬å’Œæ¶ˆè´¹ååŒçš„åŠŸèƒ½äº¤ç»™ä¸­é—´ä»¶åŠæ¶ˆæ¯é˜Ÿåˆ—ç­‰ç»„ä»¶ã€‚åº”ç”¨æ— éœ€å†é¢å¤–å®ç°å®ä¾‹é—´çš„åè°ƒæœºåˆ¶ï¼Œåªéœ€è¦è´Ÿè´£ä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ¶ˆè´¹å°±å¯ä»¥ï¼Œä¿è¯æ¶ˆæ¯at-least-onceæ¶ˆè´¹ã€‚ä¸€æ¬¡æ³¨å†Œï¼Œå°±å¯æ»¡è¶³å•åº”ç”¨å¤šå®ä¾‹ç”šè‡³å¤šåº”ç”¨çš„å…±äº«ã€‚</p><span id="more"></span><h3 id="æ‹“æ‰‘"><a href="#æ‹“æ‰‘" class="headerlink" title="æ‹“æ‰‘"></a>æ‹“æ‰‘</h3><div align="center" style="width:75%;margin:auto">    <img src="/images/sc-event-listener/topology.jpg">  </div><h3 id="èšåˆæ¶ˆè´¹ç‰ˆ"><a href="#èšåˆæ¶ˆè´¹ç‰ˆ" class="headerlink" title="èšåˆæ¶ˆè´¹ç‰ˆ"></a>èšåˆæ¶ˆè´¹ç‰ˆ</h3><h4 id="ZookeeperèŠ‚ç‚¹ç›®å½•"><a href="#ZookeeperèŠ‚ç‚¹ç›®å½•" class="headerlink" title="ZookeeperèŠ‚ç‚¹ç›®å½•"></a>ZookeeperèŠ‚ç‚¹ç›®å½•</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">monitor  </span><br><span class="line">    |_ nodes</span><br><span class="line">        |_ active (ephemeralèŠ‚ç‚¹ï¼Œè®°å½•active monitorçš„ä¿¡æ¯ï¼Œå¦‚ipï¼Œç«¯å£ç­‰)  </span><br><span class="line">    |_ eventsï¼ˆæ°¸ä¹…èŠ‚ç‚¹ï¼‰  </span><br><span class="line">        |_ fooï¼ˆè¯¥èŠ‚ç‚¹è®°å½•å¯¹åº”çš„contract addressï¼Œabi, event nameç­‰ä¿¡æ¯ï¼Œå”¯ä¸€ç¡®å®šé“¾ä¸Šåˆçº¦äº‹ä»¶ï¼‰    </span><br><span class="line">            |_ latsBlock(è¯¥äº‹ä»¶æœ€è¿‘å·²æ¶ˆè´¹çš„åŒºå—é«˜åº¦)</span><br><span class="line">            |_ topic(å¯¹åº”çš„kafka topicå)</span><br><span class="line">        |_ bar  </span><br><span class="line">            |_ lastBlock</span><br><span class="line">            |_ topic</span><br></pre></td></tr></tbody></table></figure><ol><li>å„ä¸ªmonitorå‘zkçš„<code>monitor/nodes/active</code>èŠ‚ç‚¹æ³¨å†Œé€‰ä¸»ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªmonitoræ˜¯activeã€‚è¯¥active monitorè´Ÿè´£è·å–é“¾ä¸Šåˆçº¦äº‹ä»¶ï¼Œå†™å…¥kafkaã€‚å„ä¸ªéactiveçš„monitorç›‘å¬è¯¥zkèŠ‚ç‚¹ï¼Œå¦‚æœå‘ç°active monitorç¦»çº¿(zkèŠ‚ç‚¹æ¶ˆå¤±)ï¼Œåˆ™å°è¯•æ³¨å†Œï¼Œæ³¨å†ŒæˆåŠŸè€…æˆä¸ºæ–°çš„activeã€‚æœ‰æ—¶å€™active monitorå¯èƒ½ä¼šæœ‰ä¸¢å¤±å¿ƒè·³åŒ…ç­‰å‡æ­»çš„ç°è±¡ï¼Œæ¢å¤è¿æ¥åï¼Œéœ€è¦é‡æ–°æ³¨å†Œï¼Œåˆ¤æ–­æ˜¯å¦è‡ªå·±æ˜¯å¦æ˜¯activeï¼ˆè¿™éƒ¨åˆ†å¯ä»¥å‚è€ƒå¸¸ç”¨çš„zkæŠ¢ä¸»æ–¹æ¡ˆï¼‰ã€‚</li><li>åº”ç”¨é€šè¿‡monitorï¼ˆä¸»ä»çš†å¯ï¼‰åˆ›å»º<code>event</code>èŠ‚ç‚¹ï¼Œå³åˆ›å»ºç‰¹å®šé“¾äº‹ä»¶çš„ç›‘å¬ä»»åŠ¡ã€‚monitoréœ€è¦åˆ¤æ–­zké‡Œæ˜¯å¦å·²ç»æœ‰è¯¥<code>event</code>ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿”å›å·²å­˜åœ¨çš„é”™è¯¯ç ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™åœ¨<code>events</code>èŠ‚ç‚¹ä¸‹åˆ›å»ºä»¥è¯¥äº‹ä»¶å‘½åçš„èŠ‚ç‚¹ï¼Œå†™å…¥å¯¹åº”çš„é“¾äº‹ä»¶ä¿¡æ¯ã€‚å¦‚æœåº”ç”¨ä¸å†éœ€è¦ç›‘å¬è¯¥äº‹ä»¶ï¼Œå¯ä»¥åˆ é™¤ç›‘å¬ä»»åŠ¡ï¼Œä¹Ÿå³æ˜¯ä»zkä¸Šåˆ é™¤è¯¥èŠ‚ç‚¹ã€‚ï¼ˆæš‚åœ/é‡æ–°å¯åŠ¨çš„åŠŸèƒ½æœºåˆ¶è¾ƒå¤æ‚ï¼Œä¸å±•å¼€è¯¦è¿°ï¼‰ã€‚ä»åº”ç”¨çš„è§’åº¦ï¼Œåªéœ€è¦æ³¨å†Œä¸€æ¬¡ï¼Œåº”ç”¨ä»¥åŠmonitoré‡å¯åéƒ½æ— éœ€é‡æ–°æ³¨å†Œã€‚</li><li>active monitoréœ€è¦ç›‘å¬<code>events</code>ç›®å½•ä¸‹èŠ‚ç‚¹çš„å¢åˆ ï¼Œå¯¹åº”çš„å¯åŠ¨/åœæ­¢æ¶ˆè´¹é“¾ä¸Šåˆçº¦äº‹ä»¶ã€‚é’ˆå¯¹æ¯ä¸ªäº‹ä»¶å½“å‰å·²æ¶ˆè´¹çš„æœ€æ–°åŒºå—é«˜åº¦å†™åˆ°è¯¥äº‹ä»¶<code>lastBlock</code>èŠ‚ç‚¹ä¸‹ã€‚monitoræ¯æ¬¡æ¶ˆè´¹å®Œæˆä¹‹åéœ€è¦æ›´æ–°è¯¥lastBlockå€¼ã€‚monitorä¸»ä»åˆ‡æ¢æˆ–è€…å…¨å±€é‡å¯åï¼Œactive monitoréœ€è¦æ‰«æ<code>events</code>ç›®å½•ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹è®°å½•ä»å„ä¸ªäº‹ä»¶çš„lastBlockå¤„æ¥ç€æ¶ˆè´¹ã€‚</li><li>monitoré‡‡ç”¨pullçš„æœºåˆ¶ä½¿ç”¨getLogsæ¥å£å‘é“¾è·å–æ—¥å¿—ï¼Œï¼ˆfrom, toï¼‰åˆ†åˆ«æ˜¯ï¼ˆlastBlock+1, currentBlockHeightï¼‰ï¼Œå‘é€åˆ°kafkaåå†æ›´æ–°zkçš„å€¼ã€‚<strong>å¼‚å¸¸æƒ…å†µä¸‹ï¼ˆå‘é€kafkaæˆåŠŸï¼Œä½†æ˜¯æ›´æ–°zkå¤±è´¥ï¼‰å¯èƒ½ä¼šé‡å¤æ¨é€ã€‚åœ¨åº”ç”¨æœ¬èº«è´Ÿè´£æ¶ˆæ¯çš„å»é‡å¤„ç†ã€‚</strong></li><li>å¯¹äºæŸäº›äº‹ä»¶éœ€è¦æŒ‰ç…§ä¸Šé“¾æ—¶é—´çš„é¡ºåºå¤„ç†çš„ï¼Œéœ€è¦è®¾ç½®kafkaé‡Œçš„åˆ†åŒºæ•°ä¸º1ï¼Œå¦åˆ™ä¼šåœ¨åº”ç”¨ç«¯ä¹±åºå¤„ç†ã€‚</li></ol><h4 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h4><ol><li>æ­¤æ–¹æ¡ˆæ‰€æœ‰é“¾ä¸Šåˆçº¦äº‹ä»¶éƒ½æ˜¯ç”±å•ä¸ªactive monitorå¤„ç†ï¼Œå¦‚æœç›‘å¬äº‹ä»¶æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå‹åŠ›è¿‡å¤§å®¹æ˜“æˆä¸ºç“¶é¢ˆã€‚ä¸è¿‡ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”±äºmonitorç›‘å¬å¤„ç†çš„é€Ÿåº¦è¦è¿œè¿œå¿«äºåŒºå—é“¾å‡ºå—çš„é€Ÿåº¦ï¼Œå¤§å¤šæ•°äº‹ä»¶çš„lastBlockæ˜¯ç›¸è¿‘çš„ï¼Œmonitorå¯ä»¥èšåˆè·å–åŒºå—äº‹ä»¶ï¼Œç„¶åå†åŒºåˆ†ä¸åŒçš„äº‹ä»¶ç›¸åº”å¤„ç†ï¼Œä¸éœ€è¦å•ç‹¬å¯¹æ¯ä¸ªäº‹ä»¶å‘é“¾èŠ‚ç‚¹å•ç‹¬è·å–ã€‚æ–°åˆ›å»ºçš„ç›‘å¬äº‹ä»¶è‹¥æŒ‡å®šä»å†å²çš„fromBlockå¼€å§‹å¤„ç†ï¼Œå¯ä»¥å•ç‹¬ç»´æŠ¤æ¶ˆè´¹ä»»åŠ¡çº¿ç¨‹ï¼Œç­‰è¿½ä¸Šä¸»æµæ¶ˆè´¹è¿›åº¦åå†mergeç›‘å¬ä»»åŠ¡ã€‚</li></ol><h3 id="å•ç‹¬æ¶ˆè´¹ç‰ˆ"><a href="#å•ç‹¬æ¶ˆè´¹ç‰ˆ" class="headerlink" title="å•ç‹¬æ¶ˆè´¹ç‰ˆ"></a>å•ç‹¬æ¶ˆè´¹ç‰ˆ</h3><h4 id="ZookeeperèŠ‚ç‚¹ç›®å½•ï¼š"><a href="#ZookeeperèŠ‚ç‚¹ç›®å½•ï¼š" class="headerlink" title="ZookeeperèŠ‚ç‚¹ç›®å½•ï¼š"></a>ZookeeperèŠ‚ç‚¹ç›®å½•ï¼š</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">monitor  </span><br><span class="line">    |_ nodes</span><br><span class="line">        |_ 0(é¡ºåºephemeralèŠ‚ç‚¹ï¼Œå­˜æ”¾èŠ‚ç‚¹ä¿¡æ¯ç­‰ï¼Œä¾‹å¦‚${ip1:port1}) </span><br><span class="line">        |_ 1(${ip2:port2}) </span><br><span class="line">    |_ eventsï¼ˆæ°¸ä¹…èŠ‚ç‚¹ï¼‰  </span><br><span class="line">        |_ foo</span><br><span class="line">            |_ active (ephemeralèŠ‚ç‚¹ï¼Œè®°å½•active monitorçš„ä¿¡æ¯ï¼Œå¦‚ipï¼Œç«¯å£ç­‰)   </span><br><span class="line">            |_ lastBlock</span><br><span class="line">            |_ topic</span><br><span class="line">        |_ bar</span><br><span class="line">            |_ active</span><br><span class="line">            |_ lastBlock</span><br><span class="line">            |_ topic</span><br></pre></td></tr></tbody></table></figure><ol><li>æ¯ä¸ªäº‹ä»¶éƒ½æœ‰å„è‡ªçš„active monitorï¼Œåˆ†æ•£å¤„ç†å‹åŠ›ã€‚</li><li>åº”ç”¨é€šè¿‡monitoråˆ›å»ºç›‘å¬ä»»åŠ¡æ—¶ï¼Œè¯¥monitoråŒæ—¶æŠŠè‡ªå·±æ³¨å†Œæˆè¯¥eventçš„activeå®ä¾‹ã€‚å„ä¸ªmonitorç›‘å¬<code>events</code>èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰eventçš„<code>active</code>èŠ‚ç‚¹ï¼ˆä¾‹å¦‚foo/active, bar/activeï¼‰ï¼Œå½“<code>active</code>èŠ‚ç‚¹æ¶ˆå¤±åï¼ˆè¯¥monitorå®•æœºæˆ–è€…ä¸‹çº¿ï¼‰ï¼Œå…¶ä»–monitoræŠ¢ä¸»ï¼Œæ–°çš„active monitoræ¥ç€æ¶ˆè´¹ã€‚</li></ol><h4 id="é—®é¢˜ï¼š-1"><a href="#é—®é¢˜ï¼š-1" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h4><ol><li>åœ¨å„ä¸ªäº‹ä»¶çš„active monitoråˆ†æ•£çš„æƒ…å†µä¸‹ï¼ŒåŒºå—éœ€è¦è¢«æ¯ä¸ªmonitorè¯»å–è§£æä»¥è·å–å„è‡ªè´Ÿè´£çš„åˆçº¦äº‹ä»¶ï¼Œé€ æˆä¸å¿…è¦çš„é‡å¤è¯»å–ï¼ˆå¦‚æœé“¾æœ¬èº«æœ‰é’ˆå¯¹äº‹ä»¶çš„bloomè¿‡æ»¤å™¨å¯å‡è½»æ­¤å½±å“ï¼‰ã€‚</li><li>æç«¯æƒ…å†µä¸‹ï¼Œä¾‹å¦‚æ‰€æœ‰åº”ç”¨æ°å¥½éƒ½é€šè¿‡åŒä¸€ä¸ªmonitoråˆ›å»ºç›‘å¬ä»»åŠ¡ï¼Œæœ€ç»ˆé€€åŒ–æˆå‰è¿°çš„å…¨å±€å”¯ä¸€active monitorã€‚ä¸€ç§æ”¹è¿›æ–¹å¼æ˜¯ï¼Œåˆ›å»ºç›‘å¬ä»»åŠ¡æ—¶monitoråªè´Ÿè´£åˆ›å»º<code>event</code>èŠ‚ç‚¹ï¼Œä½†æ˜¯å¹¶ä¸æŠŠè‡ªå·±æ³¨å†Œä¸ºactiveã€‚æ‰€æœ‰çš„monitoréœ€è¦ç›‘å¬<code>events</code>å’Œ<code>nodes</code>é‡Œæ‰€æœ‰èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰æ–°å¢/åˆ é™¤äº‹ä»¶èŠ‚ç‚¹ï¼Œæˆ–è€…èŠ‚ç‚¹åŠ¨æ€åŠ å…¥/é€€å‡ºï¼Œéœ€è¦æ‰§è¡Œrebalanceé‡æ–°åˆ†é…ï¼ˆå¯ä»¥é€šè¿‡ä¸€ä¸ªåè°ƒè€…æ¥åˆ†é…ï¼‰ã€‚è¿™ä¸ªrebalanceæœºåˆ¶çš„å¯é æ€§å®ç°ä¼šç›¸å½“å¤æ‚ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Smart Contract </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ™ºèƒ½åˆçº¦é¢„è¨€æœº</title>
      <link href="//articles/sc-oracle/"/>
      <url>//articles/sc-oracle/</url>
      
        <content type="html"><![CDATA[<p>åˆçº¦è¿è¡Œçš„å¯å›æº¯é‡å¤æ‰§è¡ŒåŠæ‰§è¡Œç¡®å®šæ€§è¦æ±‚ï¼Œåˆçº¦æ‰§è¡Œè¿‡ç¨‹ä½¿ç”¨çš„æ•°æ®å¿…é¡»è¢«è®°å½•ï¼Œå¯ä»¥é‡‡å–è®°å½•åœ¨é“¾ä¸Šé¢„è¨€æœºåˆçº¦å†…ï¼ˆå…¬é“¾ï¼‰ï¼Œæˆ–è€…æ˜¯åˆçº¦çš„å«é¢„è¨€æœºè¿”å›å€¼çš„æ‰§è¡Œå‡­è¯ï¼ˆè”ç›Ÿé“¾ï¼Œç”¨äºäº‹åå®¡è®¡ï¼‰ã€‚å¯¹äºå‰è€…ï¼Œä½¿ç”¨é“¾ä¸Šé¢„è¨€æœºä¸»è¦åˆ†æˆä¸‰ç§æ–¹å¼ï¼š</p><ol><li>â€œç«‹å³è¯»å–â€ ï¼š ç”¨æˆ·åˆçº¦ç›´æ¥è®¿é—®é¢„è¨€æœºåˆçº¦è¯»å–æ‰€éœ€æ•°æ®ã€‚ï¼ˆé¢„è¨€æœºæ•°æ®å¯èƒ½è¢«æ›´æ–°ï¼Œå¯¼è‡´å¤šæ¬¡è¯»å–ä¸ä¸€è‡´ã€‚éœ€è¦ç»“åˆæ•°æ®ç‰ˆæœ¬ç­‰æœºåˆ¶ä¿è¯ï¼Œè¾ƒä¸ºå¤æ‚ï¼‰</li><li>â€œè®¢é˜…å‘å¸ƒâ€ ï¼š å…³æ³¨é¢„è¨€æœºæ•°æ®çš„å˜åŒ–ã€‚å¯ä»¥é¢„è¨€æœºåˆçº¦åœ¨æ•°æ®å˜åŠ¨æ—¶ï¼ŒåŒæ—¶å‘å‡ºåˆçº¦äº‹ä»¶ã€‚é“¾ä¸‹åº”ç”¨ç›‘å¬ç‰¹å®šçš„åˆçº¦äº‹ä»¶ï¼Œç„¶åç›¸åº”çš„è°ƒç”¨ç”¨æˆ·åˆçº¦ã€‚æœ¬è´¨ä¸Šè¿˜æ˜¯é“¾ä¸‹å‘èµ·çš„ä¸Šé“¾äº¤æ˜“ï¼ŒåŒºåˆ«åªæ˜¯è§¦å‘æ—¶æœºã€‚</li><li>â€œè¯·æ±‚å“åº”â€ ï¼š ç”±ç”¨æˆ·åˆçº¦æ‰§è¡Œæ—¶ç»„è£…è¯·æ±‚ï¼ˆå¸¸è§çš„HTTPè¯·æ±‚ï¼‰å‘é¢„è¨€æœºåˆçº¦è¯·æ±‚æ•°æ®ï¼Œå¹¶ä¸”é™„å¸¦å›è°ƒAPIã€‚é“¾ä¸‹çš„é¢„è¨€æœºåº”ç”¨ç›‘å¬é¢„è¨€æœºåˆçº¦ï¼Œå‘å¤–éƒ¨ç³»ç»Ÿè¯·æ±‚æ•°æ®ï¼Œç„¶åå›å†™åˆ°é¢„è¨€æœºåˆçº¦ï¼ˆä¸Šé“¾æˆ–åˆ†å¸ƒå¼è´¦æœ¬ï¼‰ã€‚ç„¶åé¢„è¨€æœºåˆçº¦å°†æ”¹å“åº”æ•°æ®å›è°ƒå‰è¿°çš„ç”¨æˆ·åˆçº¦å£°æ˜çš„å›è°ƒAPIã€‚<em>å¯ä»¥æ˜¯ç”¨ä»¥GETè·å–æ•°æ®åˆçº¦å†…è®¡ç®—ï¼Œä¹Ÿå¯ä»¥æ˜¯POSTé“¾ä¸‹åº”ç”¨ç³»ç»Ÿè¿›è¡Œå¤æ‚è®¡ç®—ï¼Œè·å–è®¡ç®—ç»“æœã€‚</em>æ­¤è¿‡ç¨‹çš„å…³é”®åœ¨äºä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å®Œæ•´æ€§çœŸå®æ€§ï¼Œå³é˜²æ­¢é¢„è¨€æœºåˆçº¦çš„ä¼ é€’ç¯¡æ”¹ä»¥åŠæ•°æ®æºä½œæ¶ã€‚</li></ol><span id="more"></span><p>ä»¥ä¸‹ä»‹ç»åœ¨Ethereumä¸Šå¾—åˆ°å…³æ³¨è¾ƒå¤šçš„ä¸¤ä¸ªé¢„è¨€æœºï¼ŒOraclizeå’ŒChainlinkã€‚</p><h3 id="Oraclize"><a href="#Oraclize" class="headerlink" title="Oraclize"></a>Oraclize</h3><p><a href="https://www.oraclize.it/"><em>Oraclize</em></a> ä¸­å¿ƒåŒ–é¢„è¨€æœºçš„æ ¸å¿ƒæ˜¯ä½¿ç”¨äº†<a href="https://old.tlsnotary.org/"><em>TSLNotary</em></a> åè®®æ¥è¯æ˜é¢„è¨€æœºåˆçº¦çš„æ•°æ®ä¼ é€’è¿‡ç¨‹çš„çœŸå®æ€§ï¼Œå³æ•°æ®æºç¡®å®æ¥è‡ªäºç”¨æˆ·åˆçº¦æ‰€æƒ³è®¿é—®çš„ç‰¹å®šæœåŠ¡åŠæ•°æ®ã€‚ç®—æ³•çš„å¤§è‡´æ€è·¯æ˜¯ï¼ŒAuditorå’ŒAuditeeé€šè¿‡æ··æ·†ç”µè·¯ï¼Œä¸ç»æ„ä¼ è¾“ç­‰æ–¹å¼ï¼Œå…±äº«ç”ŸæˆTSLåè®®é‡Œçš„é€šä¿¡ä¿¡é“çš„åŠ å¯†å¯†é’¥ã€‚è¿™æ ·Auditeeåœ¨ä¸æ³„æ¼ç™»é™†ä¿¡æ¯ç­‰æ•°æ®çš„å‰æä¸‹ï¼Œæœ‰é€‰æ‹©çš„å‘Auditorè½¬å‘serverç«¯çš„responseï¼ŒåŒæ—¶ä¿è¯è½¬å‘çš„responseæ¥æºã€‚</p><div align="center" style="width:50%;margin:auto">    <img src="/images/sc-oracle/tslnotary.jpg">      å›¾1    TSLNotaryç®—æ³•</div><p>åœ¨Oracilzeçš„æ–¹æ¡ˆé‡Œï¼Œç”¨æˆ·åˆçº¦å‘é¢„è¨€æœºåˆçº¦å‘é€è¯·æ±‚ï¼ŒåŒ…å«è¦è®¿é—®çš„HTTPæœåŠ¡åœ°å€è·¯å¾„ï¼Œæ–¹æ³•å‚æ•°ç­‰ã€‚é“¾ä¸‹çš„Oralizeé¢„è¨€æœºåº”ç”¨æ‰®æ¼”Auditeeè§’è‰²ï¼Œç›‘å¬é“¾ä¸Šé¢„è¨€æœºåˆçº¦ï¼Œå……å½“proxyè¿›è¡ŒHTTPæ•°æ®è¯·æ±‚ã€‚åŒæ—¶ï¼Œåœ¨AWSéƒ¨ç½²äº†äº‘å®ä¾‹å……å½“ç‹¬ç«‹ç¬¬ä¸‰æ–¹Autidorè§’è‰²ï¼Œæ­¤äº‘å®ä¾‹çš„å¯é æ€§å®‰å…¨æ€§å¯ç”¨æ€§åœ¨æ­¤æ–¹æ¡ˆä¸­éå¸¸å…³é”®ã€‚è€ƒè™‘åˆ°Proofçš„ä½“ç§¯å¯èƒ½ä¼šå¾ˆå¤§ï¼Œå¯¹äºåƒEthereumè¿™ç§å¯¹æ•°æ®é‡è®¡è´¹çš„æ–¹å¼ï¼Œé“¾ä¸Šæ ¡éªŒä»£ä»·æ˜‚è´µï¼Œå¯ä»¥é€‰æ‹©å°†Proofä¸Šä¼ åˆ°IPFSï¼Œé“¾ä¸Šè®°å½•Proffçš„IPFSåœ°å€ï¼Œä½œé“¾ä¸‹çš„æ ¡éªŒã€‚å½“å‰ï¼Œé“¾ä¸Šæ ¡éªŒçš„ProofShieldæ–¹å¼ä»ç„¶å¤„åœ¨å®éªŒé˜¶æ®µã€‚</p><blockquote><p><a href="https://ethereum.stackexchange.com/questions/201/how-does-oraclize-handle-the-tlsnotary-secret">How does Oraclize handle the TLSnotary secret?</a> ï¼š åˆ©å¼Šåˆ†æï¼Œå¯¹äºAWSçš„autidorå®ä¾‹å’Œserverç«¯å®‰å…¨æ€§çš„é¡¾è™‘ã€‚æåˆ°å¯¹äºæœ‰é™å‚ä¸æ–¹çš„åœºæ™¯ï¼ˆä¾‹å¦‚è”ç›Ÿé“¾ï¼‰ï¼Œå¯ä»¥è‡ªå·±æ‰®æ¼”auditorå’Œauditeeçš„è§’è‰²ä»¥è§„é¿é£é™©ã€‚</p></blockquote><h3 id="Chainlink"><a href="#Chainlink" class="headerlink" title="Chainlink"></a>Chainlink</h3><p><a href="https://docs.chain.link/"><em>Chainlink</em></a> ä»ä¸­å¿ƒåŒ–åˆ°åˆ†å¸ƒå¼åˆ†ä¸ºä¸‰ç§æ¨¡å¼ã€‚</p><ol><li><p><a href="https://docs.chain.link/architecture-overview/architecture-request-model?parent=gettingStarted">Basic Request Model åŸºæœ¬è¯·æ±‚æ¨¡å‹</a>ã€‚</p><p> <img src="/images/sc-oracle/chainlink-basic-request-model.png" alt=""></p><p> ç±»ä¼¼äºOraclizeçš„æ¨¡å¼ï¼Œé“¾ä¸‹çš„é¢„è¨€æœºåº”ç”¨ç›‘å¬é“¾ä¸Šé¢„è¨€æœºåˆçº¦äº‹ä»¶ï¼Œä»£ä¸ºå‘èµ·é“¾ä¸‹HTTPè®¿é—®ï¼Œè½¬å‘å“åº”ç»“æœè‡³é“¾ä¸Šã€‚ä½†æ­¤æ–¹å¼å¹¶æ²¡æœ‰è€ƒè™‘å’Œè§£å†³é“¾ä¸‹é¢„è¨€æœºçš„ä½œæ¶ï¼Œé“¾ä¸‹é¢„è¨€æœºä¸ºä¸­å¿ƒåŒ–æ¶æ„ã€‚åªèƒ½é€šè¿‡å¯¹åŒä¸€ä¸ªæ•°æ®å¤šæ¬¡è¯·æ±‚ä¸åŒçš„é¢„è¨€æœºæœåŠ¡èšåˆæ¥å‡è½»å…¶é—®é¢˜ã€‚</p></li><li><p><a href="https://docs.chain.link/architecture-overview/architecture-decentralized-model?parent=gettingStarted">Decentralized Data Model åˆ†å¸ƒå¼æ•°æ®æ¨¡å‹</a>ã€‚é’ˆå¯¹å¯¹æ˜¯æ•°æ®feedæµè®¢é˜…çš„æ–¹å¼ï¼Œä¸»è¦æ˜¯ä»·æ ¼ï¼Œåˆ©ç‡ç­‰ä¸æ–­å˜åŠ¨å¹¶ä¸”å®æ—¶æ€§è¦æ±‚é«˜çš„æ•°æ®ã€‚å®˜æ–¹æä¾›äº†éƒ¨åˆ†<a href="https://docs.chain.link/data-feeds/">å¸¸ç”¨feedæ•°æ®</a>ã€‚æ­¤æ¨¡å‹é“¾ä¸Šä¸»è¦æœ‰ä¸‰ç§è§’è‰²ã€‚</p><ul><li>Consumer Contractæ¶ˆè´¹è€…åˆçº¦ã€‚feedæ•°æ®ä½¿ç”¨è€…ã€‚</li><li>Proxy Contractä»£ç†è€…åˆçº¦ã€‚æŒ‡å‘aggregatoråˆçº¦åœ°å€ã€‚consumeré€šè¿‡proxyé—´æ¥è®¿é—®aggretatorã€‚é—´æ¥è®¿é—®ä½¿å¾—consumerå¯ä»¥ä¿æŒç¨³å®šçš„é…ç½®proxyåˆçº¦çš„åœ°å€ï¼Œaggregatoråˆçº¦çš„å‡çº§æ›´æ¢ä¸å½±å“consumerçš„æ­£å¸¸ä½¿ç”¨ï¼Œä¿è¯ä¸šåŠ¡è¿ç»­æ€§ã€‚</li><li>Aggregator Contracèšåˆåˆçº¦ã€‚é“¾ä¸‹å„ä¸ªæ•°æ®æºå°†æ•°æ®å‘é€åˆ°æ­¤åˆçº¦ï¼Œæ­¤åˆçº¦è¿›è¡Œæ•°æ®èšåˆï¼Œä¾‹å¦‚é€‰æ‹©å¤§å¤šæ•°çš„å€¼ï¼Œå°½å¯èƒ½çš„ä¿è¯æ•°æ®çš„å‡†ç¡®æ€§ã€‚æœ‰ä¸¤ç§é“¾ä¸‹è§¦å‘èšåˆè½®æ¬¡çš„è§¦å‘æ—¶æœºã€‚<ul><li>Deviation Threshold: å½“å‰å€¼åç¦»é“¾ä¸Šçš„æœ€æ–°å€¼ä¸€å®šçš„èŒƒå›´ã€‚</li><li>Heartbeat Threshold: å®šæœŸæ›´æ–°ã€‚</li></ul></li></ul></li><li><p><a href="https://docs.chain.link/architecture-overview/off-chain-reporting?parent=gettingStarted">Off-Chain Reporting é“¾ä¸‹èšåˆæŠ¥å‘Š</a>ã€‚å¯¹ä¸Šä¸€ç‚¹çš„æ”¹è¿›ï¼Œå°†é“¾ä¸Šèšåˆè½¬æ¢æˆé“¾ä¸‹èšåˆã€‚å…·ä½“çš„æ–¹æ¡ˆæ˜¯åœ¨é“¾ä¸‹p2pç½‘ç»œé‡Œï¼Œå¤šä¸ªæ•°æ®æä¾›èŠ‚ç‚¹æä¾›ç­¾åæ•°æ®ï¼Œç”±leaderèŠ‚ç‚¹ä½œä¸ºåè°ƒè€…ä½œèšåˆï¼Œå°†èšåˆç»“æœå‘è¿˜å„æä¾›èŠ‚ç‚¹è¿›è¡Œç¡®è®¤å¹¶ç­¾åã€‚ç„¶åéšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹å°†æ­¤æ•°æ®ä¸Šé“¾ï¼Œç”±aggreatoråˆçº¦æ¥éªŒè¯æ­¤æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚é“¾ä¸‹èŠ‚ç‚¹ç›‘è§†ä¸Šé“¾ç»“æœï¼Œé˜²æ­¢æ‰€é€‰èŠ‚ç‚¹ä¸Šé“¾å¤±è´¥ã€‚æ­¤æ–¹å¼å¯ä»¥å‡å°‘ä¸Šé“¾äº¤æ˜“çš„æ•°é‡ï¼ŒåŒä¸€ä¸ªæ•°æ®åªéœ€è¦ä¸Šé“¾ä¸€æ¬¡ï¼›èšåˆæ— éœ€ç­‰åˆ°è¶…è¿‡é˜ˆå€¼æ•°çš„èŠ‚ç‚¹ä¸Šé“¾ï¼Œç¼©çŸ­èšåˆæ—¶é—´ï¼Œä»è€Œä¹Ÿå¯ä»¥å®¹çº³æ›´å¤šçš„æ•°æ®æä¾›æºèŠ‚ç‚¹ï¼Œå¢è¿›æ•°æ®å¯ä¿¡åº¦ã€‚</p></li></ol><blockquote><p><a href="https://stackoverflow.com/questions/72318627/chainlink-newbie-doubts">Chainlink newbie doubts</a>: å¯¹chainlinkå±€é™æ€§çš„åˆ†æ</p></blockquote><hr><p>é¢„è¨€æœºçš„æ—¶æ•ˆæ€§å’Œå‡†ç¡®æ€§è¦ä»æ•°æ®æºå’Œé“¾ä¸‹é¢„è¨€æœºç­‰ä¸¤ä¸ªæ–¹å‘æ¥ä¿è¯ã€‚æ•°æ®æºçš„å¯é æ€§å¸¸è§„æ–¹æ³•æ˜¯é€šè¿‡å¢åŠ æ•°æ®æä¾›æºï¼Œé“¾ä¸Šè¿›è¡Œçš„èšåˆï¼ŒæŠµå¾¡æ‹œå åº­èŠ‚ç‚¹ã€‚æˆ–è€…é“¾ä¸Šé¢„å…ˆé…ç½®å¯ä¿¡æºï¼Œæ•°æ®è¿›è¡Œç­¾åï¼Œé“¾ä¸ŠéªŒè¯æ•°æ®æºèº«ä»½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼ ç»Ÿç½‘ç»œä¸–ç•Œé‡Œçš„CAè¯ä¹¦è®¤è¯ä½“ç³»æ— æ³•ç›´æ¥é€‚ç”¨ã€‚å¯¹äºHTTPè¯·æ±‚è¿™ç±»éå›ºå®šè®¿é—®åœ°å€æ•°æ®ï¼Œéœ€è¦é“¾ä¸‹æœ‰å¯ä¿¡èŠ‚ç‚¹ï¼ˆChainlinkæ˜¯å®Œå…¨ä¿¡èµ–é“¾ä¸‹é¢„è¨€æœºï¼Œè™½ç„¶å¯ä»¥é€šè¿‡è¯·æ±‚å¤šä¸ªé¢„è¨€æœºæ¥ç›¸äº’æ ¡éªŒæ¥æé«˜å¯ä¿¡åº¦ï¼›Oraclizeåˆ™æ˜¯ä¾é å¯ä¿¡çš„ä¸­ç«‹å®¡è®¡è€…ï¼‰ã€‚åœ¨è”ç›Ÿé“¾çš„åœºæ™¯ä¸‹ï¼Œå„æ–¹çš„èº«ä»½éƒ½å¯ä»¥é€šè¿‡èº«ä»½åˆçº¦é…ç½®å’Œæ•°æ®ç­¾åæ ¡éªŒï¼Œå¤šæ–¹å“åº”æ•°æ®èšåˆèƒ½ç›¸å¯¹æœ‰æ•ˆçš„æŠµå¾¡æ‹œå åº­èŠ‚ç‚¹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Smart Contract </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CBDCç³»åˆ—ï¼ˆ2ï¼‰ - æ•°å­—æ¬§å…ƒç ”ç©¶æŠ¥å‘Šï¼ˆåˆ†å±‚æ¶æ„ï¼‰æµ…æ</title>
      <link href="//articles/digital-euro-tiered-model/"/>
      <url>//articles/digital-euro-tiered-model/</url>
      
        <content type="html"><![CDATA[<p>åŸºäºæ¬§å¤®è¡ŒECBäº2021å¹´7æœˆå…¬å¼€çš„æŠ€æœ¯ç ”ç©¶æŠ¥å‘Š<a href="https://www.banque-france.fr/sites/default/files/media/2021/08/02/821220_digital_euro_en.pdf">Digital Euro experiment Combined feasibility â€“ Tiered model</a></p><p>æ¬§å¤®è¡Œæ¢ç´¢æ•°å­—æ¬§å…ƒæŠ€æœ¯å®ç°å¯èƒ½æ€§ï¼Œå…³æ³¨è®°è´¦è´¦æœ¬ï¼Œéšç§ä¸åæ´—é’±ï¼Œæµé€šçš„é™åˆ¶ï¼Œç»ˆç«¯æ¥å…¥4ä¸ªæ–¹é¢ã€‚ä»ä¸­å¿ƒåŒ–å‘åˆ†å¸ƒå¼æ¸å˜çš„æ–¹å‘ï¼Œæ€»å…±åˆ†ä¸ºä»¥ä¸‹4ä¸ªæ€è·¯ï¼š</p><ol><li><em>scale the existing</em> : åŸºäºå½“å‰TIPSï¼ˆTARGET Instant Payment Settlementï¼Œé›¶å”®å¿«é€Ÿæ”¯ä»˜ç³»ç»Ÿï¼‰ï¼Œä¸­å¿ƒåŒ–ç®¡ç†</li><li><em>combined feasibility</em> : ä¸­å¿ƒåŒ–ç³»ç»Ÿç»“åˆåˆ†å¸ƒå¼å¹³å°ï¼ˆä¾‹å¦‚åˆ†å¸ƒå¼è´¦æœ¬DLTï¼‰</li><li><em>a new solutiion</em> : åŸºäºåŒºå—é“¾ï¼Œå›ºå®šé¢é¢çš„tokenä»·å€¼æ¨¡å‹</li><li><em>bearer instrument</em> : ç¡¬ä»¶æ”¯ä»˜è®¾å¤‡ï¼Œæ”¯æŒç¦»çº¿æ”¯ä»˜</li></ol><p>æœ¬æ–¹æ¡ˆæ˜¯æ€è·¯äºŒ <em>combined feasility</em> æå‡ºçš„åˆ†å±‚æ¶æ„ï¼Œç¬¬ä¸€å±‚æ˜¯æ¬§å…ƒç³»ç»Ÿè¿è¡Œçš„ä¸­å¿ƒåŒ–è´¦æœ¬ï¼Œç”±æ¬§å¤®è¡Œé€šè¿‡æ¬§å…ƒæ¸…ç®—ç³»ç»Ÿå‘è¡Œç»™ç›´å‚ï¼›ç¬¬äºŒå±‚åˆ™æ˜¯ç”±è¿è¥æœºæ„åˆ†å‘ç»™ç›´å‚ï¼Œé—´å‚å’Œä¸ªäººæˆ–è€…å…¬å¸ç­‰ç»ˆç«¯ç”¨æˆ·ã€‚è¿™ä¸ªæ–¹æ¡ˆå¸¦æœ‰è¯•éªŒæ€§è´¨ï¼Œç›®çš„å°±æ˜¯ä¸ºåç»­çš„è®¨è®ºå’Œæ”¿ç­–åˆ¶å®šæä¾›å‚è€ƒã€‚</p><blockquote><p>TARGET2 :  ç¬¬äºŒä»£æ³›æ¬§å®æ—¶å…¨é¢è‡ªåŠ¨æ¸…ç®—ç³»ç»Ÿï¼ˆTrans-European Automated Real-time Gross settlement Express Transfer systemï¼‰</p></blockquote><span id="more"></span><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><ol><li>æ•°å­—æ¬§å…ƒï¼ˆDCï¼‰æ˜¯æ¬§å¤®è¡Œçš„ç›´æ¥è´Ÿå€ºã€‚</li><li>äºŒå±‚ç³»ç»Ÿæ»¡è¶³äº’æ“ä½œæ€§ï¼Œå—ç›‘ç®¡ä¸­ä»‹æœºæ„ï¼ˆsupervised intermediaries, ä¾‹å¦‚é“¶è¡Œï¼‰è´Ÿè´£é¢å®¢ï¼Œåœ¨è¯¥å±‚ä¸ºå®¢æˆ·å¼€æˆ·ï¼ˆåŸºäºè´¦æˆ·ä½“ç³»ï¼‰å¼€é’±åŒ…ï¼ˆåŸºäºä»·å€¼ä½“ç³»ï¼‰ã€‚ç»Ÿä¸€åº”ç”¨ç¼–ç¨‹æ¥å£ï¼ˆcommon APIï¼‰æ–¹ä¾¿å¤–éƒ¨æ¥å…¥ï¼Œä¿ç•™è¶³å¤Ÿçš„å¼¹æ€§ç»™å°†æ¥çš„ä¸šåŠ¡åˆ›æ–°å’Œè§£å†³æ–¹æ¡ˆã€‚</li></ol><p><img src="/images/digital-euro-tiered-model/two-tiered-model.jpg" alt=""></p><p><img src="/images/digital-euro-tiered-model/composition-of-each-tier.jpg" alt=""></p><h3 id="å‘è¡Œè¿‡ç¨‹"><a href="#å‘è¡Œè¿‡ç¨‹" class="headerlink" title="å‘è¡Œè¿‡ç¨‹"></a>å‘è¡Œè¿‡ç¨‹</h3><ol><li>TIPSåœ¨è¯•éªŒæ–¹æ¡ˆä¸­ä¸´æ—¶å……å½“ä¸€å±‚ç³»ç»Ÿã€‚ä¸­ä»‹æœºæ„é€šè¿‡åœ¨TARGET2/CLMçš„æ¸…ç®—è´¦æˆ·å‘TIPSçš„æ¸…ç®—è´¦æˆ·è½¬è´¦ã€‚</li><li>TIPSä¸€å±‚ç³»ç»Ÿåœ¨ç›¸åº”çš„ä¸­ä»‹æœºæ„çš„DCè´¦æˆ·ç”Ÿæˆå¯¹åº”æ•°é‡çš„DCï¼ˆ3ï¼‰ã€‚</li><li>ä¸­ä»‹æœºæ„é€šè¿‡æŠ¥æ–‡ç­‰é€šä¿¡æ‰‹æ®µï¼Œè¯·æ±‚ä¸€å±‚ç³»ç»Ÿå°†å…¶DCè´¦æˆ·é‡Œçš„DCè½¬ç§»åˆ°äºŒå±‚è¿è¥ç³»ç»Ÿçš„ä¸­è½¬è´¦æˆ·ã€‚ï¼ˆ3-&gt;4aï¼‰</li><li>äºŒå±‚è¿è¥ç³»ç»Ÿä¸ä¸€å±‚ç³»ç»Ÿè¿é€šï¼ŒDCä»ä¸€å±‚ç³»ç»Ÿé‡Œçš„ä¸­è½¬è´¦æˆ·è½¬ç§»åˆ°äºŒå±‚ç³»ç»Ÿé‡Œçš„å‘è¡Œè´¦æˆ·ã€‚ï¼ˆ4a-&gt;4bï¼‰</li><li>äºŒå±‚ç³»ç»Ÿçš„å‘è¡Œè´¦æˆ·è½¬ç§»åˆ°äºŒå±‚ç³»ç»Ÿé‡Œçš„ä¸­ä»‹æœºæ„è´¦æˆ·ã€‚ï¼ˆ4b-&gt;5ï¼‰</li><li>ä¸­ä»‹æœºæ„è´¦æˆ·è½¬ç§»åˆ°å®¢æˆ·è´¦æˆ·ã€‚ï¼ˆ5-&gt;6ï¼‰</li></ol><h3 id="èµå›è¿‡ç¨‹"><a href="#èµå›è¿‡ç¨‹" class="headerlink" title="èµå›è¿‡ç¨‹"></a>èµå›è¿‡ç¨‹</h3><p>ä¸å‘è¡Œé•œåƒã€‚</p><h3 id="äº¤æ˜“è¿‡ç¨‹"><a href="#äº¤æ˜“è¿‡ç¨‹" class="headerlink" title="äº¤æ˜“è¿‡ç¨‹"></a>äº¤æ˜“è¿‡ç¨‹</h3><ol><li>ä¸¤ä¸ªè´¦æˆ·å±äºåŒä¸€ä¸ªè¿è¥ç³»ç»Ÿçš„ï¼Œåˆ™é€šè¿‡äºŒå±‚é‡Œçš„æ”¶ä»˜åŒæ–¹å„è‡ªçš„ä¸­ä»‹æœºæ„çš„äºŒå±‚è´¦æˆ·ç»“ç®—ã€‚</li><li>è·¨è¿è¥ç³»ç»Ÿçš„äº¤æ˜“ï¼Œä»˜æ¬¾äººçš„DCè´¦æˆ·å…ˆå€Ÿè®°ï¼Œå…¶ä¸­ä»‹æœºæ„çš„äºŒå±‚è´¦æˆ·è´·è®°ã€‚ç„¶åè¯¥ä¸­ä»‹æœºæ„å°†DCè½¬ç§»åˆ°è¯¥äºŒå±‚è¿è¥ç³»ç»Ÿçš„å‘è¡Œè´¦æˆ·ã€‚ç„¶åæ­¤ä¸­è½¬è´¦æˆ·åœ¨ä¸€å±‚å†…è½¬ç§»åˆ°æ”¶æ¬¾æ–¹æ‰€åœ¨è¿è¥ç³»ç»Ÿçš„ä¸­è½¬è´¦æˆ·ï¼Œåç»­ç±»ä¼¼äºå‘è¡Œè¿‡ç¨‹ã€‚ï¼ˆè¯„ï¼šå¼•å…¥ä¸­ä»‹æœºæ„è´¦æˆ·çš„è½¬å‘ï¼Œä»æ–¹æ¡ˆæè¿°çœ‹ï¼Œè¿è¥ç³»ç»Ÿçš„å‘è¡Œè´¦æˆ·ä¸ç›´æ¥ä¸å®¢æˆ·è´¦æˆ·å‘ç”Ÿè”ç³»ï¼Œè€Œå¿…é¡»é€šè¿‡ä¸­ä»‹æœºæ„è´¦æˆ·ã€‚å³ä½¿è¯¥è¿è¥ç³»ç»Ÿçš„å®ä½“åŒæ—¶ä¹Ÿæ˜¯ä¸­ä»‹æœºæ„ï¼Œä¹Ÿéœ€è¦é€šè¿‡è‡ªèº«çš„ä¸­ä»‹æœºæ„è´¦æˆ·ã€‚æ­¤ä¸¾ä¿è¯äº†è´¦æˆ·çš„åˆ’åˆ†èŒèƒ½çš„å•ä¸€æ€§ï¼Œå€¼å¾—å­¦ä¹ ï¼‰</li></ol><ul><li>æ€»çš„æ¥çœ‹ï¼ŒäºŒå±‚<strong>è¿è¥ç³»ç»Ÿ</strong>ä¸<strong>ä¸­ä»‹æœºæ„</strong>æœ‰ä¸€å®šçš„åŒºåˆ«å’Œç‹¬ç«‹æ€§ï¼Œè¿è¥ç³»ç»Ÿåå‘äºæŠ€æœ¯ï¼Œä¸­ä»‹æœºæ„åˆ™æ›´å¤šå…³æ³¨ä¸šåŠ¡ã€‚</li></ul><h2 id="ä¸»è¦ç»“è®º"><a href="#ä¸»è¦ç»“è®º" class="headerlink" title="ä¸»è¦ç»“è®º"></a>ä¸»è¦ç»“è®º</h2><h3 id="1-è´¦æœ¬é€‰æ‹©"><a href="#1-è´¦æœ¬é€‰æ‹©" class="headerlink" title="1. è´¦æœ¬é€‰æ‹©"></a>1. è´¦æœ¬é€‰æ‹©</h3><ol><li>æ¬§å¤®è¡Œè´Ÿè´£å‘è¡Œï¼Œä»è€Œå¯ä»¥æ§åˆ¶å‘è¡Œé‡å’Œæµé€šé‡ï¼ŒåŒæ—¶ä¸æ•°å­—æ¬§å…ƒæ˜¯æ¬§å¤®è¡Œçš„ç›´æ¥è´Ÿå€ºç›¸ç¬¦ã€‚</li><li>æ•°å­—æ¬§å…ƒé€šè¿‡äºŒå±‚ä¸­ä»‹æœºæ„å¯ä»¥å¾ˆå®¹æ˜“ä¸ä¼ ç»Ÿé“¶è¡Œè´¦æˆ·ï¼Œå•†ä¸šç¥¨æ®ç­‰äº’æ¢ï¼Œæ¶‰åŠåˆ°ä¸­ä»‹æœºæ„åœ¨TARGET2çš„æ¸…ç®—è´¦æˆ·å’Œä¸€å±‚DCè´¦æˆ·ã€‚äº¤æ˜“å¯ä»¥æ»¡è¶³å³æ—¶ç»“ç®—ï¼Œå¦‚æœæ˜¯åŒè¿è¥ç³»ç»Ÿåˆ™æ˜¯æœ¬åœ°ç»“ç®—ï¼Œå¦‚æœæ˜¯è·¨ç³»ç»Ÿï¼Œåˆ™æ˜¯é€šè¿‡ä¸€å±‚è´¦æˆ·ã€‚</li><li>äºŒå±‚è¿è¥ç³»ç»Ÿä¸é¢„è®¾æŠ€æœ¯è·¯çº¿ï¼Œè¶³å¤Ÿå¼¹æ€§ï¼ŒäºŒå±‚å¯ä»¥å‘å±•å„è‡ªçš„ç‰¹è‰²ä¸šåŠ¡åˆ›æ–°åº”ç”¨ï¼Œå·²ç»é‡‡ç”¨ä¸åŒçš„æŠ€æœ¯æ¶æ„ä»¥åŠåˆ›æ–°ã€‚å¯ä»¥æ˜¯ä¸­å¿ƒåŒ–è´¦æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯è”ç›Ÿé“¾ï¼Œç§æœ‰é“¾ç­‰åˆ†å¸ƒå¼è´¦æœ¬ã€‚</li><li>å…¨å±€çš„å®¹é”™é¿å…å•ç‚¹æ•…éšœã€‚ä¸€å±‚çš„æ•…éšœï¼Œä¸å½±å“äºŒå±‚è¿è¥ç³»ç»Ÿå†…çš„DCç»§ç»­äº¤æ˜“ï¼›å•ä¸ªäºŒå±‚è¿è¥ç³»ç»Ÿçš„æ•…éšœï¼Œä¹Ÿåªé™å®šåœ¨å½“å‰ç³»ç»Ÿã€‚</li></ol><h3 id="2-ä¸­ä»‹æœºæ„çš„è§’è‰²"><a href="#2-ä¸­ä»‹æœºæ„çš„è§’è‰²" class="headerlink" title="2. ä¸­ä»‹æœºæ„çš„è§’è‰²"></a>2. ä¸­ä»‹æœºæ„çš„è§’è‰²</h3><ol><li>äºŒå±‚ä¸­ä»‹æœºæ„è´Ÿè´£æ•°å­—æ¬§å…ƒçš„æµé€šï¼Œç”¨æˆ·çš„åˆè§„ç®¡ç†ï¼ˆKYCï¼ŒAMLï¼ŒCFTï¼‰ã€‚æŠ€æœ¯ä¸Šå¯ä»¥å°†åˆè§„è§„èŒƒç¼–ç¨‹åˆ°è´¦æˆ·/é’±åŒ…ç²’åº¦ã€‚</li><li>å…è®¸ç¬¬ä¸‰æ–¹æä¾›è´¦æˆ·/é’±åŒ…å¢å€¼æœåŠ¡ã€‚ä¾‹å¦‚ç”¨æˆ·æˆæƒç®¡ç†èšåˆå¤šä¸ªè´¦æˆ·/é’±åŒ…ï¼Œå‘èµ·äº¤æ˜“ï¼ˆé’±åŒ…ä½“ç³»ä¸‹ç®¡ç†ç§é’¥ï¼‰ã€‚æ¶æ„é‡Œç»Ÿä¸€çš„common APIï¼Œä½¿å¾—ç¬¬ä¸‰æ–¹åº”ç”¨å¯ä»¥æ»¡è¶³ä¸€å¤„å¼€å‘ï¼Œåˆ°å¤„é€‚ç”¨ï¼Œä¸è´¦æˆ·/é’±åŒ…çš„å…·ä½“çš„å½’å±è¿è¥ç³»ç»Ÿæ— å…³ã€‚</li><li>åŒæ—¶ï¼Œä¸­ä»‹æœºæ„å¯ä»¥ä»£è¡¨å…¶å®¢æˆ·éƒ¨ç½²æ™ºèƒ½åˆçº¦ã€‚ä¸ç¬¬2ç‚¹æä¾›äº†ä¸¤ç§å¯ç¼–ç¨‹æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯common API + ç¬¬ä¸‰æ–¹æœåŠ¡å•†ï¼Œä»¥åŠsmart contract + äºŒå±‚ä¸­ä»‹æœºæ„ã€‚</li></ol><h3 id="3-éšç§ä¸åˆè§„"><a href="#3-éšç§ä¸åˆè§„" class="headerlink" title="3. éšç§ä¸åˆè§„"></a>3. éšç§ä¸åˆè§„</h3><ol><li>éšç§åˆè§„ä¸ä½™é¢ï¼Œäº¤æ˜“é™é¢æ˜¯ç›¸å…³çš„ã€‚æœ‰é™çš„AML/KYCæœºåˆ¶å¯ä»¥æ–¹ä¾¿éæœ¬åœ°å±…æ°‘ä½¿ç”¨DCï¼Œä¾‹å¦‚åŸºäºä»·å€¼ä½“ç³»çš„åŒ¿åP2Pæ”¯ä»˜äº¤æ˜“ã€‚</li><li>äºŒå±‚ä¸­ä»‹æœºæ„è´Ÿè´£åˆè§„ç®¡ç†ã€‚åœ¨å®¢æˆ·å¼€æˆ·æ—¶ï¼Œåº”è¯¥è¦åšå¼€æˆ·æ£€æŸ¥ï¼Œä¿è¯ç”¨æˆ·åœ¨äºŒå±‚è¿è¥ç³»ç»Ÿé‡Œè´¦å·/é’±åŒ…çš„å”¯ä¸€æ€§ï¼ˆæˆ–è€…æ˜¯å…³è”é’±åŒ…ç­‰ï¼Œå°†æ–°å¼€çš„è´¦å·é’±åŒ…ä¸ç”¨æˆ·å·²æœ‰è´¦å·å…³è”èµ·æ¥ï¼‰ã€‚è¿™æ ·é¿å…ç”¨æˆ·é€šè¿‡å¤šå¼€è´¦å·æ¥é€ƒé¿é™é¢ï¼Œé€ƒç¨ç­‰ã€‚è¿™æ ·çš„ä¿¡æ¯å…±äº«éœ€è¦ä½¿ç”¨é€‚å½“çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œç¬¦åˆGDPRä¿æŠ¤æ¡ä¾‹ã€‚</li></ol><h3 id="4-é™é¢"><a href="#4-é™é¢" class="headerlink" title="4. é™é¢"></a>4. é™é¢</h3><ol><li>æ•°å­—æ¬§å…ƒå¯èƒ½ä¼šå¯¼è‡´å­˜æ¬¾æ¬å®¶ã€‚é™åˆ¶è´¦æˆ·ä½™é¢ä»¥åŠè½¬å‡ºäº¤æ˜“é¢æ˜¯å…¶ä¸­ä¸€ä¸ªåº”å¯¹æ–¹æ¡ˆã€‚åŒæ—¶ä¹Ÿæ˜¯æœ‰åŠ©äºAML/CFTã€‚</li><li>è´¦æˆ·åˆ†çº§ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„è´¦æˆ·è®¾å®šå·®å¼‚åŒ–çš„é™é¢ã€‚</li><li>è´¦æˆ·ä½™é¢é™åˆ¶å¯èƒ½ä¼šå¯¼è‡´åœ¨æ”¶æ¬¾æ—¶è¶…è¿‡é™é¢ã€‚æœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä»¥è§£å†³ï¼š</li></ol><ul><li>è½¬è´¦å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ã€‚ç¼ºç‚¹æ˜¯å½“æ”¶æ¬¾äººçš„ä½™é¢æ˜¯æœºå¯†ä¿¡æ¯æ—¶ï¼Œå¯èƒ½ä¼šæš´éœ²å…¶éšç§ã€‚</li><li>DCè´¦æˆ·ç»‘å®šä¼ ç»Ÿé“¶è¡Œè´¦æˆ·ï¼Œè¶…å‡ºé™é¢éƒ¨åˆ†è‡ªåŠ¨è½¬å­˜åˆ°é“¶è¡Œè´¦æˆ·ã€‚ç¼ºç‚¹æ˜¯å¢åŠ ç»“ç®—è¿‡ç¨‹çš„å¤æ‚æ€§ã€‚</li></ul><h3 id="5-è®¡æ¯"><a href="#5-è®¡æ¯" class="headerlink" title="5. è®¡æ¯"></a>5. è®¡æ¯</h3><ol><li>è­¦æƒ•å¼•å…¥DCå¯èƒ½å¯¼è‡´é“¶è¡Œç³»ç»Ÿçš„å»ä¸­ä»‹åŒ–ï¼Œä»¥åŠé˜»ç¢è´§å¸æ”¿ç­–çš„ä¼ å¯¼ã€‚</li><li>å¯¹äºä¸­ä»‹æœºæ„è€Œè¨€ï¼Œå¦‚æœDCå‚ç…§æ”¯ç¥¨ä¸è®¡æ¯ï¼Œåˆ™åœ¨è´Ÿåˆ©ç‡çš„æ—¶ä»£ï¼Œä¸­ä»‹æœºæ„å€¾å‘äºæŒæœ‰è¶…é‡çš„DCæ¥é¿å…å­˜æ¬¾å‡†å¤‡é‡‘çš„è´Ÿåˆ©ç‡å½±å“ï¼Œä»è€Œå½±å“è´Ÿåˆ©ç‡çš„è´§å¸æ”¿ç­–ä¼ å¯¼ï¼›å¦‚æœDCå‚ç…§å­˜æ¬¾å‡†å¤‡é‡‘çš„è´Ÿåˆ©ç‡æ”¿ç­–ï¼Œåˆ™ä¸­ä»‹æœºæ„ä¼šé¿å…æŒæœ‰DCï¼Œä»è€Œå¯¼è‡´DCçš„æµåŠ¨æ€§ä¸è¶³ã€‚</li><li>æè®®çš„åˆ†å±‚è®¡æ¯æ–¹æ¡ˆã€‚å¯¹ä¸­ä»‹æœºæ„æŒæœ‰çš„DCè®¾ç½®é˜ˆå€¼ï¼Œä½äºé˜ˆå€¼çš„éƒ¨åˆ†è§†ä¸ºç°é‡‘ä¸è®¡æ¯ï¼Œé«˜äºé˜ˆå€¼çš„éƒ¨åˆ†è§†åŒå­˜æ¬¾å‡†å¤‡é‡‘ã€‚</li><li>å¯¹äºç»ˆç«¯ç”¨æˆ·ï¼Œè¶…è¿‡é˜ˆå€¼çš„ä¸è®¡æ¯æˆ–è€…æ­£åˆ©ç‡çš„ä»˜æ¯ï¼Œè¶…è¿‡çš„éƒ¨åˆ†åˆ™æ”¯ä»˜æ›´ä½çš„åˆ©æ¯ï¼Œæœ‰å¯èƒ½æ˜¯è´Ÿåˆ©ç‡ã€‚</li><li><code>To complement this technical analysis, thorough impact assessments of a digital euro on the transmission of monetary policy should be conducted.</code> ä»¥ä¸Šä»…ä»…æ˜¯ç†è®ºåˆ†æï¼Œå…·ä½“çš„æ”¿ç­–è¿˜éœ€è¦æ·±å…¥ç ”ç©¶ã€‚</li></ol><h3 id="6-å¯ç¼–ç¨‹æ€§"><a href="#6-å¯ç¼–ç¨‹æ€§" class="headerlink" title="6. å¯ç¼–ç¨‹æ€§"></a>6. å¯ç¼–ç¨‹æ€§</h3><ol><li>æ¡ä»¶æ”¯ä»˜ï¼šä¾‹å¦‚DvP, PvPç­‰</li><li>è´§å¸çš„å±æ€§å¯ç¼–ç¨‹ï¼š ä¾‹å¦‚åˆ©ç‡ï¼Œé™é¢ï¼Œæ”¶æ¬¾æ–¹çš„é»‘ç™½åå•ç­‰</li></ol><p>æ€»è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¸å…¬å¸ƒå‡ºæ¥çš„åŒå±‚è¿è¥æ¶æ„ä½“ç³»çš„æ€è·¯å¾ˆå¤šåœ°æ–¹ç±»ä¼¼ï¼Œä¹Ÿä¸é¢„è®¾æŠ€æœ¯è·¯çº¿ã€‚ä»æŠ€æœ¯è§’åº¦çœ‹ï¼Œæ•´ä¸ªæ¶æ„çš„å„ä¸ªè§’è‰²ï¼Œè´¦æˆ·åˆ’åˆ†ç‹¬ç«‹æ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿä¿ç•™æœ€å¤§é™åº¦çš„çµæ´»æ€§ã€‚æœ€å¤§çš„é—®é¢˜ï¼Œå¯èƒ½è¿˜æ˜¯åœ¨äºå¦‚æœå¤„ç†å¥½è·Ÿä¼ ç»Ÿé“¶è¡Œè´¦æˆ·ä½“ç³»çš„å…³ç³»ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°è®¡æ¯ï¼Œå­˜æ¬¾æ¬å®¶ï¼Œæœºæ„ç›ˆåˆ©å¯æŒç»­è¿è¥ç­‰ã€‚æ›´å¤šçš„æ”¿ç­–æ€§ä¸šåŠ¡æ€§ç ”ç©¶ï¼Œå¯ä»¥å‚çœ‹ECBåœ¨æ›´æ—©æœŸ2020å¹´10æœˆå…¬å¼€çš„ç ”ç©¶æŠ¥å‘Š<a href="http://www.zentral-bank.eu/pub/pdf/other/Report_on_a_digital_euro~4d7268b458.en.pdf">Report on a digital euro</a>ã€‚æ­¤æŠ€æœ¯ç ”ç©¶æŠ¥å‘Šä¹Ÿæ˜¯åŸºäºæ­¤çš„å®éªŒæŠ¥å‘Šã€‚</p><h4 id="æ›´å¤šå‚è€ƒï¼š"><a href="#æ›´å¤šå‚è€ƒï¼š" class="headerlink" title="æ›´å¤šå‚è€ƒï¼š"></a>æ›´å¤šå‚è€ƒï¼š</h4><blockquote><p><a href="https://www.ecb.europa.eu/paym/intro/news/html/ecb.mipnews221221.en.html">ECB publishes second progress report on the digital euro investigation phase</a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> CBDC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CBDCç³»åˆ—ï¼ˆ1ï¼‰ - OpenCBDCé¡¹ç›®</title>
      <link href="//articles/open-cbdc/"/>
      <url>//articles/open-cbdc/</url>
      
        <content type="html"><![CDATA[<p>åŸºäº2022å¹´2æœˆå…¬å¼€å‘å¸ƒçš„OpenCBDCé¡¹ç›®ï¼ˆBoston Fed &amp; MITè”åˆç ”ç©¶é¡¹ç›®ï¼Œä¹Ÿç§°Hamiltoné¡¹ç›®ï¼‰èµ„æ–™ï¼š</p><blockquote><p>è®ºæ–‡ : <a href="https://eprint.iacr.org/2022/163.pdf">A High Performance Payment Processing System Designed for Central Bank Digital Currencies</a><br>githubä»“åº“ : <a href="https://github.com/mit-dci/opencbdc-tx">OpenCBDC</a>  </p></blockquote><h3 id="è®¾è®¡ç›®æ ‡"><a href="#è®¾è®¡ç›®æ ‡" class="headerlink" title="è®¾è®¡ç›®æ ‡"></a>è®¾è®¡ç›®æ ‡</h3><p>å½“å‰é˜¶æ®µ1å±äºç ”ç©¶æ€§è´¨ï¼Œæ›´å¤šæ˜¯åœ¨äºæ¢ç´¢æŠ€æœ¯ä¸Šçš„å¯èƒ½æ€§ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå³æ’å³ç”¨çš„æˆç†Ÿæ–¹æ¡ˆã€‚è®¾è®¡ç›®æ ‡ç€çœ¼äºæ€§èƒ½ä»¥åŠå®¹é”™ï¼ŒåŒæ—¶ä¿ç•™è¶³å¤Ÿçš„çµæ´»æ€§ï¼ˆä¸é™å®šå‘è¡Œçš„æ–¹å¼ï¼Œæ”¯æŒä¸­å¤®é“¶è¡Œç›´æ¥é›¶å”®å‘è¡Œï¼Œä¹Ÿæ”¯æŒç±»ä¼¼äºæ•°å­—äººæ°‘å¸çš„æ‰¹å‘-é›¶å”®åŒå±‚è¿è¥æ¨¡å¼ï¼‰ã€‚åŒæ—¶ï¼Œå¯¹äºå…¶ä»–çš„è¯¾é¢˜ï¼Œä¾‹å¦‚éšç§ä¿æŠ¤ï¼Œé£æ§ï¼Œåˆè§„ï¼Œç›‘ç®¡ï¼Œå•†ä¸šåŒ–ç­‰ä¹Ÿæ²¡æœ‰æ·±å…¥è®¨è®ºã€‚ï¼ˆå¯¹äºéšç§ä¿æŠ¤ï¼Œè®ºæ–‡é‡Œæåˆ°æœ€å®‰å…¨æ–¹å¼å°±æ˜¯ä»äº¤æ˜“æºå¤´å¼€å§‹å°½å¯èƒ½çš„å°‘æ”¶é›†æ•°æ®ï¼Œè¿™ä¸ªä¹Ÿåœ¨é˜¶æ®µ1çš„è®¾è®¡è€ƒè™‘ä¸­ã€‚<em>å½“ç„¶ï¼Œéšç§ä¿æŠ¤ä¸ç›‘ç®¡é£æ§çš„ç›®æ ‡åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯å¯¹ç«‹çš„ã€‚</em>ï¼‰è¿™äº›é—®é¢˜ä¼šåœ¨é˜¶æ®µ2é‡Œé˜è¿°ã€‚</p><h3 id="è®¾è®¡æ€æƒ³"><a href="#è®¾è®¡æ€æƒ³" class="headerlink" title="è®¾è®¡æ€æƒ³"></a>è®¾è®¡æ€æƒ³</h3><ol><li>UTXOæ¨¡å‹ã€‚ç”¨æˆ·æŒæœ‰æ•°å­—é’±åŒ…ï¼Œä½¿ç”¨ç§é’¥ç­¾åçš„æ–¹å¼æ¥æ¶ˆè´¹ã€‚</li><li>åˆ†å±‚è§£è€¦ã€‚å°†äº¤æ˜“çš„åˆæ³•æ€§éªŒè¯å’Œèµ„é‡‘çš„å­˜åœ¨æ€§éªŒè¯åˆ†ç¦»ï¼Œåªæœ‰åˆæ³•æ€§éªŒè¯æ‰éœ€è¦äº¤æ˜“çš„ç»†èŠ‚ä¿¡æ¯ï¼Œæœ€å°åŒ–äº¤æ˜“å¤„ç†æ ¸å¿ƒå±‚çš„å­˜å‚¨ï¼ˆä¸æ¶‰åŠç”¨æˆ·ä¸ªäººä¿¡æ¯ç­‰ï¼‰ã€‚æ ¸å¿ƒå±‚ç®€å•çš„åªåšçº¯ç²¹çš„èµ„é‡‘äº¤æ˜“ï¼ˆUTXOçš„ç”Ÿæˆå’Œé”€æ¯ï¼‰ï¼Œä¿è¯ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚è´§å¸çš„æ‰©å±•åŠŸèƒ½åšåœ¨å¤–å±‚ã€‚</li><li>åŸºäºUHS(Unspent funds Hash Set)å’Œç±»ä¼¼æ¯”ç‰¹å¸äº¤æ˜“çš„æ•°æ®ç»“æ„ã€‚å…¼å®¹æœªæ¥è­¬å¦‚ç±»ä¼¼åœ°æ·»åŠ é”å®šè„šæœ¬ç­‰ï¼Œè€Œæ— éœ€ä¿®æ”¹UHSäº¤æ˜“æ ¸å¿ƒå±‚çš„å‰æä¸‹å®ç°æ‰©å±•åŠŸèƒ½ã€‚</li></ol><span id="more"></span><h3 id="è´¦æˆ·æ¨¡å‹-VS-UTXOæ¨¡å‹"><a href="#è´¦æˆ·æ¨¡å‹-VS-UTXOæ¨¡å‹" class="headerlink" title="è´¦æˆ·æ¨¡å‹ VS. UTXOæ¨¡å‹"></a>è´¦æˆ·æ¨¡å‹ VS. UTXOæ¨¡å‹</h3><ol><li>UTXOæœ‰æ›´å¥½çš„æ‰§è¡Œå¹¶è¡Œåº¦ï¼Œè´¦æˆ·æ¨¡å‹éœ€è¦é”å®šè´¦æˆ·ã€‚OpenCBDCé€‰æ‹©UTXOæ¨¡å‹ã€‚</li><li>è´¦æˆ·æ¨¡å‹æ›´å…·æ˜“ç¼–ç¨‹æ€§ã€‚</li><li><code>Account banlances are more fungible, which is an important property for money.</code></li><li><code>It might be useful to consider an account balance data model which minimizes the amount of data stored in the transaction processor in the future.</code> æœªæ¥å¯èƒ½å°è¯•å¯¹æ¯”è´¦æˆ·æ¨¡å‹ã€‚</li><li>ä¸¤ç§æ¨¡å‹éƒ½æ”¯æŒè´¦æˆ·æ¨¡å‹å¼çš„ç”¨æˆ·ç•Œé¢UIã€‚</li></ol><h3 id="UTXOæ•°æ®ç»“æ„"><a href="#UTXOæ•°æ®ç»“æ„" class="headerlink" title="UTXOæ•°æ®ç»“æ„"></a>UTXOæ•°æ®ç»“æ„</h3><p><code>utxo := (v,P,sn)</code>    </p><ol><li><code>v</code>: valueï¼Œé‡‘é¢ã€‚</li><li><code>P(tx, wit)</code>: predicate. <code>tx</code>: æ¶ˆè´¹æ­¤UTXOçš„äº¤æ˜“ï¼Œ<code>wit</code>: witnessï¼Œè§è¯ã€‚åœ¨æ”¯æŒæ•°å­—ç­¾åçš„æ–¹æ¡ˆé‡Œ<code>P</code>ç¡¬ç¼–ç pkï¼Œå¹¶ä¸”<code>P</code>æ ¡éªŒ<code>w</code>åŒ…å«è¯¥pkçš„ç­¾åã€‚åœ¨åªæ”¯æŒæ•°å­—ç­¾åçš„æ–¹æ¡ˆé‡Œï¼Œ<code>P</code>å¯ä»¥è¿‘ä¼¼ç­‰åŒäº<code>pk</code>ã€‚</li><li><code>sn</code>: serial numberï¼Œå…¨å±€å”¯ä¸€çš„åºåˆ—å·ï¼Œç”¨äºä¿è¯UTXOçš„å”¯ä¸€æ€§ï¼Œé˜²æ­¢é‡æ”¾åŒèŠ±ã€‚<code>our system assigns each UTXO a serial number by deterministically hashing all the corresponding transactionâ€™s inputs, as well as the output UTXOâ€™s encumbrance, value, and its index among all outputs.</code> é“¸å¸çš„<code>sn</code>é€‰æ‹©ä¸ºå‡åŒ€åˆ†å¸ƒéšæœºæ•°æˆ–è€…å…¨å±€å•è°ƒé€’å¢æ•°ã€‚</li><li>äº¤æ˜“ä¸å…·æœ‰å»¶å±•æ€§ï¼ˆnon-malleableï¼‰ï¼Œå¯å‚è€ƒæ¯”ç‰¹å¸ï¼Œé˜²åŒèŠ±ã€‚<code>we require signatures to cover all fields of uniquely-encoded transaction and derive UTXO serial numbers from the same fields (plus, output indexes).</code></li></ol><h3 id="äº¤æ˜“ç³»ç»Ÿçš„åŒå±‚è®¾è®¡æ€æƒ³"><a href="#äº¤æ˜“ç³»ç»Ÿçš„åŒå±‚è®¾è®¡æ€æƒ³" class="headerlink" title="äº¤æ˜“ç³»ç»Ÿçš„åŒå±‚è®¾è®¡æ€æƒ³"></a>äº¤æ˜“ç³»ç»Ÿçš„åŒå±‚è®¾è®¡æ€æƒ³</h3><ol><li><code>transaction-local validation</code>äº¤æ˜“åˆæ³•æ€§éªŒè¯ã€‚ä¸»è¦æ ¡éªŒæ•°æ®ç»“æ„ï¼Œè¾“å…¥è¾“å‡ºé‡‘é¢ç›¸ç­‰ï¼Œç­¾åç­‰ã€‚æ— çŠ¶æ€ï¼Œè®¡ç®—å¯†é›†å‹ã€‚ç”ŸæˆUHSï¼Œå³cryptographic commitments <code>h := H(v, P, sn)</code>ã€‚ä½¿ç”¨hashå€¼ä»£æ›¿äº¤æ˜“æœ¬èº«ï¼Œåˆ©ç”¨hashç¢°æ’æä½æ¦‚ç‡çš„ç‰¹æ€§ã€‚</li><li><code>existence validation</code>äº¤æ˜“å¼•æ“ã€‚å­˜å‚¨UHSï¼Œæ‰§è¡Œå®é™…çš„swapæ“ä½œï¼ˆUHSçš„å¢åˆ ï¼Œå³å¯¹åº”ç€UTXOçš„ç”Ÿæˆé”€æ¯ï¼‰ã€‚å­˜å‚¨å¯†é›†å‹ã€‚  </li></ol><h4 id="è®¾è®¡å…³é”®æ€è€ƒï¼š"><a href="#è®¾è®¡å…³é”®æ€è€ƒï¼š" class="headerlink" title="è®¾è®¡å…³é”®æ€è€ƒï¼š"></a>è®¾è®¡å…³é”®æ€è€ƒï¼š</h4><ul><li>æŒ‰éœ€å¼¹æ€§æ¨ªå‘æ‰©å®¹ã€‚</li><li>èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚äº¤æ˜“å¼•æ“åªå­˜å‚¨32å­—èŠ‚çš„hashå€¼ã€‚</li><li>å¼¹æ€§è®¾è®¡ã€‚äº¤æ˜“å¼•æ“çš„UHSç»“æ„ä¹Ÿå¯ä»¥ç”¨äºè´¦æˆ·æ¨¡å‹ã€‚<code>The UHS makes no assumptions about what hashes represent, and this data structure is not limited to UTXOs; it could be applied to a digital currency with balances or some other application that requires atomically swapping hashes.</code> <em>è´¦æˆ·æ¨¡å‹ä¸‹å…·ä½“å¦‚ä½•å¯¹åº”UHSçš„å¢åˆ ä»ç„¶æœ‰å¾…è§‚å¯Ÿï¼Œä¸€ç§æ–¹å¼æ˜¯è´¦æˆ·æ¨¡å‹ä¸‹è®°è´¦å…³è”UTXOï¼Œç”±åˆæ³•æ€§éªŒè¯sentinelæ¥æ‹†åˆ†åˆå¹¶UTXO</em></li><li>éšç§ä¿æŠ¤åŠç›‘ç®¡å®¡è®¡ã€‚äº¤æ˜“å¼•æ“åŠŸèƒ½å•ä¸€ï¼ŒUHSæ²¡æœ‰åŒ…å«äº¤æ˜“ç»†èŠ‚ã€‚è¿™éƒ¨åˆ†åŠŸèƒ½æ”¾åˆ°sentinelç­‰å¤–å›´ç³»ç»Ÿï¼Œæˆ–è€…æ˜¯ä½¿ç”¨éšç§è®¡ç®—ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯åšæœ¬åœ°åŒ–éªŒè¯ï¼Œæäº¤é›¶çŸ¥è¯†è¯æ˜å’ŒUHSï¼Œè€Œä¸æ˜¯åŸå§‹çš„äº¤æ˜“æœ¬èº«ï¼Œæœ€å¤§ç¨‹åº¦çš„ä¿æŠ¤éšç§ã€‚</li><li>ç¼–ç¨‹æ€§ã€‚å¹¶å‘å¤„ç†ä¸‹ï¼ŒUTXOç›¸å¯¹è´¦æˆ·æ¨¡å‹å…·æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œè´¦æˆ·æ¨¡å¼éœ€è¦é”å®šè´¦æˆ·ï¼ŒUTXOé”å®šçš„ç²’åº¦æ›´å°ã€‚ä½†æ˜¯ï¼ŒUTXOè¦å®ç°å¤æ‚çš„æ™ºèƒ½åˆçº¦éš¾åº¦æ›´å¤§ï¼Œéœ€è¦åœ¨åç»­æ™ºèƒ½åˆçº¦è§¦å‘ä½¿ç”¨UTXOæ—¶çŸ¥é“çŠ¶æ€è½¬ç§»é“¾ï¼Œä»¥åŠæ¯ä¸ªçŠ¶æ€çš„UTXOæ‰èƒ½æ„é€ äº¤æ˜“ã€‚è€Œè´¦æˆ·æ¨¡å‹ä»…ä»…éœ€è¦è´¦æˆ·æ ‡å¿—ã€‚</li><li>UTXOçš„è·å–ã€‚UTXOè®°å½•åœ¨ç”¨æˆ·æœ¬åœ°ï¼Œäº¤æ˜“å®Œæˆéœ€è¦é€šçŸ¥æ”¶å‘åŒå‘ã€‚ç”¨æˆ·ä¸¢å¤±UTXOï¼Œæˆ–è€…æ›´æ¢è®¾å¤‡UTXOè½¬ç§»å¤±è´¥ï¼Œéƒ½éœ€è¦æ¢å¤ã€‚ä½†æ˜¯å½“å‰è®¾è®¡ä¸‹æ•´ä¸ªç³»ç»Ÿæ²¡æœ‰è®°å½•UTXOï¼Œéœ€è¦ç¬¬ä¸‰æ–¹ç³»ç»ŸååŠ©ã€‚</li></ul><h3 id="äº¤æ˜“æ¨¡å‹"><a href="#äº¤æ˜“æ¨¡å‹" class="headerlink" title="äº¤æ˜“æ¨¡å‹"></a>äº¤æ˜“æ¨¡å‹</h3><ul><li><p>äº¤æ˜“æ•°æ®ç»“æ„<br></p><div align="center" style="width:50%;margin:auto">  <img src="/images/opencbdc/tx-format.jpeg"></div><br>  UTXOçš„åºåˆ—å·<code>sn := (txid, idx). The first component, txid is the unique transaction identifier: the cryptographic hash of the Mint or Transfer transaction that created this UTXO. This hash covers all input UTXOs, output encumbrances and values. The second component, idx, is the particular output index, i.e., first, second, etc, output of the transaction.</code><p></p></li><li><p>äº¤æ˜“å¼•æ“çš„å­˜å‚¨åŠåŸå­æ€§swapå¤„ç†<br><img src="/images/opencbdc/compact-tx.jpeg" alt=""></p></li></ul><h3 id="ç”¨æˆ·ä½“éªŒåŠäº¤äº’åœºæ™¯"><a href="#ç”¨æˆ·ä½“éªŒåŠäº¤äº’åœºæ™¯" class="headerlink" title="ç”¨æˆ·ä½“éªŒåŠäº¤äº’åœºæ™¯"></a>ç”¨æˆ·ä½“éªŒåŠäº¤äº’åœºæ™¯</h3><ol><li>äº¤äº’åœºæ™¯æ”¶å‘åŒæ–¹éœ€è¦åå•†ï¼Œå‘é€æ–¹éœ€è¦å¾—åˆ°æ¥æ”¶æ–¹çš„pkã€‚æ¥æ”¶è€…éœ€è¦æ”¶åˆ°output utxoï¼Œå¹¶ä¸”ç¡®è®¤è¿™ç¬”transferäº¤æ˜“æˆåŠŸï¼Œå¦åˆ™è¿™ç¬”èµ„é‡‘æœ‰å¯èƒ½æ— æ³•è¢«ä½¿ç”¨ã€‚<code>The recipient should not consider a payment â€œcompleteâ€ until they have received both a confirmation from the transaction processor and the full preimage data for their new outputs.</code></li><li>éäº¤äº’çš„äº¤æ˜“åœºæ™¯ï¼Œä¾‹å¦‚æ‰«æé™æ€äºŒç»´ç æ…ˆå–„ææ¬¾åœºæ™¯ï¼Œäº¤æ˜“ç³»ç»Ÿå…ˆå­˜å‚¨è¿™äº›outputï¼Œæ¥æ”¶æ–¹åç»­æŸ¥è¯¢ã€‚éœ€è¦ç³»ç»Ÿå­˜å‚¨pkå’Œutxoçš„å¯¹åº”å…³ç³»ï¼Œäº¤æ˜“é—´çš„å…³ç³»å®¹æ˜“è¢«è¿½è¸ªï¼Œæœ‰éšç§æ³„éœ²çš„éšæ‚£ã€‚  </li></ol><h4 id="äº¤æ˜“ç³»ç»Ÿç¡®è®¤æ–¹å¼"><a href="#äº¤æ˜“ç³»ç»Ÿç¡®è®¤æ–¹å¼" class="headerlink" title="äº¤æ˜“ç³»ç»Ÿç¡®è®¤æ–¹å¼"></a>äº¤æ˜“ç³»ç»Ÿç¡®è®¤æ–¹å¼</h4><ul><li>äº¤æ˜“æ‰§è¡ŒæˆåŠŸåï¼Œäº¤æ˜“ç³»ç»Ÿå¯¹ç»“æœç­¾åï¼Œè¿”å›å‘é€æ–¹ã€‚å‘é€æ–¹ç›´æ¥ä¸­ç»§ç»™æ¥æ”¶æ–¹ç¡®è®¤ã€‚</li><li>æ„é€ äº¤æ˜“æ—¶ï¼Œäº¤æ˜“ç»“æ„å¢åŠ <code>callback endpoint</code>ã€‚äº¤æ˜“ç³»ç»Ÿæ‰§è¡ŒæˆåŠŸåï¼Œå›è°ƒæ­¤endpointé€šçŸ¥æ¥æ”¶æ–¹ã€‚æ­¤æ–¹æ¡ˆä¾èµ–äºcallback endpointçš„å¯ç”¨æ€§ï¼Œæš‚æ—¶ä¸å¯ç”¨æ—¶éœ€è¦æ”¯æŒé™çº§æŸ¥è¯¢åŠŸèƒ½ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å­˜å‚¨éœ€æ±‚ï¼Œä¹Ÿå°±è®°å½•äº¤æ˜“ä¸»ä½“å’Œäº¤æ˜“æœ¬èº«çš„å…³è”å…³ç³»ã€‚<em>æœ¬æ–¹æ¡ˆé‡Œå¾ˆå…³æ³¨éšç§ä¿æŠ¤çš„è€ƒè™‘ï¼Œä¹Ÿå°±æ˜¯å°½å¯èƒ½çš„å‡å°‘äº¤æ˜“å¯è¢«è¿½è¸ªçš„å¯èƒ½æ€§ã€‚æ­¤ç¡®è®¤æ–¹å¼æœ‰æ‰€å†²çª</em>ã€‚</li></ul><h4 id="äº¤æ˜“æ–¹å¼å±€é™æ€§"><a href="#äº¤æ˜“æ–¹å¼å±€é™æ€§" class="headerlink" title="äº¤æ˜“æ–¹å¼å±€é™æ€§"></a>äº¤æ˜“æ–¹å¼å±€é™æ€§</h4><p>å½“å‰ <strong>æ— æ³•</strong> æ”¯æŒç”±æ”¶æ¬¾æ–¹ä¸»åŠ¨å‘èµ·ï¼ˆä¾‹å¦‚ä»£å‘å·¥èµ„ï¼Œåˆ’æ‰£ç”Ÿæ´»ç¼´è´¹ç­‰åœºæ™¯ï¼‰ï¼Œå› ä¸ºæ„é€ äº¤æ˜“éœ€è¦æŒ‡å®šinput utxoå¹¶ä¸”å‘é€æ–¹ç­¾åï¼Œåœ¨ç¼ºå°‘å‘é€æ–¹çš„çŸ¥è¯†å’Œç§é’¥çš„æƒ…å†µä¸‹ï¼Œéš¾ä»¥æ„é€ åˆæ³•äº¤æ˜“ã€‚<em>è´¦æˆ·æ¨¡å¼ä»¥è®°è´¦æ¨¡å¼æ¯”è¾ƒå®¹æ˜“å®ç°ã€‚</em></p><h3 id="äº¤æ˜“ç³»ç»Ÿæ¶æ„è®¾è®¡"><a href="#äº¤æ˜“ç³»ç»Ÿæ¶æ„è®¾è®¡" class="headerlink" title="äº¤æ˜“ç³»ç»Ÿæ¶æ„è®¾è®¡"></a>äº¤æ˜“ç³»ç»Ÿæ¶æ„è®¾è®¡</h3><h4 id="1-å…¨å±€æœ‰åºæ–¹æ¡ˆ"><a href="#1-å…¨å±€æœ‰åºæ–¹æ¡ˆ" class="headerlink" title="1. å…¨å±€æœ‰åºæ–¹æ¡ˆ"></a>1. å…¨å±€æœ‰åºæ–¹æ¡ˆ</h4><p><strong><em>TBD</em></strong></p><h4 id="2-ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ"><a href="#2-ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ" class="headerlink" title="2. ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ"></a>2. ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ</h4><p><img src="/images/opencbdc/2PC-architecture.jpeg" alt=""></p><ul><li>æ‰¹é‡æ‰§è¡Œã€‚ä¸¤é˜¶æ®µæ‰§è¡Œç»“æœæ˜¯å…·å¤‡ç¡®å®šæ€§çš„ï¼Œæ‰¹é‡å†…çš„äº¤æ˜“å¯èƒ½ä¼šå› ä¸ºç›¸äº’å†²çªå¯¼è‡´éƒ¨åˆ†å¤±è´¥ã€‚</li><li><p>é›†ç¾¤å®¹é”™ã€‚æ¯ä¸ªç»„ä»¶éƒ½ä½¿ç”¨Raftåè®®ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>  <em>å·¥ç¨‹å®ç°ä¸Šä»ç„¶è¿˜æœ‰å¾ˆå¤šç»†èŠ‚éœ€è¦è€ƒè™‘è®¾è®¡ï¼Œæç«¯åœºæ™¯ï¼Œè¾¹ç¼˜åœºæ™¯ç­‰ï¼Œè¿™äº›æ— æ³•åœ¨è®ºæ–‡é‡Œå±•å¼€è¯¦è¿°ã€‚</em></p></li></ul><h3 id="æœªæ¥çš„å·¥ä½œ"><a href="#æœªæ¥çš„å·¥ä½œ" class="headerlink" title="æœªæ¥çš„å·¥ä½œ"></a>æœªæ¥çš„å·¥ä½œ</h3><ol><li>éšç§ä¿æŠ¤ï¼Œè´¹ç”¨ï¼Œé£æ§ï¼Œåˆè§„</li><li>ä¸­é—´æœºæ„ï¼ˆä¾‹å¦‚å•†ä¸šé“¶è¡Œï¼‰çš„ä½œç”¨</li><li>ç¦»çº¿æ”¯ä»˜</li><li>é˜²æ­¢DoSæ”»å‡»</li><li>ä¸°å¯Œä½¿ç”¨åœºæ™¯ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚é€šçŸ¥æ”¶å‘åŒæ–¹ç¡®è®¤äº¤æ˜“å®Œæˆå’Œéšç§ä¿æŠ¤é—´çš„å¹³è¡¡</li><li>æå‡ç³»ç»Ÿæ€§èƒ½ï¼ˆå…ˆæ¶ˆè´¹input UTXOï¼Œå»¶è¿Ÿç”Ÿæˆoutput UTXOï¼‰</li></ol><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><ol><li><p>CBDCé¢†åŸŸé‡ŒUTXOæ¨¡å‹æœ‰å±€é™æ€§ï¼ŒæŸäº›åœºæ™¯ä¸‹ç­‰åŒäºè´¦æˆ·æ¨¡å‹ã€‚</p><ul><li>æ­£å¦‚è®ºæ–‡é‡Œæåˆ°çš„ç”¨æˆ·ä½“éªŒï¼Œå¦‚ä½•å°†å¯ç”¨UTXOé€šçŸ¥åˆ°ç”¨æˆ·ï¼Œå¹¶ä¸”éœ€è¦èƒ½æ”¯æŒæŸ¥è¯¢ï¼Œæ¢å¤ã€‚è¿™å°±æ¶‰åŠåˆ°UTXOçš„å­˜å‚¨å’Œç”¨æˆ·å…³ç³»ï¼ˆå¯èƒ½æ˜¯pkï¼‰çš„ç®¡ç†ï¼Œè¿™å°±ç±»ä¼¼äºè´¦æˆ·æ¨¡å‹äº†ã€‚ä¸€æ—¦pkå…³è”çš„ç”¨æˆ·è¢«è·å¾—ï¼Œå°±å®Œå…¨é€€åŒ–ä¸ºè´¦æˆ·æ¨¡å‹ã€‚</li><li>ç›®å‰éš¾ä»¥å®ç°ç”±æ”¶æ¬¾æ–¹ä¸»åŠ¨å‘èµ·ä¸”ä»˜æ¬¾æ–¹ä¸€æ¬¡æˆæƒåç»­æ— éœ€å‚ä¸çš„äº¤æ˜“ï¼Œå› ä¸ºå‰ææ˜¯éœ€è¦è·å–åˆ°ä»˜æ¬¾æ–¹çš„å¯ç”¨UTXOã€‚å¯ä»¥ç”±è´§å¸å‘è¡Œæ–¹ç»Ÿä¸€ç®¡ç†å’Œè®°å½•ï¼Œç”¨æˆ·å’ŒUTXOçš„å¯¹åº”å…³ç³»ï¼Œä½†è¿™ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿç­‰ä»·äºè´¦æˆ·æ¨¡å‹ã€‚æˆ–è€…æˆæƒç¬¬ä¸‰æ–¹ï¼Œè¿™éœ€è¦ä»˜æ¬¾æ–¹åŠæ—¶å°†å¯ç”¨UTXOå‘é€åˆ°ç¬¬ä¸‰æ–¹ï¼Œä¿è¯å……è¶³çš„å¤´å¯¸ã€‚è¿™äº›æ–¹æ¡ˆéƒ½éœ€è¦å°†ç§é’¥æ‰˜ç®¡ã€‚è¿™å°±æ¶‰åŠåˆ°éšç§ä¿æŠ¤å’Œæ”¯ä»˜å®‰å…¨çš„é—®é¢˜ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡ç­¾è®¢åè®®ï¼Œä»¥åŠä¸ºä¸åŒçš„åœºæ™¯ç”Ÿæˆä¸åŒçš„å¯†é’¥å¯¹æ¥ä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤ã€‚è´¦æˆ·æ¨¡å‹ä¸‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¼€ç«‹ä¸“ç”¨è´¦æˆ·è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚</li><li>CBDCé¢†åŸŸé‡Œå·®é”™å¤„ç†æ˜¯éå¸¸é‡è¦çš„ï¼Œå½“å‰å¸¸ç”¨çš„è´¦æˆ·æ¨¡å‹ä¸‹è´§å¸è®°è´¦æ–¹æ‹¥æœ‰æ›´å¤šçš„æ§åˆ¶æƒï¼Œä½¿ç”¨å†²æ­£ç­‰æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒæˆç†Ÿï¼Œèƒ½æœ‰æ•ˆé¿å…èµ„æŸã€‚ç›¸å¯¹æ¥è¯´UTXOæ¨¡å‹æ›´åŠ ä¾èµ–å³æ—¶æ¸…ç»“ç®—çš„ç¡®å®šæ€§ã€‚</li><li>ç±»ä¼¼è´¦æˆ·æ¨¡å‹çš„åˆ†çº§ç®¡ç†ç­‰é£æ§æ‰‹æ®µï¼Œä¸šåŠ¡è§„åˆ™åœ¨UTXOæ¨¡å‹ä¸‹å¯èƒ½éš¾ä»¥ä½¿ç”¨ã€‚</li></ul></li><li><p>æ™ºèƒ½åˆçº¦ä¸UTXOç»“åˆæ›´èƒ½è¾¾åˆ°å¯¹æ”¯ä»˜çš„æœ‰æ•ˆæ§åˆ¶ã€‚<br>UTXOæ¨¡å‹ä¸‹ï¼Œæ™ºèƒ½åˆçº¦çš„ä»£ç æ˜¯å†…ç”Ÿåœ¨UTXOæ•°æ®ç»“æ„æœ¬èº«çš„ï¼ˆwitnesså­—æ®µï¼‰ï¼Œç±»ä¼¼äºæ¯”ç‰¹å¸é‡Œçš„é”å®šè„šæœ¬ï¼Œæ™ºèƒ½åˆçº¦æ§åˆ¶ç€UTXOæ˜¯å¦èƒ½è¢«æ¶ˆè´¹ã€‚è€Œç›¸æ¯”ä¹‹ä¸‹è´¦æˆ·æ¨¡å‹ä¸‹æ™ºèƒ½åˆçº¦çš„æ‰§è¡Œå’Œè®°è´¦æœ¬èº«æ˜¯åˆ†ç¦»çš„ï¼Œç†è®ºä¸Šå­˜åœ¨ç»•å¼€æ™ºèƒ½åˆçº¦ç›´æ¥æ”¹åŠ¨è´¦æœ¬çš„å¯èƒ½æ€§ã€‚å½“ç„¶ï¼Œwitnesså­—æ®µå¿…é¡»å°½å¯èƒ½çš„å°‘å æ®ç©ºé—´ï¼Œå› æ­¤ä¹Ÿé™åˆ¶äº†æ™ºèƒ½åˆçº¦çš„å¤æ‚æ€§ï¼ŒåŒæ—¶èƒ½å¤Ÿé€šè¿‡è„šæœ¬è¯­è¨€åšåˆ°å›¾çµå®Œå¤‡ï¼Œæˆ–è€…ç®€åŒ–çš„æ»¡è¶³CBDCé¢†åŸŸçš„éœ€è¦ï¼Œè¿™ç‚¹ä»ç„¶æœ‰å¾…æ›´å¤šçš„ç ”ç©¶ã€‚</p></li><li><p>éšç§å’Œç›‘ç®¡çš„å¹³è¡¡ã€‚<br>UTXOçš„éšç§æ€§æ›´å¼ºï¼Œç›‘ç®¡éš¾åº¦æ›´å¤§ã€‚ç”±äºç”¨æˆ·ç†è®ºä¸Šå¯ä»¥æ— é™çš„è‡ªç”±ç”Ÿæˆå…¬ç§é’¥å¯¹ï¼Œå¹¶ä¸”ç”Ÿæˆçš„å¯†é’¥å¯¹é‡Œæ— æ³•åå‘æ¨å‡ºç”¨æˆ·ä¿¡æ¯ã€‚å†ç»“åˆæ··å¸å™¨æ··æ·†ç­‰æŠ€æœ¯ï¼ŒUTXOçš„äº¤æ˜“è·¯å¾„ä¹Ÿå¾ˆéš¾è¢«è¿½è¸ªï¼Œç›¸æ¯”è´¦æˆ·æ¨¡å‹ï¼Œå…¶éšç§ä¿æŠ¤çš„èƒ½åŠ›æ›´å¼ºã€‚åŒæ—¶ä»ç›‘ç®¡è§’åº¦æ›´éš¾è¿½è¸ªäº¤æ˜“æµå‘ã€‚å¯¹äºæ¶‰åŠåˆ°åè¯ˆéª—åæ´—é’±åææ€–èèµ„ç­‰åœºæ™¯ï¼Œç›‘ç®¡å½“å±€å¯¹é£é™©äº¤æ˜“å’Œè´¦æˆ·åŠæ—¶çš„è¯†åˆ«å’Œå¤„ç½®é£é™©éš¾åº¦å¾ˆå¤§ï¼Œæ‰‹æ®µè¾ƒä¸ºæœ‰é™ã€‚è´¦æˆ·æ¨¡å‹ä¸‹é‡‡ç”¨å†»ç»“è´¦æˆ·å’Œèµ„é‡‘ç­‰æ–¹å¼åˆ™è¾ƒä¸ºç®€å•æœ‰æ•ˆã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œåœ¨å›½é™…çº·äº‰ä¸­ä¹Ÿå¾ˆå®¹æ˜“æˆä¸ºâ€œåˆ¶è£â€çš„æ­¦å™¨ã€‚</p></li></ol><p>æ€»è€Œè¨€ä¹‹ï¼Œå½“å‰é‡‘èç³»ç»Ÿé‡‡ç”¨è´¦æˆ·æ¨¡å‹ï¼Œè¿™ä¸€å¥—è¿è¡Œä½“ç³»å·²ç»å¾ˆæˆç†Ÿäº†ã€‚è¦åœ¨è´§å¸é¢†åŸŸè½¬åˆ°UTXOçš„æ–¹å¼è¿˜ç¼ºå°‘å¯ä»¥å€Ÿé‰´çš„æˆåŠŸæ¡ˆä¾‹ï¼Œåœ¨è®²æ±‚ç¨³å®šçš„é‡‘èé¢†åŸŸï¼Œè¿™ä¸ªç›®å‰è¿˜åªèƒ½ç®—æ˜¯å¾ˆåˆçº§çš„ç ”ç©¶é˜¶æ®µï¼Œè·ç¦»è½åœ°è¿˜æœ‰å¾ˆé•¿ä¸€æ®µè·ç¦»ã€‚å½“ç„¶ï¼ŒUTXOè¿˜æ˜¯æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä¾‹å¦‚ä¸æ™ºèƒ½åˆçº¦çš„ç»“åˆå®ç°æ›´æœ‰æ•ˆçš„ä¸“æ¬¾ä¸“ç”¨å’Œç›‘ç®¡ã€‚ä½†å¯ä»¥ç¡®å®šçš„æ˜¯ï¼ŒåŠ å¯†è´§å¸é¢†åŸŸå•çº¯çš„UTXOæ¨¡å‹æ˜¯æ— æ³•å®Œå…¨é€‚ç”¨äºCBDCé¢†åŸŸçš„ã€‚åœ¨å½“å‰çš„ä¼ ç»Ÿè´¦æˆ·æ¨¡å‹ä¸‹ï¼Œå¦‚ä½•åˆ©ç”¨UTXOæ¨¡å‹çš„ä¼˜ç‚¹ï¼Œè¿™æ˜¯åº”è¯¥ç€åŠ›æ¢ç´¢çš„æ–¹å‘ï¼Œå¤§æ¦‚ç‡æ˜¯è´¦æˆ·æ¨¡å‹å’ŒUTXOçš„æœ‰æœºç»“åˆã€‚è‡³äºOpenCBDCé¡¹ç›®çš„ç¬¬ä¸€é˜¶æ®µï¼Œå°½ç®¡ä¸­å¿ƒåŒ–ç³»ç»Ÿï¼Œæ²¡æœ‰ä½¿ç”¨åŒºå—é“¾ï¼Œä½†æ˜¯å€Ÿé‰´å’Œç»„åˆäº†å½“å‰å¾ˆå¤šåŒºå—é“¾å’Œåˆ†å¸ƒå¼åº”ç”¨é¢†åŸŸçš„æŠ€æœ¯ï¼Œæœ¬èº«å¹¶æ²¡æœ‰ç‰¹åˆ«å¤šçš„äº®ç‚¹ï¼Œé™¤äº†å¼•å‘å¯¹CBDCçš„æ•°æ®æ¨¡å‹çš„æ€è€ƒï¼Œä»…ä»…æ˜¯å› ä¸ºå…¶èƒŒæ™¯å’Œå®£ç§°çš„å®éªŒå®¤æµ‹è¯•æ•°æ®è€Œå—äººå…³æ³¨ã€‚å¾ˆå¤šå·¥ç¨‹ç»†èŠ‚éƒ½æ²¡æœ‰è€ƒè™‘ï¼Œè¿™äº›åœ¨ä¸€å®šç¨‹åº¦ä¸Šè‚¯å®šä¼šå½±å“ç³»ç»Ÿçš„å¤æ‚åº¦å’Œæ€§èƒ½ã€‚è¿˜æ˜¯æœŸå¾…ä¸‹ä¸€ä¸ªé˜¶æ®µèƒ½æœ‰ä¸€äº›æ›´æœ‰åˆ›æ–°æ€§æˆ–è€…æ›´æ¥è¿‘è½åœ°çš„æˆæœã€‚</p><div align="right">    To beloved Hannah <span class="github-emoji"><span>â¤</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></div>]]></content>
      
      
      
        <tags>
            
            <tag> CBDC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebAssembly 2.0æ–°ç‰¹æ€§</title>
      <link href="//articles/whats-new-in-wasm-2-0/"/>
      <url>//articles/whats-new-in-wasm-2-0/</url>
      
        <content type="html"><![CDATA[<p>å®˜ç½‘ï¼š <a href="https://webassembly.github.io/spec/core/appendix/changes.html#change-history">Change History</a></p><ol><li><p>Multiple values</p><ul><li><em>Function types allow more than one result.</em><br>  é€‚é…goè¯­è¨€ç­‰å‡½æ•°å¤šè¿”å›å€¼çš„ç‰¹æ€§ã€‚</li><li><em>Block types can be arbitrary function types.</em><br>  æ§åˆ¶å—å¸¦å‚æ•°ï¼Œé€‚é…Cè¯­è¨€ç­‰å†…è”å‡½æ•°çš„å±•å¼€ã€‚Wasm1.0é‡Œè°ƒç”¨å†…è”å‡½æ•°ä½¿ç”¨çš„æ˜¯<code>call</code>æŒ‡ä»¤ã€‚</li></ul></li><li><p>Reference types</p><ul><li><em>Added <code>funcref</code> and <code>externref</code> as new value types and respective.</em><br>è¡¨å…ƒç´ å¢åŠ æ–°ç±»å‹ã€‚<blockquote><p><code>externref</code> allows modules to hold references to objects provided by the host environment; in other words, you can pass a JavaScript object to your .wasm module. The .wasm module canâ€™t really do much with the object via the type. Whatâ€™s more important is that the module is holding a reference to a garbage collected object on the JavaScript heap. æŒæœ‰å¤–éƒ¨å¼•ç”¨ï¼Œä¸ºå°†æ¥wasmå¼•å…¥GCå‡†å¤‡ã€‚ å‚çœ‹<a href="https://www.oreilly.com/library/view/what-is-webassembly/9781492076902/ch04.html">Upcoming Features and Proposals</a></p></blockquote></li></ul></li><li><p>Bulk memory </p><ul><li><em>New memory instructions: <code>memory.fill</code>, <code>memory.init</code>, <code>memory.copy</code>, <code>data.drop</code></em>.<br>å¯¹åº”Cé‡Œçš„<code>memcpy</code>, <code>memmove</code>ç­‰ï¼Œç›®çš„æé«˜å¤„ç†å¤§å—å†…å­˜çš„æ€§èƒ½ã€‚Wasm1.0é‡Œä½¿ç”¨<code>load</code>, <code>store</code>æŒ‡ä»¤æ“ä½œå†…å­˜ï¼Œåªèƒ½å¤„ç†åŸºæœ¬ç±»å‹çš„æ•°å€¼ã€‚</li></ul></li><li><p>Multiple table<br><em>coming soon</em></p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç›‘ç®¡ç§‘æŠ€ï¼ˆ1ï¼‰ - æ•°æ®é‡‡é›†</title>
      <link href="//articles/suptech-data-collection/"/>
      <url>//articles/suptech-data-collection/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="146e9ef62fa6a93a3ae39abfd32cacd161146cf6fe18b069a147d9594d60f796">3175488eedc729df0c7d358c640da99e5db97a13f852973918f00ac21570e613274c023f24fb0816aae305d8ec69c5952ad4b24e77da37571698484b461fdacab92854ece071879549e016da92c9eec9343f77c437aee31c76a455ea386d199294abfd2897004d87a4b1be0d48b4c86b9518e151d6273629cb953ee6602e3a0f1d6979e254bb57558ddc9999a132dd156fb6ac9ed43dc6696784c22a76c9b60f4ea86a7fb1a77a572dbb3924a24887384816018218072e0dfcd5397d57e6604f67a9fa75a869ff80e71a7da5e078171f38dec0efd899f508e582ba62e6ab223ce8074d538c617caa1408cf4635a0d5eed0ef978044450209de24b3c513d9ad5c3431a90babf1df6401ea2ad86b3ef120a60249c165f8737350330abc255ae97ce8c9cc90d349b95393935748c2b72960af43b387d6281b56498c188cdedab89fe22cd6f3ca346f8dfc547a4e6303d4677470ba7f7d43e2824f650865c9dc32b8fc79842349f9dc0f3507a47cc939cd4b951c8dae802af94cbdfa363adac97d2afb2e42469a1e3217a34989f90b21b5d5bdece1759a4924c05f02f338f90688729426de7ea04bc361d3e6bc15d0a15df3aa1204684ae94cbf13542913b0e2b75efcbafc2a89be53770a861de138362970806d5799d349be5c9ee5e589177622ca7a74841b691fe3a8f88b279d1c6c43644b1e6150e4da1e877cd1ec5e3bdf22c8541befe8340f5d6dbc1333faa68226a7f2bf62cd31b389ff531a5444670417bdfc09ea779ba0e6e3fe0c38a35952f0a475f1c32bc48afed22219cb62531df18cb889e060901fb0b458139cb1880f82a7a02644d301b88d55a15168fe1c8e620ad0b06cd3970b1f876cd28b44af984d442e85198a00d89a844287ad35d659c5783433276a9fa476f4d961da4bc066ec97e82d5ae2a57f176a26e6eec43e15cf667579372a87845efd69ddf22911b002a4e9eba9da1a76591f3f6c9444b88f42f3d126c8f82a9d035a2c413326923e61af7084a57c9a2bd88d20d67a9351ff3d6a988b2af3d8c55cb2923b0eec27a860bc47f323a3b221a57ab2aa07ae03e206ce049ae06f4502097f12c7cb07313df574e31e792f57aee1c69b97221883972eb25b5789dfd843de01e17ed5967cfce32ea991b04f3add87e80ca9d1f3ebc03befb9e43091a5284234ac0b4ccafb29b7952b2ba60249e967d9d1e1af4dc67e7b15f875ab7dc80be21c223fb06ebe0dbe5e62425d6dc5acb0757bf1f26df44fedfd5e440332b9bc8e31c585604c61944b1574a441c679bb4e01579c8cb48ba37087c9bcbd53c72aa58ed682cf9ed60834722cb854bdbbb341439ee9ffadf82c53c13cb4c7cee60f5a5fa727f17129b821a08486e709e0cff7c1915d7dc5d8d227013419d4977c27db7d6acf15495ba8421deb4fd75448ff9da6591f34e55ad833e6cbe2158575899c248ce87d9c09b58dbff98e866b401128ae03c3687fd0b22bb1aee8b7f65028eb9dd37212134f9e32a076163592e39ad12b8067845161470f6edfa0954b8d02bd6e7ca1babaf10fbe458a4ff060a379961f7d6464392486228e0c1e58713d0dd3a43c19e18753acf32c38862cf14a17f20d12ae2f9ab18a8f58bf5d7dc89f01d23632e354f04dabdec1fee69d09556564d1f6da2d7e2a3f13cf1d3e7e40c215b9cf43f06f6c5f833136263388e5a5ca0153fc91754980ea5fa2d6448c0fab93c4ef3e11f5d3cb2dba6319f8140ae698f909ef7100efc74db7111ad960301d6b137a4676138d2e26178d63cbc3cbf2e16be06a19217843a1ccf0d894acb14091a96b3616db67e35a9830133a80326d62c79416bb6cf3518b8896ed4dde453a976898da6fde9f8223a87f0506c1eb2b08310e9fc5d19af925d893e7c43d39ed995a78ad79ea420759f30bd3c95f1283d1108efd19fa0d188caf8113907ecebce567036aaba8fab178ed55ce8988db40fb6be5947c29a6dea6e2f0ee3221f740edc6138ff32f54451a7bc3609ab7e104c98c0210be7c4fae0bb56d5702083cb7f3b7c8dcf65dde94a3cd05ce0569605668384f36d22ef705ab1f55372f103410d0b522a03e37773af2b5a3d388f47b35c5aa4dd41e064c3dd9ced86989d674bd2c9dac9191eb2f16529c146deb17423dd3db01ad24a296eda9b500efba74c63592a07ea11e3cff34b29f17834f7381529a51d1e1a1190ba66ab2fda402d00ce14609b6b8f26dfb37ef3942e4361986d83b308568cb8db2c02558a231eda1fee5f3f6e000081135c2e5e40bf41a50c3b7cefacb652a64f12c4736ba24dc2e684f71ecd218c5eb83e8faf395e18d81a1cb5474f1b783ca7bcdcd73bf182670cb27baed4c4bc7a66e3b621541380e393b3c9af466a625b3ec5a379b0284fbc9e9b04ab99fccc2671b8054dd8d9749c9e420c6c77eb682a7f279457978938b19d03ddf0419e317aff42380cd4dc4ae7073d1cdb139e61077a33c90d7c02c8fe5fd9d56f845e0d224e6034b23f2d25c5dee1cdaace45909b1721bd37f9ba429d34517559c00c27f96775773b00b8816f00649719a979c41d02d1c7c7fba47cf154747900d9ab55e325fa02f966cec07c65126ccf3c5a0b3d715b8dacb87a05c72954aa92b77b32ccdd007d91606e0a163adb170659aa3048da02639891332b83ec10b664435955ffe6188ea444a1e411e8121da2bd36a5e2b569aaceb1b80aac900e4a8548acead46b88cd3b53b45e2cf24d8c16672cdc49a0f207f4231a6ca4ba16b31ac03568154c6d76fcc42f9af42d75225b5dedf33ea638c3b62ab264db9ffb23fdf926aec2ae59f2679177dad111112eda5d20a6fff1aa6ea5c4613767353a689cf893923c5bedb07d54c83755ca7baa870b37c1ce9f22d8c1e347dee3cb652ebaf8b4021b32858706b7a42e96772ed586cbe4f62be99a618f45ed89588fa01f268a2fa1d55935a81e6887e7e4b11fc461f281b6b425af079d7287fa37063fe8999bae335a2488dc45f5d955770be5cb87af7a1723cb84a5f985e5c5bcb09701c8a93c387a9c7afb9c9e4f6df6ee426325e7ea6c3b47a3b13068573e96e7a07c6a289649200218a43bc837fbb00ecb012fbb8586ab6f37a8db0e751596c3945d3d2253f8ef50a3fc71278b45a119408097e2094c0d40af7bd81051c6eef9d56d8154634313ad6bb61c5a178e5374fcbe6866b6190c166eb13955a0197cba8fc75957f87ce063f4e31cd21ce919ce0644dd36f3878972973c02fd95ca4b68b3dd4173e839640c3c8b6cd9121b36c2706de5fa84a81bb7044ff9a13b53c6e2c0c2ccf75b8795b2cde714b619d977775807bfd246f656d09c4c192be6d1d96fa6e5480af997d23fb8ea8995a4ba7fb2af8ee22cec49855177e62f45aae65d06c70f5f01497ac983109db0decd08ea95cb9e833b063d6ed7f11ee7daf83674ec596617975d3bb49ba756fe01dbf7522be47220e933efbd3ccd35f1415cd7fca45cd4875b81ca0865b756fe54ded9a5c71b938aa70ae1b6e229fba2f6664e50632dcb6512c44f093c237089eb8e54ab058c072dc18f050020da8c68724b0a04614bd7bfaa9e17594a2b1ebc40014f80583a1f0aed8d7365274e7acc3fc2bbeec6d5cd510f5a48e22ebe19d96054cdac5af6e8dbefefbdc944ec5c1a85c3b8b382077b98340b0d11a35bd2869cddc19de4d12abf6914481695d447739c6bd4814827ba2f742f07bc70501cb1654ca6a7f65178bee6acfb9a923737ab618750470ca5bf7977bffa178df7c85ae84b0ea531f7cde1a2daf505c41160f0dac9c98e540b5f311d0377ae15818ddc17f27fb04957fdf3f569f6db6e497a9ef7ac38c263a5ab7bc6c61ca935231d8d97fe5b2b50eeb171275ee2b30f1968f96bb9d0d6bbd2e02838070f001e755dd9fa8b76d5af83fc328dfc6a348018568273276c4c12313934830ef90a40a4b2250972baeceec5bb02a79ad2bb4964d118defa061f77927d0f72bc7ea1c4091a1eb52f6db7efa4fa307757de7f70d6f159f30e1b7e1d6abdf6bdc9dca4403fa323686556a5fef88030a864d18900f3758f0ddf09ae03cd67e144591f1726ce7f232bafe8ab7341945abc192321f6f177221215c4417334f5c8f5f352b0b0ecb74bddf4137c907cf467eff9e0b104cd27cf6f8b95f253dcad47ebdcef9c47a885a86dc27532cff146f8aa3e15756e484257eb91e18a0bb3aaa31e6c78e4e27efb1e048623bd2128523857e660e834bc608eb6b80a3550a5157c38c4d7ce0a4048fb8fa379dd6a9a211a62a23927679e5ba41a28c719f38ccf86d0aaf7bfe9e8bfa7f82b5e9c1783a2a69c5427b95b5b66e966cc75ea2b354646f942ae41af7e084a932f2071c3c40ccdf5c593114d55d469b5d67360464ae3725d7b0f077dbae2314819a28897cbf73f7557c2f1293b4a7bd23418dc30b1b019030519f75b9d540332bd051fe2542b624a15e702a038feb297d171a6cffa30f2d1cab598dbf3ec2c1370a93eff1397531c900554d518976fb18d06e16f03d1706151405d6728f5a281219a5fffc58539498234944756d47f8e09507063538754f492360566f21d0aa79975c5422667becbfbf9b614f4af44202ac471e60c2c4847764a559a18a53fc23261da6f5bd3caac2cbb76403cf556ee3842c7861d4cc62e8ba6d99c339c130586421c3e7b62df8873ecd74f308e7743be56caf3b7858dd89b1238d0e3a41d8643f18d44d87b9b97fbc7105dacda1e333db432e152e26172e629fd6a436fbecee94b194766d24db8543ac9497ca9beb27d74f15caa114f1e34e9fb0aa10d336236d45dc9ebcb913791fb5f5da774fe8ccaa5096ed940ad019b0c6239c914b5ea89d7a7b3d4b1406c9ac1367669b317c408bf8ac08a68330d93306142ae57022b0167527a47ccae7719ac5060559d5663ad3bc1863b23142fe4a64020250e001eca55870b26e80286ee25edbf9a093495911eb0c0ec21f54f1f0ba551dc587311e7f3b38e6d8177d23f99f0e04f10034f72b2a5d71e859fd69aaf28c0c86ff581a1c34d2540b5d9fa42fd0e82f406d4d472933b202db2b5ecd8fb26dd3925db92e9d1d5049325c9841e9371ed44f81d136e6e89ce1f84740e1da243b04b9fc7da79a701f59622794e3ba32e533ac2a384c91097badad2991ceab37bde4bdff006f5861ca001b4e04e8c9641a3e8c2158eae702478d9abba87e2f2c7b474fb669807dffd596e7c84ca143b9afa75ddca04eab0dfb773877a9b64e353e09af9065e9f569647cedb85b9b9733ef45631924458a70d73f1c56ca515fc504fa3ea2c7fc8f7db38693af11a16444eb362fc7905530555e593189bd1bd9bdca6a66cac45a19e7606d43a3c7807bda4813e9940e8084d043c76517c794a8ba3df285e6630460c28b15489a91e25bd3c9c373577a65b11451c37f43ece8a81eba3d78e9b40b6311ad8531d1923a4ea4e91951c4c6fc1515c02d1e1fa0bfb9e984dd45b242f496388abb4f626e7abe4dc458ae23edd4f3b9a3321be60103dc2b674d8411499da4c7c9b3b3e3d7897650f7bb5829ffdc027757d56af37eef341a7195a4a7dcb463381a39c1cb7573451c2e578d4ee595ba6d4a213aeb225ba7bf33bd7ef0b156682e43aa94f552dff30a3b41caf4a5f45e693272fccc6fb1f1336a3767055566e4fea1d851025e0058ffe1f79f0c27c056a5edbf9668ee0022a1be125f3518b2a6f9321eb553372893be6a24a1d8040a7d5e8691986b21afb7bdede9c02a892dbb845e8918cbe6dab699ae5ba1f3b6047cb92d24adfdc0e9c942438e73aeaa6345f815ba89b39e284e0d31a55d0295170f204a309631a54724e772e9a0ef960ccc10d2e02741fd480eed461d09264db8447280c0778f06a335e13bfd4b20cfd5fa905c43a00026cccefe6c595b980ddc27d36eae22c68cd588095c918ac627012f17787a6f3f102da8a1a98b795518b0907db4b4d3bbf3e872abc3f6532e2a2f259a9b6e1dd80d119860cede97942ed0dcea7607b295124051ca922e13de0e7f092f5808f4b0c5c58a692402faf84f68ced70a41412ae43b52c597810185409583a8707f66b8b5ff0c77f67569864cab3b1166bf6929aaca182595db2da327c8713df7bf3b061d74fbf3596fbae8dace3c63917fe7725c7c7c75aa430ae46910093653259abe1886b7fefea4d649b690aff729f10a2e9930bbb2b248713e0dfbf84279155479bb5ed9e3bd48c379d63d9c34d75b52f145de19b483fba766db8135a31dae9b5004d6b8510d4404b5ce7d33df261f21a84b7d94e50f8995ddf470fdc1715f772b8ee2922f64fd1c682ea9ed0c03857574b7646de8bcab4ec0a66e7970f388d41c29287c559ca3ea1a1fdbff0b3f3a433bed2b01ebfa6772055c07bc8d5b1e2cc1abef83d90de82714350662e72f5d881ba4ab1350359c4a24d4502388b33664c0eae183fad979e3cb5fd67910305d362065e4c4462c66aaaa60975162836cf98be34011802f46b089d9b4a5b84ab50fc6f0d7956a007cb0b9409cbcba153a04631066fe3a79a33b0f1cfa5186027097421d42811028847397923b7bd5558a7b785c66988d8680d326e0e73ad67554f77407252e82ecaad3059b144ab3a7276ffa679f53b9974d33438e462e57fbe8870f91dfa67ca6ce03be4b6a9323a36c37d848f6e19374fff692aaa07eceafa84c482a8ce74f85cc3dd300e8c9a0e6d586bf653d0aeefe656310eb89064109813897f9386f83b1d7f0520ec8fbce3067195184ede4af16793c26fc4c3703c7e1743700f25e81685a3468bd05cf3b399ba39a6e9bbaa258a0dbf5c26fb22ee0ba9940739de519129b27ec5ccf3eb0cd61b96c19a80ba713f88df7288bc3a14706afbb37486911f551983f6512f92e63018d7855220dc7ef72116c6d364b727415ad3637a603ad571177e45a087c3490f754f3e923093bf35ff768161b14b1b3a77a1a8fab92ed0313aeb1d6b08c1946af3c75bb9364fec781406d4edd9c747becacb5662e87a7656c79d98643ba7aecdd39fe7911c8c3b7bcbb9edd864b4589db4bd4c1022f7b5976e50a10ccfd7d4dcc9d4140ef9ba9ba69351b0c77478b6ac13df98fc2ad843ed9ccbfbaf3d7c1c54f3cf9efe4af606c4665f965f427701ad8c0338e509101aa89e85086197829df2f7a8ec0acac107459ec1d707dcb20c5073f229b4ea7da1afc3a1cbbd8b365a0827b2cda6ec96378e687518072afe525a6184badf5069552f167bf42065db49fd3e2b9ba5a2d7ff31ee1c87182612a266c8ec0125056b9b519f5269cae86e119bed46f13d844be1b3a701f247ebaacd0244e99d727d1551fcdc76e8d4faa41abcf6f750b8043389ef3e3d8bbb8d365f747b10cf8693077403ff9626bddce0d3ffd44817ae9d4b83fa79c1f1f9491f3bdcd064e56c23bda03653d1482542933356dc7e7e4486c4f7bd4bb7fac8e21eca4f29516fe552c916dc5da299bd13b0d5d4ec1cf331646f3003e28920296f41859c54385ed2304962e7e32a14cc584047635fa018291d4d0c948f433c3515934cfc0f612c62f7d98040f9d020fa872b097abd3ae1ad95afd94bd220c4fad19f4541805bf09913a93403301f00eb5816c76ac34aa86c1c1fb01bca9bffaa0c2e2d97ba6a4e3d67dd3e76bedde5f70bace853851769963d09d1bd2debd6765d2044529d268f831e24185d5893d99c21beb88e55fc2fa76a9aced348ceff95d346e2dcf9fdb713e7263c3321878d0fef7c2bb5c58d5b6e28c82a570ed6dff65c2be9e0a60b1c84b3fc212ed2b36081aba47225ff5cc5b7840f923b4301229afb7db846edbbe75e92c772509a48bedf41d40b4fdcf1b3eed81d76f0050cf8b6edb4f7dada35b6eb77f0ed7e3700b246102ce87323daede0c37388d72e4a2de7db9dce98d9b68571192c880d53097970ed938462cee756b001412d1d6af8feb2f1c34904b41b657a86a2d2c3bbc1016316728a46a7964323b4ca7acf97f62b9efd035f8dea6844b1b0bd1fcafb5cec9e8af113e85894332b5f65ad58bd1a45f42955d25a45113c5288f37a31c7861e0e49f32e47a7b0df50db939f5e81bfc08c81b7f16ce7e37c05fe528c728ea676283815251d23873dbe60a5b5ef5e02197e01b649c4b05f6bc730d8aa22482f535d9812d2f7d4e9217c51c9a541525b3113a2f0435ba700b89b96005cd29614ca4b4e4941305989175c6a9a123c3c72f0d0e8f38a6225af5cc16c84e1448c93183c483b1caf5220168525a4d3103b13f78dbcedcb9b89ed1098240f21a8702a1c0047f6cb6f0640a30ed23e2cafa87fb50fa3d990b765ab555dbb96ab44008f08dba88be15dc1f2fcdac22b390a6694bfced14b21fade87552c001e6bd996704c9a59577fadbd70eacf5272847295086ec1b65e832c8b54e15ad1a1897a3d7832ef351d3f7e1c4d2f05df8b27352fe4d019c80dcf98702cfc79260c9aca04f034cc8586a00e9e6294c2225aa450f9fe7db46041a1cbdfee515919f5cc29562ba32d880ef19e03aa1101c83d3b684cada31341a15509b781b01a9265809528ba7ed7ebe9b211cde6b4727cb73cd98bcaa151f7ec4eecfae9b96f87d8e015e028a65d8bf5a12f19c5b0ad23a0be15bbad84ab0a2329e67b3c8128c9cce478f08d3747544ce359d7e57cfa30bac055915287c6796fdbc26d6b69bcf205a3c6302f557c0585d07a00791697139d65af45a40aab5a80c9dd68a6498d75f86c8a10597a4af44a8d30ef453b0b4f2c964cb8c5e1ee22db46793750d0cfbe42ab4689c1c84a320e637887e3d86564009e5d108a7e922470c26018522d43031215a6816ade4efb6e0c46d3add0c7574741cad67b87cde3d07c78072cd81e6fa333b3e3f457a33f1653e1e913f2c0ef8cd75c54477b648aaa29916a976b42f554e59b19ef996cbb92a9da4268d3b84a5e2a2c86e0591becc984e5c1fb7298dce0af79b3c9b53065467046c69b3a3a5bb6fd62a43f3b15f5cccbe30ed4ba839f9994fa8e61f598ea664f374f20d2a87aee9cdf3d0ef62201d3b240d6fca87d8e1b287c57281a150389b6a011303f067604fa4a8d3781522c8806d2457b3194e7e8b31b952ef4df0aba6ca1e6bebf1a681bf4182db33a7d525cf08a217cca9cf5bed1217695ce30bde8c00bdb5760321de4db60f6a8e414467ae5b1f59acf2ef2d25c36659a010ee36953029d626169b0f17067db10210ad0f72112765e9e5424073ed0b363636c588ca8b0bc323ce244c2e460ed3fb9cd3ee62f7b1e400520776ba1bc44e3921a1f0285fe10a2f27ff09ed4c149575b6a1a6dd745d0cff63712f2fb68535fe0d6e41a6b2fbcddcf2153f6d2a3e1de0e32b24226575816fa5a235da20c3be3d7f04152ac077cce9823f226f46de228821175ec3c16aece5790168edadcff0b3083ce80694a4bd658161b1411b428526c87914d2f698603b719b0f8602f81ef9f04dca92333e7da8399fc54d7b813377578e8acddf638550442a9b9ff61db7afc5a27f167efce2087f6586cc22ae6ab56a41d10c51f855cc2de4debb10b9fab96998163caeee17a0a64cd27326c145e3c10dbcafdd0068dbb7819f6d11798a64b1e3e5f41677cac8dc9e2775965fb26a1bae6dde48556109612812eb9744ef07fb4636d4a48eff9f20a2cb847536df544456c411d3e835c76fb290d48c784f8c100bf6db2b35e54d41de9cafad4e6344def9b9521cb4dd5a342e45ee7abce1d65d25784c9ef01062bcf6fd12f79b8046f40e18592ad0d6832ad0208b839ca4d963cbe7837d2ec0e10724963889efa56ade040071420c2d5f0cab9cc279192ba3502e3ecdb82d7f4c3dec8946f97361c75217919b4caf374205c50c158a4d6cbd77987fb688090ef5a7f5f1ae01a45c455fbca80ba8983d181c045f69cae269679bd7e4c65c2c0375e39fce494918c9167e39fa65ffcebaad0dccb6262d977fa96d343593c77c30ae17a919cecf1191ad584230695d3a6ad36326bae60a224df36ae28a65350f15b13e18ecdde6cc92ba4d50e6dda5f6a87473892238c0ee47e8f6b0afb5d92c561b06753a0c3a8ae3cfafc3de1fb55ebd09f9d0ba2f7f05cc67f2f2148da570d90a507b7f6573d7291a9b45b01323bd50251532e6059a68672b804e78225db011b611695aa7de1966ded70b88d893d9b17c3602199de56a69f1bf2e1ac6debe9b22576c186a5e2eec2fa1dff9766e27fbe18d30d0b60c1ab5fbe0627e5953362dfed846d69d42463b372cbae9e016f42175da65e502d046b7db9cea7ece2675bdc9ba38c962b2b3160a470bff1ce7062c5d555f6861c5a1a80ce2a4e06ad323800cf19624daba7fbb0f60bb49e8181213de394c14f56703bb5943d36657737ad48e70790934dc3952d4e98fb1c09551bc829450e89d1e44949e7ae40fb738d41ecce521b8703765911ba08f8ee08e324ecb63a83ba21c67b7eae95bd5da2fc684110d2087c41cbe1038f020416f5ea637b0d5ded70ec556ab0572b6e63ce49c5ee632dbf08db625a5c6b905a2ca4680353bafbc5ba17e5efa19c0d4333fe89771e3b1a2e001d66ef759cee49bc1b5ae04e2a3bb24c6db2106c2838db60e30eaf8cde850a43d592dbd933581e13a45828a0f624daab04b0fce4979459d90e6fb39ba24a4a7abecd06f685741c2132764953a6463d79357231561a11b66a1c911e227a507e7ee72a765b950281034a3bb7416b093ca40fee3bc7d621f1a65d025a3c4b1d833cf1e9ca47a1f3e5e93db293acb625692d072d3a0eb73ca7ac12512b733574d6e2ea3d41334775af670a41c34f09608ae0789c92cef8c31b93ac3f1f346fa77ef080c0ae489ac12902cf0fc7c97887f9055af8cc13ee1f5f0335fca3e8fe9811e83c84af05fec7747e647b5c626171241c4302653b76e81a15e978836d58e5470bb93d76f03e9565c764c0a2e1d2c89fefc99f001e33ef970ee7d23cd7e747f55472bbc691054fe8f6dbf2d9435e4e6c62a22ae5cb95393223342b580016baf9fcada5ab36d4b4b7aa98a6f38a37c618e2451568993aa86bf7914fb04b8eaa9707c13572cfec0cff203542c9529bf3639c5b40992acea3acdc59379a53400bfffabcda84d5789e1e5373dd7f40a3370b49368a294e3f0ba5afe5679b7d28de0f0ffd4cdd7de2f5426fce1201258642933e5fab02d059b9acabf75a822fdf10525a449bb32a74c2819299f61ad306aa9fb7eddfd3e2a6ba724f8b2dd1e8d9bd5b88f6aeda998f033ec0b67c7fc14773153a694a5ed07e3dae2924e3c4abfcdc9e1ba98d98ebda2c6f9c1c4a0d43b725c7b863f63a2f9713fa105f6982bec19c994a138c9748d190c11393779fd714ba3d1a76521840ce5ba1c5119f45aae2dcf61dd4b244a426371c746b2965a039a9727a6bd00f56f57b447e5701c3a7e9da8f04240345eadb139453546be1871eaacb3245021b47c7909f451e9db562848a3c86969c97190b2cb95dcb88561824793189ea5ded2a22db5429f12c089d6504dcfb23df7a979061fcedd0929819e35028c1cd2cac8ec2fc4b45558e467c2251cafb331d9216b0550a45cb202468add76fdb6a15eef9b202575891550cf233068b8d85c6214590ef85d776bf18dff59de7c79839aad676ad634e6564254c8e8ce97f7acb0812c40db86aed124271cf1c68114eb37742e4ae9e5e6a21b4b8818e677a5a2aa486741e54102e49c56107c5411ae4441cada6b9229de0e0c00c3cdf961474f7670654146c9cd87f09554e000f5106dc0836be9151ee53a5dd5341ebe9d421c25af486c0a58bbbf22d085d722616894ff2b6da79bdb2e2fa47be1e5c33b51ae7a45a75742fa974a580f79dd844b3c4250fff3828af1e225d9cd806fb86aa97156d76af5212a9a3e594dc8a13bf62dd13c7a268f5df928ba164152a805215ea1ce21ab17a2b890ccbd79a5cc60ff6b192ce41d2242f0db295264145e2778aff86572c594483ec885d7cc307666ba3d18fec3f9c4d4dd65c99a609764fa9b82adcd5a0f5febc296513dc1570bfbcd8fa76f22d1485594865825e0f51d429b7553f9b43b1dbce326697ac5c8471276a51c3e6967fc9d48cacded27d3516c5c6e7115886b434fd6151eac132339b5f9b604a3000591180c385a4217b9dfae8a3a23a35801e61608da536c6dff5358a1f5e51a27f02668c77add8af3c1cabde0260d63bf06dade9cd563492a54a24c13e55c07d863e297416aa44d7fa8f3d0f09578ff7f6c06d611d15d3509d4c00cc7af2072b485998ee0041b03fe0eb651d251533b3f633990bfa19d866d187dbbae8d28ab69113b13f401a805b3f9145e9bac178d6f91373dc29300f528151ba8df225e4d341e21dd1d7460705603169e1e55f476c6594bf67b8432a273b1485c42fd9f468ece0ac4027fa070e1348da8c4bc298d4f46e86e7bb092a64357719a41c2ad12b8b6f1305aa2174d263337ee5b37cc388f47df589f3a49959d166f4ef41e74995e60dee63ff170cc2a15be990aeadf8e8d55e468e5347b4aa2b25893b1c0fcef43e7abfca521bbc13f8d572ed6970240321fc7c1b2d9688b43ddf8ec875fecd87fb0b1257f7dc7e8a8a4e5588a56ef9530a19258378411054dbec8c5ada7903b3aed98785482df64851ffe320b2e71b185a0dbbb376971f01f82d7cd1076a875179a8be4240d9ad5d4e9a783ca32698d56cab14633ea2a5178664aa64dc8df47fcaf387154851fb91733e93c4cee11be604a0d391b55df4e331b361bac4c78554dcd155ca5d61c0d96608563d209a8162b3726c14704014ed983e6299c169b06856c249bd5d680ef94bc8aed832db7f434097fec490203f2e8694cea2d7eea728740e438530ca016c7b30a2dc2cbef96dad998aa62d1454849b0ca71233d1adfa5f3541127f2eb4a445f443e62ad9d0990a478d0ddfd5af6c408c07675d4136ba288e4e1573fed9771f142511dfcfea931eb3cf366c08ac5b8e69f3b92254ad682c77905409aa1788ea46656506d94e99f94ac03e6d61d00d0d1473496a936a9df91767f45f79a1ab3973404854195f01af7fdb9e668e0076cc4f6835ad74e439f274e65a3534f0e8631678d0d19b64bc271b2dfd23efb4a42caa910ada550849e3ed5d2ecb8e0fb4894832aaf29f2a942fbd317a33f2e75da7b2c46388c0a3b3654bed41b5cc22426ab8fef74b6d275093aef3f37f396ae9519feff6ef8fd7da7f1fe941126a76f8fd3a592c43f1262cc58b99024575231e21986576d836b17543970e3bd5fbdf1078c4752aeacac17701ccad3b3d6a169e5d0d805159c58a21447e00f49c0505ed4882375b404c8d8b440a0f44aa8bad07e86101765cab756e06b17806d32ae34b838bcd3d85b89c9363e1c3252870f20e3587ea4479dca3dace268b3c15a4472247331f20020ee2b3ac7a9ccc184df60fdf9377bd01b8f3cab55a5dc1e107a46724a87400be12e42135557e1951e4bc98b82b2fa89178cfeaf6a00c5b3c3f3ac0f1a830cbfde1d479a525b6de8050d630cc66cd2755538099d25d7d12cc0a0caa7af28fe4844981cc686bc562810547c953b2068fc12d4d2528d6ab87ca46601040013fa2b38da86ffd5ff4fa41a24df45380ed09f1645434b7a35a59cdcda39a068b164ac2ead454d1c96763abe52fa35ca5f1d0df87bde78ad0d0f0137fed1af99c9b5c1ceb45f6c3af7dcb2f94f679cc6e0eb220a9a6d516d6cdbe31043b087d89814bd804c82980ede4494eec15d0ca987304a947265ad07e422247f0bb36a0b045864fa1712dea845ea55a33c17eb0f2e0a2bc0ca3dc1c7c9d2480eec242a5e897e55658b49a04f5b7ade69c356a7e652c4ac1bdbff7a97ac14cbbf949c4b749d32c54fbcc0e8bc16000655c8e3a577560329714bfd3475301fa2ce2313fca7a25d9383399022288ed18357e315c879915acfa818493b93a1a2fdd5dccebb98312e660a2c3d48d59d06e98ad8c3b81ba3bce10fc25edb18ab9ae10cda25820bd4ae3528a9b175ff32036c9c9ac8e36d074dbd70ee62906724a562720c9c690d10db5e85b374f3c9dc6d97cd712c66ac49f0a30f8d4b0c6d28b8f998f0108b8915422035deedbf375a571396f91c45ea2ed8d7aa72fa47cb65dbccf9c7f3b5546ee4e0eac8fce5cde5b95965c2b070a2c05a307e6784f27d3506f231775a480f9efe27f91005b50cca13debab2c4ed80489a0ebb85cfdcb93aa455c3bb0442cb89a81c7ae870a5acc73a11c47cc2269eee97dcfb1af8fcaf82416de53a26323ed0aec4adff9e9ee6c0889803adfff93572ca57f93f8fc5043ad06dfb2f1b7fab5cb85468550f4eec65080ee72181cf707c9794e944460c939801bcc78c06eedd51d0c6f67b91b6e8f255cb1c159f17394fa1efea13ec403b8afb53dd21e9f4d1d94741b596ef6cdc961412096aed05dbad1e93fbd5da263c3d1803f8f6a30a4bb36d2332a79489f37d38d16452d0754c30bd4c22c23c82e742b53c64be8ce00a6f49b6845abf600de5d2626d7bc716b3deabd36a16c3894283bc0cad06c149773c9bc157de5d9efbcb633a9bcf61244367e45249003b3dd3f6e8834d33e439c05eda2c24d4bade995e93d99cea0aa0a52c39549dd16d0893e484159bf25029bab35c4dca1b8b3077bc451c8f0cbb17b15aec4058d49315e5d5fcca53611f0bed7a66af9debbfe638f550b8507ffc41e6f1c5419e16fc8609701effc7a8c735e0e8d16edaf8a0d038a83bb8e6c04f41b66acd085159df600c2b3f61c16dbf97eb7dd122feaf3a070c4c56c58901b4c43515d6317f08b3a8824427b08332b76aaaeaf988387d3e2a813f472846e69064a5f4d28179587fb7ff0f8d2ea96c15e7c2f14cd0cde0e35eaad0627a03b21d683e6978d2555ef10cd39a62cf0af778e6db0779bcd2e30ed6ec1de25b54c17779ce537689081bfc2790774239eb010f972338f8b0e1b23f9660f6a2c579e69124c166867933178181e46e4df7c065b24774eca8c3e902805a41b9454d418f58d4001e21e6ef70365a07984e0586213ecd9954aebb333bbbac2d1b99831d596e44c5684033fb000f90bfa8c053303e66102663c38f8cb1fdd183a4415762c80e3b9266d515782e49ce13814da2c51c4d51029d1c5e34459679513475a52adf0596e215b1badc3ce97d8bb2139d7c4220884ab7566cd419866915b67a02e7802571e10fd112f1d4250de27160512907fe03ff1a2ab2be31f78344dee6c1fd6aaa7cd9d456a5543b6eede70050ec6a8f4a648c5995baf5402202d09d84d4acc31ad61a425df8516de07fea5897a6d546809540722719eb8cfa680fcd6f18ddc220caa117809c626ad6410f5f5e94347d81bdb64e9a7979d17beb500259a1875f7a9b2ca761baed166c49363a5f5289f69cdee6be1cde2e4c846b29a900788b693e32acd5e7a5700f7917968ed2c94b219a6aa271a9ebff72e04c7e2c271f5065d7afe0443022dffa49624bb6018e5e0bde27ed49d86e02b11f7fd87923d39e75d37c2ae30372f884df6aff04466daf0245e81203596d0d3f33e68f296dc7fd36f2c7d282ce0f46d664b567acb89cb9184bf26687f1e0765f79ef27da7fcb9f456ea5df9544890d8268b7e2cfc4bd976a7e98dd2a0a326b7855f1fd6138b3d37658d1df4691932f30a7930691c4aceb0e63409660eb12a79e3e4a2d6415f5381c7d6e23eebfb50da100f99c94b6df4b28677eaab0483a9aedd38cb40010be8f2c4755c6bf2b863ae4e4db02be42e1fa7e6680d4f7e08aa8e261d1cd1c42db4b9538c231f9a4098060d5cdb51d3cd1e94ebbe76b81f7364fa045407efdc19a5bfb55fa9c273a4ef5b97fc739f031b33c8b1a295911daf94685c5050bd7fe49f32c3ff6c7775e2acf5a37b446ae30eefda87b7e2623a3327609fe6ae2de92dcdf896f493b7f7060b5fdad859d981fee1abcef4172cf7854210cab0a3affe1f41ce6ee671842fab9cc3f1a0b91873d1a983b0d782e1b78b6076f000869af0b557a49afe846ee18948ab8aa03ab509fbba742408d6c5929321ac1e717a99ea02109fae61174312b64e35000a0929f5f56b82ccbc5e0617d4d9727eb12e2ff1ec44f5fad910ad185b66f42670a92d5f5aede5cf131a881b4b456f29bf919e9775aff30ee84d50d13d76d0bff7bd2c518960163a5737b47181076494d12a9146ee6742d488eab53a54b0ad74f6327dee843056cc5581dfbbf4920c60c2283009ad26a4a7e2fb305caded1b29a73c49e2602b8e053e6eaac95f594fe5b12dac651d6dd11d596cf3d5946471b0d2e575210eaa83ecd5610156e41c30f4cd8612a7c19239baa2ddba1bc832826afa6ddde1ca79fb9242821303bf8f548787ca9d1470032c5e9f573fe60ddf8eb6e7c9fc58138e6333f458bfff6207ed842589f10a8d941c29208782a393ce236c75c573bdebcaaf09a6d393bc7f9dbf26cdfad5cb59a1e89eeb5ec9398a632a1367d772e2e0c03eece1abb2b7819a964cfdf2a2c81677f897c738a604a0f9fc0d1dc279883cf85a7f50cb7fb850159900cf08e35d3cb5f3fdae2914588d4ed9524b0977cce974a177612276be099c1b12eef2017bf5eefd09fb164d848daa7d08d4aad51a5d646066c40862bf2de2348e7e9345a37c089569cdeaf816def11c77a5ea1a4ce06aaef70ad851c64eb6dcc8c5e32162aaef11d93760b9cd2d7b2e24509f90d4d3ebd55318b584da1172b36569a037318fe11b81345c1658823a8aaf41d5159cecfbc4a30cf303ced3bd4fefa659017d2ba34f9662e338c9cc0f5621c2e8cfe1b4c6cca81c04f1c189b7cbbe09caef0e8f67ae9154a1f89074f05edea0241f1c6933cfa9df89a209270eb8fd5205699b38025506d9be4ccb8ff44d4e67993d3145993e456279be1a97b4f48f60d93f1f3b88496a40afcac1bd221ff861810b2a5fe096a945cf72b4bb9b9df6a74a93f2856c02a2efd5db2e540fe08a116117cee61092711f628098691bc90ed79c55b1ffd77789b90b5754870f5bbbb2ae5d17d32d546ce81bb83e2b1dcfcb6f5a51b0b02e89f1482e7f2f882565e6c878c638d9483b33b8126de9ef1a3eb807f2be4a84899a1d932b5c61f9e66d05740b9d17b9c66bd0dcf3a4b964368d9a4cb7a38d8b8c74434712ca2bfb29491023ce24b267191ccbe5017cada5406f74971abe5b3c7121c73df09a5fd36fac731e9fe6100cb907755e40b50df1730e9b78388014de395766e3dc2888c0a91aba51894ec9218499fe3c6e18978bd94f3bfbcbab9ad3e88b4333d5155e743335ba55cd44f275e2e72daa8e6ec8829440ee908004debe10b73333f71ae8e6a3761807f4bfe7df25594a09b46201949b645dae44fcd7462be40fea646b58c7d9ff4a60a0dcfa8936e906809bc9c345caa3b73ecd969da98eac4cab9e5e5ef62aa6e6231918b938659345c5a70cfe69800e1d71e49190d54c500b931fcaad38c0e7aa535eb25d0dee45e127ad503472ce2862b9f8c40cd1f2e6df0fe8a812ab4033666c5e8812edcc7db2b3c34c0e97ef4e92e19ae3162cc26b573634ff846e22b1f63c61ae1cd7e1d06889824edde4c956f7a5087a5d5507b92cb3c54ea77d66432cd6b8c34b58bad5e22a6f40d9f56d5da02e5ce9aa72cb741fe200b02cc08c18008b1396c0c2c87fe722ac9585f5b88431281927e72a9ad99d1020d83d403e8e00faba6c6975dcaf255e279e2c0ec37b48cb500bacba98c475a01c3f94aa468d0ccf5fdc8a10084672b12a931e7960afab26d45105b4707a0d566b678e5f9c4c0e2dd44f8bc9d631c8ceef2433f0afcae4295f2cb9d69fce6ef08afedc98b571c9b53dfa49324bcc62332ec50a5423e0d43f93cf279e8ccabc67af43193081be50a94ac8656316d17ad8c9e8332d831214cacb326bb73bb7a6bb7c0dc630f93c2935953d97132bf439fa4e6900fdda81e8d90df53600c89a58f358b063d02df793130b1203d24397ae2279024e2787be036a9d815d36159579b9f72bbb90c8d60383269cf7d5b43ac6c605d1e0ab2a483ff0f57f6a7</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Post is cheap, show me the password</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Suptech </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Suptech </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®æ²»ç†ï¼ˆ2ï¼‰ - å…ƒæ•°æ®ç®¡ç†Atlas</title>
      <link href="//articles/bigdata-metadata-governance/"/>
      <url>//articles/bigdata-metadata-governance/</url>
      
        <content type="html"><![CDATA[<h3 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a>Pros</h3><ol><li>æ”¯æŒä¸»æµæ•°æ®æºï¼Œä¾‹å¦‚æ­£åœ¨ç”¨çš„hiveï¼ˆåº“ï¼Œè¡¨ï¼Œåˆ—ï¼Œå¤„ç†è¿‡ç¨‹ï¼‰ä»¥åŠsqoopï¼ˆæ•°æ®åº“ï¼Œå¤„ç†è¿‡ç¨‹ï¼‰ã€‚æ­¤å¤–è¿˜æœ‰hbaseï¼Œkafkaç­‰ã€‚<br>ä¸šåŠ¡è§†è§’ï¼š</li><li>æ•°æ®å­—å…¸ã€‚æœ‰UIç•Œé¢ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°hiveè¡¨çš„schemaï¼Œè¡¨æ³¨é‡Šï¼Œåˆ†åŒºå­—æ®µï¼Œå­˜å‚¨è·¯å¾„ï¼Œåˆ›å»º/æ›´æ–°çš„æ—¶é—´åŠæ“ä½œç”¨æˆ·ç­‰å®¡è®¡æ—¥å¿—ã€‚å¯ä»¥æŸ¥çœ‹åˆ°hiveè¡¨å­—æ®µçš„ç±»å‹ï¼Œæ³¨é‡Šç­‰ã€‚</li><li>æ£€ç´¢ã€‚å¯ä»¥æ ¹æ®è¡¨åï¼Œè¡¨æ³¨é‡Šï¼Œå­—æ®µæ³¨é‡Šç­‰è¿›è¡Œæ¨¡ç³Šæœç´¢ï¼Œå¿«é€Ÿå®šä½éœ€è¦æŸ¥æ‰¾çš„è¡¨æˆ–è€…å­—æ®µã€‚</li><li>è‡ªåŠ¨å®æ—¶é‡‡é›†ã€‚ä¾‹å¦‚æ–°å»ºhiveè¡¨ï¼Œæˆ–è€…å¯¹å·²å­˜åœ¨çš„hiveè¿›è¡Œä¿®æ”¹ï¼Œè‡ªåŠ¨å®æ—¶åŒæ­¥å˜æ›´ä¿¡æ¯ï¼Œæ— éœ€äººå·¥ç»´æŠ¤æ›´æ–°å­—å…¸åŠæ¸…æ´—é€»è¾‘<br>å¼€å‘è§†è§’ï¼š</li><li>è¡€ç¼˜å…³ç³»ã€‚ç»´æŠ¤è¡¨çº§å’Œå­—æ®µçº§çš„è¡€ç¼˜å…³ç³»ï¼Œå¯ä»¥æ¸…æ¥šçœ‹åˆ°è¡¨é—´ä¸Šä¸‹æ¸¸çš„å…³ç³»ï¼Œä»¥åŠæ¸…æ´—çš„é€»è¾‘ã€‚å½“åœ¨è¡¨ä¸­å‘ç°æœ‰åƒåœ¾æ•°æ®æ—¶ï¼Œå¯ä»¥å›æº¯åˆ°è¯¥æ•°æ®æ˜¯ä»ä¸Šæ¸¸å“ªä¸ªæºå¤´å¼•å…¥çš„ã€‚åŒæ—¶ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹å·²æœ‰çš„è¡¨ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°ä¼šå½±å“ä¸‹æ¸¸çš„å“ªäº›è¡¨ã€‚</li><li>è¡¨æœ‰ç»´æŠ¤last access timeï¼Œå¯ä»¥åˆ¤æ–­å“ªäº›è¡¨å·²ç»åºŸå¼ƒï¼Œå¯ç”¨äºå¯¹åºŸå¼ƒè¡¨çš„æ¸…ç†</li><li>æ ‡ç­¾ä½“ç³»ï¼Œç»“åˆrangerï¼ˆå¦‚æœä½¿ç”¨ï¼‰åšæƒé™ç®¡ç†ã€‚å¯ä»¥åœ¨atlaså¯¹è¡¨æˆ–è€…å­—æ®µæ‰“å„ç±»æ ‡ç­¾tagï¼Œä¾‹å¦‚å¯¹æ‰‹æœºå·phoneå­—æ®µæ ‡ä¸Šâ€œPIIâ€ä¸ªäººéšç§ï¼Œåœ¨rangeré‡Œé…ç½®é™åˆ¶ç‰¹å®šè´¦å·å¯¹æ‰“ä¸ŠPIIæ ‡ç­¾çš„æ•°æ®çš„è¯»/å†™æƒé™ã€‚</li></ol><h3 id="Cons"><a href="#Cons" class="headerlink" title="Cons"></a>Cons</h3><ol><li>hiveå…ƒæ•°æ®æ¥æºäºå…¶å®šä¹‰ï¼Œä¾‹å¦‚å»ºè¡¨è¯­å¥ä¸­çš„commentæ³¨é‡Šï¼Œå½“å‰åœ¨ç”¨çš„éƒ¨åˆ†è¡¨æ˜¯æ²¡æœ‰æ·»åŠ æ³¨é‡Šçš„ï¼Œè€Œä¸”å¯¹äºæšä¸¾å€¼éƒ½ä¸ä¼šåˆ—ä¸¾å‡ºæ¥ï¼Œè¿™æ ·å¯¼è‡´æŸäº›è¡¨/å­—æ®µæ²¡æœ‰ä»»ä½•ä¸­æ–‡æ³¨é‡Š/æè¿°ï¼Œéœ€è¦æŸ¥æ‰¾ä¸Šä¸‹æ¸¸æ¥ç¡®å®šã€‚åœ¨atlas UIç•Œé¢ä¸Šçš„è¡¨/å­—æ®µéƒ½æœ‰descriptionæè¿°é¡¹ï¼ˆç±»ä¼¼äºå¤‡æ³¨ï¼‰ï¼Œä½†ç›®å‰æ²¡æœ‰æ‰¾åˆ°ç›´æ¥åœ¨uiä¸Šæ›´æ–°è¯¥æè¿°çš„æ–¹æ³•ï¼Œä¹Ÿä¸çŸ¥é“æ­¤æè¿°ä»ä½•è€Œæ¥ã€‚å¯¹äºæšä¸¾é¡¹ï¼Œä»ç„¶éœ€è¦å†å¦å¤–ç»´æŠ¤æ–‡æ¡£ã€‚</li><li>UIç•Œé¢æ— æ³•æ·»åŠ ä¿®æ”¹è¡¨çš„ownerè´£ä»»äººã€‚</li><li>æ²¡æœ‰è®¿é—®çƒ­åº¦ç»Ÿè®¡ä¿¡æ¯ï¼Œæ— æ³•ç”¨äºåŒºåˆ†å†·çƒ­æ•°æ®å‚è€ƒã€‚</li><li>æš‚æœªæ”¯æŒflinkï¼Œsparkçš„è¿è¡Œæ—¶è¡€ç¼˜ã€‚</li><li>UIç•Œé¢æ²¡æœ‰æ˜¾ç¤ºæ‰€å±ä¸»é¢˜åŸŸï¼Œæ‰€åœ¨å±‚ç­‰ä¿¡æ¯</li><li>éƒ¨ç½²éœ€è¦å¼•å…¥é¢å¤–çš„ç»„ä»¶ã€‚hbaseï¼ˆç”¨äºå­˜å‚¨å…ƒæ•°æ®ä¿¡æ¯ï¼‰ï¼Œ solr/esï¼ˆç”¨äºæœç´¢ï¼‰ï¼Œkafkaï¼ˆç”¨äºè‡ªåŠ¨åŒæ­¥æ›´æ–°å…ƒæ•°æ®å˜æ›´ï¼‰ã€‚é™¤äº†å•ç‹¬éƒ¨ç½²è¿™äº›ç»„ä»¶ï¼Œatlasä¹Ÿæä¾›å†…åµŒhbaseå’Œsolrçš„æ–¹å¼ï¼ˆå¤šç”¨äºå¼€å‘ç¯å¢ƒéªŒè¯ä½¿ç”¨ï¼‰ã€‚</li><li>æ— æ•°æ®é¢„è§ˆï¼Œåˆ†åŒºä¿¡æ¯ã€‚éœ€è¦ç»“åˆå…¶ä»–å·¥å…·ï¼Œä¾‹å¦‚cdhå¥—è£…é‡Œçš„hueã€‚</li></ol><h3 id="ç«å“"><a href="#ç«å“" class="headerlink" title="ç«å“"></a>ç«å“</h3><ol><li>Linkedin Datahubæ˜¯å¦ä¸€ä¸ªå¸¸ç”¨çš„å¼€æºå·¥å…·ï¼Œå…·å¤‡æ•°æ®å­—å…¸ï¼Œè¡€ç¼˜å…³ç³»ï¼Œæ ‡ç­¾ç­‰ï¼Œä¹Ÿå¯ä»¥è‡ªä¿®æ”¹ç»´æŠ¤æè¿°ï¼Œè´£ä»»äººç­‰ã€‚åŸºäºdockeréƒ¨ç½²ã€‚atlasç›¸å¯¹datahubæˆç†Ÿï¼Œå‚è€ƒèµ„æ–™è¾ƒä¸ºä¸°å¯Œï¼Œä¸apacheå…¶ä»–ç»„ä»¶é€‚é…åº¦æ›´é«˜äº›ã€‚demoï¼š <a href="https://demo.datahubproject.io/">https://demo.datahubproject.io/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Big Data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Data Governance </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®æ²»ç†ï¼ˆ1ï¼‰- æ¦‚è¿°</title>
      <link href="//articles/bigdata-data-governance/"/>
      <url>//articles/bigdata-data-governance/</url>
      
        <content type="html"><![CDATA[<h2 id="æ€»ä½“æ€è·¯"><a href="#æ€»ä½“æ€è·¯" class="headerlink" title="æ€»ä½“æ€è·¯"></a>æ€»ä½“æ€è·¯</h2><h4 id="1-å»ºç»„ç»‡"><a href="#1-å»ºç»„ç»‡" class="headerlink" title="1. å»ºç»„ç»‡"></a>1. å»ºç»„ç»‡</h4><div align="center" style="width:70%;margin:auto">    <img src="/images/bigdata-data-governance/organization.png"></div><div align="center" style="width:50%;margin:auto">    <img src="/images/bigdata-data-governance/roles1.png">    <img src="/images/bigdata-data-governance/roles2.png">    <img src="/images/bigdata-data-governance/roles3.png"></div><ul><li>æ‘˜è‡ª ä¿¡é€šé™¢ã€Šæ•°æ®èµ„äº§ç®¡ç†å®è·µç™½çš®ä¹¦4.0ã€‹</li></ul><h4 id="2-ç«‹è§„èŒƒ"><a href="#2-ç«‹è§„èŒƒ" class="headerlink" title="2. ç«‹è§„èŒƒ"></a>2. ç«‹è§„èŒƒ</h4><div align="center" style="width:70%;margin:auto">    <img src="/images/bigdata-data-governance/rules.png"></div><h4 id="3-é€‰å¹³å°"><a href="#3-é€‰å¹³å°" class="headerlink" title="3. é€‰å¹³å°"></a>3. é€‰å¹³å°</h4><h4 id="4-é‡è¿è¥"><a href="#4-é‡è¿è¥" class="headerlink" title="4. é‡è¿è¥"></a>4. é‡è¿è¥</h4><span id="more"></span><hr><h2 id="æŠ€æœ¯è§’åº¦"><a href="#æŠ€æœ¯è§’åº¦" class="headerlink" title="æŠ€æœ¯è§’åº¦"></a>æŠ€æœ¯è§’åº¦</h2><h3 id="1-å…ƒæ•°æ®æ²»ç†"><a href="#1-å…ƒæ•°æ®æ²»ç†" class="headerlink" title="1. å…ƒæ•°æ®æ²»ç†"></a>1. å…ƒæ•°æ®æ²»ç†</h3><ol><li>æ•°æ®å­—å…¸&amp;æ•°æ®åœ°å›¾ã€‚éœ€è¦æä¾›å¯ç”¨å·¥å…·ï¼Œæ•°æ®ä½¿ç”¨æ–¹èƒ½å¾ˆæ–¹ä¾¿çš„æŸ¥æ‰¾åˆ°æ‰€éœ€è¦çš„æ•°æ®ï¼Œç†è§£å¤§æ•°æ®æ•°ä»“ä¸­çš„è¡¨ï¼Œå­—æ®µå®šä¹‰ï¼Œä¾‹å¦‚ç»Ÿè®¡äº¤æ˜“æ•°æ®è¯¥ä½¿ç”¨å“ªå¼ è¡¨ç­‰ç­‰ã€‚åŒæ—¶å½“çº¿ä¸Šçš„æ•°ä»“ç»“æ„æ›´æ–°æ—¶ï¼Œèƒ½è‡ªåŠ¨çš„æ•è·å˜åŒ–ï¼Œä¿è¯ä½¿ç”¨æ–¹æŸ¥åˆ°çš„æ•°æ®å­—å…¸ç­‰ä¿¡æ¯ä¸ç”Ÿäº§çš„æ—¶åˆ»ä¿æŒä¸€è‡´ï¼Œå‡å°‘äººå·¥ç»´æŠ¤æˆæœ¬ã€‚</li><li>å·¥å…·éœ€è¦è®°å½•æŠ€æœ¯å…ƒæ•°æ®ï¼ˆè¡¨ï¼Œåˆ—çš„schemaç­‰ï¼‰ &amp; ä¸šåŠ¡å…ƒæ•°æ®ï¼ˆç»´åº¦/å±æ€§ï¼Œä¸šåŠ¡è¿‡ç¨‹ï¼ŒæŒ‡æ ‡çš„è§„èŒƒåŒ–å®šä¹‰ï¼‰ &amp; ä»»åŠ¡è¿è¡Œ/è°ƒåº¦å…ƒæ•°æ®ï¼ˆè¿è¡Œæ—¶é—´è¿‡é•¿èŠ‚ç‚¹ï¼‰</li><li>è¡€ç¼˜å…³ç³»ã€‚æ–¹ä¾¿æŸ¥çœ‹è¡¨/å­—æ®µé—´å„å±‚çš„ç›¸äº’å…³ç³»ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ•°ä»“é‡Œï¼Œæ•°æ®æ˜¯ä»å“ªé‡Œæ¥ï¼Œå¦‚ä½•ä½¿ç”¨ã€‚å½“å‘ç°æ•°æ®é—®é¢˜ï¼Œå¯ä»¥å›æº¯åˆ°æºå¤´ï¼›å½“éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—æ—¶ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°å¯¹åé¢çš„å“ªäº›æ•°æ®é€ æˆå½±å“ã€‚</li><li>è§„èŒƒæŒ‡æ ‡å®šä¹‰ã€‚æŒ‡æ ‡äº§å‡ºéœ€è¦æŒ‡å®šä¸šåŠ¡è´£ä»»äººï¼ŒæŠ€æœ¯è´£ä»»äººã€‚ä¸šåŠ¡å›¢é˜Ÿéœ€è¦æ¸…æ™°å®šä¹‰ç»Ÿè®¡å£å¾„ã€‚å½“ç»„ç»‡äººå‘˜æµåŠ¨æ¯”è¾ƒå¤§ï¼Œç¼ºä¹è´£ä»»äººæœºåˆ¶ä¼šé€ æˆå†å²ä»»åŠ¡æ— æ³•è·Ÿè¸ªï¼Œé€ æˆä»»åŠ¡ä¸Šçº¿å¤šï¼Œä¸‹çº¿å°‘ã€‚åŒæ—¶ï¼Œå¯¹ç»Ÿè®¡æŒ‡æ ‡ç¼ºä¹æ˜ç¡®å®šä¹‰ï¼Œæ—¢ä¸åˆ©äºç†è§£æŒ‡æ ‡ï¼Œä¹Ÿå®¹æ˜“é€ æˆæŠ€æœ¯å¼€å‘ä¸ä¸šåŠ¡å¯¹å£å¾„çš„ç†è§£åå·®ï¼Œè¿˜ä¸åˆ©äºæŒ‡æ ‡çš„å¤ç”¨ã€‚</li><li>ç‰©ç†è¡¨æŸ¥è¯¢çƒ­åº¦ï¼Œèµ„æºæ¶ˆè€—ã€‚</li></ol><h3 id="2-æ•°æ®èµ„äº§åˆ†çº§åŠæ ‡ç­¾åŒ–"><a href="#2-æ•°æ®èµ„äº§åˆ†çº§åŠæ ‡ç­¾åŒ–" class="headerlink" title="2. æ•°æ®èµ„äº§åˆ†çº§åŠæ ‡ç­¾åŒ–"></a>2. æ•°æ®èµ„äº§åˆ†çº§åŠæ ‡ç­¾åŒ–</h3><ol><li>æ ¹æ®ä¸šåŠ¡é‡è¦æ€§åŠå½±å“åŠ›åˆ’åˆ†ç­‰çº§ï¼ˆä¾‹å¦‚ ç¾éš¾ï¼Œé‡è¦ï¼Œæ™®é€šï¼ŒæœªçŸ¥ï¼‰ç­‰ã€‚å€ŸåŠ©ä¸Šè¿°çš„å…ƒæ•°æ®ç®¡ç†å·¥å…·ï¼Œæ ¹æ®ä»»åŠ¡çš„è¡€ç¼˜å…³ç³»ï¼Œå°†åˆ†çº§ä¸Šæ¨è‡³å„å±‚çº§çš„æ•°æ®ï¼Œæ•°ä»“è¡¨ã€‚æ•°æ®åˆ†çº§çš„åº”ç”¨å¯ä»¥åœ¨ç›‘æ§ä»»åŠ¡ç­‰ã€‚ä¾‹å¦‚ï¼Œç›‘æ§ä»»åŠ¡äº§å‡ºæ—¶æ•ˆæ€§ï¼Œç›‘æ§é‡è¦ä»»åŠ¡é“¾è·¯ä¸Šçš„èŠ‚ç‚¹ï¼ŒæŒ‰ç…§ä¸åŒçš„ç­‰çº§è®¾ç½®å‘Šè­¦ç­–ç•¥ã€‚</li><li>åˆ©ç”¨å…ƒæ•°æ®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ•°æ®æ ‡ç­¾åŒ–ï¼Œè¿›è¡Œåˆ†çº§ã€‚<ul><li>åŸºç¡€æ ‡ç­¾ï¼š å®‰å…¨ç­‰çº§ï¼Œè®¿é—®æƒ…å†µï¼ˆå†·çƒ­æ•°æ®ï¼‰</li><li>æ•°ä»“æ ‡ç­¾ï¼š å…¨é‡/å¢é‡ï¼Œæ˜¯å¦å¯å†ç”Ÿï¼Œç”Ÿå‘½å‘¨æœŸ</li><li>ä¸šåŠ¡æ ‡ç­¾ï¼š ä¸»é¢˜åŸŸï¼Œå±‚ï¼Œä¸šåŠ¡ç±»å‹</li></ul></li></ol><p>åˆ†çº§å¤„ç†å¯ä»¥åº”ç”¨åœ¨æ²»ç†ä¸­çš„å„ä¸ªç»´åº¦ï¼Œåˆ†çº§çš„æ ‡å‡†ä¾æ®æ ¹æ®å…·ä½“çš„ç»´åº¦è®¾è®¡ã€‚</p><h3 id="3-æ•°æ®è´¨é‡"><a href="#3-æ•°æ®è´¨é‡" class="headerlink" title="3. æ•°æ®è´¨é‡"></a>3. æ•°æ®è´¨é‡</h3><ol><li>è´¨é‡è¡¡é‡ç”±äº‹å‰ï¼ˆDQCè¦†ç›–ï¼Œè‡ªå®šä¹‰è§„åˆ™ï¼‰ï¼Œäº‹ä¸­ï¼ˆå¼‚å¸¸æŠ¥è­¦ï¼‰ï¼Œäº‹åï¼ˆé—®é¢˜è·Ÿè¸ªï¼Œè´¨é‡è¯„åˆ†ï¼Œå†å²è¶‹åŠ¿ï¼‰ç»“åˆã€‚</li><li>æ ¹æ®æ•°æ®èµ„äº§åˆ†çº§è¿›è¡Œè´¨é‡ç›‘æ§ç¨‹åº¦åˆ†çº§ã€‚å‡†ç¡®æ€§ï¼Œå®Œæ•´æ€§ï¼ŒåŠæ—¶æ€§ï¼Œå”¯ä¸€æ€§ï¼Œè§„èŒƒæ€§ï¼Œä¸€è‡´æ€§ã€‚</li><li>å‡†ç¡®æ€§ã€‚DQCæ£€æŸ¥ï¼ŒæŒ‰ç…§èµ„äº§ç­‰çº§é…ç½®ç›‘æ§è¦†ç›–ç‡ã€‚ç”±äºDQCæ£€æŸ¥åµŒå…¥ä»»åŠ¡ï¼Œéœ€è¦æŒ‰ç­‰çº§åšå¥½è¦†ç›–ç‡ç­‰çº§é…ç½®ã€‚</li><li>åŠæ—¶æ€§ã€‚æŒ‰ç…§ä»»åŠ¡ä¼˜å…ˆçº§åˆ†é…èµ„æºï¼Œè®¾ç½®å‘Šè­¦ç­–ç•¥ï¼Œä»»åŠ¡å»¶è¿Ÿé¢„è­¦ç­‰ã€‚ç›¸åº”çš„è§„èŒƒäººå·¥è¿ç»´ä»‹å…¥æ—¶æœºï¼Œä¿è¯é‡è¦ä»»åŠ¡äº§å‡ºã€‚</li><li>äº‹åè´¨é‡é—®é¢˜è®°å½•ã€‚æ•…éšœå®šä¹‰ï¼Œåˆ†çº§ï¼Œå¤„ç†ï¼Œreviewã€‚å½¢æˆé•¿æœŸè®°å½•ï¼Œè´¨é‡é—®é¢˜æœ‰è·Ÿè¸ªè®°å½•ï¼ŒåŒæ—¶é¿å…è´¨é‡é—®é¢˜é‡å¤çš„å‡ºç°ã€‚</li></ol><h3 id="4-æ•°æ®å®‰å…¨"><a href="#4-æ•°æ®å®‰å…¨" class="headerlink" title="4. æ•°æ®å®‰å…¨"></a>4. æ•°æ®å®‰å…¨</h3><p>æ•°æ®å®‰å…¨åˆ†ä¸ºå››ä¸ªå±‚æ¬¡ã€‚</p><ol><li>åˆ©ç”¨ä¸Šè¿°çš„åˆ†çº§æ€æƒ³ï¼Œä»å­—æ®µå«ä¹‰ï¼Œäº§å‡ºæŒ‡æ ‡åæ¨ç­‰ï¼Œå®šä¹‰æ•°æ®å¯†çº§ã€‚åˆ©ç”¨å…ƒæ•°æ®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å°†å¯†çº§æ¨é€åˆ°ä¸Šä¸‹æ¸¸ã€‚</li><li>è§’è‰²/åˆ†ç»„è®¿é—®æˆæƒï¼Œæ•°æ®ç¡®æƒã€‚æ•°æ®æ‰€æœ‰è€…/ç®¡ç†å‘˜åˆ†é…æ•°æ®è®¿é—®æƒé™ã€‚æŒ‰ç…§æœ€å°æƒé™åˆ†é…ã€‚</li><li>æ•°æ®è„±æ•ï¼ŒåŠ å¯†ã€‚å³ä½¿è¶Šæƒè·å–åˆ°æ•°æ®ä¹Ÿæ— æ³•è¯»æ‡‚ç†è§£æ•°æ®ã€‚æ ¹æ®ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œå¯†çº§ï¼Œæ•°æ®ä½¿ç”¨æ–¹å¼ï¼Œä½¿ç”¨ä¸åŒçš„æƒé™æ§åˆ¶ä¸åŠ å¯†æ–¹å¼ï¼Œä¾‹å¦‚éšè—æ•°æ®åˆ—ï¼Œhashï¼Œå¯¹ç§°åŠ å¯†ï¼ŒåŒæ€åŠ å¯†ç­‰ã€‚ç¡®ä¿å³ä½¿è¶Šæƒè·å–åˆ°æ•°æ®ä¹Ÿæ— æ³•è¯»æ‡‚ç†è§£æ•°æ®ã€‚æœ€æ™šè§£å¯†åŸåˆ™ã€‚</li><li>å¯¹æ•°æ®è®¿é—®è¿›è¡Œå®¡è®¡ã€‚ä½¿ç”¨æ•°æ®æ°´å°ï¼Œåœ¨æ•°æ®æ³„æ¼æ—¶å¯è¿½æº¯æ³„æ¼æºã€‚</li></ol><h3 id="5-ç”Ÿå‘½å‘¨æœŸ"><a href="#5-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="5. ç”Ÿå‘½å‘¨æœŸ"></a>5. ç”Ÿå‘½å‘¨æœŸ</h3><ol><li>è¡¨åˆ†ç±»ã€‚ ç©ºè¡¨ï¼Œ 3ä¸ªæœˆæ— è®¿é—®è¡¨ï¼Œæ•°æ®æ— æ›´æ–°æ— /æœ‰ä»»åŠ¡è¡¨ç­‰</li><li>åˆ é™¤ç­–ç•¥<ul><li>å‘¨æœŸæ€§åˆ é™¤Xå¤©å‰ã€‚é€‚ç”¨äºæ¯å¤©ä»æ•°æ®åº“åŒæ­¥</li><li>æ°¸ä¹…ä¿ç•™ï¼ˆå¢é‡äº¤æ˜“ï¼‰ + è¿ç§»è‡³å†·æ•°æ®ä¸­å¿ƒï¼ˆ3å¹´ä»¥ä¸Šæ—¥å¿—ï¼‰</li><li>å¢é‡åŒæ­¥ï¼Œå…¨é‡mergeã€‚å¯¹åº”çš„deltaè¡¨ä¿ç•™3ä¸ªæœˆ</li></ul></li><li>åˆ’åˆ†å†å²æ•°æ®ç­‰çº§<ul><li>éå¸¸é‡è¦/é‡è¦/ä¸é‡è¦ï¼Œå¯æ¢å¤/ä¸å¯æ¢å¤</li></ul></li><li>æ ¹æ® ï¼ˆæ•°æ®é‡è¦æ€§ç­‰çº§ï¼Œæ•°æ®è¡¨ç±»å‹ï¼ˆå…¨é‡è¡¨ï¼Œç»´åº¦è¡¨ï¼Œäº¤æ˜“å¢é‡è¡¨ï¼‰ï¼Œæ•°ä»“å±‚ï¼‰ ç­‰ç»„åˆç»´åº¦åˆ’åˆ†ç”Ÿå‘½å‘¨æœŸç®¡ç†çŸ©é˜µ ï¼ŒæŒ‰ç…§æ‰€åœ¨çš„åŒºé—´ï¼Œç›¸åº”çš„é‡‡å–ä¿ç•™3å¤©ï¼Œä¸€å‘¨ï¼Œä¸€æœˆï¼Œä¸€å¹´ï¼Œæ°¸ä¹…ä¿å­˜ç­‰ä¸åŒçš„ç­–ç•¥ã€‚</li></ol><h3 id="6-æ•°æ®æˆæœ¬"><a href="#6-æ•°æ®æˆæœ¬" class="headerlink" title="6. æ•°æ®æˆæœ¬"></a>6. æ•°æ®æˆæœ¬</h3><ol><li>è®¡ç®—èµ„æºæˆæœ¬ã€‚<ul><li>ç›‘æ§èµ„æºä½¿ç”¨ç‡ï¼Œåˆç†åˆ†é…èµ„æºï¼Œé¿å…æµªè´¹ã€‚</li><li>æ— æ•ˆä»»åŠ¡ä¸‹çº¿ã€‚éœ€è¦æ ¹æ®æ•°æ®è¡¨çš„è®¿é—®ç»Ÿè®¡ï¼Œè¯†åˆ«åºŸå¼ƒä»»åŠ¡/è¡¨ã€‚</li><li>è¶…é•¿ä»»åŠ¡ä¼˜åŒ–ã€‚</li></ul></li><li>æ•°æ®å­˜å‚¨æˆæœ¬ã€‚ç»“åˆä¸Šè¿°çš„æ•°æ®ç”Ÿå‘½å‘¨æœŸï¼Œåˆ†çº§å¤„ç†ï¼Œåˆ¶å®šç­–ç•¥ã€‚ä¾‹å¦‚å¦‚ä½•å¤„ç†å†·æ•°æ®ï¼Œé‡å¤æ•°æ®ï¼Œå‹ç¼©ï¼Œæ— æ•ˆæ•°æ®ä¸‹çº¿é”€æ¯ç­‰ã€‚</li><li>æŒ‰ç…§åˆ†ç»„/ä¸ªä½“äººå‘˜ï¼Œä»¥ç»Ÿä¸€çš„æ ‡å‡†æŠ˜ç®—æ•°æ®æˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œ1CPUï¼Œ1TæŠ˜åˆä¸€ä¸ªå•ä½æˆæœ¬ï¼‰ï¼Œæ¯å‘¨ç»Ÿè®¡æŠ˜ç®—åæˆæœ¬ï¼Œç£ä¿ƒæˆæœ¬å¤§æˆ·é‡æ–°å®¡è§†å’Œä¼˜åŒ–ä»»åŠ¡.</li></ol><hr><h3 id="å‚è€ƒæ–‡æ¡£ï¼š"><a href="#å‚è€ƒæ–‡æ¡£ï¼š" class="headerlink" title="å‚è€ƒæ–‡æ¡£ï¼š"></a>å‚è€ƒæ–‡æ¡£ï¼š</h3><blockquote><ol><li>ã€Šå¤§æ•°æ®ä¹‹è·¯-é˜¿é‡Œå·´å·´å¤§æ•°æ®å®è·µã€‹</li><li>ä¿¡é€šé™¢ã€Šæ•°æ®èµ„äº§ç®¡ç†å®è·µç™½çš®ä¹¦4.0ã€‹</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> Big Data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Data Governance </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®ä¼—é“¶è¡ŒFISCO-BCOSä¸­é—´ä»¶èµæ</title>
      <link href="//articles/webank-fisco-bcos-middleware/"/>
      <url>//articles/webank-fisco-bcos-middleware/</url>
      
        <content type="html"><![CDATA[<p>åŒºå—é“¾ä¸­é—´ä»¶æ˜¯åœ¨åŒºå—é“¾èŠ‚ç‚¹å’ŒåŒºå—é“¾åº”ç”¨é—´çš„é€šç”¨ç»„ä»¶ï¼Œç”±äºå¤šæ•°æƒ…å†µä¸‹ä¼šå­˜åœ¨å¤šä¸ªåº”ç”¨å…±ç”¨ä¸€æ¡é“¾çš„æƒ…å†µï¼Œå› æ­¤ä¸­é—´ä»¶åŠŸèƒ½çš„é€šç”¨æ€§å’Œå®Œå¤‡æ€§å°±éå¸¸é‡è¦ã€‚é’ˆå¯¹ä¸åŒçš„é“¾ï¼Œä¸­é—´ä»¶è·Ÿé“¾çš„æ¥å£æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯æä¾›ç»™ä¸Šå±‚åº”ç”¨çš„åŠŸèƒ½å’Œæ¥å£åº”è¯¥æ˜¯ç¨³å®šçš„ï¼Œè€Œä¸”ç†æƒ³çŠ¶æ€ä¸‹åº”è¯¥å°½å¯èƒ½çš„ä¸ä¸å…·ä½“çš„é“¾ç‰¹æ€§åšç»‘å®šï¼ˆå®é™…ä¸Šå¾ˆå¤šæƒ…å†µä¸‹åšä¸åˆ°å®Œå…¨çš„å±è”½åº•å±‚é“¾ç‰¹æ€§ï¼‰ï¼Œå³é€‚é…å±‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸­é—´ä»¶éœ€è¦æä¾›æœ‰ä»¥ä¸‹çš„åŠŸèƒ½:</p><ul><li><strong>é“¾æ•°æ®ç®¡ç†</strong>ï¼š ç›¸å½“äºåŒºå—é“¾æµè§ˆå™¨ï¼Œè·å–é“¾çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å—é«˜ï¼Œå—ä¿¡æ¯ç­‰ï¼Œä»¥åŠç®¡ç†å„ä¸ªèŠ‚ç‚¹çš„ç®¡ç†å‘˜adminåŠŸèƒ½ï¼ˆå¯¹åº”å¾®ä¼—çš„<a href="https://fintech.webank.com/developer/docs/webase/docs/WeBASE-Node-Manager/index.html">WeBASE-Node-Manager</a>ï¼Œä¸‹åŒï¼‰</li><li><strong>äº¤æ˜“</strong>ï¼š äº¤æ˜“ä¸Šé“¾ï¼Œäº¤æ˜“æŸ¥è¯¢ï¼Œäº¤æ˜“å›æ‰§æŸ¥è¯¢ï¼Œå­˜è¯ç­‰ï¼ˆ<a href="https://fintech.webank.com/developer/docs/webase/docs/WeBASE-Transaction/index.html">WeBASE-Transcation</a>ï¼‰</li><li><strong>åˆçº¦ç¼–è¯‘éƒ¨ç½²</strong>ï¼š ç¼–è¯‘åˆçº¦ï¼Œéƒ¨ç½²åˆçº¦ç­‰(<a href="https://fintech.webank.com/developer/docs/webase/docs/WeBASE-Sign/index.html">WeBASE-Sign</a>)</li><li><strong>åˆçº¦äº‹ä»¶ç›‘å¬</strong>ï¼š è®¢é˜…äº‹ä»¶ï¼Œäº‹ä»¶æ¨é€ç­‰(åœ¨<a href="https://fintech.webank.com/developer/docs/webase/docs/WeBASE-Front/index.html">WeBASE-Front</a>é‡Œæœ‰åŸºäºMQçš„æ–¹æ¡ˆï¼Œä»¥åŠå•ç‹¬çš„åŸºäºåŒºå—é“¾çš„åˆ†å¸ƒå¼äº‹ä»¶é©±åŠ¨æ¶æ„<a href="https://fintech.webank.com/weevent">WeEvent</a>)</li><li><strong>ç§é’¥æ‰˜ç®¡</strong>ï¼š æ‰˜ç®¡ç§é’¥ï¼Œä»£ç”¨æˆ·ç­¾åä¸Šé“¾(<a href="https://fintech.webank.com/developer/docs/webase/docs/WeBASE-Sign/index.html">WeBASE-Sign</a>)</li><li><strong>åˆ†å¸ƒå¼èº«ä»½</strong>ï¼šDIDï¼Œä¸€èˆ¬éµä»W3Cè§„èŒƒï¼ˆåŸºäºå…¬ä¼—è”ç›Ÿé“¾çš„å®ä½“èº«ä»½æ ‡è¯†ä¸å¯ä¿¡æ•°æ®äº¤æ¢è§£å†³æ–¹æ¡ˆ<a href="https://fintech.webank.com/weidentity">WeIdentity</a>ï¼‰</li></ul><p>å…¶ä»–çš„è¿˜æœ‰<strong>è·¨é“¾</strong><a href="https://fintech.webank.com/wecross">WeCross</a>ï¼Œ<strong>é“¾ä¸Šæ•°æ®å¯¼å‡º</strong><a href="https://fintech.webank.com/developer/docs/webase/docs/WeBASE-Collect-Bee/index.html">WeBASE-Collect-Bee</a>ç­‰ã€‚è®¾è®¡éµä»æ¨¡å—ç‹¬ç«‹å¯æ‰©å±•ï¼Œåˆ†å¸ƒå¼æŒ‰éœ€éƒ¨ç½²çš„ç†å¿µã€‚åœ¨åç«¯è®¾è®¡ä¸Šé€šå¸¸ä½¿ç”¨http restfulæ¥å£æœåŠ¡çš„å½¢å¼ï¼Œå‡å°‘å¯¹è°ƒç”¨æ–¹çš„è¦æ±‚ï¼ŒåŒæ—¶å±è”½åº•å±‚ï¼Œä½¿åº”ç”¨å¼€å‘æ–¹ä¸“æ³¨äºä¸šåŠ¡å¼€å‘ã€‚ä¸‹é¢å…·ä½“åˆ†æå„ä¸ªç»„ä»¶ã€‚</p><h1 id="ç›®å½•ï¼š"><a href="#ç›®å½•ï¼š" class="headerlink" title="ç›®å½•ï¼š"></a>ç›®å½•ï¼š</h1><ol><li><a href="#event-listener">åˆçº¦äº‹ä»¶ç›‘å¬</a></li><li><a href="#governance">WeBankBlockchain-Governanceé“¾æ²»ç†é€šç”¨ç»„ä»¶</a></li><li><a href="#data">WeBankBlockchain-Dataæ•°æ®æ²»ç†é€šç”¨ç»„ä»¶</a></li></ol><span id="more"></span><h2 id="1-åˆçº¦äº‹ä»¶ç›‘å¬"><a href="#1-åˆçº¦äº‹ä»¶ç›‘å¬" class="headerlink" title="1. åˆçº¦äº‹ä»¶ç›‘å¬"></a><span id="event-listener">1. åˆçº¦äº‹ä»¶ç›‘å¬</span></h2><p>åˆçº¦é‡Œç»å¸¸ä¼šåŒ…å«æœ‰äº‹ä»¶ï¼ˆeventå…³é”®å­—ï¼‰ï¼Œåº”ç”¨é€šè¿‡ç›‘å¬é“¾ä¸ŠæŒ‡å®šåˆçº¦çš„æŒ‡å®šäº‹ä»¶ï¼Œä»è€Œå¾—åˆ°ç›¸åº”çš„æ•°æ®è§¦å‘ç›¸åº”çš„å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„ç³»ç»Ÿä¸å†éœ€è¦é“¾ä¸‹çš„äº¤äº’ï¼ˆä¾‹å¦‚apiè°ƒç”¨ç­‰ï¼‰ï¼Œåœ¨è¿™é‡Œï¼Œé“¾æ‰®æ¼”äº†ç±»ä¼¼<strong>æŒä¹…åŒ–çš„æ¶ˆæ¯é˜Ÿåˆ—</strong>çš„è§’è‰²ã€‚åœ¨å¤šæ•°åœºæ™¯ä¸‹ï¼Œå¯¹äºé“¾ä¸Šäº‹ä»¶ï¼Œåº”ç”¨æ–¹ä¼šæœ‰ç€ <strong>å¯ä»¥é‡å¤è¯»ï¼Œå¯ä»¥ä»æŒ‡å®šå—å¼€å§‹è¯»ï¼Œä¸èƒ½ä¸¢å¤±äº‹ä»¶</strong> ç­‰ç­‰çš„éœ€æ±‚ï¼Œè¿™äº›åœ¨è®¾è®¡ä¸­é—´ä»¶æ—¶éƒ½éœ€è¦è€ƒè™‘åœ¨å†…ã€‚</p><h3 id="1-1-åŸºäºMQçš„é€šçŸ¥æ–¹æ¡ˆ"><a href="#1-1-åŸºäºMQçš„é€šçŸ¥æ–¹æ¡ˆ" class="headerlink" title="1.1 åŸºäºMQçš„é€šçŸ¥æ–¹æ¡ˆ"></a>1.1 åŸºäºMQçš„é€šçŸ¥æ–¹æ¡ˆ</h3><p>è¯¥å®ç°åœ¨<a href="https://fintech.webank.com/developer/docs/webase/docs/WeBASE-Front/appendix.html#id8">WeBASE-Front:æ”¯æŒé“¾ä¸Šäº‹ä»¶è®¢é˜…å’Œé€šçŸ¥</a>å†…ï¼Œå¤§è‡´æµç¨‹ï¼ˆæ‘˜å½•ï¼‰ï¼š</p><ol><li>WeBASE-Frontè¿æ¥åˆ°MQ-Server(ç›®å‰æ”¯æŒRabbitMQ-Server);</li><li>WeBASE-Frontæ¥æ”¶èŠ‚ç‚¹çš„äº‹ä»¶Pushåï¼Œå¦‚å‡ºå—é€šçŸ¥ï¼ŒWeBASE-Frontå°†å‡ºå—æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼›</li><li>åŒºå—é“¾åº”ç”¨è¿æ¥MQ-Serverï¼Œè·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¾…æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå³å¯è·å¾—äº‹ä»¶é€šçŸ¥ï¼›  </li></ol><p>æ¥å£æ–‡æ¡£åœ¨<a href="https://fintech.webank.com/developer/docs/webase/docs/WeBASE-Front/interface.html#id491">è®¢é˜…åˆçº¦eventäº‹ä»¶é€šçŸ¥</a>(åŸºäºç‰ˆæœ¬v1.4.1ï¼Œä¸‹åŒ)ã€‚å…¶ä¸­ä¸»è¦å‚æ•°æœ‰ï¼ˆéƒ¨åˆ†ï¼‰</p><div class="table-container"><table><thead><tr><th>ä¸­æ–‡</th><th>å‚æ•°å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åº”ç”¨ç¼–å·</td><td>appId</td><td>æ³¨å†Œäº‹ä»¶é€šçŸ¥çš„åº”ç”¨çš„å”¯ä¸€ç¼–å·ï¼Œä»…æ”¯æŒæ•°å­—å­—æ¯å’Œä¸‹åˆ’çº¿</td></tr><tr><td>åˆçº¦abi</td><td>contractAbi</td><td>åˆçº¦çš„ABIï¼Œç”¨äºåˆçº¦eventè§£æ</td></tr><tr><td>eventèµ·å§‹åŒºå—</td><td>fromBlock</td><td>é»˜è®¤latestï¼Œè¡¨ç¤ºä¸€ç›´ç›‘å¬æœ€æ–°åŒºå—ï¼Œæœ€å°å€¼ä¸º1</td></tr><tr><td>eventæœ«åŒºå—</td><td>toBlock</td><td>æœ€å°å€¼ä¸º1ï¼Œæœ€å¤§å€¼ä¸ºå½“å‰åŒºå—é«˜åº¦ï¼Œéœ€ è¦å¤§äºç­‰äºfromBlockï¼›å¡«å†™latestï¼Œè¡¨ç¤ºä¸€ç›´ç›‘å¬æœ€æ–°åŒºå—</td></tr><tr><td>åˆçº¦åœ°å€</td><td>contractAddress</td><td>åˆçº¦åœ°å€</td></tr><tr><td>åˆçº¦eventåˆ—è¡¨</td><td>topicList</td><td>Listç±»å‹ï¼Œåˆçº¦Eventäº‹ä»¶åˆ—è¡¨ï¼ŒEventå‚æ•°ä¹‹é—´ä¸å¸¦ç©ºæ ¼</td></tr></tbody></table></div><p>å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š<br><img src="/images/webank/webase-front-event.jpg" width="50%" height="50%"></p><ol><li>åº”ç”¨é€šè¿‡APIè¯·æ±‚<a href="https://fintech.webank.com/developer/docs/webase/docs/WeBASE-Front/interface.html#id491">è®¢é˜…åˆçº¦eventäº‹ä»¶é€šçŸ¥</a>æ¥å£</li><li><code>EventService</code>ç±»æ„é€ äº†<code>ContractEventCallback</code>ç”¨äºåç»­æ”¶åˆ°å¼‚æ­¥æ¨é€çš„å›æ‰å®ç°ï¼ŒåŒæ—¶ç”ŸæˆUUIDä½œä¸ºfilterIDï¼Œç„¶åå°†ï¼ˆfilterID-callbackï¼‰è¿™é”®å€¼å¯¹è®°å½•åˆ°<code>eventLogFilterManager</code>(æœ¬åœ°mapç»“æ„ï¼‰å†…ã€‚ç„¶åå‘FISCO BCOSèŠ‚ç‚¹åŒæ­¥å‘é€<code>ChannelMessageType.CLIENT_REGISTER_EVENT_LOG</code>ç±»å‹çš„æ³¨å†Œè¯·æ±‚ã€‚ï¼ˆå®¢æˆ·ç«¯ä¸èŠ‚ç‚¹çš„äº¤äº’åŸºäº<a href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/design/protocol_description.html#channelmessage-v2">Channel</a>åè®®ã€‚äº¤äº’åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šæ³¨å†Œè¯·æ±‚ï¼ŒèŠ‚ç‚¹å›å¤ï¼ŒEvent Logæ•°æ®æ¨é€ã€‚ï¼‰å®é™…å®ç°æ˜¯åŸºäºnettyé€šä¿¡æ¡†æ¶ï¼Œè¿™é‡Œçš„webase-frontä¸­é—´ä»¶ä¸é“¾èŠ‚ç‚¹é—´ç»´æŒç€é•¿é“¾æ¥ã€‚å‚è€ƒ<a href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/sdk/java_sdk/event_sub.html">Fisco Bcosçš„åˆçº¦äº‹ä»¶æ¨é€</a>ã€‚ç„¶ååŒæ­¥æ³¨å†ŒæˆåŠŸ/å¤±è´¥åå°†ç»“æœè¿”å›ç»™APIè°ƒç”¨æ–¹ã€‚</li><li>ä¸­é—´ä»¶æ”¶åˆ°é“¾èŠ‚ç‚¹æ¨é€çš„<code>ChannelMessageType.EVENT_LOG_PUSH</code>ç±»å‹æ¶ˆæ¯ï¼Œæ ¹æ®æ¶ˆæ¯ä½“é‡Œæºå¸¦çš„filterIDä»<code>eventLogFilterManager</code>é‡Œå–å‡ºç›¸åº”çš„callbackï¼Œç„¶åè°ƒç”¨<code>ContractEventCallback#onPushMessageLog</code>ã€‚</li><li>åœ¨callbacké‡Œè°ƒç”¨<code>ContractEventCallback#pushMeessage2MQ</code>ï¼Œå°†ç›‘å¬åˆ°çš„logæ¨é€åˆ°MQã€‚åœ¨æ­¤ä¹‹å‰ï¼Œåº”ç”¨å·²ç»è®¢é˜…äº†MQçš„æŒ‡å®šä¸»é¢˜ï¼Œåç»­çš„ç®¡ç†äº¤ç”±MQã€‚</li></ol><h4 id="è§‚ç‚¹ï¼š"><a href="#è§‚ç‚¹ï¼š" class="headerlink" title="è§‚ç‚¹ï¼š"></a>è§‚ç‚¹ï¼š</h4><ol><li>åœ¨å¤šconsumeråœºæ™¯ååŒæ¶ˆè´¹ç­‰æƒ…å†µä¸‹ï¼Œä¼ ç»ŸMQçš„ç®¡ç†æ˜¯ç›¸å¯¹å¤æ‚çš„ï¼Œè€Œä¸”ä¹Ÿæœ‰å¾ˆæˆç†Ÿçš„æ–¹æ¡ˆå’Œç»„ä»¶ã€‚å› æ­¤ï¼ŒåŒºå—é“¾ä¸­é—´ä»¶è´Ÿè´£ç›‘å¬é“¾ä¸Šæ•°æ®å¹¶å¯¼å…¥MQï¼Œåç»­ç®¡ç†æ¶ˆè´¹äº¤ç”±MQï¼Œå„å¸å…¶èŒï¼Œä¹Ÿå……åˆ†åˆ©ç”¨MQçš„ç‰¹æ€§ï¼Œå€¼å¾—å€Ÿé‰´ã€‚</li><li>è¯¥æ–¹æ¡ˆæ²¡æœ‰æŒä¹…åŒ–ï¼Œæ¯æ¬¡frontä¸­é—´ä»¶é‡å¯ä¹‹åéœ€è¦é‡æ–°æ³¨å†Œã€‚å› æ­¤ï¼Œéœ€è¦åœ¨åº”ç”¨å±‚æŒä¹…åŒ–å½“å‰æ¶ˆè´¹åˆ°çš„blockNumberï¼Œä¸‹æ¬¡é‡å¯åæŒ‡å®šfromBlockã€‚ä¸‹æ¬¡é‡å¯åï¼Œå¾ˆå¯èƒ½ä¼šé€ æˆé‡å¤æ¶ˆè´¹ã€‚</li><li>å¦‚æœåŒä¸€ä¸ªåº”ç”¨çš„å¤šä¸ªå®ä¾‹å‘å¤šä¸ªfrontä¸­é—´ä»¶æ³¨å†Œï¼Œç”±äºæ²¡æœ‰æŒä¹…åŒ–ï¼Œå¹¶ä¸”éƒ½æ˜¯è®°å½•åœ¨è¿›ç¨‹mapæ•°æ®ç»“æ„å†…ï¼Œä¸åŒçš„filterIDï¼Œå°±ä¼šé€ æˆå¤šä¸ªfrontä¸­é—´ä»¶ç‹¬ç«‹æ³¨å†Œï¼ˆä¾‹å¦‚å‘ä¸åŒçš„é“¾èŠ‚ç‚¹ï¼‰ï¼Œé€ æˆåŒä¸€ä¸ªäº‹ä»¶çš„æ•°æ®è¢«é‡å¤æ¨é€ï¼ˆä¾‹å¦‚ï¼Œæ€»å…±3ä¸ªfrontï¼Œå„è‡ªå‘3ä¸ªä¸åŒçš„é“¾èŠ‚ç‚¹æ³¨å†ŒåŒä¸€ä¸ªäº‹ä»¶ï¼Œåˆ™3ä¸ªfrontä¸­é—´ä»¶éƒ½ä¼šæ”¶åˆ°åŒä¸€ä¸ªäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¢«3æ¬¡å†™å…¥MQï¼‰ã€‚å› æ­¤ï¼Œéœ€è¦åœ¨åº”ç”¨å±‚åšå¥½å¤šå®ä¾‹ä¸‹çš„åŒæ­¥ï¼ŒåŒ…æ‹¬å®ä¾‹çš„åŠ å…¥/é€€å‡ºåœºæ™¯ï¼Œé¿å…é‡å¤æ³¨å†Œç›‘å¬å™¨ã€‚</li><li>ç›‘å¬çš„äº‹ä»¶é€šçŸ¥æ˜¯é€šè¿‡PUSHçš„æ¨¡å¼å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯é“¾ä¸Šç›‘å¬çš„lastBlockNumberæ˜¯è®°å½•åœ¨é“¾èŠ‚ç‚¹ç«¯çš„ã€‚å­˜åœ¨ä¸€ç§æç«¯çš„æƒ…å†µï¼Œä¾‹å¦‚<code>ContractEventCallback#pushMeessage2MQ</code>å¼‚å¸¸ï¼Œæ²¡æ³•æ¨é€åˆ°MQé‡Œï¼Œå½“å‰åªæ˜¯è®°å½•åˆ°æ—¥å¿—é‡Œerrorçº§åˆ«ã€‚åœ¨é“¾èŠ‚ç‚¹ç«¯çœ‹æ¥æ¨é€æˆåŠŸï¼ˆæ— è®ºæ˜¯å¦å¤„ç†æˆåŠŸï¼‰ï¼ŒlastBlockNumberç»§ç»­å¾€å‰æ¨è¿›ï¼Œè€Œå®é™…ä¸ŠMQé‡Œæ²¡æœ‰è¿™æ¡æ•°æ®ï¼Œå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ã€‚å³ä½¿åæœŸé€šè¿‡æ—¥å¿—æ¥è¡¥å‘MQï¼Œå¯¹äºå¤„ç†äº‹ä»¶æœ‰å…ˆåé¡ºåºçš„ç‰¹æ®Šåº”ç”¨å¯èƒ½ä¼šå¼•èµ·è¿é”ååº”ï¼Œï¼ˆä¾‹å¦‚æŸä¸ªåˆçº¦é‡Œåœ¨block Næœ‰äº‹ä»¶ä¸€ä½†æ˜¯ä¸¢å¤±äº†ï¼Œblock N+10é‡Œäº‹ä»¶äºŒï¼Œç”±äºäº‹ä»¶ä¸€æœªå¤„ç†ï¼ŒçŠ¶æ€å¯¹åº”ä¸ä¸Šï¼Œå¯¼è‡´äº‹ä»¶äºŒä¹Ÿå¤±è´¥ï¼‰ã€‚è¿™ç§PUSHçš„æ–¹å¼åœ¨æŸäº›åœºæ™¯ä¸‹éš¾ä»¥æ¥å—ã€‚</li></ol><h4 id="è§£å†³æ€è·¯ï¼š"><a href="#è§£å†³æ€è·¯ï¼š" class="headerlink" title="è§£å†³æ€è·¯ï¼š"></a>è§£å†³æ€è·¯ï¼š</h4><ol><li>ä»ç„¶å‚è€ƒå¼•å…¥ç¬¬ä¸‰æ–¹MQçš„æ€è·¯ï¼Œå°†é“¾ä¸Šäº‹ä»¶å¯¼å…¥MQï¼Œç”±MQæ¥ç®¡ç†é˜Ÿåˆ—æ¶ˆè´¹ã€‚æ­¤å¤„è€ƒè™‘å¼•å…¥zk + kafkaã€‚</li><li>æ”¹ç”¨PULLçš„æ–¹å¼ã€‚åœ¨frontä¸­é—´ä»¶æŒä¹…åŒ–å½“å‰å·²ç»æˆåŠŸå‘é€åˆ°MQçš„lastBlockNumberï¼Œæ¯æ¬¡åœ¨æˆåŠŸå‘é€MQåå†æ›´æ–°æŒä¹…åŒ–çš„lastBlockNumberã€‚èƒ½ä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯å¯èƒ½ä¼šé‡å¤åŠ å…¥MQã€‚è¿™é‡Œçš„æŒä¹…åŒ–å¯ä»¥è€ƒè™‘ä½¿ç”¨zkï¼Œå°†æ¶ˆè´¹ä¿¡æ¯è®°å½•åˆ°zkä¸Šï¼Œå¦‚æœäº¤äº’å¯èƒ½ä¼šæ¯”è¾ƒé¢‘ç¹ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨mysqlç­‰å…³ç³»å‹æ•°æ®åº“ã€‚</li><li>å¤šä¸ªfrontèŠ‚ç‚¹åªéœ€è¦ä¸€ä¸ªå®ä¾‹æ¥PULLé“¾ä¸Šçš„event logï¼Œè€Œä¸”éœ€è¦æœ‰ä¸”ä»…æœ‰å”¯ä¸€ã€‚å¯ä»¥ä½¿ç”¨zkæ¥åšåˆ†å¸ƒå¼é”ï¼Œè§£å†³å¤šå®ä¾‹çš„åŠ å…¥é€€å‡ºä¸‹çš„åŠ¨æ€é€‰ä¸»ã€‚</li><li>ç”±äºåœ¨frontä¸­é—´ä»¶æœ‰æŒä¹…åŒ–ç›‘å¬ä¿¡æ¯ï¼Œå› æ­¤å³ä½¿åœ¨å¤šä¸ªåº”ç”¨å®ä¾‹åŒæ—¶æ³¨å†Œæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åˆ¤æ–­åŒä¸€ä¸ªç›‘å¬æ˜¯å¦å·²è¢«æ³¨å†Œè€Œä¸”åœ¨è¿è¡Œä¸­ç­‰çŠ¶æ€ï¼ˆè¿™é‡Œéœ€è¦é€‚å½“çš„é”ï¼‰ï¼Œä»è€Œé¿å…å¤šå®ä¾‹é‡å¤æ³¨å†Œçš„é—®é¢˜ã€‚</li></ol><h3 id="1-2-WeEventæ¡†æ¶"><a href="#1-2-WeEventæ¡†æ¶" class="headerlink" title="1.2 WeEventæ¡†æ¶"></a>1.2 <a href="https://fintech.webank.com/weevent">WeEvent</a>æ¡†æ¶</h3><p>åŸºäºWeEvent v1.4.0ç‰ˆæœ¬ã€‚æ¦‚å¿µåŠæ¨¡å‹å‚è€ƒ<a href="https://weeventdoc.readthedocs.io/zh_CN/latest/introduction/core.html">æ ¸å¿ƒæ¦‚å¿µ</a>ã€‚consumerçš„å®ç°é€»è¾‘å¦‚ä¸‹å›¾ï¼š<br><img src="/images/webank/weevent-stomp.jpg" width="80%" height="80%"></p><ul><li><strong>åº”ç”¨è®¢é˜…ä¸»é¢˜</strong>ï¼š</li></ul><ol><li>é€šè¿‡stompåè®®è®¢é˜…topicï¼Œè¿™ä¸ªæ˜¯websocketçš„ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„æŠ¥æ–‡æ ¼å¼ã€‚è¿™ä¸ªåœ¨weevent-brokeråŒ…é‡Œã€‚é‡Œé¢æœ‰mqttï¼ˆç”¨äºIoTï¼‰å’Œstompåè®®ç”¨äºconsumerï¼Œå¦å¤–æœ‰jsonrpcå’Œrestç”¨äºproducerã€‚å‚çœ‹<a href="https://weeventdoc.readthedocs.io/zh_CN/latest/introduction/core.html">æ¥å…¥è¯´æ˜</a>ï¼Œå…¶ä¸­ï¼Œ<strong><code>æš‚æ—¶ä¸æ”¯æŒæ¶ˆæ¯ç¡®è®¤ACKå’Œäº‹åŠ¡Transactionè¯­ä¹‰ã€‚</code>(</strong><a href="https://weeventdoc.readthedocs.io/zh_CN/latest/protocol/stomp.html">æ‘˜å½•</a>)</li><li>é’ˆå¯¹æ¯ä¸ªè®¢é˜…ï¼Œæ–°å»ºnotifyTaskå¹¶ä¸”æ³¨å†Œã€‚ï¼ˆweevent-coreåŒ…ï¼‰</li></ol><ul><li><strong><a href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/manual/amop_protocol.html">AMOP</a>ï¼ˆAdvanced Messages Onchain Protocolï¼‰åè®®</strong><br>é“¾ä¸Šä¿¡ä½¿åè®®AMOPï¼ˆAdvanced Messages Onchain Protocolï¼‰ç³»ç»Ÿæ—¨åœ¨ä¸ºFisco Bcosè”ç›Ÿé“¾æä¾›ä¸€ä¸ªå®‰å…¨é«˜æ•ˆçš„æ¶ˆæ¯ä¿¡é“ï¼Œè”ç›Ÿé“¾ä¸­çš„å„ä¸ªæœºæ„ï¼Œåªè¦éƒ¨ç½²äº†åŒºå—é“¾èŠ‚ç‚¹ï¼Œæ— è®ºæ˜¯å…±è¯†èŠ‚ç‚¹è¿˜æ˜¯è§‚å¯ŸèŠ‚ç‚¹ï¼Œå‡å¯ä½¿ç”¨AMOPè¿›è¡Œé€šè®¯ï¼ˆæ‘˜ï¼‰ã€‚è¿™ä¸ªå®é™…ä¸Šæ˜¯æ„å»ºåœ¨é“¾çš„å•æ’­/å¹¿æ’­æ¶ˆæ¯é€šä¿¡åè®®ï¼Œæ”¯æŒç§æœ‰è¯é¢˜åŠ å¯†é€šä¿¡ï¼Œå‘é€æ–‡æœ¬å’Œæ–‡ä»¶ï¼ˆä»¥åæœ‰æœºä¼šå†æ·±å…¥ç ”ç©¶ï¼‰ï¼Œæ­¤å¤„å¯ä»¥å®ç°é“¾èŠ‚ç‚¹å’Œé“¾å¤–ç³»ç»Ÿçš„é€šä¿¡ã€‚æ­¤å¤„ä¹Ÿæœ‰Topicçš„æ¦‚å¿µï¼Œéœ€è¦åŒºåˆ†è¯¥Topicå’Œevent topicä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚</li></ul><ol><li>é“¾èŠ‚ç‚¹åœ¨å‡ºå—æ—¶é€šè¿‡AMOPåè®®å‘<code>Consummer</code>æ¨é€<code>BLOCK_NOTIFY</code>æ¶ˆæ¯ã€‚ï¼ˆè¯¥è¯é¢˜æ˜¯consumeråˆå§‹åŒ–æ—¶è®¢é˜…çš„ï¼‰</li><li><code>BlockEventListener</code>å‘<code>BlockNotifyQueue</code>é˜Ÿåˆ—åŠ å…¥æœ€æ–°çš„blockNumerã€‚</li></ol><ul><li><strong>æ¶ˆè´¹eventå¹¶æ¨é€</strong></li></ul><ol><li>å¸¸é©»çº¿ç¨‹<code>MainEventLoop</code>ä»<code>BlockNotifyQueue</code>pollé˜Ÿåˆ—å†…çš„<code>blockNumber</code>ï¼Œè·å¾—æœ€æ–°çš„blockNumer</li><li><code>MainEventLoop</code>æœ¬åœ°ç»´æŠ¤ä¸Šæ¬¡æ¶ˆè´¹åˆ°çš„<code>lastBlock</code>ï¼Œæ¯”è¾ƒ<code>lastBlock + 1 &lt;= blockNumber</code>ï¼Œé€šè¿‡<code>getBlock</code>æ¥å£å‘é“¾èŠ‚ç‚¹è·å–ä¸‹ä¸€ä¸ªåŒºå—ï¼ˆ<code>lastBlock + 1</code>ï¼Œæ¯æ¬¡åªæ¶ˆè´¹ä¸€ä¸ªåŒºå—ï¼‰ï¼Œä»è€Œè·å–åŒºå—åŒ…å«çš„äº¤æ˜“å›æ‰§ï¼Œä»è€Œdecodeå‡ºå…·ä½“çš„eventã€‚</li><li>ç„¶ådispatchæäº¤åˆ°å„è‡ªåˆ°<code>eventQueue</code>é˜Ÿåˆ—å†…ï¼Œç„¶åæ›´æ–°<code>lastBlock += 1</code>ã€‚æ­¤å¤„<code>lastBlock</code>æ˜¯çº¿ç¨‹å†…éƒ¨å˜é‡ï¼Œä¸æŒä¹…åŒ–ã€‚</li><li><code>NotifyTask</code>ä»è‡ªèº«çš„<code>eventQueue</code>pollé˜Ÿåˆ—å†…çš„eventï¼Œç„¶åå›è°ƒ<code>BrokerStomp.EventListener#onEvent</code>æ–¹æ³•ã€‚</li><li><code>BrokerStomp</code>ä½¿ç”¨stompåè®®é‡Œ<code>SEND</code>å‘åº”ç”¨æ¨é€eventã€‚</li></ol><h4 id="è§‚ç‚¹ï¼š-1"><a href="#è§‚ç‚¹ï¼š-1" class="headerlink" title="è§‚ç‚¹ï¼š"></a>è§‚ç‚¹ï¼š</h4><ol><li>é“¾èŠ‚ç‚¹åˆ°eventä¸­é—´ä»¶é—´çš„AMOPåè®®æ˜¯PUSHæ–¹å¼ï¼Œeventä¸­é—´ä»¶å‘é“¾èŠ‚ç‚¹è·å–åŒºå—æ—¶æ˜¯PULLæ–¹å¼ã€‚å› æ­¤ï¼Œå³ä½¿PULLæ–¹å¼å¶å°”å¤±è´¥ï¼Œä¾‹å¦‚ä¸¢å¤±è‹¥å¹²ä¸ªä¸­é—´å‡ºå—äº‹ä»¶çš„å—é«˜ï¼Œæœ€åè¿˜æ˜¯ä¼šä»¥æœ€å¤§çš„å—é«˜ä¸ºå‡†ã€‚è€Œè·å–åŒºå—getBlockä½¿ç”¨pullçš„æ–¹å¼ï¼Œå¯é‡å¤è¯»ï¼Œä¿è¯æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</li><li>æ¶ˆè´¹<code>lastBlock</code>æ²¡æœ‰æŒä¹…åŒ–ï¼Œåº”ç”¨æ¯æ¬¡subscribeåéƒ½æ˜¯æŒ‰ç…§ä»æœ€æ–°çš„blockå¼€å§‹å–ï¼Œ<strong>ä¸æ”¯æŒ</strong>æŒ‡å®š(fromBlock, toBlock)æ¶ˆè´¹å†å²æ•°æ®ã€‚</li><li><code>BrokerStomp</code>åˆ°åº”ç”¨è¿™ä¸€æ®µçš„æ¨é€<strong>ä¸æ”¯æŒ</strong>ACKåŠäº‹åŠ¡ï¼Œå› æ­¤è¿™éƒ¨åˆ†æ¨é€æœ‰å¯èƒ½ä¸¢å¤±ã€‚</li><li><code>weevent-processor</code>åŒ…é‡Œä¸»è¦æ˜¯é“¾ä¸Šçš„æµäº‹ä»¶å¤„ç†ã€‚ï¼ˆè¿™ä¸ªä¸å¤§æ•°æ®æµè®¡ç®—çš„å¯¹æ¯”æœ‰å¾…åç»­åˆ†æï¼‰</li></ol><hr><h2 id="2-WeBankBlockchain-Governanceé“¾æ²»ç†é€šç”¨ç»„ä»¶"><a href="#2-WeBankBlockchain-Governanceé“¾æ²»ç†é€šç”¨ç»„ä»¶" class="headerlink" title="2. WeBankBlockchain-Governanceé“¾æ²»ç†é€šç”¨ç»„ä»¶"></a><span id="governance">2. <a href="https://github.com/WeBankBlockchain/Governance-Doc">WeBankBlockchain-Governanceé“¾æ²»ç†é€šç”¨ç»„ä»¶</a></span></h2><p>å¾®ä¼—é“¶è¡Œæå‡ºé¢å‘åŒºå—é“¾çš„å¤šæ–¹åä½œæ²»ç†æ¡†æ¶â€”â€” Multilateral Collaborative Governance Frameworkï¼ˆMCGFï¼‰ã€‚å…·ä½“è§<a href="https://mp.weixin.qq.com/s?__biz=MzU0MDY4MDMzOA==&amp;mid=2247486381&amp;idx=1&amp;sn=caae41a2241e3b1c2cd58181ef73a1bc&amp;chksm=fb34c250cc434b46b2c1b72299c2eb71e1bd6b7597c341423c5d262f18a6e0af1628e0ba4037&amp;scene=21#wechat_redirect">ç™½çš®ä¹¦</a></p><h3 id="2-1-WeBankBlockchain-Governance-Key-ç§é’¥ç®¡ç†ç»„ä»¶"><a href="#2-1-WeBankBlockchain-Governance-Key-ç§é’¥ç®¡ç†ç»„ä»¶" class="headerlink" title="2.1 WeBankBlockchain-Governance-Key ç§é’¥ç®¡ç†ç»„ä»¶"></a>2.1 WeBankBlockchain-Governance-Key ç§é’¥ç®¡ç†ç»„ä»¶</h3><ol><li><p>åŠ©è®°è¯ç”Ÿæˆç§é’¥<br>å‚è€ƒç±»<code>PkeyByMnemonicService.java</code>ã€‚é€šè¿‡åŠ©è®°è¯<code>mnemonic</code>ä¸å¯†ç <code>passphrase</code>è¿›è¡Œ<code>PBKDF2WithHmacSha512</code>å“ˆå¸Œç®—æ³•ç”Ÿæˆç¡®å®šæ€§çš„å…¬ç§é’¥å¯¹<code>keyPair</code>å’Œç”¨äºå®‰å…¨æ´¾ç”Ÿå­å¯†é’¥çš„<code>chaincode</code>ã€‚</p></li><li><p>ç§é’¥æ‰˜ç®¡<br>å‚è€ƒç±»<code>KeyHandler.java</code>ã€‚ä»¥æ•°æ®åº“å­˜å‚¨ä¸ºä¾‹ï¼Œç§é’¥ <strong><em>åŠ å¯†</em></strong> åå­˜å‚¨ï¼ŒåŠ å¯†çš„æ–¹å¼ä¾‹å¦‚<a href="https://github.com/ethereum/wiki/wiki/Web3-Secret-Storage-Definition">Ethereum wallet file</a>(é€‚é…Ethereumçš„æ¨¡å¼), æˆ–è€…p12çš„KeyStoreï¼ˆå¯†ç è®¿é—®æ¨¡å¼ï¼‰ç­‰ã€‚æŒ‰ç…§åŠ å¯†å£ä»¤æ ¹æ®æ˜¯å¦åŒæ—¶æ‰˜ç®¡ä¹Ÿåˆ†ä¸ºåŠæ‰˜ç®¡ï¼ˆåŠ å¯†å£ä»¤åœ¨ç”¨æˆ·æ‰‹ä¸­ï¼ŒåŠ å¯†åçš„ç§é’¥å­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œéœ€è¦ä½¿ç”¨ç§é’¥ç­¾åæ—¶å€™éœ€è¦åŒæ—¶ä¼ å…¥åŠ å¯†å£ä»¤è§£å¯†ï¼‰å’Œå…¨æ‰˜ç®¡ã€‚å…¨æ‰˜ç®¡æ–¹å¼ä¸‹ï¼ŒåŠ å¯†å£ä»¤å’ŒåŠ å¯†åçš„ç§é’¥åˆ†åº“å­˜å‚¨ï¼Œé™ä½å®‰å…¨é£é™©ã€‚</p></li><li><p>ç§é’¥æ´¾ç”Ÿ</p></li><li>ç§é’¥åˆ†ç‰‡</li></ol><h3 id="2-2-WeBankBlockchain-Governance-Account-è´¦æˆ·æ²»ç†ç»„ä»¶"><a href="#2-2-WeBankBlockchain-Governance-Account-è´¦æˆ·æ²»ç†ç»„ä»¶" class="headerlink" title="2.2 WeBankBlockchain-Governance-Account è´¦æˆ·æ²»ç†ç»„ä»¶"></a>2.2 WeBankBlockchain-Governance-Account è´¦æˆ·æ²»ç†ç»„ä»¶</h3><p>å¢åŠ <code>æ™®é€šè´¦æˆ·ï¼ˆNormal Accountï¼‰</code>çš„æ¦‚å¿µï¼Œä¸å¤–éƒ¨è´¦æˆ·ä¸€å¯¹ä¸€ç»‘å®šï¼Œåœ¨é“¾ä¸Šçš„èº«ä»½ç”¨çš„æ˜¯æ™®é€šè´¦æˆ·çš„åœ°å€ã€‚å³<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> ------------------------      --------       --------</span><br><span class="line">| å¤–éƒ¨è´¦æˆ·(ç”¨æˆ·æ‰‹æŒçš„å…¬ç§é’¥) | -&gt; | æ™®é€šè´¦æˆ· | -&gt; | åº”ç”¨åˆçº¦ |</span><br><span class="line"> ------------------------      --------       --------</span><br></pre></td></tr></table></figure><br>å› æ­¤ï¼Œç®¡ç†å‘˜å¯ä»¥æ·»åŠ ï¼Œæ›¿æ¢ï¼Œå†»ç»“ï¼Œè§£å†»æ™®é€šè´¦æˆ·ï¼ˆä¹Ÿå¯ä»¥ç”±ç”¨æˆ·è‡ªèº«æå‡ºï¼‰ï¼Œä¾‹å¦‚ç”¨æˆ·é—å¤±/æ³„éœ²ç§é’¥çš„åœºæ™¯ä¸‹ï¼Œåªéœ€è¦æ›´æ–°&lt;å¤–éƒ¨, æ™®é€š&gt;è´¦æˆ·å¯¹åº”å…³ç³»ï¼Œè€Œé“¾ä¸Šçš„åº”ç”¨åˆçº¦å¯¹åº”çš„æ™®é€šè´¦æˆ·ä¸å˜ã€‚åº”ç”¨åˆçº¦éœ€è¦å¼•å…¥<code>AccountManager.sol</code>ï¼Œä½¿ç”¨<code>_accountManager</code>é‡Œè®°å½•çš„æ™®é€šç”¨æˆ·åœ°å€æ¥ä»£æ›¿<code>msg.sender</code>æ¥åˆ¤æ–­èº«ä»½æƒé™ã€‚</p><p>ç®¡ç†å‘˜çš„è§’è‰²å¯ä»¥åˆ†ç±»ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯è¶…çº§ç®¡ç†å‘˜ï¼ˆå”¯ä¸€ï¼‰ï¼Œä¸€ç±»æ˜¯ç®¡å‘˜å§”å‘˜ä¼šï¼ˆæŠ•ç¥¨å†³ç­–ï¼‰ã€‚éƒ¨ç½²çš„åˆçº¦åˆ†åˆ«æ˜¯<code>AdminGovernBuilder.sol</code>å’Œ<code>ï¼ˆWeightï¼‰VoteGovernBuilder.sol</code>ã€‚ä»¥<code>AdminGovernBuilder.sol</code>ä¸ºä¾‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AdminGovernBuilder.sol</span></span><br><span class="line"><span class="comment">// éƒ¨ç½²åˆçº¦ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ä¾‹åŒ–ä»¥ä¸‹çš„åˆçº¦ã€‚</span></span><br><span class="line">contract AdminGovernBuilder &#123;</span><br><span class="line">  address public _governance;</span><br><span class="line"></span><br><span class="line">  <span class="title">constructor</span>(<span class="params"></span>) <span class="title">public</span> &#123;</span><br><span class="line">    WEGovernance governance = <span class="keyword">new</span> WEGovernance(<span class="number">0</span>);</span><br><span class="line">    governance.setOwner(msg.sender);</span><br><span class="line">    _governance = address(governance);</span><br><span class="line">    address _accountManager = governance.getAccountManager();</span><br><span class="line">    AccountManager accountManager = AccountManager(_accountManager);</span><br><span class="line">    accountManager.newAccount(msg.sender);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getGovernance</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address</span>) </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getAccountManager</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address</span>) </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WEGovernance.sol</span></span><br><span class="line"><span class="comment">// è¯¥åˆçº¦æ˜¯ç®¡ç†è§„åˆ™ï¼Œä¾‹å¦‚åœ¨ç®¡ç†å§”å‘˜ä¼šæ–¹å¼ä¸‹ï¼Œå‘èµ·æŠ•ç¥¨requestVoteå’Œå„ä¸ªå§”å‘˜voteçš„æ±‡æ€»è®¡ç®—é€»è¾‘éƒ½æ˜¯åœ¨æ­¤åˆçº¦é‡Œã€‚</span></span><br><span class="line">contract WEGovernance is WEBoardVoteGuard &#123;</span><br><span class="line">  address _accountManager;</span><br><span class="line">  <span class="comment">// 0: admin-mode; 1: vote-mode.</span></span><br><span class="line">  uint8 public _mode = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title">constructor</span>(<span class="params">uint8 mode</span>) <span class="title">public</span> &#123;</span><br><span class="line">    _mode = mode;</span><br><span class="line">    AccountManager accountManager = <span class="keyword">new</span> AccountManager();</span><br><span class="line">    _accountManager = address(accountManager);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‘èµ·æŠ•ç¥¨ï¼Œç™»è®°è¯¥æŠ•ç¥¨ä¿¡æ¯</span></span><br><span class="line">  <span class="comment">// return id : å”¯ä¸€æ ‡å¿—ææ¡ˆï¼Œä¸voteæ–¹æ³•çš„å…¥å‚ç›¸å¯¹åº”</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params">uint8 txType, ...</span>) <span class="title">external</span> <span class="title">validVoter</span> <span class="title">returns</span> (<span class="params">bool b, uint256 id</span>) </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŠ•ç¥¨</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">vote</span>(<span class="params">uint256 id, bool flag</span>) <span class="title">external</span> <span class="title">validVoter</span> <span class="title">returns</span> (<span class="params">bool b</span>)</span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AccountManager.sol</span></span><br><span class="line"><span class="comment">// &lt;å¤–éƒ¨, æ™®é€š&gt;è´¦æˆ·å¯¹åº”å…³ç³»çš„å­˜æ”¾</span></span><br><span class="line">contract AccountManager is WEBasicAuth &#123;</span><br><span class="line">  <span class="comment">// å¤–éƒ¨è´¦æˆ· -&gt; æ™®é€šè´¦æˆ·</span></span><br><span class="line">  mapping(<span class="function"><span class="params">address</span> =&gt;</span> address) _externalAccountMapping;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ™®é€šè´¦æˆ· -&gt; å¤–éƒ¨è´¦æˆ·</span></span><br><span class="line">  mapping(<span class="function"><span class="params">address</span> =&gt;</span> address) _userAccountMapping;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// EvidenceDemo.sol</span></span><br><span class="line"><span class="comment">// åº”ç”¨åˆçº¦ç¤ºä¾‹ã€‚å¼•å…¥AccountManagerå³å¯</span></span><br><span class="line">contract EvidenceDemo &#123;</span><br><span class="line">  address public _owner;</span><br><span class="line">  AccountManager _accountManager;</span><br><span class="line"></span><br><span class="line">  <span class="title">constructor</span>(<span class="params">address accountManager</span>) <span class="title">public</span> &#123;</span><br><span class="line">    _accountManager = AccountManager(accountManager);</span><br><span class="line">    _owner = _accountManager.getUserAccount(msg.sender);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨_accountManageré‡Œè®°å½•çš„æ™®é€šç”¨æˆ·åœ°å€æ¥ä»£æ›¿ msg.sender</span></span><br><span class="line">  modifier <span class="function"><span class="title">onlyOwner</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    address userAccountAddress = _accountManager.getUserAccount(msg.sender);</span><br><span class="line">    <span class="built_in">require</span>(userAccountAddress == _owner, <span class="string">&quot;Not admin&quot;</span>);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-WeBankBlockchain-Governance-Auth-æƒé™æ²»ç†ç»„ä»¶"><a href="#2-3-WeBankBlockchain-Governance-Auth-æƒé™æ²»ç†ç»„ä»¶" class="headerlink" title="2.3 WeBankBlockchain-Governance-Auth æƒé™æ²»ç†ç»„ä»¶"></a>2.3 WeBankBlockchain-Governance-Auth æƒé™æ²»ç†ç»„ä»¶</h3><p>ä¸è´¦æˆ·æ²»ç†ç»„ä»¶éå¸¸ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å¼•å…¥äº†æƒé™ç®¡ç†åˆçº¦ï¼Œç”±è¶…çº§ç®¡ç†å‘˜æˆ–è€…ç®¡ç†å‘˜å§”å‘˜ä¼šè¿›è¡Œç®¡ç†ã€‚åœ¨åº”ç”¨åˆçº¦é‡Œè®¿é—®æƒé™ç®¡ç†åˆçº¦ï¼Œè°ƒç”¨<code>canCallFunction</code>æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è®¿é—®æŒ‡å®šçš„åˆçº¦æ–¹æ³•ã€‚æ¶æ„å›¾å¦‚ä¸‹ï¼š<br><img src="/images/webank/webank-governance-auth.jpg" width="50%" height="50%"></p><hr><h2 id="3-WeBankBlockchain-Dataæ•°æ®æ²»ç†é€šç”¨ç»„ä»¶"><a href="#3-WeBankBlockchain-Dataæ•°æ®æ²»ç†é€šç”¨ç»„ä»¶" class="headerlink" title="3. WeBankBlockchain-Dataæ•°æ®æ²»ç†é€šç”¨ç»„ä»¶"></a><span id="data">3. WeBankBlockchain-Dataæ•°æ®æ²»ç†é€šç”¨ç»„ä»¶</span></h2><p>å‚è€ƒ<a href="https://github.com/WeBankBlockchain/Data-Doc">æ–‡æ¡£</a></p><h3 id="3-1-WeBankBlockchain-Data-Reconcileå¯¹è´¦æœåŠ¡"><a href="#3-1-WeBankBlockchain-Data-Reconcileå¯¹è´¦æœåŠ¡" class="headerlink" title="3.1 WeBankBlockchain-Data-Reconcileå¯¹è´¦æœåŠ¡"></a>3.1 WeBankBlockchain-Data-Reconcileå¯¹è´¦æœåŠ¡</h3><p>é‡‘èæœºæ„ç‰¹åˆ«æ˜¯å¤®è¡Œ/å•†ä¸šé“¶è¡Œé—´æ¸…ç»“ç®—ï¼Œè€Œä¸”åœ¨å½“å‰åŒºå—é“¾çš„æ€§èƒ½é™åˆ¶æ¡ä»¶ä¸‹ï¼Œæ‰¹é‡å®šæ—¶çš„å¯¹è´¦æ˜¯å¸¸é‡‡ç”¨çš„æ–¹å¼ã€‚è¿™ä¸ªç»„ä»¶å…¶å®æ˜¯æ¯”è¾ƒå®Œæˆçš„å¯¹è´¦é¡¹ç›®ä»£ç ï¼Œé¥±å«äº†åŸºæœ¬æµç¨‹ã€‚å…·ä½“å‚è€ƒ<a href="https://data-doc.readthedocs.io/zh_CN/dev/docs/WeBankBlockchain-Data-Reconcile/index.html">æ–‡æ¡£</a>ã€‚æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/images/webank/data-reconcile.jpg" width="50%" height="50%"></p><p>ä»¥æ­£å‘å®šæ—¶ä»»åŠ¡ä¸ºä¾‹ï¼Œä»£ç é‡Œä¸»è¦é‡‡ç”¨äº†è´£ä»»é“¾çš„æ–¹å¼ï¼Œå…·ä½“é…ç½®åœ¨<code>ReconcileHandlerFactory.java</code>ç±»ä¸­ã€‚å…·ä½“çš„hanlder chainå¦‚ä¸‹<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> ------------------------------------------      ------------------------------------------------------</span><br><span class="line">| ReconcileTaskHandler(åˆ›å»ºä»»åŠ¡ï¼Œè®°å½•åœ¨æ•°æ®åº“) | -&gt; | ReconcileFileObtainHandlerï¼ˆä»FTP/åŒºå—é“¾ä¸Šè·å–å¯¹è´¦æ–‡ä»¶ï¼‰ |  </span><br><span class="line"> ------------------------------------------      ------------------------------------------------------</span><br><span class="line">         ------------------------------------------------------      ------------------------------------------</span><br><span class="line">    -&gt; | ReconcileExecuteHandlerï¼ˆå¯¹è´¦è¿‡ç¨‹ï¼Œå…·ä½“æ¯æ¡æ•°æ®ä»¥ç´¢å¼•å¯¹é½ï¼‰ | -&gt; | ReconcileResultHandlerï¼ˆå°†å¯¹è´¦ç»“æœä¸Šä¼ åˆ°FTPï¼‰ï½œ</span><br><span class="line">         ------------------------------------------------------      ------------------------------------------</span><br></pre></td></tr></table></figure></p><p>å®é™…è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è€ƒè™‘æ•°æ®/æ–‡ä»¶çš„åŠ å¯†ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šæ–¹å¯¹è´¦çš„åœºæ™¯ï¼Œéœ€è¦åœ¨å¤šä¸ªå±‚é¢åšå¥½æ•°æ®åŠ å¯†å’Œéš”ç¦»ï¼Œè¿™ç‚¹åœ¨é¡¹ç›®ä¸­æ²¡æœ‰ä½“ç°ã€‚ä¾‹å¦‚ï¼Œä¸Šé“¾æ–¹ç”Ÿæˆå¯¹ç§°å¯†é’¥ï¼Œå¯¹æ¯ç¬”æ•°æ®ï¼ˆä¾‹å¦‚æ¶‰åŠåˆ°é‡‘é¢çš„æ•æ„Ÿå­—æ®µç­‰ï¼‰ä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†ï¼Œå¹¶ä¸”åœ¨ä¸Šé“¾çš„æ•°æ®ä¸­é™„å¸¦ä¸Šè¯¥å¯¹ç§°å¯†é’¥çš„æ ‡å¿—ã€‚ä¸Šé“¾æ–¹é‡‡ç”¨å¯¹è´¦æ–¹çš„å…¬é’¥å¯¹å¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”é€šè¿‡æŠ¥æ–‡å‘é€ç»™å¯¹è´¦æ–¹ã€‚å¯¹è´¦æ–¹ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†åï¼Œè¿›è€Œå¯¹é“¾ä¸Šæ•°æ®è¿›è¡Œå¯¹ç§°è§£å¯†ã€‚å¦å¤–ï¼Œä¸Šé“¾æ–¹åœ¨FTPä¸­å­˜æ”¾çš„å¯¹è´¦æ–‡ä»¶ï¼Œä¹Ÿéœ€è¦ç›¸åº”çš„è¿›è¡ŒåŠ å¯†å†™å…¥ï¼Œå¹¶ä¸”ï¼Œä¸åŒçš„å¯¹è´¦æ–¹ä¹Ÿéœ€è¦ç›¸äº’éš”ç¦»ï¼Œåœ¨FTPä¸Šä½¿ç”¨ä¸åŒçš„è·¯å¾„ï¼Œå¹¶ä¸”é…ç½®å¯è®¿é—®æƒé™ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ™ºèƒ½åˆçº¦æƒé™ç®¡ç†</title>
      <link href="//articles/sc-authorization/"/>
      <url>//articles/sc-authorization/</url>
      
        <content type="html"><![CDATA[<h3 id="1-åˆçº¦å†…æˆæƒ"><a href="#1-åˆçº¦å†…æˆæƒ" class="headerlink" title="1. åˆçº¦å†…æˆæƒ"></a>1. åˆçº¦å†…æˆæƒ</h3><p>ä¸šåŠ¡æ™ºèƒ½åˆçº¦å†…ï¼Œå¯èƒ½ä¼šé’ˆå¯¹æŸäº›ç”¨æˆ·ç»™äºˆæŒ‡å®šçš„æ•°æ®è®¿é—®æƒï¼Œæˆ–è€…è°ƒç”¨æ–¹æ³•çš„æƒé™ï¼Œæ¶‰åŠåˆ°åˆçº¦å†…æ•°æ®çš„æˆæƒã€‚ä»¥ä¸‹æ˜¯solidityä¼ªä»£ç ï¼Œé€‚ç”¨äºè¯¥ä¸šåŠ¡åˆçº¦ç”±æƒå¨æœºæ„ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨administratorè§’è‰²ç»Ÿä¸€åˆ†é…æƒé™ï¼Œå…¶ä»–åªèƒ½ä½œä¸ºå‚ä¸æ–¹è®¿é—®æˆæƒæ•°æ®ã€‚ç›¸åº”çš„å¯ä»¥å‚è€ƒå¾®ä¼—é“¶è¡Œ<a href="https://github.com/WeBankBlockchain/Governance-Authority/tree/master/src/main/contracts">æƒé™æ²»ç†åˆçº¦</a>ï¼Œå°†ç”¨æˆ·æƒé™æŒ‰ç…§åˆ†ç»„åœ¨æƒé™åˆçº¦é‡Œç»Ÿä¸€ç®¡ç†ï¼Œåº”ç”¨åˆçº¦æ¥å£ç²’åº¦çš„æƒé™ã€‚<br></p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">contract Admin {</span><br><span class="line">  address public administrator;</span><br><span class="line"></span><br><span class="line">  modifier <span class="function"><span class="title">admin</span>(<span class="params"></span>)</span> {</span><br><span class="line">      <span class="built_in">require</span>(msg.sender == administrator, <span class="string">"Only called by administrator"</span>);</span><br><span class="line">      _;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">transferAdmin</span>(<span class="params">address newAdministrator</span>) <span class="title">admin</span> <span class="title">public</span> </span>{</span><br><span class="line">      administrator = newAdministrator;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸šåŠ¡åˆçº¦ï¼ˆåŒ…å«æƒé™ç®¡ç†ï¼‰</span></span><br><span class="line">contract Service is Admin {</span><br><span class="line">  mapping(<span class="function"><span class="params">uint256</span> =&gt;</span> mapping(<span class="function"><span class="params">address</span> =&gt;</span> bool)) private _authorized;</span><br><span class="line"></span><br><span class="line">  <span class="title">constructor</span>(<span class="params"></span>) <span class="title">public</span> {</span><br><span class="line">    administrator = msg.sender;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åªæœ‰administratoræ‰æœ‰æƒé™æˆæƒç»™userAddr</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">authourize</span>(<span class="params">uint256 itemID, address userAddr</span>) <span class="title">admin</span> <span class="title">public</span> </span>{</span><br><span class="line">    _authorized[itemID][userAddr] = <span class="literal">true</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æˆæƒç”¨æˆ·æ‰èƒ½æ“ä½œç‰¹å®šæ•°æ®</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">doSth</span>(<span class="params">uint256 itemID</span>) <span class="title">admin</span> <span class="title">public</span> </span>{</span><br><span class="line">    <span class="built_in">require</span>(_authorized[itemID][msg.sender] == <span class="literal">true</span>, <span class="string">"Unthorized"</span>);</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><span id="more"></span><h3 id="2-åº”ç”¨æˆæƒ"><a href="#2-åº”ç”¨æˆæƒ" class="headerlink" title="2. åº”ç”¨æˆæƒ"></a>2. åº”ç”¨æˆæƒ</h3><p>å›é¡¾ä¸Šä¸€ç¯‡æ–‡ç« æåˆ°çš„é’±åŒ…ï¼ˆåº”ç”¨å•†åº—ï¼‰æ‹“æ‰‘ï¼Œå¹³å°ä¼šå­˜åœ¨å…±ç”¨çš„åˆçº¦ï¼Œç”¨æˆ·é€šè¿‡æŸä¸ªåº”ç”¨ï¼ˆç±»ä¼¼äºdappï¼‰æ¥è°ƒç”¨è¿™ä¸ªå¹³å°åˆçº¦ï¼ˆåªèƒ½é€šè¿‡ç”¨æˆ·çš„èº«ä»½è€Œä¸æ˜¯åº”ç”¨çš„èº«ä»½ï¼Œä¹Ÿå°±æ˜¯msg.senderæ˜¯ç”¨æˆ·èº«ä»½åˆçº¦åœ°å€ï¼‰ã€‚æ­¤å¤„æ¶‰åŠåˆ°ä¸¤ä¸ªéªŒè¯ï¼Œä¸€æ˜¯éªŒè¯è¯¥åº”ç”¨è¢«å¹³å°æˆæƒè°ƒç”¨è¯¥åˆçº¦ï¼ŒäºŒæ˜¯éªŒè¯è¯¥ç”¨æˆ·è¢«è¯¥åº”ç”¨æˆæƒå¯ä»¥é€šè¿‡æ¥è°ƒç”¨è¯¥åˆçº¦ã€‚å¯ä»¥éµå¾ªä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>ç”¨æˆ·éœ€è¦åœ¨åº”ç”¨è·å¾—æˆæƒï¼Œåº”ç”¨ä¼šåœ¨ç”¨æˆ·çš„èº«ä»½åˆçº¦é‡Œæ·»åŠ æ ‡ç­¾ï¼ˆå¯ä»¥ç†è§£ä¸ºåº”ç”¨å¯¹ç”¨æˆ·çš„æˆæƒç­¾åï¼‰ã€‚</li><li>å½“ç”¨æˆ·è¯·æ±‚å¹³å°åˆçº¦æ—¶ï¼Œå¹³å°åˆçº¦ä¼šæ ¹ç»ç”¨æˆ·çš„èº«ä»½åœ°å€msg.senderå»æŸ¥æ‰¾åˆ°ç”¨æˆ·çš„èº«ä»½åˆçº¦ï¼Œå¹¶ä¸”ä»ä¸­è¯»åˆ°ç›¸åº”çš„åº”ç”¨ï¼Œä»¥åŠåº”ç”¨æ‰“ä¸Šçš„æ ‡ç­¾ã€‚</li><li>å¹³å°åˆçº¦ä¼šåˆ°ç›‘ç®¡æˆæƒåˆçº¦ä¸­å»è®¤è¯ï¼Œç¡®è®¤åº”ç”¨å·²æˆæƒåï¼Œå¹³å°åˆçº¦æ ¡éªŒç”¨æˆ·èº«ä»½åˆçº¦é‡Œåº”ç”¨æ ‡ç­¾çš„çœŸå®æ€§ã€‚åˆ™ç”¨æˆ·å¯ä»¥è°ƒç”¨æ­¤å¹³å°åˆçº¦ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Smart Contract </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DIDåˆ†å¸ƒå¼èº«ä»½ï¼ˆ2ï¼‰ - è´¦æˆ·ä½“ç³»æ¶æ„</title>
      <link href="//articles/did-account-system/"/>
      <url>//articles/did-account-system/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="85f9cc2b3ab6a76c0049d2c74b4b82a8996bddea3918cb86cac6c9958b8086d7">3175488eedc729df0c7d358c640da99e5db97a13f852973918f00ac21570e613c8066394a45ce05b6fb350006fc572aba6ddbb11c5d81918b1e6e787347dc4090eae74287cb56e112850ed5877a00b0c38f7f72d1f82c0e6f33952297af2eed6f7e9b9281efae3b827cd823ad0dc6aa0166f8a5cc5ecd391fed4d5b8059855e4b12184333ed28d40b5517345f07b9888b06a7e76d343f56507d72c8582dd621f2039d1aa7b5504f362d8fc942bcdd04dca63d6e5efc7eeae08cd8b39d326b29103078d812dc280406ecd2c91a900594e6fc11eca8b2482d4cf277f5bcbcc4ed82c645e83227a11cd214ccb74dadd5cafd45c62883845bcaab687c4d69160d93bcc5de69c09c32851fd3f57742098440818ab40f93ed0a565d8d165f42727510c5392021a91caf4cadf7945160e01c213337bb444f0cca83d45a5ac63cc8e06a58ad550577a3aab00e1ea13be33de5b3bc87ab4f6b50c622a7bec8543ce46e36d4652c118be6348b8ccf3ce5dffe2ed847377085fb9ea06c6fb61e1e0ae81958e701eb5898c0188a48cfaccecdd42bd9f1f16d9e9f88cd063a7dd37c41547a37bea54a797c92fce40aa98f0c37a30373f19d961855b7e686a10a0a82df791733494a2625f79b98285abc4ce56fd40c2d909c29bdad008923115ed39413b141c053df5d6145f8290401f3a9c6d4580582ab3cc090209a20b04b93b0f90ccf57534a0ecd275f899f4c884a59193508c325a8a8d1108fa16c3799d3e2a0523966be55fe98e815cfcfb7bb376a9530a30638767b7385ab803fcbb0946288a7440feb62f8a1e493996a2ba119f864da5f5c73afc5661532a18013e60b765b3d0a987a8fc5e32042e6f0849f7b8b23254bacb8f89683a7b4acb2477fb69212355f43136eec23f2306993f9f9bf21faf240ddcc19b2ccbf5331ab92f0700c7f5bf3c8c56109b68934eb38022d8815ff6155991d80833699ad4eafbd8abb22af92c15ecff47d68fdc4f9c4a5c3058e411faea0fdd78492eeea731ee246f041ebf026a7987c22ea8c0cc509d1cac78d55033616cf130422db38593b5950e689cc58adc0f798ea0ba1ddab47ed328f47e92070565267a6b904f54fc48cf9bc17ca1266382388b4ebbef84a758dfae8b6749ca729588ab225b2ed0f5bb7a0df4b2dea95d5d13f39c4a326d143da10ea9e09220f678c20bead66e68940ea1ecde75df11aaff69ec3028eb448824bb980d8db802d33dd93fbd72de5b55ab0107eab230a149b7a07457958c2973f8aebdbb368391dd3754c061194c325548c06f06ba17242ab958b9210f62420fecbdac09881ccb31cd67ed4fbbb57f510600f45c17dca25dc441b38065070ec147d348d8282e79c28cebd1aa27838e258d61abe8cace4c98a98392d7e0cb58b9ca61ddc5a4d87b58b73f8a2276b158c3c3934f7c4466c87f3a77bd0e9674446eb95e233dd7da36caf7adec2f158b95c1c9e63861211e1042901e7917b84d7ab33bd3bf0298ab2b688ec990d06d66828cce8217da621d5b9cde59e6daf58f6245538e71153e48468ceb6c89b959e64334afa254646fa0e6aac1ee04284f2791fe811538703e9e6d0300bdce76c3534ba1be054d3f2bc5c507e31d59d2566c8aec38621fe6332509100ec1adddb101c95f09b000ac09e2922ac817e43de927a341a910e50e9f1f29a22b0d0a0cf3ac933dcbea0f76b9ee624cc125cb48222d20d7eea445f104bf759f485dee96fada1599ab9cfb5288040195644e5e4391355605f5842300743dd2bbcfc0035ba5f69b78e0668fed9b30847eb5be6bf088b463cca359b2fe6c328c022b2b6f61157e7d4c37902fb1d540396800a083bdb8007c5287983a44b8b7acde17d3d4ed5858bd72ba2d04707043a11231d722e588a9545c36fbd3bee2164c4fd7c0700c385fdcbc81ff57d210103d40725e1cda2d61e4177756d2677dd21715850f5c45c3bd3d59965e7a1d37a88ad0c3291fa660136c261cd11f8f8173134bc413c9038397903ae981950b4f1f6f7237ecd6a3369988dbcc7a1f34f7369cb824a9277cef9f65151a48e47705f9d909fb468e778bbbb25dc3e17ece3e059a432e4f4abb3f7fe18e3fd989e02f55be66db8470d71559cea81c275c32af30425abe52e7d99d04e165e02a4c796a3938a05eacb0a33064a6748d680206e834d6ed587d71dd5db55c36a3ad06126038b90adca821be1a8d6a1da15c654af18644c21b1b999e7dcfdc37143e65cb386727dcb5166d933d474123eb6b70856ae0895cf0b821a02e61cff29a29a6c8cde840f39dfdbabab36b83eb6309e2658bf018935c8f717036b1ad5c4ab3cd86cd5a644ae94fd3253342037d2cc875d7be4d58d3cd4e0b2b86c373a8c3a15483b49f15d6272a546160e2a281e069b2812bd5fa3585323001cb91e9ef507041328899f279195ed3884e2841386b3e3105b6c677b37ceda824c2e9f9a3a7e19ac5319ba2c9372feaf2474e8e02955da1650c26d5ecd94517f862dc66f2b71ed7fc9b852f6ae5348c58d5cf064fe32c3ff73f7f74e98b1a3ed9861c3482962826171bf4b768814704748424b097fd5b2bb05652d5a048a376d9bbab2707a7589db111ed28f1c0e97eceb6d0d3ac1bac261ff04465fc17eef0aef515064276d7a943dd8869cc58b056021bece30356abde90ac64e6c1eafab7641cd97658812cb88d0cb1302849140c580789e070adde50a1845a7debd4793725b02410b42871c6943bc12570a1392820deeabd4c52e6f9123d5c79031ea03ec569496523fe8b07659ebd9f26fcd708b3256ace8f97c379ddda62ed3a2f5776388547a4f6eaf8f99bd9a7c0286ca76e23dedb6fa85b26dbae8463d5e2f0e907b9e6890975fb95e9bbf19837315341ddb4d121d53b6bd70aca4ae0aa385364849dbf95c624c1bfd4b98872c742a00091b28d80650d14e246acba1f911a2c9ff84eb2674d071ef877ffe43718b30332a8b1f6b57692e4ebf471d63466267439d7599db34e19d26da843619ee4e7f7292a2309056b808321b5d3436595a5c95d3ce58c6a3fbabb7f5bb0e82b4ac0f97eb2b7f3b18476695f9a93b02b1bb2ea0f6c08b4da0cf4409f7f7a8c15e726a5cff26cf9f0e1f58defb2862d76fd0cf8192f8be06ae71ee7e47d53dbab5b518566ad3f9c77083bd75abf19b6d80f351b4d74cb11802defb22db2e22a4c544ac716c13c86b01856bf9606bec8138f72bbf3653b399f278b4b1e2543cad890ce02db6b0db1472cc23e1c8cb5067db8bfba0898e428c03b9f66a66573e75b5b9c550a8a905eb11c34361c29fe9b1e0ae32bf63969b342459ea55dc5c874ceda15c8e342e426ddbbc3d2d7a7da0120dec20fe0f2dbf96099bf3a51a4c0179e15039dc6e566e6aadabda78c431a30e60636b0bb35a5713e9f125f59e774e1f71300a3508437990ef173fe4111b9e410641f00b1cd42c5d9639ff3e60a3338e901c32e9c4b69065aa558179182210186b010dbcafbe3200e8d55c734e27e752f6893984b145d55196db789b06aa0226ccffd6b11b0df3560d8f0fe026373aba207933d1608816fd020ec46728bb8082b824f2df49298e4a759b510450a27679ec11ff088d046f540b4b6c11458302680ff428f0759f65495e6d42131058c9d3f0f03c6e49a6b8e2456ee463897d0e4c47688383b7d435ed749c09e4997fcbf25aef3ee67849332dc831940ef8cb2308bf4b28b9361dfa0f353453540f5788210a7d3b968947691edfd1c25e9c79b7ce7a0ec99e4ce01cbabd8e58c0b86ba7f6d05cfc0c9eec112d4ef7894f94e3e83489b42ea58d88b61ddb3dfc8b21bd0ac34d4de2071eda39f177b7d0d0fbb3b2d02d8e96aa87ddc1dad98c129fa7ca75c3e5562e9d7959438a80975957940aaae179dbb0294fba855c3b65d19689887cc2da90685ab3e2d9687164b7a6bc434a76462ada862e2331fc6b288312b9bf36eb66139115fde92f41e242cab904ca854f9f6db5ac5a5d304a8acdc6fc13f9a8aac3352301af1413ee0a4d7f1e56145659ff41b90da40817575850783b9e9d54faed518b49f16d23408629ddbb8bbc4a2ab25f8f3cf1cbfa3edd04e987379228f0d6a19612f7b1044776136725a255f4e95a0307cc872a7f910303710a25837d3c9dfd62ca02081147df7523741fcfacab533add4d56b6618bec200e2adf7adda9321e3123a7abf3233a41e401b73cdd04a33059ad707560c79188b81079b961e2352eceaccf9999b9537f672b42cea98e972afa1379d7186dad922b42331feeab3b7ce6732fc0dc75008401de6b0be1e9fbabce484a94b28affb27dfbb3fd7ceecd8f6899f762ea14ebc19a2fab49d64c64015a92782defdb3940c33d4fd80fc25b4d1cf365733f9fd3f2ef85a9277550f2e74b366450b3f84df947899e36d476a25e3d758a63cfbab7847b59cd717976ba966aa0f1b30802afbbd31c50969a5a6da10bca2c7cd9be1488c4b01b967345f93a9972472f46e29092ac9259cf56c1793cbe3b2acb06329097d6d4fb0d6e8db54bf7b24cdcec02ab949858819711bb5bce5d5f473784c8a914caadb272a2def6f4910b89252c537776fde0183e17b25b746eaf999822a4f1601f3381fa7107c9c82dabf49c524b5b3fc84bfeca77d28169f847aedb7e36ad57041e26a95f649747027db3cfb6b652edb6a16206bd9935b9a397e30a843b220d55aa4a53d492c2007f0475256c04e5a01803f62db63f3b6314c8397503a0f763ee1a7459526f35d8a988b58fd2b5401ceb04d30905d9fe3a6e7e211780cf495c981732e66ad243210c512ace597e1a29778c83e78797eba03a66cb8447741034b67cfc07b08a6ce225e4cdb9ecaedda1be68844235a0d6f17ba26c4e1ba49cb6ee15ea45f7e8a544710cb3dab67ed9451b5da54282a7cfcc730edad60d80f962dadcaabdad539acd058e6b4030ccccf3bce9e83c61cd88f510310fc2f263129a11987bc368ab3b454ea6e9fda444426749b5b45f199ec94e920a4d18f36269ffb65a0f065795c5de373af9e654d86305490a01e6e3ef5f1ed3da3c63327e70cd2fbf710c96c0145b68f4579cf287f99830080fbe11133d8bb23124df994e0d12da517c9def88d928604b556d9a3b091e0a7fe9f7da848c57394b82c87fca3b5c3b407f6bb2094327cbdd6b4fd27a742d12de1bd81eb7144cf1926030144fb3c14078b7759c37858585859ddc7f6c0c684af957a1d8ca4701d1adbf99723de5c25fc5e1d3fa9cc8744ef47d3a012d95eb9cdd231c886a224b6f559a524839a5672bf0549eee11b3f28cd8f7c72af87719caeae7687ea2035717b15de71fe74837f61410222a41a9271aab44eb431a2e6a64a13dae62be8c4af68e0b9008c0d0d0389db3aa62724a20f2d5e232560778a6065ae45ea0f79e69ca8d2a94bf5fb65675c17bd503f9af0552b5d352fc6084bbb7d671feed13593e2c01a6fbcfd3d8f66389215fcb37045b1bff49baa106632b25eaa8cb56405306dd3562c3aef561971e512411b0c8f748ab430d3a992cab316ce3dfd0977909c5a6571e51985a66f2005ec139fd77687d640277cd760726e0ed2ec4f47c92c99cb1dc53a85134ab243e13d2c3476317c9c198ac517a16a48e5644eb29d95cf10143be47ab30823e8598bc7cf6c3e463ca2bd2a3dcf28a90de566d16028d06d13bd67c94f9f5f1a446683c0f31b0327ef9f78d2892dfd57948e62ea8c338004599800088fa56de83587ce0e29f2554f20c4cb58c090b5a886bae32ec077f194e3848bec5fa70ffe58de35503cd44575c0dea1f6c220d9b23ebef56869c65ecdc4b8c45ed517b953dec63ec16b52f1d1119b09824920b0e6915f79595ce97a5e630839abfb78d0f03f2c8018a9f721a483da5d9179ea58e343520ed2f47f33415daaaa54345677ed3fb67f6650b93959f1e542073570fcb6c8f2b7b489c02e87387e92a9ddd39aab8988e76449224d3c6e25ed8ad53c2354bf04000376f9497b0713dbb9307ac6abd4065954da729858cdf272d10e0cc0b73bab73d1682759ad254d020cc6a890c61f59a8d04751e598abbb0ad2f39afdf8997c7900b500d00039eca00a360cddf1d064859948af17d291af2f3b49c75b6c6b5ad1aeeec90ad1dc2f8ed87150edb00a74aad670123c0a919ee88841dab900e018c380c831c6339f0891c08d3430ab627697cc510ef544d8c1846b2bb46b0407f4f35444976682cb00fdb040ab49284d314410a5be30300fabb282ec1cf27b1dd7fdc35c76f6a3ccee6a361abd8fe4abfb24b0d2b78489ba24f7cc7eef6b8a75cdf3fd58c793ef3956a1c98dea625a3d2994f10a42e4f312f315ca3bc09668e5cbe116df75927463694cc3d0c90c9b3f80e320340a7f86a92862e4aa66b013f0d436de1dfb22b5f91e00ac628f6967c68e6db882189b25f17ecaa298c7c26134636dbfa549ae1db9cf777fd40ab3592c5858f7cfbf1fdf7526b300daa19f75fad6ad1b2a1c8f9d78c43ec423f92df0b16895807fbaf7b80dca87319a8bf574ce4076b09d1fdca57d82b2483656cb5ebd8c042316ecfb3d032ebb50e9439602a4d3524f9215214daea8f6676b6ef476e4258e347ffd0a8aa528f88ad8b05845229ef2e39beca238c1bcf6b073068ca2e104ac32e041ee72260bc82a94248fe63ea8e1184222c2602c1eea991f7e21eea0d76bd4a663dad64cf08e630453f7f3f38a4da51a955fe829c2c8131d2fe226ca34f4e400af7b83f199f71ee8defdfbaae78172e3124929f97e6208cdd37d92586c285477b3bfdd24535d26c450bdc90537bf3af442f806f8b0d3900500b263d741b9f8d5be5e1d72cd81a2b0730fa66805cbabf190d6b6558f9347ad7dff42e9049eecfc3156945ea32fd51d9aaf23812c845f0cbd40bdf2d0272f2ed59e78c608e669e78a5a0e9a52aa09ce4d0bff39b7d573420d8daf37e38ec2531f216a9a7add1801ce0565b745bb8be47a5963c2eabb667109855dfe5668083a1056ac73a3d7ed744b343f2541ba36b2646a7c5595ba6315990dfa9368ac4f67fded9252f50a84ce2b6426cc09dd6ea41be9ff174cd0841be298fc573c1409d6820365048bc98871fd4bf4a0d8bfbdc863c644fecf013533c98be407b15d79a21c5152cbf82b9299f57d3d41983e4fd7f44a3735fe8e9c737e94c9aec7154686d5e4f02867b7575d413e96bdbea46721c21820d7e262ea21bf21913583823b4c1af2b50e8f0ecb0eb69592ce46ceea167c0f164d9a7ce891ff0f70a6d617906bcbe26b69297266dc051784f580c0b3cc84e32a90b35db1fe343159b733f55897519a2137243739233be88a9160525c7f8e3fc06ed9c4a0a84d18c42df8dd8e1c14ead6baf3b9b56a88995af82788e9f594323abd0906b25c59043f041441da62a0d901849c34695357e62dc96895d9c39fd9e29a241239fc61e6b69227996f75508c062d6587a763c7c10042ba2bab6b23ec832966bc2dd0fb22ee982b46ca4c6633105cb3cf71788ba775dfc38f3227dd8a25d37fc7bbb1a5935fdbc4af55b0a484ca4b97022c702eeb7d3c2d5f9bd4a7c999e02b427bcaef1fa60f9aa9af4b079a419440d693fdc3fa82809e510f2da6e6b3c8d19c541bf784f922a83df1d7cb0b1352531c65bbd04b90a57e2c4cb1446388e406829e117d939f02823b37a649d253f5e013caa0073232b72fd8e2feae4824905c2a752c337a28ec2367ea570699b4e85c92774fe1c02e05cd3d2755782f44e8f199c18a788f6e0c6b27100f23793f5fcd3bb389aae83a416753ccbd623c1e93a57db2d3a008b7585820b05fe1c29edc52ac8b8ac1086a2f4d2c69f4d24d23d6c2e659859ef12802bbb94a47bda27281e03b680a0b0b35c59de9320873aae9b486a463a8139fa8a74e23b8cc9bd818e36553d4d3d253198edcfd7715d45b039a5297058ed63ff53035347807f394c877a7d8d3e6bcbe5df6fa568633265728e2bface05af2f45084a39882b902bcc72ce504058be5950df13d335db7c75b80a269edf3fa81452f318e670ada88661ae44392a50ff3315982b0b1b1d44b826aad3d4f87df7635737c1b0b094b7976b8d204e985814fda2a474f4a8d3b3326e724925b164048c82baf6e030ec2ccd933ff633bf5b80716b88b0a965766095a5740ed6ab13dbdb3f79639b0a1afe8a33f44632904ace764ba205c959b7d27a0f91f4105d6c2d46e1b6acc0ba46a8b50cd2b76f8dcccc2406ed53c45dd7ee6de2f3865c5194a9cd2eccd3750b1daac5c25d9074cb2b2bf7d99ad5fc3107c3e0365865a5b615a67b2440d6dc464c6e3f9c03c10e92b8571c4eae1980e15ca02c9c365a29465d0414f27a38086dbe7ac0b7c59937f7b5b18e67c775aab94e40c1c330f05e3d08e7e0ebd2cf46cbc0c8aacc53cb19b69b3c72f9b60a3e6e423b2c0f06fc0a41bd4d260a4421e58b96353dc879d990b93f2570f291eddf8d763a0caf5e3c47f272caf6a6ec2b0e6ba529bb089bb778902bf6bee0c4c1c344c52feaf9e42bd4891248102a920b07275ce7fe8b181f668bc144beb8d03ea46a6ae20699f56774b62e3c1ea46e3f01227293adf7e2887698958c4d8b49fa6c3b7d54a3f9d823d2eed2158558e095c4cad97dda24235ee4b85c2dac261b8f27a888a853bcc3a63d2ccf772cb4bf406a1dc13936340d5fefd8116ff969fa0129ef2728d0385bed14a3b7ba197e16f5d0623a3e3f85ee1647871a6dcb4d18ed5a043ba5f51a1650c7ef4adfae4106f63c1876e0450c5000c516dfa1686f959b28c9f2e6c25913c974980070bb312e3e6f1cda8e1646ca80fc94baf8e512d4a6cc6da1d0fa2d401bc013d7988154e42c9ca5b331e7a7be2674bfc73812c2ab33a488ccfbd8624d1b175243931787c529bbbe40d12653829158ad4dce286d0092340ea704260f6eaf67c8ac6fed11e8dfa9863f1fef81d3ee72c02e70a358360ca480e7590d50e3f7f982587474b4c1cfeb2e8acc1e6e85a97f843a4e34ea7618a888506bc8d36ea5fb857e1bfed796a8b16755d4ee8723262ee488814d9a34054bf03ed0fbab25675b5e9acc82d9bbb4b004562594cba90d6dca785e17dd07b5b96b53c139b0e12a12776a0a166807cc96494b3ccf39d2c05e83c4571f6dc13b55cb3548f4fc8bf50dd63555c1e01af67173765771b378f4347612b32b23111a767af85237f776a75809a0f6bdf839de1a08f</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Post is cheap, show me the password</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> DID </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DIDåˆ†å¸ƒå¼èº«ä»½ï¼ˆ1ï¼‰ - W3Cè§„èŒƒ</title>
      <link href="//articles/did-w3c/"/>
      <url>//articles/did-w3c/</url>
      
        <content type="html"><![CDATA[<h2 id="DID-decentralized-identifier-åˆ†å¸ƒå¼èº«ä»½çš„ç‰¹ç‚¹ï¼š"><a href="#DID-decentralized-identifier-åˆ†å¸ƒå¼èº«ä»½çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="DID(decentralized identifier)åˆ†å¸ƒå¼èº«ä»½çš„ç‰¹ç‚¹ï¼š"></a>DID(decentralized identifier)åˆ†å¸ƒå¼èº«ä»½çš„ç‰¹ç‚¹ï¼š</h2><ul><li><strong>è‡ªä¸»</strong>ã€‚å®ä½“å¯è‡ªä¸»å®ŒæˆDIDçš„æ³¨å†Œã€è§£æã€æ›´æ–°æˆ–æ’¤é”€æ“ä½œï¼ˆä¸Šé“¾ï¼‰ï¼Œâ½†éœ€ä¸­å¤®æ³¨å†Œæœºæ„å®ç°<strong>å…¨å±€å”¯â¼€æ€§</strong>ã€‚</li><li><strong>èº«ä»½äº’é€š</strong>ã€‚å¤šä¸ªdappåº”ç”¨å¯ä»¥å…±ç”¨ä¸€ä¸ªDIDï¼Œå…±ç”¨ä¸€å¥—èº«ä»½è´¦æˆ·ä½“ç³»ã€‚</li><li><strong>éšç§</strong>ã€‚â¼€ä¸ªå®ä½“å¯ä»¥æ‹¥æœ‰å¤šä¸ªèº«ä»½ï¼Œç”±å®ä½“è‡ªâ¼°è¿›â¾ç®¡ç†ã€ç»´æŠ¤ï¼Œä¸åŒçš„èº«ä»½ä¹‹é—´æ²¡æœ‰å…³è”ä¿¡æ¯ï¼Œé¿å…èº«ä»½ä¿¡æ¯è¢«ç¬¬ä¸‰â½…å½’é›†ã€‚åŒæ—¶ï¼Œæœªæˆæƒçš„ç¬¬ä¸‰æ–¹dappåº”ç”¨æ— æ³•å¾—çŸ¥DIDå¯¹åº”çš„å…·ä½“ç”¨æˆ·ä¿¡æ¯ã€‚</li></ul><h2 id="W3Cæ ‡å‡†"><a href="#W3Cæ ‡å‡†" class="headerlink" title="W3Cæ ‡å‡†"></a>W3Cæ ‡å‡†</h2><p>è®¤å¯åº¦è¾ƒé«˜ï¼Œæ˜¯è¡Œä¸šçš„ä¸»è¦æ ‡å‡†ï¼Œå¤§å¤šæ•°å¹³å°éµä»W3Cçš„è§„èŒƒï¼Œè¿™æ ·æ•°æ®å¯ä»¥æ–¹ä¾¿ç§»æ¤å’Œå…±äº«ï¼Œå®ç°åº•å±‚åŒºå—é“¾å¹³å°çš„å…¼å®¹ã€‚</p><h3 id="1-æ ¼å¼è§„èŒƒ"><a href="#1-æ ¼å¼è§„èŒƒ" class="headerlink" title="1. æ ¼å¼è§„èŒƒ"></a>1. æ ¼å¼è§„èŒƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Scheme:DID Method:DID Method Specific String</span><br></pre></td></tr></table></figure><ul><li>Scheme : é€šå¸¸å›ºå®šä¸ºdidï¼ŒæŒ‡æ˜è¯¥ä¸²ä¸ºDIDæ ‡å¿—</li><li>DID Method : æŒ‡å®šå…·ä½“éµä»çš„æ ¼å¼è§„èŒƒï¼Œé€šå¸¸ä¸ºä¸åŒçš„æœåŠ¡è¿è¥å•†</li><li>DID Method Specific String ï¼šå…·ä½“çš„å®ä½“çš„æ ‡å¿—ï¼Œé€šå¸¸ä¸ºURLæˆ–è€…URIæ ‡è¯†ç¬¦ã€‚<br>ä¾‹å¦‚ï¼Œå¾®ä¼—çš„WeIdentityä¸º <code>did:weid:101:0x0086eb1f712ebc6f1c276e12ec21</code>, å…·ä½“å‚çœ‹Ref[2]ã€‚</li></ul><h3 id="2-DIDæ–‡æ¡£ï¼ˆDocumentï¼‰"><a href="#2-DIDæ–‡æ¡£ï¼ˆDocumentï¼‰" class="headerlink" title="2. DIDæ–‡æ¡£ï¼ˆDocumentï¼‰"></a>2. DIDæ–‡æ¡£ï¼ˆDocumentï¼‰</h3><p>JSONç»“æ„ï¼Œè‡ªæè¿°çš„æ–‡æ¡£ï¼Œé€šå¸¸åŒ…å«æœ‰DIDæœ¬èº«ï¼Œå…¬é’¥ä¿¡æ¯ç­‰å†…å®¹ï¼Œå¯æ”¯æŒè§£æï¼Œæ›´æ–°ï¼Œæ’¤é”€ç­‰åŠŸèƒ½ã€‚å¯ä»¥å­˜åœ¨åŒºå—é“¾æˆ–è€…éåŒºå—é“¾çš„åˆ†å¸ƒå¼è´¦æœ¬åº•å±‚å¹³å°ï¼Œæˆ–è€…å­˜æ”¾åœ¨IPFSç­‰åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿé‡Œã€‚å¯ä»¥ç†è§£æˆDIDä¸Documentæ˜¯K-Vç»“æ„ã€‚å…·ä½“å­—æ®µæ ¼å¼å†…å®¹å‚çœ‹Ref1ã€‚</p><h3 id="3-å¯éªŒè¯å£°æ˜ï¼ˆVerifiable-Credentialï¼‰"><a href="#3-å¯éªŒè¯å£°æ˜ï¼ˆVerifiable-Credentialï¼‰" class="headerlink" title="3. å¯éªŒè¯å£°æ˜ï¼ˆVerifiable Credentialï¼‰"></a>3. å¯éªŒè¯å£°æ˜ï¼ˆVerifiable Credentialï¼‰</h3><ul><li>å»ºç«‹DIDä½“ç³»çš„ä»·å€¼æ‰€åœ¨ã€‚DIDå¯ä»¥è‡ªç®¡ç†ï¼Œä½†æ˜¯åªæœ‰è¢«ç›¸å…³æ–¹è®¤è¯è¿‡çš„èº«ä»½æ‰ä¼šè¢«ä¿¡ä»»ï¼Œæ‰æœ‰ä¸šåŠ¡ä¸Šçš„ä»·å€¼ã€‚</li><li>åŒ…å«è‹¥â¼²ä¸ªâ€œå£°æ˜(claims) â€ã€‚å£°æ˜ä¿¡æ¯æ˜¯ä¸èº«ä»½å…³è”çš„å±æ€§ä¿¡æ¯ï¼Œå¦‚å§“åï¼Œå¹´é¾„ã€å­¦å†ã€èŒä¸šç­‰ç­‰ã€‚</li><li>å‡­è¯ç”±å‘â¾è€…ç­¾åï¼Œå¯é€šè¿‡å¯†ç å­¦è¯æ˜æ˜¯å¦ç”±å‡­è¯ä¸­å£°ç§°çš„å®ä½“ç­¾å‘ä¸”æœªè¢«ç¯¡æ”¹ï¼Œå› æ­¤è¢«ç§°ä¸ºå¯éªŒè¯å‡­è¯ã€‚</li><li>VCä¹Ÿå¯ä»¥ä¾èµ–äºåŒºå—é“¾å®ç°æµè½¬ï¼ŒéªŒè¯ã€‚</li><li><strong>å¯ä»¥é€šè¿‡æˆæƒæ§åˆ¶ï¼Œåªé€éœ²Documenté‡Œçš„æŒ‡å®šå­—æ®µã€‚ç»“åˆé›¶çŸ¥è¯†è¯æ˜ï¼Œå¯ä»¥åªè¯æ˜æŸäº›è®ºæ–­ï¼Œè€Œä¸é€éœ²å…·ä½“çš„ä¿¡æ¯ã€‚</strong>  </li><li>æ¨¡å‹å‚çœ‹<a href="https://w3c.github.io/vc-data-model/#terminology">W3C Draft: Verifiable Credentials Data Model 1.0</a><br><img src="/images/did-verifiable-credential.jpg" alt=""></li></ul><p>Refï¼š</p><blockquote><ol><li><a href="https://w3c.github.io/did-core/">W3C Draft: Decentralized Identifiers (DIDs) v1.0</a>: W3Cçš„è§„èŒƒä»‹ç»ã€‚</li><li><a href="https://weidentity.readthedocs.io/zh_CN/latest/docs/weidentity-spec.html">WeIdentity è§„èŒƒ</a>ï¼š å¾®ä¼—çš„DIDè§„èŒƒä»‹ç»ï¼Œç§‘æ™®</li></ol></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> DID </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é“¾ä¸Šéšç§æ•°æ®ä¿æŠ¤</title>
      <link href="//articles/privacy-on-chain/"/>
      <url>//articles/privacy-on-chain/</url>
      
        <content type="html"><![CDATA[<p>ç”±äºåŒºå—é“¾å„å‚ä¸æ–¹å¯èƒ½å­˜åœ¨åˆ©ç›Šå†²çªï¼Œä¸æ„¿æ„å°†ç§æœ‰æ•°æ®ä¸Šé“¾ï¼Œå‚¬ç”Ÿäº†é“¾ä¸Šéšç§æ•°æ®çš„éœ€æ±‚ã€‚å¯¹äºä¸åŒçš„éšç§ç­‰çº§å­˜åœ¨ç›¸åº”çš„å¤„ç†æ–¹å¼ã€‚</p><ol><li><strong>çŸ­æœŸå†…éšç§æ•°æ®</strong>ã€‚æŒ‡çš„æ˜¯æ˜“å˜æ•°æ®ï¼Œä¸€å®šæœŸé™åè¯¥æ•°æ®çš„ä»·å€¼é™ä½ï¼Œä¾‹å¦‚æ³¢åŠ¨çš„å•†å“æˆäº¤ä»·ã€‚å› ä¸ºå¯†ç å­¦ç ´è§£åœ¨å¯é¢„è§çš„çŸ­æœŸå†…æ— æ³•è¾¾æˆï¼Œå¯ä»¥è®¤ä¸ºå®‰å…¨é£é™©å¾ˆå°ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æµè¡Œçš„å¯¹ç§°åŠ å¯†/éå¯¹ç§°åŠ å¯†çš„æ–¹å¼ï¼Œå¯†æ–‡ä¸Šé“¾ï¼Œç›¸å…³æ–¹ä½¿ç”¨é“¾ä¸‹æ–¹å¼æˆ–è€…é“¾ä¸Šæ–¹å¼äº¤æ¢å¯†é’¥ã€‚ç”šè‡³å¯ä»¥å•ç¬”äº¤æ˜“æ›´æ¢å¯†é’¥ï¼Œè¿™æ ·å¯¹äºå¯å˜ä½†æ˜¯æ•°å€¼èŒƒå›´æœ‰é™çš„æ•°æ®ï¼Œä¾‹å¦‚çŠ¶æ€å€¼ï¼Œå•ä»·/æ•°é‡ç­‰æ•°å€¼ï¼Œåˆ™é¿å…äº†ç»Ÿè®¡å­¦ä¸Šç ´è§£ã€‚</li><li><strong>é•¿æœŸå›ºå®šéšç§æ•°æ®</strong>ã€‚ä¾‹å¦‚èº«ä»½è¯å·ç ï¼Œä¼ä¸šç¤¾ä¼šä¿¡ç”¨ä»£ç ç­‰ï¼Œè¯¥æ•°æ®é•¿æœŸä¸å˜ï¼Œå­˜åœ¨è‹¥å¹²å¹´åç”±äºé‡å­è®¡ç®—æˆ–è€…ç›¸åº”çš„å¯†ç å­¦è¢«ç ´è§£å¯¼è‡´æ³„éœ²ï¼ˆå½“ç„¶ï¼Œéšç€ç ´è§£æ–¹æ¡ˆçš„æ¼”è¿›ï¼ŒåŠ å¯†æ–¹æ¡ˆä¹Ÿä¼šç›¸åº”çš„æ¼”è¿›ï¼Œä½†æ˜¯å¯¹äºé“¾ä¸Šçš„å†å²æ•°æ®åˆ™ææ˜“å—åˆ°æ–°çš„ç ´è§£æ–¹æ¡ˆçš„å¨èƒï¼‰ã€‚å› æ­¤ï¼Œé“¾ä¸Šå¯ä»¥ä¿å­˜æ•°å€¼hashï¼Œå…·ä½“çš„æ•°æ®é“¾ä¸‹äº¤æ¢ï¼Œä½¿ç”¨é“¾ä¸Šçš„hashå€¼ä½œä¸ºéªŒè¯ã€‚åŒæ—¶ï¼Œå¯¹äºæ•°å€¼ç±»ç­‰å–å€¼ç©ºé—´æœ‰é™çš„ï¼Œå¯ä»¥é’ˆå¯¹æ¯ç¬”äº¤æ˜“æ•°æ®æ·»åŠ ç›å€¼åï¼ˆåŒæ ·é€šè¿‡é“¾ä¸‹äº¤æ¢ï¼‰ï¼Œå†åšhashä¸Šé“¾ï¼Œé¿å…å½©è™¹è¡¨æ”»å‡»ã€‚</li></ol><span id="more"></span><hr><h3 id="Fabricçš„private-dataè®¾è®¡"><a href="#Fabricçš„private-dataè®¾è®¡" class="headerlink" title="Fabricçš„private dataè®¾è®¡"></a>Fabricçš„private dataè®¾è®¡</h3><h4 id="1-transient-data-vs-transient-data-store-vs-private-data-collection"><a href="#1-transient-data-vs-transient-data-store-vs-private-data-collection" class="headerlink" title="1. transient data vs. transient data store vs. private data collection"></a>1. transient data vs. transient data store vs. private data collection</h4><ul><li>transient data: é“¾ç chaincodeçš„è¾“å…¥æ•°æ®ï¼Œclientå‘èµ·äº¤æ˜“æ—¶æŒ‡å®šï¼Œendorseråœ¨èƒŒä¹¦è¿‡ç¨‹ä¸­ï¼Œå°†è¿™äº›æ•°æ®ä»¥gossipçš„æ–¹å¼ç‚¹å¯¹ç‚¹å‘é€åˆ°å…¶ä»–çš„æ‹¥æœ‰æƒé™çš„ç›¸å…³èŠ‚ç‚¹ï¼ˆä¾‹å¦‚åŒå±äºè¯¥private data collectionçš„ä¸åŒç»„ç»‡ï¼‰ï¼Œé“¾ä¸Šblocké‡Œçš„äº¤æ˜“ä¿¡æ¯å¹¶ä¸ä¼šåŒ…å«æœ‰è¿™äº›æ•°æ®ã€‚</li><li>transient data store: ä¸­é—´å­˜å‚¨ï¼Œå­˜æ”¾transient dataè¿›è¡Œè¿ç®—åçš„RW-setï¼Œæ–¹ä¾¿åç»­çš„gossipäº¤æ¢åˆ°å…¶ä»–çš„authorizedèŠ‚ç‚¹ï¼Œåœ¨commité˜¶æ®µï¼Œprivate data hashå°†ä¼šä¸è¯¥éƒ¨åˆ†æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œæ— è¯¯åæäº¤åˆ°private data collectionï¼Œç„¶åæ¸…é™¤transient data storeã€‚</li><li>private data collection: é•¿æœŸå­˜å‚¨ï¼ˆç”±blockToLiveå‚æ•°æ§åˆ¶ç”Ÿå‘½ï¼‰åŒºå—æ‰§è¡Œä¹‹åçš„world stateä¸–ç•ŒçŠ¶æ€é‡Œï¼ŒåŒ…å«æœ‰public stateå’Œprivate stateï¼Œï¼ˆåˆ†åˆ«å¯¹åº”ç€public RW-setå’Œprivate RW-setï¼‰è¿™éƒ¨åˆ†æ˜¯é€šè¿‡gossipåè®®ä»å…¶ä»–èŠ‚ç‚¹å‘é€è¿‡æ¥çš„ï¼Œé’ˆå¯¹ç›¸å…³çš„orgå¼€æ”¾è¯»å†™æƒé™ã€‚åŒ…å«åŸå§‹æ•°æ®å’Œè¯¥æ•°æ®çš„hashå€¼ç»„æˆï¼Œè¿™æ ·çš„hashå€¼ä¼šè¢«åœ¨commité˜¶æ®µæ¯”è¾ƒprivate RW-setï¼Œä»¥åŠåç»­åœ¨chaincodeé‡Œç¡®è®¤è¯¥ç¬”æ•°æ®æˆ–è€…äº¤æ˜“çš„å­˜åœ¨çœŸå®æ€§ã€‚</li></ul><p><img src="/images/fabric-private-data-structure.jpg" alt=""></p><center>Fig1. éšç§æ•°æ®å­˜å‚¨ç»“æ„ï¼ˆæ‘˜è‡ªRef.3ï¼‰</center><p><img src="/images/fabric-private-data-phases.jpg" alt=""></p><center>Fig2. éšç§æ•°æ®äº¤äº’æµç¨‹ï¼ˆæ‘˜è‡ªRef.2ï¼‰</center>  <ol><li><code>The transactions with the private data hashes get included in blocks as normal. The block with the private data hashes is distributed to all the peers.</code>å³private data hashä¼šæäº¤åˆ°ordererè¿›è¡Œæ’åºï¼Œå¯¹äºæ²¡æœ‰æƒé™çš„private data collectionï¼Œåªèƒ½è·å–åˆ°å…¶hashä½œä¸ºå­˜è¯å’Œåç»­éªŒè¯ã€‚</li><li><code>Note that because gossip distributes the private data peer-to-peer across authorized organizations, it is required to set up anchor peers on the channel, and configure CORE_PEER_GOSSIP_EXTERNALENDPOINT on each peer, in order to bootstrap cross-organization communication.</code>ã€‚æ„å‘³ç€gossipåè®®ä¼šæ ¹æ®collectionçš„jsonå®šä¹‰æ–‡ä»¶é‡Œçš„policyæ”¿ç­–ä¼ æ’­åˆ°ç¬¦åˆæ¡ä»¶çš„å„ä¸ªç»„ç»‡ã€‚</li></ol><p>å½“å‰fabricæä¾›çš„æ˜¯hashæ ¡éªŒçš„åŸºæœ¬åŠŸèƒ½ï¼Œåªæ˜¯æ•°æ®çš„çœŸå®æ€§æ ¡éªŒå’Œæ•°æ®äº¤æ¢ï¼Œå¯¹äºæ›´å¤šçš„åº”ç”¨åœºæ™¯ä¾‹å¦‚éœ€è¦è®¡ç®—/æ¯”è¾ƒçš„ï¼Œå°†æ¥å¯ä»¥æ‰©å±•å åŠ é›¶çŸ¥è¯†è¯æ˜å’ŒåŒæ€åŠ å¯†è¿ç®—ç­‰ï¼Œä¼šæœ‰æ›´å¹¿çš„åº”ç”¨æƒ³è±¡ç©ºé—´ã€‚</p><p>Refï¼š</p><blockquote><ol><li><a href="https://hyperledger-fabric.readthedocs.io/en/latest/private-data/private-data.html?highlight=private">HyperLedger Fabricå®˜ç½‘</a></li><li><a href="https://www.serial-coder.com/post/demystifying-hyperledger-fabric-private-data-collection/">Demystifying Hyperledger Fabric (2/3): Private Data Collection</a></li><li><a href="https://medium.com/@kctheservant/private-data-and-transient-data-in-hyperledger-fabric-46b5258f391e">Private Data and Transient Data in Hyperledger Fabric</a></li><li><a href="https://v.qq.com/x/page/a09419gwu90.html">è§†é¢‘</a> ï¼š IBMå·¥ç¨‹å¸ˆä»‹ç»private data</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰å…¨å¤šæ–¹è®¡ç®—MPCçš„è‹¥å¹²ä¸ªæ¦‚å¿µ</title>
      <link href="//articles/mpc-terminology/"/>
      <url>//articles/mpc-terminology/</url>
      
        <content type="html"><![CDATA[<p>å®‰å…¨å¤šæ–¹è®¡ç®—ï¼ˆMPCï¼‰ä¸å¯ä¿¡è®¡ç®—ç¯å¢ƒï¼ˆTEEï¼‰ï¼Œè”é‚¦å­¦ä¹ ï¼ˆFederated Learningï¼‰æ˜¯éšç§è®¡ç®—é¢†åŸŸçš„ä¸‰ä¸ªé‡è¦å®ç°æ–¹å¼ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://securecomputation.org/">A Pragmatic Introduction to Secure Multi-Party Computation</a></p></blockquote><h3 id="1-ä¸ç»æ„ä¼ è¾“ï¼ˆOTï¼ŒOblivious-Transferï¼‰"><a href="#1-ä¸ç»æ„ä¼ è¾“ï¼ˆOTï¼ŒOblivious-Transferï¼‰" class="headerlink" title="1. ä¸ç»æ„ä¼ è¾“ï¼ˆOTï¼ŒOblivious Transferï¼‰"></a>1. ä¸ç»æ„ä¼ è¾“ï¼ˆOTï¼ŒOblivious Transferï¼‰</h3><p><strong>ç›®æ ‡å¦‚ä¸‹</strong>ï¼š</p><ol><li>Senderæä¾›å¯é€‰å‚æ•°(m0, m1)ï¼Œä½†æ˜¯ä¸çŸ¥é“Receiverå…·ä½“é€‰æ‹©å“ªä¸ªã€‚</li><li>Receiverå¯ä»¥é€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œä½†æ˜¯ä¸çŸ¥é“é™¤æ­¤ä¹‹å¤–çš„å…¶ä»–å‚æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œé€‰æ‹©m0åï¼Œæ— æ³•å¾—çŸ¥m1çš„å€¼ã€‚<br><img src="/images/mpc-ot.jpg" alt=""></li></ol><div style='display: none'>1-ou-of-2çš„å®ç°æ–¹æ¡ˆæœ‰å¤šç§ï¼Œå…¶ä¸­ä¸€ä¸ªåŸºäºå…¬ç§é’¥æœºåˆ¶çš„å®ç°æ–¹æ¡ˆï¼š1. Senderæ‹¥æœ‰ä¸¤ä¸ªæ¶ˆæ¯ï¼Œåˆ†åˆ«ä¸ºm0, m1,å¹¶ä¸”ç”Ÿæˆä¸¤å¯¹å¯†é’¥å¯¹ï¼ˆpub0, pri0ï¼‰å’Œï¼ˆpub1, pri1ï¼‰2. Receiveréšæœºç”Ÿæˆå¯¹ç§°å¯†é’¥kï¼Œä»¥Receiveré€‰æ‹©æ¶ˆæ¯m0ä¸ºä¾‹ï¼Œç”¨å…¬é’¥pub0åŠ å¯†kï¼Œå¾—åˆ°k0å’Œk1ï¼Œè¿”å›ç»™Senderã€‚3. Senderä½¿ç”¨ç§é’¥ï¼ˆpri0ï¼Œpri1ï¼‰åˆ†åˆ«è§£å¯†ï¼ˆk0ï¼Œk1ï¼‰ï¼Œå¾—åˆ°ï¼ˆk0', k1'ï¼‰ã€‚æ­¤æ—¶ï¼ŒSenderæ— æ³•å¾—çŸ¥å…·ä½“é€‰æ‹©äº†å“ªä¸ªï¼Œæ»¡è¶³æ¡ä»¶ï¼ˆ1ï¼‰ã€‚å¯¹Receiverè€Œè¨€ï¼Œå…¶ä¸­k0'=kï¼Œk1'åˆ™æ˜¯ä¸€ä¸²ä¸æ˜å­—ç¬¦ä¸²ã€‚4. Senderä½¿ç”¨å¯¹ç§°å¯†é’¥k0'å’Œk1'åˆ†åˆ«å¯¹m0, m1åŠ å¯†ï¼Œå¾—åˆ°m0'ï¼Œ m1'ï¼Œå¹¶å›ä¼ ç»™Receiverã€‚5. Receiverå¯ä»¥ç”¨kå¯¹m0'è§£å¯†ï¼Œå¾—åˆ°m0ã€‚å¦å¤–ï¼Œm1'åˆ™æ˜¯ä¸å¯è§£ï¼Œæ»¡è¶³æ¡ä»¶ï¼ˆ2ï¼‰ã€‚</div><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="https://zhuanlan.zhihu.com/p/126396795">æ··æ·†ç”µè·¯ä»‹ç»ï¼ˆä¸€ï¼‰ä¸ç»æ„ä¼ è¾“</a><br><a href="https://crypto.stanford.edu/pbc/notes/crypto/ot.html">Oblivious Transfer (OT)</a></p></blockquote><span id="more"></span><h3 id="2-æ··æ·†ç”µè·¯ï¼ˆGCï¼ŒGarbled-Circuitï¼‰"><a href="#2-æ··æ·†ç”µè·¯ï¼ˆGCï¼ŒGarbled-Circuitï¼‰" class="headerlink" title="2. æ··æ·†ç”µè·¯ï¼ˆGCï¼ŒGarbled Circuitï¼‰"></a>2. æ··æ·†ç”µè·¯ï¼ˆGCï¼ŒGarbled Circuitï¼‰</h3><p>å°†è®¡ç®—é€»è¾‘è½¬æ¢æˆé—¨ç”µè·¯ï¼Œä»¥ä¸é—¨ä¸ºä¾‹ï¼Œæµç¨‹å¦‚ä¸‹  </p><ol><li>Aç”Ÿæˆxä¸º0ï¼Œ1å¯¹åº”çš„å¯†é’¥kx0,kx1, yä¸º0ï¼Œ1æ—¶å¯¹åº”çš„å¯†é’¥ky0,ky1ï¼Œå¹¶ä¸”è®¡ç®—å¦‚ä¸‹çœŸå€¼è¡¨(zä¸ºä¸¤æ¬¡å¯¹ç§°åŠ å¯†å€¼)</li><li>Aå°†çœŸå€¼è¡¨æ‰“ä¹±è¡Œé¡ºåºã€‚å‡è®¾Aè¾“å…¥x=0ï¼Œå°†å¯¹åº”çš„kx0å’ŒçœŸå€¼è¡¨å‘é€ç»™Bã€‚å› ä¸ºé¡ºåºä¹±ï¼Œæ‰€ä»¥è¿™æ ·Bæ— æ³•ä»è¡Œæ’åˆ—ä¸­æ¨æµ‹å‡ºkx0å¯¹åº”çš„Açš„è¾“å…¥æ˜¯x=0è¿˜æ˜¯x=1ï¼Œå³<strong><em>Bæ— æ³•å¾—çŸ¥Açš„è¾“å…¥</em></strong>ã€‚</li><li>å‡è®¾Bé€‰æ‹©y=1,é€šè¿‡OTåè®®è·å–ky1ï¼ˆæ— æ³•å¾—çŸ¥ky0ï¼‰ï¼Œæ­¤æ—¶<strong><em>Aä¹Ÿæ— æ³•å¾—çŸ¥Bçš„è¾“å…¥</em></strong>ã€‚</li><li>Bé€šè¿‡å¯¹çœŸå€¼è¡¨é‡Œçš„zè¿›è¡Œè§£å¯†ï¼ˆæ­¤æ—¶Båªæœ‰kx0å’Œky1ï¼‰ï¼Œé€‰æ‹©å¯¹E<sub>kx0</sub>(E<sub>ky1</sub>(0))è¿›è¡Œè§£å¯†ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆç»“æœ0ï¼Œå³x=0ï¼Œy=1æ—¶çš„ç»“æœã€‚</li></ol><div class="table-container"><table><thead><tr><th>x</th><th>y</th><th>z</th></tr></thead><tbody><tr><td>kx0</td><td>ky0</td><td>E<sub>kx0</sub>(E<sub>ky0</sub>(0))</td></tr><tr><td>kx0</td><td>ky1</td><td>E<sub>kx0</sub>(E<sub>ky1</sub>(0))</td></tr><tr><td>kx1</td><td>ky0</td><td>E<sub>kx1</sub>(E<sub>ky0</sub>(0))</td></tr><tr><td>kx1</td><td>ky1</td><td>E<sub>kx1</sub>(E<sub>ky1</sub>(1))</td></tr></tbody></table></div><center>è¡¨1: åŠ å¯†çœŸå€¼è¡¨</center><h3 id="3-ç§˜å¯†å…±äº«-SS-Secret-Sharing"><a href="#3-ç§˜å¯†å…±äº«-SS-Secret-Sharing" class="headerlink" title="3. ç§˜å¯†å…±äº«(SS, Secret-Sharing)"></a>3. ç§˜å¯†å…±äº«(SS, Secret-Sharing)</h3><p>ç§˜å¯†å…±äº«é€šè¿‡æŠŠç§˜å¯†è¿›è¡Œåˆ†å‰²ï¼Œå¹¶æŠŠç§˜å¯†åœ¨nä¸ªå‚ä¸è€…ä¸­åˆ†äº«ï¼Œä½¿å¾—åªæœ‰å¤šäºç‰¹å®štä¸ªå‚ä¸è€…åˆä½œæ‰å¯ä»¥è®¡ç®—å‡ºæˆ–æ˜¯æ¢å¤ç§˜å¯†ï¼Œè€Œå°‘äºtä¸ªå‚ä¸è€…åˆ™ä¸å¯ä»¥å¾—åˆ°æœ‰å…³ç§˜å¯†ã€‚å®ç°æ–¹å¼ä¾‹å¦‚ï¼š</p><ol><li>æ„é€ t-1æ¬¡å¤šé¡¹å¼ f(x) = s + a<sub>1</sub>Â·x + â€¦ + a<sub>t-1</sub> Â· x<sup>t-1</sup>ã€‚ å…¶ä¸­ï¼Œsä¸ºåˆ†äº«çš„ç§˜å¯†</li><li>è®¡ç®—f(x1), f(x2), â€¦, f(xn)ï¼Œåˆ†åˆ«åˆ†å‘ç»™å‚ä¸æ–¹P1, â€¦, Pnã€‚æ­¤æ—¶ä»»æ„è‡³å°‘tä¸ªPç»„åˆåœ¨ä¸€èµ·å¯é€šè¿‡æ‹‰æ ¼æœ—æ—¥æ’å€¼æ³•è®¡ç®—f(x),ä¹Ÿå°±å¾—åˆ°ç§˜å¯†sã€‚</li></ol><p>åœ¨å¸ƒå°”ç”µè·¯ä¸Šï¼Œå¯å°†å¼‚æˆ–é—¨å’Œä¸é—¨åˆ†åˆ«çœ‹æˆåœ¨æœ‰é™åŸŸä¸Š <em>F<sub>2</sub></em> çš„åŠ æ³•å’Œä¹˜æ³•ã€‚å°†å¼‚æˆ–ç”¨æ¨¡ä¸º 2 çš„åŠ æ³•è¿›è¡Œè®¡ç®—ï¼Œä¸ç”¨æ¨¡ä¸º 2 çš„ä¹˜æ³•è¿›è¡Œè®¡ç®—ã€‚<a href="https://blog.csdn.net/Matrix_element/article/details/117357359?spm=1001.2014.3001.5501">BGWåè®®</a>åŸºäºShamirç§˜å¯†åˆ†äº«æ–¹æ¡ˆå®ç°åŠ æ³•/ä¹˜æ³•ç‰¹æ€§ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><blockquote><p><a href="http://web.mit.edu/6.857/OldStuff/Fall03/ref/Shamir-HowToShareASecret.pdf">How to Share a Secret</a> - Adi Shamir</p></blockquote><h3 id="4-å·®åˆ†éšç§-DP-Differential-Privacy"><a href="#4-å·®åˆ†éšç§-DP-Differential-Privacy" class="headerlink" title="4. å·®åˆ†éšç§(DP, Differential Privacy)"></a>4. å·®åˆ†éšç§(DP, Differential Privacy)</h3><p><strong>ä¸­å¿ƒæ€æƒ³</strong>ï¼šæ— æ³•ä»ç»“æœä¸­åæ¨å‡ºå•ä¸ªè¾“å…¥ä¸ªä½“çš„ä¿¡æ¯ã€‚<br><strong>ä¸´è¿‘æ•°æ®é›†</strong>ï¼šæŒ‡çš„æ˜¯ä¸¤ä¸ªæ•°æ®é›†D1ï¼ŒD2åªæœ‰å•ä¸ªè®°å½•ä¸ä¸€è‡´ã€‚ä¾‹å¦‚ï¼ŒD1={1, 0, 1}, D1={1, 0, 1, 1}ã€‚æ•°æ®æ“ä½œæ˜¯countï¼Œåˆ™count(D1)=2, count(D2)=2, åˆ™å¯ä»¥åæ¨å‡ºæœ€åä¸€ä¸ªè¾“å…¥ä¸º1ã€‚ä¸»è¦é€šè¿‡ä¸¤ç§æ–¹å¼æ·»åŠ å™ªå£°ï¼Œä¸€æ˜¯æ ¹æ®æ•°æ®æ•æ„Ÿçš„æ•°å€¼å‹ï¼ˆæœä»æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒçš„éšæœºå™ªå£°ï¼‰ï¼ŒäºŒæ˜¯ç¦»æ•£å€¼(æŒ‡æ•°åˆ†å¸ƒ)ã€‚æ·»åŠ çš„å™ªå£°åˆ†ç±»å¦‚ä¸‹ï¼š</p><ul><li>è¾“å…¥å™ªå£°ï¼š f(x0, x1, â€¦, xn, <em>c</em>) -&gt; f(x0, x1, â€¦, xn + <em>noice</em>, <em>c</em>)</li><li>å‚æ•°å™ªå£°ï¼š f(x0, x1, â€¦, xn, <em>c</em>) -&gt; f(x0, x1, â€¦, xn, <em>c</em> + <em>noice</em>)</li><li>è¾“å‡ºå™ªå£°ï¼š f(x0, x1, â€¦, xn, <em>c</em>) -&gt; f(x0, x1, â€¦, xn, <em>c</em>) + <em>noice</em></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> MPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é›¶çŸ¥è¯†è¯æ˜ï¼š Why and How zk-SNARK Worksï¼šDefinitive Explanationè®ºæ–‡å­¦ä¹ ç¬”è®°</title>
      <link href="//articles/zk-snark-paper/"/>
      <url>//articles/zk-snark-paper/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸º<a href="https://arxiv.org/abs/1906.07221">Why and How zk-SNARK Works: Definitive Explanation</a>è®ºæ–‡å­¦ä¹ å¿ƒå¾—ï¼Œçº¯ç²¹ä¸ªäººåœ¨é˜…è¯»è¿‡ç¨‹ä¸­çš„ç–‘é—®å’Œæ€è€ƒï¼Œè¯¦ç»†çš„ç†è§£è¯·é˜…è¯»é™„å½•å¼•ç”¨çš„æ–‡ç« ã€‚</p><h3 id="2-The-Medium-of-a-Proof"><a href="#2-The-Medium-of-a-Proof" class="headerlink" title="2. The Medium of a Proof"></a>2. The Medium of a Proof</h3><ul><li><strong>å¤šé¡¹å¼æ˜¯zk-snarkçš„æ ¸å¿ƒ</strong></li></ul><ol><li>åŸºæœ¬æµç¨‹<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â€¢ Verifier chooses a random value for x and evaluates his polynomial locally</span><br><span class="line">â€¢ Verifier gives x to the prover and asks to evaluate the polynomial in question</span><br><span class="line">â€¢ Prover evaluates his polynomial at x and gives the result to the verifier</span><br><span class="line">â€¢ Verifier checks if the local result is equal to the proverâ€™s result, and if so then the statement is proven with a high confidence</span><br></pre></td></tr></tbody></table></figure></li><li>å­˜åœ¨é—®é¢˜<ul><li>proverå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å¾—åˆ°å¤šé¡¹å¼ç»“æœï¼Œæ²¡æœ‰æ–¹æ³•ç¡®ä¿è¯¥ç»“æœæ˜¯ç»è¿‡å¤šé¡¹å¼è®¡ç®—å¾—æ¥</li><li>å¤šé¡¹å¼çš„é˜¶æ•°éœ€è¦è¶³å¤Ÿé«˜</li></ul></li></ol><h2 id=""><a href="#" class="headerlink" title=""></a><span id="more"></span></h2><h3 id="3-Non-Interactive-Zero-Knowledge-of-a-Polynomial"><a href="#3-Non-Interactive-Zero-Knowledge-of-a-Polynomial" class="headerlink" title="3 Non-Interactive Zero-Knowledge of a Polynomial"></a>3 Non-Interactive Zero-Knowledge of a Polynomial</h3><p>è¿™ä¸€ç« æ˜¯zk-snarkçš„ç†è®ºåŸºç¡€ã€‚</p><h3 id="3-1-Proving-Knowledge-of-a-Polynomial"><a href="#3-1-Proving-Knowledge-of-a-Polynomial" class="headerlink" title="3.1 Proving Knowledge of a Polynomial"></a>3.1 Proving Knowledge of a Polynomial</h3><ol><li><p>æµç¨‹</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â€¢ Verifier samples a random value r, calculates t = t(r) (i.e., evaluates) and gives r to the prover</span><br><span class="line">â€¢ Prover calculates h(x) = p(x) and evaluates p(r) and h(r); the resulting values p,h are t(x) provided to the verifier</span><br><span class="line">â€¢ Verifier then checks that p = t Â· h, if so those polynomials are equal, meaning that p(x) has t(x) as a cofactor.</span><br></pre></td></tr></tbody></table></figure><ul><li><p>Q1ï¼š ä¸ºä»€ä¹ˆproverä¸ç›´æ¥ä¼ é€’t ?<br>A1ï¼š éœ€è¦è¯æ˜çš„æ˜¯ proverçŸ¥é“tï¼Œå³å…¶ä¸­çš„ä¸¤ä¸ªæ ¹ã€‚ä¸‹æ–‡æœ‰è¯´æ˜ï¼Œproverå¯èƒ½é€šè¿‡åˆ«çš„æ–¹å¼æ°å¥½çŸ¥é“t(s)çš„å€¼ï¼Œåè®®ä¸å®‰å…¨ã€‚è€Œzk-snarké‡Œæ˜¯å°†è¦è¯æ˜çš„è¡¨è¾¾æˆå¤šé¡¹å¼ï¼Œç„¶åç”±verifieræ„é€ åŸºç¡€å¤šé¡¹å¼ï¼Œè®©proveræ¥èµ‹å€¼è¾“å…¥/è¾“å‡ºï¼Œé€šè¿‡è¯æ˜tçš„æ ¹æ˜¯verifierçš„ç›®æ ‡å¤šé¡¹å¼çš„æ ¹ï¼Œä»è€Œè¯æ˜å…¶è¾“å‡ºçš„æ­£ç¡®æ€§ã€‚</p></li><li><p>Q2: å¦‚æœè¯•éªŒæ¬¡æ•°è¶³å¤Ÿå¤šï¼Œä¾‹å¦‚hçš„é˜¶æ•°ï¼Œæ˜¯å¦å¯èƒ½æ¨ç®—å‡ºhï¼Œä»è€Œæ¨ç®—å‡ºp ?<br>A2: ä¸‹æ–‡å¼•å…¥é›¶çŸ¥è¯†è¯æ˜ï¼Œé€šè¿‡3.3çš„åŒæ€åŠ å¯†çš„æ¨¡è¿ç®—å®ç°ã€‚</p></li></ul></li><li><p>å­˜åœ¨é—®é¢˜</p><ul><li>proverè®¡ç®—å¾—åˆ°tåï¼Œå¯ä»¥éšæ„é€‰æ‹©hï¼Œè®¡ç®—p=h*tï¼Œverifieræ— æ³•éªŒè¯proveræ˜¯å¦çŸ¥é“pã€‚</li><li>proveræ°å¥½çŸ¥é“x=rå¤„çš„å€¼t(r)ï¼Œå¯ä»¥æ„é€ ä»»ä½•çš„å¤šé¡¹å¼</li></ul></li></ol><h3 id="3-3-Obscure-Evaluation"><a href="#3-3-Obscure-Evaluation" class="headerlink" title="3.3 Obscure Evaluation"></a>3.3 Obscure Evaluation</h3><h3 id="3-3-1-Homomorphic-Encryptionï¼ˆåŒæ€åŠ å¯†ï¼‰"><a href="#3-3-1-Homomorphic-Encryptionï¼ˆåŒæ€åŠ å¯†ï¼‰" class="headerlink" title="3.3.1 Homomorphic Encryptionï¼ˆåŒæ€åŠ å¯†ï¼‰"></a>3.3.1 Homomorphic Encryptionï¼ˆåŒæ€åŠ å¯†ï¼‰</h3><p>The general idea is that we choose a base natural number g (say 5) and to encrypt a value we exponentiate g to the power of that value.<br></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5^3 = 125, Where 125 is the encryption of 3.</span><br></pre></td></tr></tbody></table></figure><p></p><ol><li>å­˜åœ¨é—®é¢˜<br>å°†125æŒç»­çš„é™¤ä»¥5ï¼Œç›´åˆ°ç»“æœä¸º1ï¼Œæ­¤æ—¶çš„stepå°±æ˜¯åŠ å¯†çš„3</li></ol><h3 id="3-3-3-Strong-Homomorphic-Encryption"><a href="#3-3-3-Strong-Homomorphic-Encryption" class="headerlink" title="3.3.3 Strong Homomorphic Encryption"></a>3.3.3 Strong Homomorphic Encryption</h3><p>æ¨¡è¿ç®—ã€‚åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š<br></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">encryption :  5^3 = 6 (mod 7)</span><br><span class="line">multiplication :  6^2 = (5^3)^2 = 5^6 = 1 (mod 7)</span><br><span class="line">addition:   5^3Â·5^2 =5^5 =3 (mod7)</span><br></pre></td></tr></tbody></table></figure><p></p><ol><li>å±€é™æ€§<br>while we can multiply an encrypted value by an unencrypted value, we cannot multiply (and divide) two encrypted values, as well as we cannot exponentiate an encrypted value.<br>ä¸¤ä¸ªåŠ å¯†ç»“æœé—´æ— æ³•ç›´æ¥è¿›è¡Œä¹˜æ³•è¿ç®—ã€‚ï¼ˆä¸‹æ–‡å¼•å…¥pairingé…å¯¹å‡½æ•°ï¼Œè§£å†³ä¹˜æ³•è¿ç®—ï¼‰</li></ol><h3 id="3-3-4-Encrypted-Polynomial"><a href="#3-3-4-Encrypted-Polynomial" class="headerlink" title="3.3.4 Encrypted Polynomial"></a>3.3.4 Encrypted Polynomial</h3><p><img src="/images/zk-snarks/zk-snarks-encrypted-polynomial.jpeg" alt=""><br><img src="/images/zk-snarks/zk-snarks-encrypted-polynomial-derivation.jpeg" alt=""></p><ul><li><em>(è¯´æ˜ï¼šå›¾ä¸­rå³è®ºæ–‡ä¸­çš„s)</em></li></ul><ol><li>èƒ½è§£å†³<code>proveræ°å¥½çŸ¥é“x=sçš„å€¼t(s)ï¼Œå¯ä»¥æ„é€ ä»»ä½•çš„å¤šé¡¹å¼</code>è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå·²ç»proverå·²ç»æ— æ³•å¾—çŸ¥<code>s</code>ä»¥åŠ<code>t(s)</code>ã€‚</li><li><strong><em>ä¸èƒ½</em></strong> è§£å†³<code>proverè®¡ç®—å¾—åˆ°tåï¼Œå¯ä»¥éšæ„é€‰æ‹©hï¼Œè®¡ç®—p=h*tï¼Œverifieræ— æ³•éªŒè¯proveræ˜¯å¦çŸ¥é“p</code>ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥éšæ„é€‰æ‹©rçš„å€¼ï¼Œæ„é€  z<sub>h</sub> = g<sup>r</sup> å’Œ z<sub>p</sub> = (g<sup>t(s)</sup>)<sup>r</sup></li></ol><h3 id="3-4-Restricting-a-Polynomial"><a href="#3-4-Restricting-a-Polynomial" class="headerlink" title="3.4 Restricting a Polynomial"></a>3.4 Restricting a Polynomial</h3><p><img src="/images/zk-snarks/zk-snarks-restricting-polynomial-derivation.jpeg" alt=""></p><ul><li><em>(è¯´æ˜ï¼šå›¾ä¸­rå³è®ºæ–‡ä¸­çš„s)</em></li></ul><ol><li><p>ç»“è®ºï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â€“ Bob has applied the same exponent (i.e., c) to both values of the tuple</span><br><span class="line">â€“ Bob could only use the original Aliceâ€™s tuple to maintain the Î± relationship</span><br><span class="line">â€“ Bob knows the applied exponent c, because the only way to produce valid (b,bâ€²) is to use the same exponent</span><br><span class="line">â€“ Alice has not learned c for the same reason Bob cannot learn Î±</span><br></pre></td></tr></tbody></table></figure><p>å³Proverå¿…é¡»ä½¿ç”¨verifieræä¾›çš„åŸºäºs<sup>i</sup>è®¡ç®—å‡ºæ¥çš„å€¼è¿›è¡Œè®¡ç®—ï¼Œverifierå¯ä»¥é€šè¿‡éªŒè¯(g<sup>p</sup>, g<sup>pâ€™</sup>)é—´ä»ç„¶ä¿æŒ Î± çš„æŒ‡æ•°åç§»é‡å…³ç³»ã€‚åŒæ—¶verifieræ— æ³•å¾—çŸ¥proverä½¿ç”¨çš„å‚æ•°cçš„å€¼ã€‚</p></li><li><p>å­˜åœ¨é—®é¢˜ï¼š</p></li></ol><ul><li>Q1: å¦‚æœåŸå§‹çš„<code>p=(x+1)*(x+2)</code>ï¼Œå…¶ä¸­<code>t=x+1</code>,<code>h=x+2</code>ã€‚ä½†æ˜¯proveræé€ <code>h'=x+3</code>ï¼Œå³<code>p'=(x+1)*(x+3)</code>ï¼Œverifieræ˜¯å¦æ— æ³•éªŒè¯ï¼Ÿ<br>A1: åœ¨zk-snarkå®é™…åº”ç”¨ä¸­çœ‹4.8å°èŠ‚</li></ul><h3 id="3-5-Zero-Knowledge"><a href="#3-5-Zero-Knowledge" class="headerlink" title="3.5 Zero-Knowledge"></a>3.5 Zero-Knowledge</h3><p>verifierå¯ä»¥ä»Eï¼ˆpï¼‰çŸ¥é“å…³äºpçš„å¤šé¡¹å¼çš„å…·ä½“å‚æ•°ã€‚ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­å¯¹Eï¼ˆpï¼‰å› å¼åˆ†è§£ï¼Ÿ<br>è§£å†³æ–¹æ¡ˆï¼šç±»ä¼¼verifierå¼•å…¥ Î± ä¿è¯proverä½¿ç”¨å…¶æä¾›çš„å€¼è¿›è¡Œè¿ç®—ï¼Œç›¸åº”çš„proverä¹Ÿæ˜ å…¥ Î´ æŒ‡æ•°åç§»é‡ã€‚ä¾‹å¦‚éªŒè¯ g<sup>Î´Â·p</sup> = g<sup>Î´Â·t(s)h</sup></p><h3 id="3-6-Non-Interactivity"><a href="#3-6-Non-Interactivity" class="headerlink" title="3.6 Non-Interactivity"></a>3.6 Non-Interactivity</h3><p>éäº¤äº’å¼ã€‚å¤šæ–¹å„è‡ªéªŒè¯ï¼Œé˜²æ­¢verifierå’Œproverè”åˆä½œå‡æˆ–è€…æ³„æ¼ï¼Œproofå¯ä»¥é‡ç”¨æé«˜æ•ˆç‡ï¼Œå¹¶ä¸”proveræ— éœ€æ—¶åˆ»åœ¨çº¿å“åº”ã€‚æ ¸å¿ƒæ˜¯Cryptographic pairings(é…å¯¹å‡½æ•°)ï¼Œå³æ‰¾åˆ°ç®—æ³•å¯ä»¥æ”¯æŒåŠ å¯†åæ•°å€¼çš„<strong>åŒæ€ä¹˜æ³•</strong>è¿ç®—ï¼Œå³e(g<sup>a</sup>, g<sup>b</sup>) = e(g, g)<sup>ab</sup>ï¼ˆå°èŠ‚3.3.3ä¸­ä¸æ”¯æŒï¼‰ã€‚è¿™æ ·åœ¨setupé˜¶æ®µå¯ä»¥æ„é€ composite CRSï¼ˆcommon reference stringï¼‰ï¼ˆå°èŠ‚3.6.3ï¼‰<br><img src="/images/zk-snarks/zk-snark-non-interactivity.jpg" alt=""></p><p>å°èŠ‚3.6.2ä¸­ï¼Œç”±äºå¼•å…¥äº†<strong>é…å¯¹å‡½æ•°</strong>ï¼ŒéªŒè¯åŠ å¯†æ–¹æ³•æ˜¯ e(g<sup>p</sup>, g<sup>1</sup>)=e(g<sup>t</sup>, g<sup>h</sup>)ï¼Œè€Œ3.3.4åŒæ€åŠ æ³•åŠ å¯†å°èŠ‚é‡Œï¼Œåˆ™æ˜¯éªŒè¯g<sup>p</sup>=g<sup>t(s)Â·h</sup>ã€‚</p><h3 id="3-7-Succinct-Non-Interactive-Argument-of-Knowledge-of-Polynomial"><a href="#3-7-Succinct-Non-Interactive-Argument-of-Knowledge-of-Polynomial" class="headerlink" title="3.7 Succinct Non-Interactive Argument of Knowledge of Polynomial"></a>3.7 Succinct Non-Interactive Argument of Knowledge of Polynomial</h3><p>é‡è¦ï¼ŒåŸºç¡€ã€‚<strong>Setup-Proving-Verification</strong> ä¸‰æ­¥éª¤ï¼Œè¯¦è§æ–‡ç« ã€‚</p><ul><li><strong>Setup</strong>  <ul><li>proving key: { g<sup>s<sup>i</sup>&lt;/sup&gt; } <sub> iâˆˆ[d] </sub> , { g<sup>Î±s<sup>i</sup>&lt;/sup&gt; }<sub> iâˆˆ[d] </sub>   (æä¾›ç»™prover)</sup></sup></li><li>verification key: g<sup>Î±</sup>, g<sup>t(s)</sup> ï¼ˆè‡ªç•™ï¼Œåç»­åœ¨Verificationé˜¶æ®µä½¿ç”¨ï¼‰</li></ul></li><li><strong>Proving</strong><ul><li>set the randomized proof Ï€ = ï¼ˆg<sup>Î´p(s)</sup>, g<sup>Î´h(s)</sup>, g<sup>Î´Î±p(s)</sup>)ï¼Œå³ï¼ˆg<sup>p</sup>, g<sup>h</sup>, g<sup>pâ€²</sup>)</li></ul></li><li><strong>Verification</strong><ul><li>check polynomial restriction : e(g<sup>pâ€²</sup> , g) = e(g<sup>p</sup>, g<sup>Î±</sup>)  </li><li>check polynomial cofactors : e(g<sup>p</sup>, g) = e(g<sup>t(s)</sup>, g<sup>h</sup>)  </li></ul></li></ul><p>è¯æ˜äº†p(x)çš„æ ¹ï¼Œå³p(xï¼‰å› å¼åˆ†è§£åå«æœ‰å¤šé¡¹å¼ t(x)ã€‚</p><hr><h3 id="4-General-Purpose-Zero-Knowledge-Proofs"><a href="#4-General-Purpose-Zero-Knowledge-Proofs" class="headerlink" title="4 General-Purpose Zero-Knowledge Proofs"></a>4 General-Purpose Zero-Knowledge Proofs</h3><p>ä¸Šé¢ä¸€ç« é“ºå«åŸºç¡€çŸ¥è¯†ï¼Œè¿™ä¸€ç« èŠ‚æ‹“å±•åˆ°å®é™…çš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="4-1-Computation"><a href="#4-1-Computation" class="headerlink" title="4.1 Computation"></a>4.1 Computation</h3><p>éœ€è¦è¯æ˜çš„æ˜¯ <code>for the input (1,4,2) of expression f(w,a,b) the output is 8, in other words, we check the equality: w(a Ã— b) + (1 âˆ’ w)(a + b) = 8</code><br>æ ¹æ®è¾“å…¥ï¼Œè¯æ˜è®¡ç®—çš„è¾“å‡ºç»“æœã€‚å°†è®¡ç®—é€»è¾‘è½¬åŒ–æˆå¤šé¡¹å¼è¿ç®—ã€‚</p><h3 id="4-3-Enforcing-Operation"><a href="#4-3-Enforcing-Operation" class="headerlink" title="4.3 Enforcing Operation"></a>4.3 Enforcing Operation</h3><p>ç®€åŒ–å¤šé¡¹å¼ <code>l(x) operator r(x) = o(x)</code></p><ul><li>Q1: è¿™é‡Œè¯æ˜3Â·2=6,å¦‚æœæ„é€ æ—¶å€™è¾“å…¥ä¸º4Â·3=12ï¼ŒverifieréªŒè¯çš„ç­‰å¼åŒæ ·æˆç«‹ã€‚å¦‚ä½•æ ¡éªŒè¾“å…¥çš„æ­£ç¡®æ€§ï¼Ÿ</li><li>A1: 4.8å°èŠ‚çš„ä¾‹å­</li></ul><h3 id="4-4-Proof-of-Operation"><a href="#4-4-Proof-of-Operation" class="headerlink" title="4.4 Proof of Operation"></a>4.4 Proof of Operation</h3><p><code>p(x) = l(x) Â· r(x) âˆ’ o(x)</code>ï¼Œ å¹¶ä¸”æ‹¥æœ‰å·²çŸ¥çš„æ ¹ã€‚ï¼ˆå‡å¦‚åªæœ‰ä¸€ä¸ªæ ¹a, åˆ™æ­¤å¤„<code>t(x)=x-a</code> ï¼‰</p><ul><li><strong>Proving</strong><ul><li>proof Ï€ = (g<sup>l</sup>, g<sup>r</sup>,g<sup>o</sup>, â€¦)</li></ul></li><li><strong>Verification</strong><ul><li>valid operation check: e(g<sup>l</sup>,g<sup>r</sup>) = e(g<sup>t(s)</sup>,g<sup>h</sup>)Â·e(g<sup>o</sup>,g)</li></ul></li></ul><p>å…³é”®åœ¨ä¸Provingç¯èŠ‚ï¼Œæ„é€ è¿™ä¸ªp(x)ï¼Œä½¿ç”¨äº†Pairingå‡½æ•°å®ç°åŠ å¯†çš„ä¹˜æ³•è¿ç®—ã€‚<br>å­˜åœ¨4.3ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œå› ä¸ºè®¡ç®—è¿™ä¸ªl,g,oæ—¶å€™ä½¿ç”¨çš„æ˜¯éœ€è¦è¯æ˜çš„è¾“å…¥è¾“å‡ºæ¥è®¡ç®—ç³»æ•°ã€‚<strong>éœ€è¦ä¿è¯æ­¤l(x),g(x),o(x)èƒ½åæ˜ éœ€è¦è¯æ˜çš„è¾“å…¥operandå’Œè¾“å‡ºoutput</strong></p><h3 id="4-6-Variable-Polynomials"><a href="#4-6-Variable-Polynomials" class="headerlink" title="4.6 Variable Polynomials"></a>4.6 Variable Polynomials</h3><ul><li><strong>Setup</strong>  <ul><li>construct l<sub>a</sub>(x), l<sub>d</sub>(x)  : åœ¨å°èŠ‚4.5çš„ä¾‹å­ä¸­ï¼Œæ»¡è¶³<code>For our example la(x) must conform to evaluations la(1) = 1, la(2) = 1 and la(3) = 0 and ld(x) is zero at 1 and 2 but 1 at x = 3</code>ã€‚ä¹Ÿå°±æ˜¯æ»¡è¶³è¿™ä¸ªç‰¹æ€§ã€‚</li><li>proving key: ( g<sup>l<sub>a</sub>(x)</sup>, g<sup>l<sub>d</sub>(x)</sup>, g<sup>Î±l<sub>a</sub>(x)</sup>, g<sup>Î±l<sub>d</sub>(x)</sup>) </li></ul></li><li><strong>Proving</strong><ul><li>assign values a and d and add and provide proof Ï€ = ï¼ˆg<sup>L(s)</sup> = g<sup>al<sub>a</sub>(x)</sup> Â· g<sup>dl<sub>d</sub>(x)</sup> = g<sup>al<sub>a</sub>(x) + dl<sub>d</sub>(x)</sup>)ï¼Œg<sup>Î±L(s)</sup>) :  ç„¶åProverå†æ¥æ„é€  L(x) = aÂ·l<sub>a</sub>(x) + dÂ·l<sub>d</sub>(x)ï¼Œå…·ä½“çš„èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥å€¼ã€‚åœ¨4.5çš„ä¾‹å­ä¸­ï¼Œa=2,d=6ã€‚ä¹Ÿå°±æ˜¯é™å®šäº†ï¼Œproverå¿…é¡»ä½¿ç”¨æŒ‡å®šçš„è¾“å…¥ã€‚</li></ul></li><li><strong>Verification</strong><ul><li>check polynomial restriction : e(g<sup>pâ€²</sup> , g) = e(g<sup>p</sup>, g<sup>Î±</sup>)  </li><li>check polynomial cofactors : e(g<sup>p</sup>, g) = e(g<sup>t(s)</sup>, g<sup>h</sup>) </li></ul></li></ul><ul><li><p>Q1: è¿™é‡Œè¯æ˜3X2=6,å¦‚æœæ„é€ æ—¶å€™è¾“å…¥ä¸º4X3=12ï¼ŒverifieréªŒè¯çš„ç­‰å¼åŒæ ·æˆç«‹ã€‚å¦‚ä½•æ ¡éªŒè¾“å…¥çš„æ­£ç¡®æ€§ï¼Ÿ</p><p>A1: è¿™é‡Œverifierå¯ä»¥æ£€æŸ¥ g<sup>L(s)</sup> = g<sup>al<sub>a</sub>(s)</sup> Â· g<sup>dl<sub>d</sub>(s)</sup> = g<sup>al<sub>a</sub>(s) + dl<sub>d</sub>(s)</sup>ï¼Œå³å¯åˆ¤æ–­è¾“å…¥å‚æ•°æ˜¯å¦ç›¸ç¬¦ã€‚<strong><em>verifieæ˜¯å¦çŸ¥é“a,dçš„å–å€¼ï¼Ÿ</em></strong></p></li><li>Q2: æä¾›çš„æ˜¯l(x)çš„é˜¶æ•°ä¸ºå¤šé˜¶çš„ï¼Œverifieræä¾›æ˜¯ä»¥{ g<sup>s<sup>i</sup>&lt;/sup&gt; }iâˆˆ[d]çš„æ–¹å¼æä¾›çš„ï¼Œåœ¨Provingé˜¶æ®µproverèµ‹å€¼æ—¶ï¼Œå¦‚ä½•ä¿è¯å¯¹äºæ¯ä¸€é˜¶éƒ½èµ‹äºˆç›¸åŒçš„å€¼ï¼Ÿ<br>A2: </sup></li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">As a consequence the prover:</span><br><span class="line">â€¢ is not able to modify provided variable polynomials by changing their coefficients, except â€œassigningâ€ values, because prover is presented only with encrypted evaluations of these polynomials, and because necessary encrypted powers of s are unavailable separately with their Î±-shifts</span><br><span class="line">â€¢ is not able to add another polynomial to the provided ones because the Î±-ratio will be broken</span><br><span class="line">â€¢ is not able to modify operand polynomials through multiplication by some other polyno- mial u(x), which could disproportionately modify the values because encrypted multipli- cation is not possible in pre-pairings space</span><br></pre></td></tr></tbody></table></figure><h3 id="4-7-Construction-Properties"><a href="#4-7-Construction-Properties" class="headerlink" title="4.7 Construction Properties"></a>4.7 Construction Properties</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Note the operationâ€™s construction is also called â€œconstraintâ€ because the operation represented by polynomial construction does not compute results per se, but rather checks that the prover already knows variables (including result), and they are valid for the operation, i.e., the prover is constrained to provide consistent values no matter what they are.</span><br></pre></td></tr></tbody></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒéªŒè¯çš„æ˜¯è¾“å…¥/è¾“å‡ºè®¡ç®—ç»“æœï¼Œå³ä»£å…¥ä¸Šé¢æ„é€ çš„L(x),R(x),O(x)ï¼Œéœ€è¦è¯æ˜å…¶ä¸­çš„æ ¹ï¼Œå³t(x)ã€‚é€šè¿‡éªŒè¯çº¦æŸçš„æ–¹å¼å–ä»£ç›´æ¥æä¾›è¾“å‡ºç»“æœçš„æ–¹å¼ã€‚</p><h3 id="4-8-Example-Computation"><a href="#4-8-Example-Computation" class="headerlink" title="4.8 Example Computation"></a>4.8 Example Computation</h3><p>l(x),r(x),o(x)ç³»åˆ—å­å‡½æ•°çš„è¿™äº›éƒ½æ˜¯å·²çŸ¥çš„ï¼Œä¹Ÿæ˜¯verifieråŠ å¯†åä¼ é€’åˆ°proverã€‚proverä½¿ç”¨è¾“å…¥w=1,a=3,b=2,è®¡ç®—å‡ºç»“æœv=6ï¼Œå¹¶ä¸”ä»£å…¥è®¡ç®—å¾—åˆ°L(x),R(x),O(x),ç„¶åå³ä¼ ç»Ÿçš„p(x)=L(x)Â·R(x)-O(x)ï¼Œå…¶ä¸­t(x)å·²çŸ¥ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯verifierç”¨æ¥è®¡ç®—l(x),r(x),o(x)çš„æ ¹ã€‚ä¹Ÿå°±æ˜¯ï¼Œ<strong>éœ€è¦è¯æ˜çš„æ˜¯v=6</strong>ã€‚è¿™ä¸ªæ˜¯é€šè¿‡å°†v=6ä»£å…¥ä¸ç­‰å¼è¯æ˜çš„ã€‚</p><p><img src="/images/zk-snarks/zk-snark-example.jpg" alt=""><br></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m=aÂ·b</span><br><span class="line">wÂ·(m-a-b)=v-a-b</span><br></pre></td></tr></tbody></table></figure><p></p><p>å³å›¾ä¸­åœ¨x=1,2,3ä¸‰ä¸ªç‚¹å¤„éƒ½æ»¡è¶³<code>L(x)Â·R(x)-O(x)=0</code>ï¼Œå¦‚æœæ”¹å˜vçš„å€¼ä½¿å…¶ä¸ç­‰äº6ï¼Œåˆ™<code>L(x)Â·R(x)-O(x)</code>è¯¥ç­‰å¼åœ¨x=2å¤„<code>wÂ·ï¼ˆm-a-bï¼‰!= v-a-b</code>ï¼Œå³x=2ä¸æ˜¯å…¶ä¸­ä¸€ä¸ªæ ¹ï¼ŒverifieréªŒè¯å¤±è´¥ã€‚</p><h3 id="4-9-Verifiable-Computation-Protocol"><a href="#4-9-Verifiable-Computation-Protocol" class="headerlink" title="4.9 Verifiable Computation Protocol"></a>4.9 Verifiable Computation Protocol</h3><h4 id="4-9-1-é™å®šL-x-åªç”±-li-x-æ„æˆï¼Œå¹¶ä¸”è¯æ˜çš„ç­‰å¼å¿…é¡»æ˜¯L-x-Â·-Rï¼ˆxï¼‰-O-x-ã€‚-é˜²æ­¢å·¦æ“ä½œæ•°ï¼Œå³æ“ä½œæ•°ï¼Œè¾“å‡ºåœ¨è¯æ˜ä¸­æ··ç”¨ã€‚"><a href="#4-9-1-é™å®šL-x-åªç”±-li-x-æ„æˆï¼Œå¹¶ä¸”è¯æ˜çš„ç­‰å¼å¿…é¡»æ˜¯L-x-Â·-Rï¼ˆxï¼‰-O-x-ã€‚-é˜²æ­¢å·¦æ“ä½œæ•°ï¼Œå³æ“ä½œæ•°ï¼Œè¾“å‡ºåœ¨è¯æ˜ä¸­æ··ç”¨ã€‚" class="headerlink" title="4.9.1 - é™å®šL(x)åªç”± li(x) æ„æˆï¼Œå¹¶ä¸”è¯æ˜çš„ç­‰å¼å¿…é¡»æ˜¯L(x) Â· Rï¼ˆxï¼‰= O(x)ã€‚ é˜²æ­¢å·¦æ“ä½œæ•°ï¼Œå³æ“ä½œæ•°ï¼Œè¾“å‡ºåœ¨è¯æ˜ä¸­æ··ç”¨ã€‚"></a>4.9.1 - é™å®š<code>L(x)</code>åªç”± l<sub>i</sub>(x) æ„æˆï¼Œå¹¶ä¸”è¯æ˜çš„ç­‰å¼å¿…é¡»æ˜¯<code>L(x) Â· Rï¼ˆxï¼‰= O(x)</code>ã€‚ é˜²æ­¢å·¦æ“ä½œæ•°ï¼Œå³æ“ä½œæ•°ï¼Œè¾“å‡ºåœ¨è¯æ˜ä¸­æ··ç”¨ã€‚</h4><p><strong>Solution</strong>: <code>l(x),r(x),o(x)</code>åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„Î±<sub>l</sub>, Î±<sub>r</sub>, Î±<sub>o</sub>ã€‚</p><h4 id="4-9-2-é™å®šåœ¨L-x-R-x-O-x-ä½¿ç”¨çš„å‚æ•°vi-å³4-8ä¾‹å­ä¸­çš„a-b-wç­‰ï¼‰æ˜¯ä¸€è‡´çš„ã€‚"><a href="#4-9-2-é™å®šåœ¨L-x-R-x-O-x-ä½¿ç”¨çš„å‚æ•°vi-å³4-8ä¾‹å­ä¸­çš„a-b-wç­‰ï¼‰æ˜¯ä¸€è‡´çš„ã€‚" class="headerlink" title="4.9.2 - é™å®šåœ¨L(x),R(x),O(x)ä½¿ç”¨çš„å‚æ•°vi(å³4.8ä¾‹å­ä¸­çš„a,b,wç­‰ï¼‰æ˜¯ä¸€è‡´çš„ã€‚"></a>4.9.2 - é™å®šåœ¨<code>L(x),R(x),O(x)</code>ä½¿ç”¨çš„å‚æ•°v<sub>i</sub>(å³4.8ä¾‹å­ä¸­çš„a,b,wç­‰ï¼‰æ˜¯ä¸€è‡´çš„ã€‚</h4><p><strong>Solution</strong>:  ä¸ºæ ¡éªŒæ ¡éªŒ v<sub>l,i</sub> = v<sub>r,i</sub> = v<sub>o,i</sub> = v<sub>Î²,i</sub>ï¼Œå…³é”®æ˜¯é€šè¿‡ä»¥ä¸‹ç­‰å¼<br>e(g<sup>v<sub>l,i</sub> Â·l<sub>i</sub>(s)</sup> Â· g<sup>v<sub>r,i</sub> Â·r<sub>i</sub>(s)</sup> Â· g<sup>v<sub>o,i</sub> Â·o<sub>i</sub>(s)</sup>, g<sup>Î²</sup>) = e(g<sup>v<sub>Î²,i</sub> Â·Î²Â·(l<sub>i</sub>(s)+r<sub>i</sub>(s)+o<sub>i</sub>(s))</sup>, g)ã€‚ è¿›ä¸€æ­¥ä¸ºé˜²æ­¢å¦‚<code>l(x) = r(x)</code>çš„æƒ…å†µï¼Œé€‰æ‹©å„è‡ªä¸ç­‰çš„Î²<sub>l</sub>, Î²<sub>r</sub>, Î²<sub>o</sub></p><ul><li><strong>Setup</strong>  <ul><li>proving key the variable consistency polynomials:<br>g<sup>Î²<sub>z</sub></sup>={g<sup>Î²<sub>l</sub>l<sub>i</sub>(s)+&gt;Î²<sub>r</sub>r<sub>i</sub>(s)+&gt;Î²<sub>o</sub>o<sub>i</sub>(s)</sup>}<sub>iâˆˆ{1,â€¦,n}</sub></li><li>verification key: (g<sup>Î²<sub>l</sub></sup> , g<sup>Î²<sub>r</sub></sup> , g<sup>Î²<sub>o</sub></sup>, g<sup>Î²<sub>z</sub></sup>)</li></ul></li><li><strong>Proving</strong><ul><li>èµ‹å€¼è®¡ç®—ï¼Œg<sup>z<sub>i</sub>(s)</sup>=(g<sup>Î²<sub>z</sub></sup>)<sup>v<sub>i</sub></sup> for i âˆˆ {1,â€¦,n}ï¼Œå¹¶ä¸”ç›¸ä¹˜å¾—åˆ°proof: g<sup>Z(s)</sup></li></ul></li><li><strong>Verification</strong><ul><li>e(g<sup>L</sup>, g<sup>Î²<sub>l</sub></sup>) Â· e(g<sup>R</sup>, g<sup>Î²<sub>r</sub></sup>) Â· e(g<sup>O</sup>, g<sup>Î²<sub>o</sub></sup>) = e(g<sup>Z</sup> , g)</li></ul></li></ul><h4 id="4-9-3-Non-malleability-of-Variable-and-Variable-Consistency-Polynomials"><a href="#4-9-3-Non-malleability-of-Variable-and-Variable-Consistency-Polynomials" class="headerlink" title="4.9.3 Non-malleability of Variable and Variable Consistency Polynomials"></a>4.9.3 Non-malleability of Variable and Variable Consistency Polynomials</h4><p><strong>Q1</strong>:ï¼ˆMalleability of Variable Polynomialsï¼‰ g<sup>Î±<sub>l</sub></sup> å’Œ g<sup>Î²<sub>l</sub></sup>æ˜¯åœ¨verification keyé‡Œçš„ï¼Œä¸ºä»€ä¹ˆproverèƒ½æ‹¿å¾—åˆ°ï¼Ÿ<br><strong>Q2</strong>ï¼šï¼ˆNon-Malleabilityï¼‰ ä½œä¸ºverification keyï¼Œè¿™é‡Œçš„g<sup>Î³</sup>æ˜¯å¦å°±æ˜¯ç±»ä¼¼ä¸Q1é‡Œçš„g ? è¿™æ ·çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ</p><h4 id="4-10-Constraints"><a href="#4-10-Constraints" class="headerlink" title="4.10 Constraints"></a>4.10 Constraints</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">However, the protocol is not actually â€œcomputingâ€ but rather is checking that the output value is the correct result of an operation for the operandâ€™s values. That is why it is called a constraint, i.e., a verifier is constraining a prover to provide valid values for the predefined â€œprogramâ€ no matter what are they. </span><br></pre></td></tr></tbody></table></figure><h3 id="4-11-Public-Inputs-and-One-é™å®šå¸¸é‡çš„å€¼ã€‚"><a href="#4-11-Public-Inputs-and-One-é™å®šå¸¸é‡çš„å€¼ã€‚" class="headerlink" title="4.11 Public Inputs and One é™å®šå¸¸é‡çš„å€¼ã€‚"></a>4.11 Public Inputs and One é™å®šå¸¸é‡çš„å€¼ã€‚</h3><p><strong>Solution</strong>:<br>L(x)=L<sub>v</sub>(x)+L<sub>p</sub>(x)ï¼Œå…¶ä¸­verifieræä¾›L<sub>v</sub>(x) = l<sub>0</sub>(x) + l<sub>1</sub>(x) + . . . + l<sub>m</sub>(x)ã€‚é™å®šäº†0é˜¶ï¼ˆå³å¸¸é‡ï¼‰çš„å€¼v<sub>one</sub></p><ul><li><strong>Setup</strong>  <ul><li>. . . separate all n variable polynomials into two groups:<ul><li>verifierâ€™s m + 1:<br>L<sub>v</sub>(x) = l<sub>0</sub>(x) + l<sub>1</sub>(x) + . . . + l<sub>m</sub>, and alike for R<sub>v</sub>(x) and O<sub>v</sub>(x), where index 0 is reserved for the value of v<sub>one</sub> = 1</li><li>proverâ€™s n âˆ’ m:<br>L<sub>p</sub>(x) = l<sub>m+1</sub>(x) + . . . + l<sub>n</sub>(x), and alike for R<sub>p</sub>(x) and O<sub>p</sub>(x)</li></ul></li></ul></li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Effectively this is taking some variables from the prover into the hands of verifier while still preserving the balance of the equation. Therefore the valid operations check should still hold, but only if the prover has used the same values that the verifier used for his input.</span><br></pre></td></tr></tbody></table></figure><h3 id="4-12-Zero-Knowledge-Proof-of-Computation"><a href="#4-12-Zero-Knowledge-Proof-of-Computation" class="headerlink" title="4.12 Zero-Knowledge Proof of Computation"></a>4.12 Zero-Knowledge Proof of Computation</h3><p>é›¶çŸ¥è¯†è¯æ˜ï¼Œå„è‡ªåŠ ä¸Šå˜æ¢å€¼ã€‚ Î´<sub>l</sub>, Î´<sub>r</sub>,  Î´<sub>o</sub>ã€‚é€šè¿‡åŠ æ³•å®ç°åŒæ€åŠ å¯†ã€‚<br>L(s) + Î´<sub>l</sub>t(s)) Â· (R(s) + Î´<sub>r</sub>t(s)) âˆ’ (O(s) + Î´<sub>o</sub>t(s)) = t(s) Â· (âˆ† + h(s))<br>âˆ† = Î´<sub>r</sub>L(s) + Î´<sub>l</sub>R(s) + Î´<sub>l</sub>Î´<sub>r</sub>t(s) âˆ’ Î´<sub>o</sub></p><p>åªè¦æ»¡è¶³ä»¥ä¸Šå…³ç³»ï¼Œå¯ä»¥æ¨å¯¼ï¼Œåœ¨verificationé˜¶æ®µå¯ä»¥å°±å¯ä»¥éªŒè¯<br>L Â· R âˆ’ O + t Â· âˆ†  = t(s)h + t(s) Â· âˆ† </p><hr><h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref:"></a>Ref:</h3><ol><li><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzIxNjkwODE5NQ==&amp;action=getalbum&amp;album_id=1432629901374636033&amp;subscene=159&amp;subscene=158&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIxNjkwODE5NQ%3D%3D%26mid%3D2247484357%26idx%3D1%26sn%3Dc07ab2eab9fc81122f4788418eba2af1%26chksm%3D9780ab09a0f7221f0eb5049da5056bdbe9702a6fc03e3d053ad18ea60e9d75c2037ad545e1a0%26scene%3D158%23rd#wechat_redirect">ä»é›¶å¼€å§‹å­¦ä¹  zk-SNARK</a> : æ¥è‡ª å®‰æ¯”å®éªŒå®¤ï¼Œç¿»è¯‘åŸæ–‡ï¼Œå¹¶ä¸”åŠ å…¥ç†è§£å’Œæ‹“å±•ï¼Œæ¨è</li><li><a href="https://github.com/sec-bit/learning-zkp/blob/master/zkp-resource-list.md">é›¶çŸ¥è¯†è¯æ˜å­¦ä¹ èµ„æºæ±‡æ€»</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Consensus &amp; Cryptography </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¤§æ•°æ®ä¸åŒºå—é“¾</title>
      <link href="//articles/bigdata-and-blockchain/"/>
      <url>//articles/bigdata-and-blockchain/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="4b4e3fa6c645048740f1d26d4256618251c171b923be80119f77e15863abd255">3175488eedc729df0c7d358c640da99ef6c8aa14b2be7cb6195cb77653a9e951f9f03e604cf0fd38f9abeb127d89fc235ee3ae13d4b572f5a052b5a1d48eddd2e682277e7bd8dd97b5a7e5bd403d7314ea64f0a970444713ea36c4943c3ca8671c8bf1c80f853ba61cdf38a009b35ccebfb8aac6ee794d84972f54eb4452d98e</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Post is cheap, show me the password</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hyperledger Fabric 2.0æ–°ç‰¹æ€§</title>
      <link href="//articles/fabric-2-0-new-feature/"/>
      <url>//articles/fabric-2-0-new-feature/</url>
      
        <content type="html"><![CDATA[<p>Hyperledger Fabricå‡çº§åˆ°2.0å¤§ç‰ˆæœ¬ï¼Œä¸»è¦ä»¥ä¸‹æœ‰3ä¸ªæ–°ç‰¹æ€§ã€‚å‚çœ‹å®˜ç½‘<a href="https://hyperledger-fabric.readthedocs.io/en/latest/whatsnew.html">Whatâ€™s new in Hyperledger Fabric v2.0</a>ã€‚åŒæ—¶å¯ä»¥è§‚çœ‹IBMå‘˜å·¥ä¹Ÿæ˜¯Fabricå¼€å‘è€…çš„ç³»åˆ—è§†é¢‘è®²åº§ä»‹ç»æ–°ç‰¹æ€§ã€‚å‚çœ‹<a href="https://v.qq.com/vplus/6a662f75e9a927ede370ba49c9e883e0#uin=6a662f75e9a927ede370ba49c9e883e0?page=video">è¶…çº§è´¦æœ¬Hyperledgeré¢‘é“</a>ï¼ˆè¶…çº§è´¦æœ¬ç½‘ç»œç ”è®¨ä¼š2020å¹´ç³»åˆ—ï¼‰ã€‚æ€»ä½“æ¥è¯´ï¼Œ2.0ç‰ˆæœ¬å¼•å…¥çš„æ–°ç‰¹æ€§éƒ½æ˜¯åœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­çš„ç—›ç‚¹ï¼Œå¢è¿›äº†å¯ç”¨æ€§ã€‚</p><ol><li>Decentralized governance for smart contracts<blockquote><p><a href="https://v.qq.com/x/page/s09376uefz5.html">è§†é¢‘</a><br><a href="https://hyperledger-fabric.readthedocs.io/en/latest/chaincode_lifecycle.html">Fabric chaincode lifecycle</a><br><a href="https://hyperledger-fabric.readthedocs.io/en/latest/deploy_chaincode.html">Deploying a smart contract to a channel</a></p></blockquote></li><li>Private data enhancements<blockquote><p><a href="https://v.qq.com/x/page/a09419gwu90.html">è§†é¢‘</a></p></blockquote></li><li><p>External chaincode launcher</p><blockquote><p><a href="https://v.qq.com/x/page/x0944c3pswy.html">è§†é¢‘</a><br><a href="https://hyperledger-fabric.readthedocs.io/en/latest/cc_service.html">Chaincode as an external service</a></p></blockquote><p><img src="/images/fabric-2_0-external-chaincode-launcher.jpg" alt=""></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bitcoinæ¦‚å¿µç†è§£</title>
      <link href="//articles/understanding-bitcoin/"/>
      <url>//articles/understanding-bitcoin/</url>
      
        <content type="html"><![CDATA[<ol><li>é”å®šè„šæœ¬ä¸è§£é”è„šæœ¬<br>ä¸¤è€…ç”¨äºç¡®å®šUTXOçš„æ‰€æœ‰æƒï¼Œå…¶ä¸­ï¼Œé”å®šè„šæœ¬ï¼ˆsciptPubKeyï¼‰å­˜åœ¨äºtransactionçš„outputï¼Œè§£é”è„šæœ¬ï¼ˆscriptSigï¼‰å­˜åœ¨äºtransactionçš„inputã€‚</li></ol><ul><li>å…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š<br><img src="/images/understanding-bitcoin/bitcoin-script.jpg" alt=""></li></ul><span id="more"></span><ul><li>äº¤æ˜“éªŒè¯è¿‡ç¨‹ï¼š<br><img src="/images/understanding-bitcoin/bitcoin-script-verification-1.jpg" alt=""><br><img src="/images/understanding-bitcoin/bitcoin-script-verification-2.jpg" alt=""></li></ul><blockquote><p>ä»¥ä¸Šæ‘˜è‡ª<a href="https://zhuanlan.zhihu.com/p/33672729">æ¯”ç‰¹å¸çš„äº¤æ˜“è¿‡ç¨‹-çŸ¥ä¹</a></p></blockquote><ul><li>è§£é”è„šæœ¬é‡Œç­¾åçš„å†…å®¹ä¸ºï¼š<br><img src="/images/understanding-bitcoin/bitcoin-transation.png" alt=""></li></ul><blockquote><p>We define an electronic coin as a chain of digital signatures. Each owner transfers the coin to the next by digitally signing a hash of the previous transaction and the public key of the next owner and adding these to the end of the coin. A payee can verify the signatures to verify the chain of ownership. æ‘˜è‡ª<a href="https://bitcoin.org/bitcoin.pdf">Bitcoin Whitepaper</a></p></blockquote><p>æ€»çš„æ¥è¯´ï¼Œæ ¡éªŒè¿‡ç¨‹å…ˆæ ¡éªŒè§£é”è„šæœ¬é‡Œå…¬é’¥PubKeyå’Œé”å®šè„šæœ¬é‡Œæ˜¯å»åˆçš„ï¼Œç„¶åæ ¡éªŒè§£é”è„šæœ¬é‡Œçš„ç­¾åã€‚ä½¿ç”¨å¯¹åº”çš„ç§é’¥ï¼Œå¯¹æ¥æºï¼ˆäº§ç”Ÿæ¶ˆè´¹çš„è¯¥UTXOçš„transactionï¼‰å’Œå»å¤„ï¼ˆè½¬è´¦æ¥å—è€…çš„pubkeyï¼‰è¿›è¡Œç­¾åã€‚æ ¡éªŒè¿‡ç¨‹åªéœ€è¦æ ¡éªŒï¼ˆç­¾åï¼Œè¯¥UTXOçš„å…¬é’¥ï¼Œç­¾åå†…å®¹ï¼‰è¿™ä¸‰è€…æ˜¯å»åˆçš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bitcoin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabricå®æˆ˜ï¼ˆ2ï¼‰- Commercial Paperçš„Fabric-Java-SDKå®¢æˆ·ç«¯</title>
      <link href="//articles/fabric-inpractice-commercialpaper-java-sdk/"/>
      <url>//articles/fabric-inpractice-commercialpaper-java-sdk/</url>
      
        <content type="html"><![CDATA[<p>åˆ°ç›®å‰ä¸ºæ­¢éƒ½æ˜¯é€šè¿‡åœ¨cliå®¹å™¨æ‰§è¡Œ<code>peer chaincode</code>å‘½ä»¤è°ƒç”¨chaincodeï¼Œå®é™…ä¸Šå®˜æ–¹æä¾›<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/fabric-sdks.html">SDK</a>ï¼ˆå½“å‰åªæœ‰Node.jså’ŒJavaä¸¤ç§ï¼‰ã€‚è¿™é‡Œæä¾›åŸºäºFabric Java SDKçš„commercial paperå®¢æˆ·ç«¯ï¼Œè®¾ç½®ä½¿ç”¨TLSï¼Œè¯¦ç»†é¡¹ç›®ä»£ç åœ¨<a href="https://github.com/simplexity-ckcclc/fabric-learning/tree/master/java-sdk/commercial-paper">github</a>ã€‚é¡¹ç›®é‡‡ç”¨Springbootï¼Œswaggeræä¾›ç½‘é¡µè°ƒç”¨ã€‚æ³¨æ„ï¼Œè¿™é‡Œåªæ˜¯demoï¼Œä¸èƒ½ä½œä¸ºç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚å…·ä½“æ­¥éª¤å¤§è‡´æ‹†è§£å¦‚ä¸‹ï¼š</p><ol><li>æ„å»ºHFClient<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> HFClient <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨Org1çš„adminç”¨æˆ·èº«ä»½ã€‚ç”±äºä½¿ç”¨TSLï¼Œè¿™é‡Œæä¾›keyFileï¼šadminçš„ç§é’¥å’ŒcertFileï¼šç”±ca.org1.example.comç­¾å‘çš„è¯ä¹¦</span></span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨HFCAClientå‘caå‘é€enrollå’Œregisterè¯·æ±‚ç”¨äºæ–°å¢æ³¨å†Œå’Œç™»è®°èº«ä»½è¯ä¹¦ã€‚å…·ä½“å¯ä»¥å‚çœ‹å‚è€ƒæ–‡æ¡£ã€‚</span></span><br><span class="line">    Enrollment enrollment = PaperUser.createEnrollmentFromPemFile(keyFile, certFile);</span><br><span class="line">    PaperUser admin = <span class="keyword">new</span> PaperUser(name, mspId, enrollment);</span><br><span class="line"></span><br><span class="line">    HFClient client = HFClient.createNewInstance();</span><br><span class="line">    client.setCryptoSuite(CryptoSuite.Factory.getCryptoSuite());</span><br><span class="line">    client.setUserContext(admin);</span><br><span class="line">    initChannel();</span><br><span class="line">    <span class="keyword">return</span> client;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> Enrollment <span class="title">createEnrollmentFromPemFile</span><span class="params">(String keyFile, String certFile)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    <span class="keyword">byte</span>[] keyPem = Files.readAllBytes(Paths.get(keyFile));     <span class="comment">//è½½å…¥ç§é’¥PEMæ–‡æœ¬</span></span><br><span class="line">    <span class="keyword">byte</span>[] certPem = Files.readAllBytes(Paths.get(certFile));   <span class="comment">//è½½å…¥è¯ä¹¦PEMæ–‡æœ¬</span></span><br><span class="line">    CryptoPrimitives suite = <span class="keyword">new</span> CryptoPrimitives();            <span class="comment">//è½½å…¥å¯†ç å­¦å¥—ä»¶</span></span><br><span class="line">    PrivateKey privateKey = suite.bytesToPrivateKey(keyPem);    <span class="comment">//å°†PEMæ–‡æœ¬è½¬æ¢ä¸ºç§é’¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> X509Enrollment(privateKey,<span class="keyword">new</span> String(certPem));  <span class="comment">//åˆ›å»ºå¹¶è¿”å›X509Enrollmentå¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨TSLï¼Œéœ€è¦æä¾›peerTLScaCertFileï¼štlsca.org1.example.comçš„è¯ä¹¦å’ŒordererTLScaCertFileï¼štlsca.example.comçš„è¯ä¹¦</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Channel channel = client.newChannel(channelID);</span><br><span class="line">    Properties peerProps = <span class="keyword">new</span> Properties();</span><br><span class="line">    peerProps.put(<span class="string">&quot;pemFile&quot;</span>, peerTLScaCertFile);</span><br><span class="line">    peerProps.setProperty(<span class="string">&quot;sslProvider&quot;</span>, <span class="string">&quot;openSSL&quot;</span>);</span><br><span class="line">    peerProps.setProperty(<span class="string">&quot;negotiationType&quot;</span>, <span class="string">&quot;TLS&quot;</span>);</span><br><span class="line">    Peer peer = client.newPeer(peerName, peerURL, peerProps);</span><br><span class="line">    channel.addPeer(peer);</span><br><span class="line"></span><br><span class="line">    Properties ordererProps = <span class="keyword">new</span> Properties();</span><br><span class="line">    ordererProps.put(<span class="string">&quot;pemFile&quot;</span>, ordererTLScaCertFile);</span><br><span class="line">    ordererProps.setProperty(<span class="string">&quot;sslProvider&quot;</span>, <span class="string">&quot;openSSL&quot;</span>);</span><br><span class="line">    ordererProps.setProperty(<span class="string">&quot;negotiationType&quot;</span>, <span class="string">&quot;TLS&quot;</span>);</span><br><span class="line">    Orderer orderer = client.newOrderer(ordererName, ordererURL, ordererProps);</span><br><span class="line">    channel.addOrderer(orderer);</span><br><span class="line"></span><br><span class="line">    channel.initialize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><code>peerURL</code>è®¾ç½®ä¸º<code>grpcs://peer0.org1.example.com:7051</code>ã€‚é¦–å…ˆï¼ŒTLSéœ€è¦è®¾ç½®ä½¿ç”¨<code>grpcs</code>ã€‚å…¶æ¬¡ï¼Œåªèƒ½ä½¿ç”¨<code>peer0.org1.example.com</code>ï¼ˆåŒæ—¶éœ€è¦é…ç½®hostsæ–‡ä»¶ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨  <code>127.0.0.1</code>æˆ–è€…<code>localhost</code>(æŠ¥é”™<code>Caused by: java.security.cert.CertificateException: No subject alternative DNS name matching IP address 127.0.0.1/localhost found</code>) ã€‚å› ä¸ºpeer0è¿”å›çš„è¯ä¹¦çš„CNæ˜¯peer0.org1.example.comï¼Œjava sslä¼šæ ¡éªŒè¿™ä¸ªåŸŸåã€‚</li></ul><ol><li><p>chaincode - query</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">query</span><span class="params">(String issuer, String paperNumber)</span> </span>&#123;</span><br><span class="line">    QueryByChaincodeRequest req = client.newQueryProposalRequest();</span><br><span class="line">    ChaincodeID cid = ChaincodeID.newBuilder().setName(chaincodeName).build();</span><br><span class="line">    req.setChaincodeID(cid);</span><br><span class="line">    req.setFcn(QUERY_FUNC);</span><br><span class="line">    req.setArgs(issuer, paperNumber);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Channelå¯¹è±¡å·²åœ¨ä¸Šé¢æ„å»º</span></span><br><span class="line">    Channel channel = client.getChannel(channelID);</span><br><span class="line">    Collection&lt;ProposalResponse&gt; propResps = channel.queryByChaincode(req);</span><br><span class="line">    <span class="comment">// endorserè¿”å›çš„ProposalResponseéœ€è¦ä¿æŒä¸€è‡´</span></span><br><span class="line">    Collection&lt;Set&lt;ProposalResponse&gt;&gt; proposalConsistencySets = SDKUtils.getProposalConsistencySets(propResps);</span><br><span class="line">    <span class="keyword">if</span> (proposalConsistencySets.size() != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(ErrorCode.CHAINCOED_SERVICE_ERROR)</span><br><span class="line">                .withErrorMsg(<span class="string">&quot;Expected only one set of consistent proposal responses but got more&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    FabricProposalResponse.Response res = propResps.iterator().next().getProposalResponse().getResponse();</span><br><span class="line">    <span class="keyword">if</span> (res.getStatus() == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success().withResponse(res.getPayload().toStringUtf8());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.fail(ErrorCode.CHAINCOED_SERVICE_ERROR).withErrorMsg(res.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>chaincode - invoke</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">issue</span><span class="params">(IssueRequest request)</span> </span>&#123;</span><br><span class="line">    TransactionProposalRequest proposalRequest = client.newTransactionProposalRequest();</span><br><span class="line">    ChaincodeID cid = ChaincodeID.newBuilder().setName(chaincodeName).build();</span><br><span class="line">    proposalRequest.setChaincodeID(cid);</span><br><span class="line">    proposalRequest.setFcn(ISSUE_FUNC);</span><br><span class="line">    proposalRequest.setArgs(request.getIssuer(), request.getPaperNumber(), issueDate, maturityDate,</span><br><span class="line">            String.valueOf(request.getFaceValue()));</span><br><span class="line"></span><br><span class="line">    Channel channel = client.getChannel(channelID);</span><br><span class="line">    <span class="comment">// Endorsing(simulate) phase</span></span><br><span class="line">    Collection&lt;ProposalResponse&gt; propResps = channel.sendTransactionProposal(proposalRequest);</span><br><span class="line">    <span class="comment">// endorserè¿”å›çš„ProposalResponseéœ€è¦ä¿æŒä¸€è‡´</span></span><br><span class="line">    Collection&lt;Set&lt;ProposalResponse&gt;&gt; proposalConsistencySets = SDKUtils.getProposalConsistencySets(propResps);</span><br><span class="line">    <span class="keyword">if</span> (proposalConsistencySets.size() != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(ErrorCode.CHAINCOED_SERVICE_ERROR)</span><br><span class="line">                .withErrorMsg(<span class="string">&quot;Expected only one set of consistent proposal responses but got more&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Orderer phase</span></span><br><span class="line">    <span class="comment">// è¿™é‡ŒåŒæ­¥è°ƒç”¨ï¼Œéœ€è¦ç­‰åˆ°æäº¤ordererå¹¶ä¸”ordereræ’åºåå‘é€åˆ°å„ä¸ªpeerï¼Œpeerå¤„ç†äº†blocké‡Œçš„äº¤æ˜“åæ‰è¿”å›ã€‚</span></span><br><span class="line">    <span class="comment">// æˆ–è€…åŒæ­¥è¿”å›txidã€‚å¯ä»¥é…ç½®eventHubå¼‚æ­¥æ¥æ”¶å’Œæ‰§è¡Œblockï¼Œé€šè¿‡txidæ¥è¿”å›æœ€ç»ˆçš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">    BlockEvent.TransactionEvent event = channel.sendTransaction(propResps).get();</span><br><span class="line">    <span class="keyword">if</span> (event.isValid()) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success().withResponse(<span class="string">&quot;txid : &quot;</span> + event.getTransactionID());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.fail(ErrorCode.CHAINCOED_SERVICE_ERROR);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="WIP"><a href="#WIP" class="headerlink" title="WIP:"></a>WIP:</h4><ol><li>eventHub</li></ol><h4 id="Ref"><a href="#Ref" class="headerlink" title="Ref."></a>Ref.</h4><blockquote><p><a href="https://zhuanlan.zhihu.com/p/63511862">Fabric Java SDKæœ€æ–°æ•™ç¨‹ã€201904ã€‘</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabricå®æˆ˜ï¼ˆ1ï¼‰ - åŸºç¡€ç¯‡ï¼ŒåŸºäºbyfnçš„Commercial Paperæ¡ˆä¾‹</title>
      <link href="//articles/fabric-inpractice-commercialpaper-byfn/"/>
      <url>//articles/fabric-inpractice-commercialpaper-byfn/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰åˆ†äº«è¿‡<a href="https://simplexity.cn/2019/04/19/fabric-commercial-paper-go/">Fabricå®˜ç½‘Commercial Paperæ¡ˆä¾‹chaincodeçš„golangå®ç°</a>ï¼Œç°åœ¨åŸºäºå®˜ç½‘<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/build_network.html">Building Your First Network</a>å†æ¬¡è®°å½•è¿‡ç¨‹ï¼ŒåŒæ—¶æ·»åŠ éƒ¨åˆ†æ–°æ“ä½œåŠåˆ†æï¼Œä»¥æ­¤ä½œä¸ºä»¥åçš„è¿›é˜¶å®æˆ˜åŸºç¡€ã€‚</p><ol><li><p>ä½¿ç”¨å‘½ä»¤<code>./byfn.sh up</code>å¯åŠ¨ç½‘ç»œ</p></li><li><p>æŸ¥çœ‹é…ç½®æ–‡ä»¶<code>/fabric-samples/first-network/docker-compose-cli.yaml</code>,å¯è§cliçš„æŒ‚è½½volumeè®¾ç½®  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli:</span><br><span class="line">  volume:</span><br><span class="line">    - ./../chaincode/:/opt/gopath/src/github.com/chaincode</span><br></pre></td></tr></table></figure></li><li><p>å°†ç¼–å†™çš„chaincodeæºæ–‡ä»¶æ”¾ç½®åœ¨è¯¥æŒ‚è½½çš„è·¯å¾„<code>/chaincode/go</code>ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp commercial_paper.go /chaincode/go</span><br><span class="line">cp paper.go /chaincode/go</span><br></pre></td></tr></table></figure></li><li><p><code>docker exec -it cli bash</code>ç™»å…¥å®¹å™¨cli</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- æ‰§è¡Œpeer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go</span><br><span class="line">- æ‰§è¡Œecho $CORE_PEER_MSPCONFIGPATHã€‚å¯è§å½“å‰è§’è‰²ä¸ºadmin</span><br><span class="line">    ---</span><br><span class="line">    /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">- æ‰§è¡Œpeer chaincode list -C mychannel --installed</span><br><span class="line">    ---</span><br><span class="line">    Get installed chaincodes on peer:</span><br><span class="line">    Name: commercialpaper, Version: 0, Path: github.com/chaincode/commercial_paper/go, Id: f033307bf72f876fb5a95883d53ed5209e6639386e21361eed65f459d8a9f276</span><br></pre></td></tr></table></figure></li></ol><span id="more"></span><ol><li><p>ç™»å…¥peer0.org1.example.com(å®¹å™¨cliå†…CORE_PEER_ADDRESS=peer0.org1.example.com:7051ï¼Œä¹Ÿå°±æ˜¯å…¶endorserèŠ‚ç‚¹)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- æ‰§è¡Œll var/hyperledger/production/chaincodesï¼Œå­˜åœ¨æ–‡ä»¶commercialpaper.0ï¼ˆå³$&#123;chaincodeName&#125;.$&#123;version&#125;ï¼‰</span><br><span class="line">- æ‰§è¡Œpeer chaincode list -C mychannel --installed</span><br><span class="line">    ---</span><br><span class="line">    Error: Bad response: 500 - access denied for [getinstalledchaincodes]: Failed verifying that proposal&#x27;s creator satisfies local MSP principal during channelless check policy with policy [Admins]: [This identity is not an admin]</span><br></pre></td></tr></table></figure><p> å®é™…ä¸Šï¼Œ<code>docker inspect peer0.org1.example.com</code>ï¼š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;HostConfig&quot;: &#123;</span><br><span class="line">    &quot;Binds&quot;: [</span><br><span class="line">        &quot;/Users/meitu/Project/github/fabric-samples/first-network/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls:rw&quot;,</span><br><span class="line">        &quot;/Users/meitu/Project/github/fabric-samples/first-network/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp:rw&quot;,</span><br><span class="line">        &quot;/var/run:/host/var/run:rw&quot;,</span><br><span class="line">        &quot;net_peer0.org1.example.com:/var/hyperledger/production:rw&quot;</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> æ²¡æœ‰å°†Admin@org1.example.com/mspæŒ‚è½½è¿›æ¥ï¼Œå½“ç„¶å¯ä»¥ä¿®æ”¹å¯åŠ¨é…ç½®æ–‡ä»¶<code>base/docker-compose-base.yaml</code>ï¼Œæˆ–è€…åç»­æ·»åŠ åˆ°æŒ‚è½½çš„volumeä¸Šï¼Œè®¾ç½®$CORE_PEER_MSPCONFIGPATHæŒ‡å‘æŒ‚è½½çš„è·¯å¾„ä¹Ÿå¯ä»¥èµ‹äºˆæƒé™è®¿é—®  </p></li><li><p>æŸ¥çœ‹<code>/fabric-samples/first-network/scripts/</code>è·¯å¾„ä¸‹<code>script.sh</code>å’Œ<code>util.sh</code>ï¼ŒåŒ…å«è®¾ç½®CORE_PEER_LOCALMSPID=(â€œOrg1MSPâ€/â€œOrg2MSPâ€)</p></li><li><p>cliæ‰§è¡Œ<code>chaincode instantiate</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode instantiate -n commercialpaper -v 0 -c &#x27;&#123;&quot;Args&quot;:[]&#125;&#x27; -C mychannel -P &quot;AND (&#x27;Org1MSP.member&#x27;)&quot; \</span><br><span class="line">--tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line"></span><br><span class="line">env</span><br><span class="line">---</span><br><span class="line">OLDPWD=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts</span><br><span class="line"></span><br><span class="line">peer0.org1.example.com:</span><br><span class="line">2019-10-22 14:28:19.931 UTC [endorser] callChaincode -&gt; INFO 1e62ef [mychannel][3156a1b7] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-10-22 14:28:19.936 UTC [endorser] callChaincode -&gt; INFO 1e630e [mychannel][3156a1b7] Exit chaincode: name:&quot;lscc&quot;  (5ms)</span><br><span class="line">2019-10-22 14:28:19.940 UTC [comm.grpc.server] 1 -&gt; INFO 1e631b unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T14:28:19.927Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:51012&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;12.4301ms&quot;&#125;</span><br><span class="line">2019-10-22 14:28:21.993 UTC [gossip.privdata] StoreBlock -&gt; INFO 1e647d [mychannel] Received block [5] from buffer</span><br><span class="line">2019-10-22 14:28:22.022 UTC [committer.txvalidator] Validate -&gt; INFO 1e64c9 [mychannel] Validated block [5] in 28ms</span><br><span class="line">2019-10-22 14:28:22.033 UTC [cceventmgmt] HandleStateUpdates -&gt; INFO 1e64db Channel [mychannel]: Handling deploy or update of chaincode [commercialpaper]</span><br><span class="line">2019-10-22 14:28:22.065 UTC [kvledger] CommitWithPvtData -&gt; INFO 1e6506 [mychannel] Committed block [5] with 1 transaction(s) in 40ms (state_validation=15ms block_commit=18ms state_commit=4ms)</span><br><span class="line">2019-10-22 14:28:31.257 UTC [endorser] callChaincode -&gt; INFO 1e6ed6 [mychannel][b206b359] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-10-22 14:28:31.262 UTC [endorser] callChaincode -&gt; INFO 1e6efc [mychannel][b206b359] Exit chaincode: name:&quot;lscc&quot;  (4ms)</span><br><span class="line">2019-10-22 14:28:31.263 UTC [comm.grpc.server] 1 -&gt; INFO 1e6f09 unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T14:28:31.255Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.4:55986&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;7.5554ms&quot;&#125;</span><br><span class="line"></span><br><span class="line">peer1.org1.example.com:</span><br><span class="line">2019-10-22 14:28:22.009 UTC [gossip.privdata] StoreBlock -&gt; INFO 1e0540 [mychannel] Received block [5] from buffer</span><br><span class="line">2019-10-22 14:28:22.011 UTC [committer.txvalidator] Validate -&gt; INFO 1e0588 [mychannel] Validated block [5] in 2ms</span><br><span class="line">2019-10-22 14:28:22.017 UTC [cceventmgmt] HandleStateUpdates -&gt; INFO 1e05a0 Channel [mychannel]: Handling deploy or update of chaincode [commercialpaper]</span><br><span class="line">2019-10-22 14:28:22.018 UTC [ccprovider] ExtractStatedbArtifactsForChaincode -&gt; INFO 1e05a3 Error while loading installation package for ccname=commercialpaper, ccversion=0. Err=open /var/hyperledger/production/chaincodes/commercialpaper.0: no such file or directory</span><br><span class="line">2019-10-22 14:28:22.018 UTC [cceventmgmt] HandleChaincodeDeploy -&gt; INFO 1e05a4 Channel [mychannel]: Chaincode [Name=commercialpaper, Version=0, Hash=[]byte&#123;0xf0, 0x33, 0x30, 0x7b, 0xf7, 0x2f, 0x87, 0x6f, 0xb5, 0xa9, 0x58, 0x83, 0xd5, 0x3e, 0xd5, 0x20, 0x9e, 0x66, 0x39, 0x38, 0x6e, 0x21, 0x36, 0x1e, 0xed, 0x65, 0xf4, 0x59, 0xd8, 0xa9, 0xf2, 0x76&#125;] is not installed hence no need to create chaincode artifacts for endorsement</span><br><span class="line">2019-10-22 14:28:22.041 UTC [kvledger] CommitWithPvtData -&gt; INFO 1e05c1 [mychannel] Committed block [5] with 1 transaction(s) in 27ms (state_validation=5ms block_commit=13ms state_commit=6ms)</span><br><span class="line"></span><br><span class="line">ordererï¼š</span><br><span class="line">2019-10-22 14:28:19.969 UTC [comm.grpc.server] 1 -&gt; INFO 027 streaming call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T14:28:19.947Z&quot;, &quot;grpc.service&quot;: &quot;orderer.AtomicBroadcast&quot;, &quot;grpc.method&quot;: &quot;Broadcast&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:53034&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;23.1002ms&quot;&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li>peer1.org1.example.comä¸Šæ²¡æœ‰installè¿™ä¸ªchaincode</li></ul><ol><li>cliæ‰§è¡Œ<code>peer chaincode invoke -c &#39;&#123;&quot;Args&quot;:[&quot;issue&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;, &quot;2020-05-31&quot;, &quot;2020-11-30&quot;, &quot;5000000&quot;]&#125;&#39; -C mychannel -n commercialpaper&quot;</code>ï¼Œå¤±è´¥ã€‚çœ‹æ—¥å¿—æ˜¯cliä¸ordererä¹‹é—´tlså¤±è´¥ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cli:</span><br><span class="line">Error: error sending transaction for invoke: could not send: EOF - proposal response: version:1 response:&lt;status:200 payload:&quot;&#123;\&quot;PaperNumber\&quot;:\&quot;00004\&quot;,\&quot;Issuer\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;Owner\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;IssueDateTime\&quot;:\&quot;2020-05-31\&quot;,\&quot;MaturityDateTime\&quot;:\&quot;2020-11-30\&quot;,\&quot;FaceValue\&quot;:5000000,\&quot;Status\&quot;:0&#125;&quot; &gt; payload:&quot;\n /!\373\020OI\024\270_1\267\251\332\337\037 $\370\347\356\004aEXZ\345\332/\366|&#x27;7\022\306\003\n\204\002\022\340\001\n\017commercialpaper\022\314\001\n\022\n\020MagnetoCorp00004\032\265\001\n\020MagnetoCorp00004\032\240\001&#123;\&quot;PaperNumber\&quot;:\&quot;00004\&quot;,\&quot;Issuer\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;Owner\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;IssueDateTime\&quot;:\&quot;2020-05-31\&quot;,\&quot;MaturityDateTime\&quot;:\&quot;2020-11-30\&quot;,\&quot;FaceValue\&quot;:5000000,\&quot;Status\&quot;:0&#125;\022\037\n\004lscc\022\027\n\025\n\017commercialpaper\022\002\010\005\032\246\001\010\310\001\032\240\001&#123;\&quot;PaperNumber\&quot;:\&quot;00004\&quot;,\&quot;Issuer\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;Owner\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;IssueDateTime\&quot;:\&quot;2020-05-31\&quot;,\&quot;MaturityDateTime\&quot;:\&quot;2020-11-30\&quot;,\&quot;FaceValue\&quot;:5000000,\&quot;Status\&quot;:0&#125;\&quot;\024\022\017commercialpaper\032\0010&quot; endorsement:&lt;endorser:&quot;\n\007Org1MSP\022\252\006-----BEGIN CERTIFICATE-----\nMIICKDCCAc6gAwIBAgIQbaczcznil/PbPlby6iZKsjAKBggqhkjOPQQDAjBzMQsw\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\nYW5jaXNjbzEZMBcGA1UEChMQb3JnMS5leGFtcGxlLmNvbTEcMBoGA1UEAxMTY2Eu\nb3JnMS5leGFtcGxlLmNvbTAeFw0xOTEwMjIwODU0MDBaFw0yOTEwMTkwODU0MDBa\nMGoxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1T\nYW4gRnJhbmNpc2NvMQ0wCwYDVQQLEwRwZWVyMR8wHQYDVQQDExZwZWVyMC5vcmcx\nLmV4YW1wbGUuY29tMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAESYh6SwhdBrUf\nsekjyFVukFQXI4q5O4DCnaTwARTlHffruISr0wnM1UkCI/OlrApnr/1Y3jagLiko\nkgwZbeVrgqNNMEswDgYDVR0PAQH/BAQDAgeAMAwGA1UdEwEB/wQCMAAwKwYDVR0j\nBCQwIoAgnPSDYZGp0kd3Lamn88Z/R0vxSeMxwJp/FKSVeVOsmsMwCgYIKoZIzj0E\nAwIDSAAwRQIhAO3ASI59+lSdlcY9RgDUlRWMe3qzXwI870wWI+ozpscLAiBf4MIV\nUcGoLpoB5GPnRxOY++CabOCmYDBZMfYAE+SKlA==\n-----END CERTIFICATE-----\n&quot; signature:&quot;0E\002!\000\257D\303\234\024\210C&gt;\203\215-\204\257 \304*\367sL9\223\207\233\312\351\277\270LR\231\236&amp;\002 )\331\334\006\025\214\337\355\262\252\305\345\214\315ae\3527\317y\274\336\352oX\037F\220\3036%\025&quot; &gt;</span><br><span class="line"></span><br><span class="line">orderer: </span><br><span class="line">2019-10-22 15:58:14.380 UTC [core.comm] ServerHandshake -&gt; ERRO 034 TLS handshake failed with error tls: first record does not look like a TLS handshake &#123;&quot;server&quot;: &quot;Orderer&quot;, &quot;remote address&quot;: &quot;172.25.0.7:53104&quot;&#125;</span><br><span class="line">2019-10-22 15:58:15.383 UTC [core.comm] ServerHandshake -&gt; ERRO 035 TLS handshake failed with error tls: first record does not look like a TLS handshake &#123;&quot;server&quot;: &quot;Orderer&quot;, &quot;remote address&quot;: &quot;172.25.0.7:53106&quot;&#125;</span><br><span class="line"></span><br><span class="line">peer0.org1.example.com:</span><br><span class="line">2019-10-22 15:58:15.391 UTC [endorser] callChaincode -&gt; INFO 2c3af6 [mychannel][89d96407] Entry chaincode: name:&quot;commercialpaper&quot;</span><br><span class="line">2019-10-22 15:58:15.398 UTC [endorser] callChaincode -&gt; INFO 2c3b04 [mychannel][89d96407] Exit chaincode: name:&quot;commercialpaper&quot;  (7ms)</span><br><span class="line">2019-10-22 15:58:15.398 UTC [comm.grpc.server] 1 -&gt; INFO 2c3b11 unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T15:58:15.389Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:51082&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;9.4211ms&quot;&#125;</span><br></pre></td></tr></table></figure></li><li>cliæ‰§è¡Œ<code>chaincode invoke</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -c &#x27;&#123;&quot;Args&quot;:[&quot;issue&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;, &quot;2020-05-31&quot;, &quot;2020-11-30&quot;, &quot;5000000&quot;]&#125;&#x27; -C mychannel -n commercialpaper \</span><br><span class="line">--tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line"></span><br><span class="line">cli:</span><br><span class="line">2019-10-22 15:55:07.564 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 0c9 Chaincode invoke successful. result: status:200 payload:&quot;&#123;\&quot;PaperNumber\&quot;:\&quot;00003\&quot;,\&quot;Issuer\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;Owner\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;IssueDateTime\&quot;:\&quot;2020-05-31\&quot;,\&quot;MaturityDateTime\&quot;:\&quot;2020-11-30\&quot;,\&quot;FaceValue\&quot;:5000000,\&quot;Status\&quot;:0&#125;&quot;</span><br><span class="line"></span><br><span class="line">peer0.org1.example.com:</span><br><span class="line">2019-10-22 15:55:07.497 UTC [endorser] callChaincode -&gt; INFO 2ba6d0 [][7b225797] Entry chaincode: name:&quot;cscc&quot;</span><br><span class="line">2019-10-22 15:55:07.502 UTC [endorser] callChaincode -&gt; INFO 2ba6ec [][7b225797] Exit chaincode: name:&quot;cscc&quot;  (5ms)</span><br><span class="line">2019-10-22 15:55:07.502 UTC [comm.grpc.server] 1 -&gt; INFO 2ba6ef unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T15:55:07.494Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:51076&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;7.6522ms&quot;&#125;</span><br><span class="line">2019-10-22 15:55:07.553 UTC [endorser] callChaincode -&gt; INFO 2ba716 [mychannel][443bff3e] Entry chaincode: name:&quot;commercialpaper&quot;</span><br><span class="line">2019-10-22 15:55:07.557 UTC [endorser] callChaincode -&gt; INFO 2ba724 [mychannel][443bff3e] Exit chaincode: name:&quot;commercialpaper&quot;  (4ms)</span><br><span class="line">2019-10-22 15:55:07.559 UTC [comm.grpc.server] 1 -&gt; INFO 2ba731 unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T15:55:07.545Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:51076&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;14.7305ms&quot;&#125;</span><br><span class="line">2019-10-22 15:55:09.574 UTC [gossip.privdata] StoreBlock -&gt; INFO 2ba941 [mychannel] Received block [8] from buffer</span><br><span class="line">2019-10-22 15:55:09.584 UTC [committer.txvalidator] Validate -&gt; INFO 2ba96b [mychannel] Validated block [8] in 9ms</span><br><span class="line">2019-10-22 15:55:09.619 UTC [kvledger] CommitWithPvtData -&gt; INFO 2ba99e [mychannel] Committed block [8] with 1 transaction(s) in 33ms (state_validation=19ms block_commit=7ms state_commit=5ms)</span><br><span class="line"></span><br><span class="line">orderer:</span><br><span class="line">2019-10-22 15:55:07.569 UTC [orderer.common.broadcast] Handle -&gt; WARN 032 Error reading from 172.25.0.7:53098: rpc error: code = Canceled desc = context canceled</span><br><span class="line">2019-10-22 15:55:07.569 UTC [comm.grpc.server] 1 -&gt; INFO 033 streaming call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T15:55:07.545Z&quot;, &quot;grpc.service&quot;: &quot;orderer.AtomicBroadcast&quot;, &quot;grpc.method&quot;: &quot;Broadcast&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:53098&quot;, &quot;error&quot;: &quot;rpc error: code = Canceled desc = context canceled&quot;, &quot;grpc.code&quot;: &quot;Canceled&quot;, &quot;grpc.call_duration&quot;: &quot;24.1982ms&quot;&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><p>ä»peer0.org1.example.comæ—¥å¿—å¯è§ï¼Œå…ˆåè°ƒç”¨äº†csccï¼ˆsystem chaincodeã€‚ è°ƒç”¨GetConfigBlockæ–¹æ³•ï¼Œè·å–channel configï¼Œä»è€Œè·å–ordereråœ°å€æä¾›ç»™cliå»ºç«‹orderer clientï¼‰å’Œcommercialpaperã€‚åç»­æ”¶åˆ°ordererä¼ æ¥çš„blockåå†éªŒè¯å’Œæäº¤æœ¬åœ°ã€‚</p></li><li><p><code>docker network inspect net_byfn</code>,å‘ç° 172.25.0.7 &lt;-&gt; cli<br>ç™»å…¥cliï¼Œ<code>netstat -anp</code>å¦‚ä¸‹ã€‚ä¼°è®¡æ˜¯ç«¯å£è¿‡æ—©å…³é—­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 127.0.0.11:35373        0.0.0.0:*               LISTEN      -</span><br><span class="line">udp        0      0 127.0.0.11:36128        0.0.0.0:*</span><br></pre></td></tr></table></figure></li></ul><ol><li><p>peer0.org1.example.com/cliæ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode list -C mychannel --instantiated</span><br><span class="line">---</span><br><span class="line">Get instantiated chaincodes on channel mychannel:</span><br><span class="line">Name: commercialpaper, Version: 0, Path: github.com/chaincode/commercial_paper/go, Escc: escc, Vscc: vscc</span><br></pre></td></tr></table></figure></li><li><p>cliæ‰§è¡Œ<code>chaincode query</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -c &#x27;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;]&#125;&#x27; -C mychannel -n commercialpaper</span><br></pre></td></tr></table></figure></li><li><p>å½“å‰commeicialpaperåªinstallåœ¨peer0.org1.example.comï¼Œæ­¤æ—¶cliæ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CORE_PEER_ADDRESS=peer1.org1.example.com:8051</span><br><span class="line">peer chaincode query -c &#x27;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;]&#125;&#x27; -C mychannel -n commercialpaper</span><br><span class="line">---</span><br><span class="line">Error: endorsement failure during query. response: status:500 message:&quot;cannot retrieve package for chaincode commercialpaper/0, error open /var/hyperledger/production/chaincodes/commercialpaper.0: no such file or directory&quot;</span><br></pre></td></tr></table></figure></li><li><p>cliåœ¨peer1.org1.example.com:8051ä¸Š<code>chaincode install</code>ï¼Œå¹¶ä¸”<code>chaincode query</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -c &#x27;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;]&#125;&#x27; -C mychannel -n commercialpaper \</span><br><span class="line">--peerAddresses peer1.org1.example.com:8051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.crt</span><br><span class="line">æˆ–è€…ï¼ˆ`CORE_PEER_TLS_ROOTCERT_FILE`å¯ä¸ä¿®æ”¹ï¼Œå› ä¸ºåŒorgç›¸åŒçš„caè¯ä¹¦ï¼‰</span><br><span class="line">CORE_PEER_ADDRESS=peer1.org1.example.com:8051</span><br><span class="line">CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt</span><br><span class="line">peer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go</span><br><span class="line">peer chaincode query -c &#x27;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;]&#125;&#x27; -C mychannel -n commercialpaper</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">&#123;&quot;PaperNumber&quot;:&quot;00001&quot;,&quot;Issuer&quot;:&quot;MagnetoCorp&quot;,&quot;Owner&quot;:&quot;MagnetoCorp&quot;,&quot;IssueDateTime&quot;:&quot;2020-05-31&quot;,&quot;MaturityDateTime&quot;:&quot;2020-11-30&quot;,&quot;FaceValue&quot;:5000000,&quot;Status&quot;:0&#125;</span><br><span class="line"></span><br><span class="line">peer1.org1.example.com:</span><br><span class="line">2019-10-23 04:43:39.847 UTC [endorser] callChaincode -&gt; INFO 5078dd [][e21cf78b] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-10-23 04:43:39.891 UTC [lscc] executeInstall -&gt; INFO 5078ea Installed Chaincode [commercialpaper] Version [0] to peer</span><br><span class="line">2019-10-23 04:43:39.892 UTC [endorser] callChaincode -&gt; INFO 5078ee [][e21cf78b] Exit chaincode: name:&quot;lscc&quot;  (45ms)</span><br><span class="line">2019-10-23 04:43:39.892 UTC [comm.grpc.server] 1 -&gt; INFO 5078f1 unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-23T04:43:39.846Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:50220&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;46.0634ms&quot;&#125;</span><br><span class="line">2019-10-23 04:43:54.861 UTC [endorser] callChaincode -&gt; INFO 5084f7 [mychannel][b060b92a] Entry chaincode: name:&quot;commercialpaper&quot;</span><br><span class="line">2019-10-23 04:43:54.914 UTC [chaincode.platform.golang] GenerateDockerBuild -&gt; INFO 508508 building chaincode with ldflagsOpt: &#x27;-ldflags &quot;-linkmode external -extldflags &#x27;-static&#x27;&quot;&#x27;</span><br><span class="line">2019-10-23 04:44:19.578 UTC [endorser] callChaincode -&gt; INFO 509732 [mychannel][b060b92a] Exit chaincode: name:&quot;commercialpaper&quot;  (24751ms)</span><br><span class="line">2019-10-23 04:44:19.581 UTC [comm.grpc.server] 1 -&gt; INFO 50973f unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-23T04:43:54.857Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:50224&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;24.7588062s&quot;&#125;</span><br><span class="line"></span><br><span class="line">ordereræ—¥å¿—æ— å˜åŒ–</span><br></pre></td></tr></table></figure></li></ol><ul><li><p>æ­¤æ—¶<code>docker ps</code>ï¼Œæ–°å¯åŠ¨äº†å®¹å™¨<code>dev-peer1.org1.example.com-commercialpaper-0</code>ã€‚</p><blockquote><p><strong><em>Fabric Documents</em></strong>: If you want additional peers to interact with ledger, then you will need to join them to the channel, and install the same name, version and language of the chaincode source onto the appropriate peerâ€™s filesystem. <strong>A chaincode container will be launched for each peer as soon as they try to interact with that specific chaincode.</strong> Again, be cognizant of the fact that the Node.js images will be slower to compile.</p></blockquote></li></ul><ol><li>ä»¥ä¸‹å¯¹peer0.org2.example.comèŠ‚ç‚¹é‡å¤å®éªŒï¼ˆä»å±ä¸åŒçš„orgï¼‰ã€‚åœ¨cliå®¹å™¨install/invoke chaincodeã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go \ </span><br><span class="line">--peerAddresses peer0.org2.example.com:9051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt</span><br><span class="line">* æŒ‡å®š--peerAddresseså’Œ--tlsRootCertFileså‚æ•°ã€‚æˆ–è€…ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼ˆå¯¹åº”å…³ç³»ï¼‰</span><br><span class="line">CORE_PEER_ADDRESS=peer0.org2.example.com:9051</span><br><span class="line">CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">peer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go</span><br><span class="line"></span><br><span class="line">---æŠ¥é”™</span><br><span class="line">Error: error getting channel (mychannel) orderer endpoint: error endorsing GetConfigBlock: rpc error: code = Unknown desc = access denied: channel [] creator org [Org1MSP]</span><br></pre></td></tr></table></figure></li></ol><ul><li>è¿™æ˜¯å› ä¸º<code>CORE_PEER_LOCALMSPID</code>å’Œ<code>CORE_PEER_MSPCONFIGPATH</code>è¿™ä¸¤ä¸ªå‚æ•°çš„è®¾ç½®ä½¿å½“å‰cliçš„mspè¯ä¹¦ä»å±äºOrg1ã€‚ä¿®æ”¹ä½¿ç”¨Org2çš„mspä»¥åŠAdminæˆ–è€…Userè§’è‰²å³å¯<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp</span><br><span class="line">peer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go \ </span><br><span class="line">--peerAddresses peer0.org2.example.com:9051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/</span><br></pre></td></tr></table></figure></li></ul><h4 id="Ref"><a href="#Ref" class="headerlink" title="Ref."></a>Ref.</h4><blockquote><p><a href="https://www.ibm.com/developerworks/cn/cloud/library/cl-lo-hyperledger-fabric-practice-analysis/index.html?ca=drs-#icomments">åˆ†æ­¥è¯¦è§£ Fabric åŒºå—é“¾ç½‘ç»œçš„éƒ¨ç½²</a> : IBMå‘˜å·¥ï¼Œç›¸å½“æ£’çš„ç³»åˆ—å®è·µæ–‡ç« </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4 chaincode lifecycle(install &amp; instantiate)</title>
      <link href="//articles/fabric-chaincode-lifecycle-uml/"/>
      <url>//articles/fabric-chaincode-lifecycle-uml/</url>
      
        <content type="html"><![CDATA[<p>chaincode install &amp; instantiateçš„å¤§è‡´æµç¨‹ï¼Œå…¶ä¸­installæ— éœ€orderæµç¨‹ã€‚å…·ä½“ç»†èŠ‚å¯å‚è€ƒä¹‹å‰çš„æºç åˆ†æç³»åˆ—ã€‚</p><p><img src="/images/chaincode-lifecycle-uml.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - ordererçš„raftå®ç°</title>
      <link href="//articles/fabric-source-orderer-etcdraft/"/>
      <url>//articles/fabric-source-orderer-etcdraft/</url>
      
        <content type="html"><![CDATA[<p>Raftå¯ä»¥è¯´æ˜¯Fabric 1.Xç³»åˆ—çš„é¦–ä¸ªçœŸæ­£æ„ä¹‰çš„å…±è¯†ç®—æ³•ã€‚Fabricçš„å®ç°ä¸»è¦æ¶‰åŠåˆ°ä¸‰ä¸ªç±»ï¼Œ<code>chain.go &lt;-&gt; etcdraft/node.go &lt;-&gt; raft/node.go</code>, å…¶ä¸­<code>raft/node.go</code>æ˜¯etcdçš„å¼€æºåŒ…ï¼Œ<code>chain.go</code>æ˜¯å®ç°å…±è¯†ç®—æ³•çš„ä¸»è¦ç±»ï¼Œ<code>etcdraft/node.go</code>åˆ™æ˜¯ç›¸å½“äºé€‚é…æ¨¡å¼ä¸‹çš„é€‚é…å™¨ï¼Œç”¨äºè¿æ¥ä¸¤è€…ï¼Œå¯¹å®ç°å±è”½Raftçš„å…·ä½“å®ç°æ–¹æ¡ˆã€‚</p><span id="more"></span><p>é¦–å…ˆçœ‹<code>chain.go</code>çš„structï¼ˆç•¥å»éƒ¨åˆ†fieldï¼‰ï¼ŒåŒ…å«<code>etcdraft/node.go</code>å¯¹è±¡ã€‚è°ƒç”¨<code>chain.go#Start</code>æ–¹æ³•æ—¶ï¼ˆçœç•¥ï¼‰ï¼Œå†…éƒ¨è°ƒç”¨äº†<code>etcdraft/node.go#start</code>æ–¹æ³•ã€‚<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Chain <span class="keyword">struct</span> {</span><br><span class="line">    rpc RPC</span><br><span class="line"></span><br><span class="line">    raftID    <span class="keyword">uint64</span></span><br><span class="line">    channelID <span class="keyword">string</span></span><br><span class="line">    lastKnownLeader <span class="keyword">uint64</span></span><br><span class="line"></span><br><span class="line">    submitC  <span class="keyword">chan</span> *submit</span><br><span class="line">    applyC   <span class="keyword">chan</span> apply</span><br><span class="line">    observeC <span class="keyword">chan</span>&lt;- raft.SoftState <span class="comment">// Notifies external observer on leader change (passed in optionally as an argument for tests)</span></span><br><span class="line">    snapC    <span class="keyword">chan</span> *raftpb.Snapshot <span class="comment">// Signal to catch up with snapshot</span></span><br><span class="line">    gcC      <span class="keyword">chan</span> *gc              <span class="comment">// Signal to take snapshot</span></span><br><span class="line"></span><br><span class="line">    configInflight       <span class="keyword">bool</span> <span class="comment">// this is true when there is config block or ConfChange in flight</span></span><br><span class="line">    blockInflight        <span class="keyword">int</span>  <span class="comment">// number of in flight blocks</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// needed by snapshotting</span></span><br><span class="line">    sizeLimit        <span class="keyword">uint32</span> <span class="comment">// SnapshotIntervalSize in bytes</span></span><br><span class="line">    accDataSize      <span class="keyword">uint32</span> <span class="comment">// accumulative data size since last snapshot</span></span><br><span class="line">    lastSnapBlockNum <span class="keyword">uint64</span></span><br><span class="line">    confState        raftpb.ConfState <span class="comment">// Etcdraft requires ConfState to be persisted within snapshot</span></span><br><span class="line"></span><br><span class="line">    createPuller CreateBlockPuller <span class="comment">// func used to create BlockPuller on demand</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// this is exported so that test can use `Node.Status()` to get raft node status.</span></span><br><span class="line">    Node *node</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start instructs the orderer to begin serving the chain and keep it current.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Chain)</span> <span class="title">Start</span><span class="params">()</span></span> {</span><br><span class="line">    c.Node.start(c.fresh, isJoin)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å“åº”c.gcC channelçš„ä¿¡å·ï¼Œè¿›è¡Œc.Node.takeSnapshotæ“ä½œï¼Œå¹¶ä¸”å°†è¿‡æœŸçš„å¯é…ç½®ä¸ªæ•°å‰çš„æ¶ˆæ¯å’Œsnapshotæ¸…ç©º</span></span><br><span class="line">    <span class="keyword">go</span> c.gc()</span><br><span class="line">    <span class="keyword">go</span> c.serveRequest()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    es := c.newEvictionSuspector()</span><br><span class="line">    interval := DefaultLeaderlessCheckInterval</span><br><span class="line">    c.periodicChecker.Run()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> node <span class="keyword">struct</span> {</span><br><span class="line">    chainID <span class="keyword">string</span></span><br><span class="line">    storage *RaftStorage    <span class="comment">// raftçš„wal, ramç­‰æŒä¹…åŒ–æˆ–è€…æš‚å­˜å†…å­˜å®ç°ç±»</span></span><br><span class="line">    config  *raft.Config</span><br><span class="line">    rpc RPC     <span class="comment">// è´Ÿè´£èŠ‚ç‚¹é—´çš„grpcé€šä¿¡ï¼Œç®¡ç†ä¸å„ä¸ªèŠ‚ç‚¹çš„grpc client/stream</span></span><br><span class="line">    chain *Chain</span><br><span class="line">    raft.Node   <span class="comment">// å¼€æºåº“etcdçš„raftèŠ‚ç‚¹å®ç°</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><code>etcdraft/node.go#run</code>æ˜¯å…¶ä¸»è¦é€»è¾‘ã€‚(ä»¥ä¸‹æˆªå–å±•ç¤ºéƒ¨åˆ†é€»è¾‘)ã€‚å®é™…ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œå¼€æºåº“etcdçš„raftèŠ‚ç‚¹å®ç°åªç®¡ç†raftç›¸å…³çš„propose, commit, electionç­‰è¿‡ç¨‹ï¼Œè€ŒæŠŠå…¶ä»–çš„ä¸šåŠ¡ç›¸å…³ç•™ç»™ä½¿ç”¨æ–¹ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹é—´é€šä¿¡ç­‰ã€‚<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> {</span><br><span class="line">    <span class="comment">//// nä¸ºæ¥è‡ªå¼€æºåº“etcdçš„raftèŠ‚ç‚¹raft.Nodeï¼Œé€šçŸ¥æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">case</span> rd := &lt;-n.Ready():</span><br><span class="line">        <span class="comment">// wal </span></span><br><span class="line">        <span class="keyword">if</span> err := n.storage.Store(rd.Entries, rd.HardState, rd.Snapshot); err != <span class="literal">nil</span> {</span><br><span class="line">            n.logger.Panicf(<span class="string">"Failed to persist etcd/raft data: %s"</span>, err)</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½åå’Œæ–°åŠ å…¥èŠ‚ç‚¹éœ€è¦åŒæ­¥çš„snapshot</span></span><br><span class="line">        <span class="keyword">if</span> !raft.IsEmptySnap(rd.Snapshot) {</span><br><span class="line">            n.chain.snapC &lt;- &amp;rd.Snapshot</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// skip empty applyã€‚ æ¥è‡ªraftèŠ‚ç‚¹çš„æ–°æ¶ˆæ¯ï¼ˆæè®®çš„æäº¤ä¿¡æ¯rd.CommittedEntriesï¼Œæˆ–è€…çŠ¶æ€å˜æ¢rd.SoftStateï¼Œå¦‚æ–°leaderï¼ŒèŠ‚ç‚¹æ•°é‡å˜åŒ–ç­‰ç­‰ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(rd.CommittedEntries) != <span class="number">0</span> || rd.SoftState != <span class="literal">nil</span> {</span><br><span class="line">            n.chain.applyC &lt;- apply{rd.CommittedEntries, rd.SoftState}</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        n.Advance()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO(jay_guo) leader can write to disk in parallel with replicating to the followers and them writing to their disks. Check 10.2.1 in thesis</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨rpc RPCï¼Œäº¤ç”±ç®¡ç†çš„grpc clientå‘é€</span></span><br><span class="line">        n.send(rd.Messages)</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><p></p><p>Ordereræ¶ˆæ¯çš„å…¥å£è¿˜æ˜¯<code>chain.go#Order</code>å’Œ<code>chain.go#Configure</code>ï¼Œå®é™…ä¸Šæœ€åè°ƒç”¨<code>chain.go#Submit</code>ï¼Œå…¶å¦‚æ³¨é‡Šæ‰€è¯´ï¼Œå¦‚æœæœ¬èŠ‚ç‚¹æ˜¯leaderåˆ™å‘é€åˆ°submitC channelå†…ï¼Œå¦åˆ™é€šè¿‡rpcå‘é€åˆ°leaderèŠ‚ç‚¹ã€‚<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Submit forwards the incoming request to:</span></span><br><span class="line"><span class="comment">// - the local serveRequest goroutine if this is leader</span></span><br><span class="line"><span class="comment">// - the actual leader via the transport mechanism</span></span><br><span class="line"><span class="comment">// The call fails if there's no leader elected yet.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Chain)</span> <span class="title">Submit</span><span class="params">(req *orderer.SubmitRequest, sender <span class="keyword">uint64</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">    leadC := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">uint64</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> c.submitC &lt;- &amp;submit{req, leadC}:</span><br><span class="line">        lead := &lt;-leadC</span><br><span class="line">        <span class="keyword">if</span> lead != c.raftID {</span><br><span class="line">            <span class="keyword">if</span> err := c.rpc.SendSubmit(lead, req); err != <span class="literal">nil</span> {</span><br><span class="line">                c.Metrics.ProposalFailures.Add(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> err</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>chain.go</code>çš„è¿è¡Œä¸»ä½“åœ¨<code>chain.go#serveRequest</code>ï¼Œå…¶ä¸­ä¸»è¦æ˜¯<code>select</code>ã€‚<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> {</span><br><span class="line">    <span class="comment">// æ¥è‡ªäº`chain.go#Submit`ï¼Œä¹Ÿå°±æ˜¯æäº¤çš„proposalï¼Œè¿™é‡Œä¸»è¦æ˜¯åˆ¤æ–­å½“å‰æ˜¯leaderæ‰ä¼šè¿›è¡Œproposeã€‚</span></span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯leaderï¼Œåˆ™è°ƒç”¨`consensus.ConsenterSupport#ProcessConfigMsg/ProcessNormalMsg`ï¼Œç„¶åè°ƒç”¨`support.BlockCutter().Ordered`åˆ‡å‰²batchã€‚</span></span><br><span class="line">    <span class="comment">// å¯¹åˆ‡å‰²åè¿˜æœ‰pendingçš„æ¶ˆæ¯å¯åŠ¨timerï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„`&lt;-timer.C():`åˆ†æ”¯ï¼Œåˆ°æœŸååœ¨è¿›è¡Œåˆ‡å‰²ã€‚</span></span><br><span class="line">    <span class="keyword">case</span> s := &lt;-submitC:</span><br><span class="line">        <span class="comment">// ä¸ordererçš„å…¶ä»–å®ç°ä¸€è‡´ï¼Œå¯å‚è€ƒ[Fabric 1.4æºç åˆ†æ - chaincode instantiate(8ï¼‰ordererçš„æ’åºè¿‡ç¨‹]</span></span><br><span class="line">        batches, pending, err := c.ordered(s.req)</span><br><span class="line">        <span class="keyword">if</span> pending {</span><br><span class="line">            startTimer() <span class="comment">// no-op if timer is already started</span></span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            stopTimer()</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        c.propose(propC, bc, batches...)</span><br><span class="line">    <span class="comment">// æ¥è‡ªä¸Šæ–‡æåˆ°çš„`etcdraft/node.go#run`ï¼Œä¹Ÿå°±æ˜¯å¼€æºåº“etcdçš„raftèŠ‚ç‚¹raft.Nodeçš„é€šçŸ¥æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">// è¿™éƒ¨åˆ†æ¶ˆæ¯å¯èƒ½åŒ…å«leaderçš„åˆ‡æ¢ï¼Œæœ€æ–°çš„è®°å½•åœ¨æ¶ˆæ¯çš„`chain.go/apply/raft.SoftState/Lead`å­—æ®µï¼Œè¿›è€Œç›¸åº”çš„`propC, cancelProp = becomeLeader()`æˆ–è€…`becomeFollower()`ã€‚</span></span><br><span class="line">    <span class="comment">// propCå³ä¸Šé¢çš„proposeæ–¹æ³•çš„å‚æ•°ï¼Œåœ¨becomeLeaderå†…å¤„ç†ï¼Œå³è°ƒç”¨`raft.go#Node.Propose`è¿›è¡Œpropose</span></span><br><span class="line">    <span class="keyword">case</span> app := &lt;-c.applyC:</span><br><span class="line">        <span class="comment">// è¿™é‡Œçš„entriesæ˜¯CommittedEntriesï¼Œå³éœ€è¦commitçš„entryï¼Œä¹Ÿå°±æ˜¯leaderå½“åˆproposeçš„block</span></span><br><span class="line">        <span class="comment">// n.chain.applyC &lt;- apply{rd.CommittedEntries, rd.SoftState}</span></span><br><span class="line">        c.apply(app.entries)</span><br><span class="line">    <span class="keyword">case</span> &lt;-timer.C():</span><br><span class="line">    <span class="comment">// snapC    chan *raftpb.Snapshot // Signal to catch up with snapshot</span></span><br><span class="line">    <span class="comment">// æ¥è‡ªäº`etcdraft/node.go#run`, select-caseçš„`rd := &lt;-n.Ready():`å†…`n.chain.snapC &lt;- &amp;rd.Snapshot`ï¼Œå³åº•å±‚raftçš„éœ€è¦åŒæ­¥çš„snapshotã€‚</span></span><br><span class="line">    <span class="comment">// ç”¨äºè½åæˆ–è€…æ–°åŠ å…¥çš„èŠ‚ç‚¹è¿½ä¸Šå½“å‰çš„æ¶ˆæ¯çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">case</span> sn := &lt;-c.snapC:</span><br><span class="line">        c.catchUp(sn); err != <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">case</span> &lt;-c.doneC:</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Chain)</span> <span class="title">propose</span><span class="params">(ch <span class="keyword">chan</span>&lt;- *common.Block, bc *blockCreator, batches ...[]*common.Envelope)</span></span> {</span><br><span class="line">    <span class="comment">// å¦‚æœå‰é¢è°ƒç”¨çš„c.ordered(s.req)åˆ‡å‰²å‡ºæ¥çš„batcheséç©ºï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°blockï¼Œå¹¶ä¸”åœ¨becomeLeaderé‡Œçš„propCé‡Œè°ƒç”¨c.Node.Propose()</span></span><br><span class="line">    <span class="keyword">for</span> _, batch := <span class="keyword">range</span> batches {</span><br><span class="line">        b := bc.createNextBlock(batch)</span><br><span class="line">        <span class="keyword">select</span> {</span><br><span class="line">        <span class="keyword">case</span> ch &lt;- b:</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// if it is config block, then we should wait for the commit of the block</span></span><br><span class="line">        <span class="keyword">if</span> utils.IsConfigBlock(b) {</span><br><span class="line">            c.configInflight = <span class="literal">true</span></span><br><span class="line">        }</span><br><span class="line">        c.blockInflight++</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">becomeLeader := <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(<span class="keyword">chan</span>&lt;- *common.Block, </span></span></span><br><span class="line"><span class="params"><span class="function">    // Leader should call Propose in <span class="keyword">go</span> routine, because this method may be blocked</span></span></span><br><span class="line"><span class="params"><span class="function">    // <span class="keyword">if</span> node is leaderless (this can happen when leader steps down in a heavily</span></span></span><br><span class="line"><span class="params"><span class="function">    // loaded network)</span>. <span class="title">We</span> <span class="title">need</span> <span class="title">to</span> <span class="title">make</span> <span class="title">sure</span> <span class="title">applyC</span> <span class="title">can</span> <span class="title">still</span> <span class="title">be</span> <span class="title">consumed</span> <span class="title">properly</span>.</span></span><br><span class="line">    ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, ch &lt;-<span class="keyword">chan</span> *common.Block)</span></span> {</span><br><span class="line">        <span class="keyword">for</span> {</span><br><span class="line">            <span class="keyword">select</span> {</span><br><span class="line">            <span class="keyword">case</span> b := &lt;-ch:</span><br><span class="line">                data := utils.MarshalOrPanic(b)</span><br><span class="line">                <span class="keyword">if</span> err := c.Node.Propose(ctx, data); err != ni</span><br><span class="line">                {...}</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }(ctx, ch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ch, cancel</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Chain)</span> <span class="title">apply</span><span class="params">(ents []raftpb.Entry)</span></span> {</span><br><span class="line">    <span class="keyword">var</span> position <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> ents {</span><br><span class="line">        <span class="keyword">switch</span> ents[i].Type {</span><br><span class="line">        <span class="comment">// è°ƒç”¨writeBlockï¼Œå°†commitEntryé‡Œçš„blockå†™å…¥è´¦æœ¬</span></span><br><span class="line">        <span class="comment">// accDataSizeæ˜¯ç´¯è®¡çš„blockæ•°æ®å¤§å°</span></span><br><span class="line">        <span class="keyword">case</span> raftpb.EntryNormal:</span><br><span class="line">            position = i</span><br><span class="line">            c.accDataSize += <span class="keyword">uint32</span>(<span class="built_in">len</span>(ents[i].Data))</span><br><span class="line">            block := utils.UnmarshalBlockOrPanic(ents[i].Data)</span><br><span class="line">            c.writeBlock(block, ents[i].Index)</span><br><span class="line">        <span class="keyword">case</span> raftpb.EntryConfChange:</span><br><span class="line">            ...</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> ents[i].Index &gt; c.appliedIndex {</span><br><span class="line">            c.appliedIndex = ents[i].Index</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// accDataSizeæ˜¯ç´¯è®¡çš„blockæ•°æ®å¤§å°ï¼Œå¤§äºé…ç½®çš„sizeLimitåï¼Œå†™å…¥c.gcC channel,åœ¨`chain.go#gc`å†…å¤„ç†c.Node.takeSnapshot</span></span><br><span class="line">    <span class="keyword">if</span> c.accDataSize &gt;= c.sizeLimit {</span><br><span class="line">        b := utils.UnmarshalBlockOrPanic(ents[position].Data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">select</span> {</span><br><span class="line">        <span class="keyword">case</span> c.gcC &lt;- &amp;gc{index: c.appliedIndex, state: c.confState, data: ents[position].Data}:</span><br><span class="line">            c.accDataSize = <span class="number">0</span></span><br><span class="line">            c.lastSnapBlockNum = b.Header.Number</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br><code>chain.go#gc</code><br><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Chain)</span> <span class="title">gc</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">for</span> {</span><br><span class="line">        <span class="keyword">select</span> {</span><br><span class="line">        <span class="keyword">case</span> g := &lt;-c.gcC:</span><br><span class="line">            c.Node.takeSnapshot(g.index, g.state, g.data)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>æ€»ä½“æ¶æ„æµç¨‹å¦‚ä¸Šï¼Œå…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒä»¥ä¸‹ï¼Œè¿™äº›å‚è€ƒæ¯”è¾ƒè¯¦ç»†éƒ½æè¿°äº†å®ç°ç»†èŠ‚ã€‚</p><h4 id="Ref"><a href="#Ref" class="headerlink" title="Ref."></a>Ref.</h4><p><a href="https://www.jianshu.com/p/667c3cf7cb76">Hyperledger-Fabricæºç åˆ†æï¼ˆorderer-consensus-etcdraftï¼‰</a><br><a href="https://tinywell.com/2019/05/15/fabric-raft-source/">Fabric raft å…±è¯†æºç æµ…æ</a></p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bitcoinæ€§èƒ½æ‰©å®¹</title>
      <link href="//articles/bitcoin-performance-scaleup-concern/"/>
      <url>//articles/bitcoin-performance-scaleup-concern/</url>
      
        <content type="html"><![CDATA[<h3 id="åŒºå—å¤§å°æ‰©å®¹-Block-size"><a href="#åŒºå—å¤§å°æ‰©å®¹-Block-size" class="headerlink" title="åŒºå—å¤§å°æ‰©å®¹(Block size)"></a>åŒºå—å¤§å°æ‰©å®¹(Block size)</h3><p>æ¯”ç‰¹å¸å¼•å…¥1MBåŒºå—å¤§å°çš„èƒŒæ™¯æ˜¯å¤§é‡çš„ç²‰å°˜æ”»å‡»å¯¼è‡´åŒºå—å·¨å¤§ï¼ŒåŒºå—éœ€è¦åŒæ­¥çš„æ—¶é—´é•¿ï¼Œä»è€Œå¼•å‘DOSï¼ˆDenial of Serviceï¼‰ã€‚åŒæ—¶å…¨èŠ‚ç‚¹çš„å¸¦å®½ï¼Œå­˜å‚¨è¦æ±‚å¢é«˜ï¼Œå¯¼è‡´æ€§èƒ½ä¸è¶³çš„èŠ‚ç‚¹æ— æ³•åŠæ—¶ä¸ä¸»é“¾åŒæ­¥ã€‚</p><h4 id="Pros"><a href="#Pros" class="headerlink" title="Pros"></a>Pros</h4><ol><li>æé«˜TPS</li><li>æ›´å¤šçš„äº¤æ˜“å¾—åˆ°ç¡®è®¤ï¼ˆå½“å‰é™åˆ¶ä¸‹ï¼Œäº¤æ˜“æ‰‹ç»­è´¹ä½çš„è´¹ç”¨å¯èƒ½æ— æ³•å¾—åˆ°ç¡®è®¤ï¼‰</li></ol><h4 id="Cons"><a href="#Cons" class="headerlink" title="Cons"></a>Cons</h4><ol><li>èŠ‚ç‚¹æ€§èƒ½è¦æ±‚å¢é«˜å‡†å…¥é—¨æ§›æé«˜ï¼Œå¯¼è‡´ç½‘ç»œå…¨èŠ‚ç‚¹æ•°é‡å‡å°‘ï¼ŒæŒ–çŸ¿ä¸­å¿ƒåŒ–è¶‹åŠ¿</li><li>å‡çº§é…ç½®å¸¦æ¥çš„ç¡¬åˆ†å‰é£é™©</li><li>åŒºå—å…¨ç½‘åŒæ­¥æ—¶é—´å¢åŠ ï¼Œä¸Šä¸€ä¸ªåŒºå—çš„çŸ¿å·¥å‘¨å›´èŠ‚ç‚¹æ¯”ç½‘ç»œè¾¹ç¼˜èŠ‚ç‚¹ï¼ˆç›¸å¯¹çš„ï¼‰æ›´æ—©åŒæ­¥æ›´æ—©å¼€å§‹æŒ–çŸ¿ï¼Œä¸­å¿ƒåŒ–è¶‹åŠ¿ã€‚åŒæ—¶å‡ºå—æ—¶é—´ä¿æŒä¸å˜çš„å‰æä¸‹ï¼ˆåŒæ­¥æ—¶é—´å åŒºå—æ—¶é—´æ¯”é‡ä¸Šå‡ï¼‰ï¼Œä¼šå¢åŠ åˆ†å‰ï¼Œå­¤å—ï¼ˆstale blockï¼‰çš„å¯èƒ½æ€§ï¼Œä»¥åŠå¢åŠ äº¤æ˜“å›æ»šï¼ŒåŒèŠ±ç­‰é£é™©ã€‚ç±»ä¼¼çš„ï¼Œå‡å°åŒºå—æ—¶é—´æé«˜å‡ºå—é€Ÿåº¦ä¹Ÿé¢ä¸´è¿™ä¸ªé—®é¢˜ã€‚</li><li>å­˜åœ¨å…¶ä»–çš„æ€§èƒ½æå‡æ›¿ä»£æ–¹æ¡ˆï¼Œå¦‚éš”ç¦»è§è¯ï¼Œä¾§é“¾ç­‰</li></ol><span id="more"></span><h3 id="éš”ç¦»è§è¯ï¼ˆSegWitï¼‰"><a href="#éš”ç¦»è§è¯ï¼ˆSegWitï¼‰" class="headerlink" title="éš”ç¦»è§è¯ï¼ˆSegWitï¼‰"></a>éš”ç¦»è§è¯ï¼ˆSegWitï¼‰</h3><p>è¿™ä¸ªæ˜¯é’ˆå¯¹æ¯”ç‰¹å¸çš„æ”¹è¿›ï¼Œæå‡ºä¸»è¦æ˜¯è¦è§£å†³Transaction Malleabilityï¼ˆäº¤æ˜“å»¶å±•æ€§ï¼‰è¿™ä¸ªé—®é¢˜ã€‚ï¼ˆå› ä¸ºæ—©æœŸçš„transactionIdæ˜¯ç”±utxoçš„æ¥æºï¼Œç›®çš„ä»¥åŠç­¾åè®¡ç®—å¾—åˆ°çš„ã€‚æ ¹æ®å¯†ç å­¦çš„ç‰¹æ€§ï¼Œå¯ä»¥ä»ç­¾åé€šè¿‡è®¡ç®—å¾—åˆ°æ–°çš„çš„ç­¾åï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å¯†ç å­¦æ„ä¹‰ä¸Šæœ‰æ•ˆçš„ï¼ˆæ¯”å¦‚æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼ˆECDSAï¼‰ï¼Œè¿™ç§ç®—æ³•ä¸‹ç­¾åï¼ˆrï¼Œsï¼‰å’Œç­¾åï¼ˆrï¼Œ-s ï¼ˆmod nï¼‰ï¼‰éƒ½æ˜¯æœ‰æ•ˆçš„ï¼‰ã€‚å› æ­¤æ¶æ„èŠ‚ç‚¹å¯ä»¥ä»æ­£å¸¸äº¤æ˜“å¤åˆ¶å‡ºæ–°äº¤æ˜“ï¼Œç­¾åæœ‰æ•ˆï¼Œä»è€Œç”Ÿæˆæ–°çš„transactionIdã€‚å½“æ’¤å›å‰ä¸€ä¸ªäº¤æ˜“å†æ¢utxoè¾“å…¥é‡å‘æ—¶ï¼Œåä¸€ä¸ªäº¤æ˜“ä»ç„¶æ˜¯æœ‰æ•ˆçš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´é‡å¤è½¬è´¦çš„æ¬ºè¯ˆè¡Œä¸ºï¼‰ã€‚æ­¤å¤–ï¼Œç¬¬ä¸‰æ–¹å¢åŠ Push dataåˆ°éªŒè¯ä¿¡æ¯çš„èµ·å§‹ä½ç½®ï¼Œæ”¹å˜äº¤æ˜“ID(txid)åŒæ—¶éªŒè¯ç»“æœä¹Ÿé€šè¿‡ã€‚å› æ­¤ï¼Œå°†ç­¾åä¿¡æ¯ï¼ˆè§è¯ï¼‰ä»äº¤æ˜“æŠ½ç¦»å‡ºæ¥æ”¾åˆ°äº¤æ˜“çš„åé¢ï¼ˆé”å®šè„šæœ¬ï¼Œè¿™éƒ¨åˆ†æ˜¯ä¸åŒ…å«åœ¨1MBå—å¤§å°çš„è®¡ç®—é™åˆ¶é‡Œï¼‰ï¼Œå³Hashå‡ºæ¥çš„transactionIdæ˜¯ä¸åŒ…æ‹¬ç­¾åçš„ï¼Œè¿™æ—¶å°±æ— æ³•é€šè¿‡æ”¹å˜ç­¾åè®¡ç®—ç”Ÿæˆæ–°çš„äº¤æ˜“ã€‚<br><img src="/images/bitcoin-performance-scaleup-concern/bitcoin-segwit.png" alt=""></p><h4 id="Pros-1"><a href="#Pros-1" class="headerlink" title="Pros"></a>Pros</h4><ol><li>è§£å†³Transaction Malleabilityè¿™ä¸ªé—®é¢˜</li><li>é—ªç”µç½‘ç»œçš„æŠ€æœ¯åŸºç¡€</li><li>åŒºå—å¤§å°é™åˆ¶å¹¶æ²¡æœ‰æ‰“ç ´ï¼Œæ—§èŠ‚ç‚¹ä»ç„¶å¯ä»¥æ¥å—æ–°çš„å—æ ¼å¼ï¼ˆä¸€ä¸ªéš”ç¦»è§è¯çš„è¾“å‡ºçœ‹èµ·æ¥åƒä¸€ä¸ªä»»ä½•äººéƒ½èƒ½èŠ±è´¹çš„è¾“å‡ºï¼Œè¯¥è¾“å‡ºå¯ä»¥è¢«ä¸€ä¸ªç©ºçš„ç­¾åè§è¯ï¼Œæ‰€ä»¥ä¸€ä¸ªäº¤æ˜“é‡Œé¢æ²¡æœ‰ç­¾åï¼ˆç­¾åè¢«éš”ç¦»ï¼‰ä¹Ÿå¯ä»¥é€šè¿‡æ—§èŠ‚ç‚¹çš„éªŒè¯ï¼‰ã€‚åç›¸å…¼å®¹çš„è½¯åˆ†å‰ã€‚</li></ol><h4 id="Cons-1"><a href="#Cons-1" class="headerlink" title="Cons"></a>Cons</h4><ol><li>æ¯ç¬”äº¤æ˜“å¹³å‡250å­—èŠ‚ï¼Œè§è¯éƒ¨åˆ†çš„æ•°æ®çº¦ä¸º150å­—èŠ‚ã€‚è¿™æ ·ç›¸å½“äºå®é™…ä¸Šå¢å¤§äº†åŒºå—å¤§å°ï¼Œéš”ç¦»è§è¯çš„æ•´ä¸ªåŒºå—å¤§å°ä¸º2.5åˆ°3MBå·¦å³ã€‚å¢åŠ åŒºå—å®é™…å¤§å°å¸¦æ¥çš„é£é™©ä¾ç„¶å­˜åœ¨ï¼ˆå½“ç„¶ï¼Œä¹Ÿæœ‰é€šè¿‡å°†è§è¯ä¿¡æ¯æ”¾åœ¨ä¾§é“¾ä¸Šï¼Œäº¤æ˜“ä¸»é“¾é€šè¿‡å¼•ç”¨çš„æ–¹å¼ï¼‰ã€‚</li></ol><blockquote><p><a href="https://github.com/bitcoin/bips/blob/master/bip-0062.mediawiki">bips/bip-0062.mediawiki</a> ï¼šTransaction Malleabilityçš„å®˜æ–¹æ–‡æ¡£<br><a href="https://www.bitdegree.org/tutorials/what-is-segwit/">What is SegWit and How it Works Explained</a></p></blockquote><h3 id="ä¾§é“¾ï¼ˆSidechainï¼‰"><a href="#ä¾§é“¾ï¼ˆSidechainï¼‰" class="headerlink" title="ä¾§é“¾ï¼ˆSidechainï¼‰"></a>ä¾§é“¾ï¼ˆSidechainï¼‰</h3><p>ä¾§é“¾åªéœ€ç¬¦åˆä¾§é“¾åè®®ï¼Œèƒ½å¤Ÿä¸ä¸»é“¾è¿›è¡Œå®‰å…¨çš„èµ„äº§/æ•°æ®è½¬ç§»çš„éƒ½å¯ä»¥æˆä¸ºä¾§é“¾ï¼Œå¯ä»¥ä½œä¸ºäºŒå±‚ç½‘ç»œåˆ†æ‹…ä¸»é“¾ä¸Šçš„å‹åŠ›ï¼ˆä¾‹å¦‚æ¯”ç‰¹å¸é—ªç”µç½‘ç»œè¿›è¡Œç»“ç®—ï¼‰ï¼Œæˆ–è€…å®ç°æ›´å¤æ‚çš„é€»è¾‘åŠŸèƒ½ï¼Œå°†ä¸»é“¾ä½œä¸ºæœ€åçš„æ¸…ç®—é“¾ï¼Œå¦å¤–ä¹Ÿå¯ä»¥å®ç°å¼‚æ„é“¾é—´çš„èµ„äº§è½¬ç§»ã€‚å®ç°çš„æŠ€æœ¯åŸºç¡€æ˜¯åŒå‘é”šå®šï¼ˆTwo-way Pegï¼‰ï¼Œé€šè¿‡åŒå‘é”šå®šæŠ€æœ¯ï¼Œå¯ä»¥å®ç°æš‚æ—¶çš„å°†æ•°å­—èµ„äº§åœ¨ä¸»é“¾ä¸­é”å®šï¼ŒåŒæ—¶å°†ç­‰ä»·çš„æ•°å­—èµ„äº§åœ¨ä¾§é“¾ä¸­é‡Šæ”¾ï¼ŒåŒæ ·å½“ç­‰ä»·çš„æ•°å­—èµ„äº§åœ¨ä¾§é“¾ä¸­è¢«é”å®šçš„æ—¶å€™ï¼Œä¸»é“¾çš„æ•°å­—èµ„äº§ä¹Ÿå¯ä»¥è¢«é‡Šæ”¾ã€‚å…·ä½“æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œå¸¸è§çš„æ˜¯SPVï¼ˆSimplified Payment Verificationï¼‰ã€‚SPVä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªä¸œè¥¿, ç¬¬ä¸€ä¸ªæ˜¯Merkle Treeï¼Œå¦ä¸€ä¸ªæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰ã€‚è­¬å¦‚è¯´è½¬è´¦åwatch eventï¼Œå¦‚æœä¸åœ¨ä¹éšç§çš„è¯, å¯ä»¥ç›´æ¥å‘Šè¯‰å…¨èŠ‚ç‚¹æ‰€å…³æ³¨çš„åœ°å€å°±å¯ä»¥ï¼›ä½†æ˜¯å¦‚æœä¸æƒ³æš´éœ²éšç§, é‚£å°±æŠŠå…³æ³¨çš„ä¿¡æ¯æ˜ å°„åˆ°BFä¸Š, ç„¶åå…¨èŠ‚ç‚¹è¿”å›æ‰€æœ‰å‘½ä¸­BFçš„eventã€‚</p><p>åŒå‘é”šå®šåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p><ol><li>ç”¨æˆ·åœ¨ä¸»é“¾ä¸Šå°†æ•°å­—èµ„äº§å‘é€åˆ°ä¸»é“¾çš„ä¸€ä¸ªç‰¹æ®Šçš„åœ°å€ï¼ŒæŠŠæ•°å­—èµ„äº§é”å®šåœ¨ä¸»é“¾ä¸Šã€‚</li><li>è¯¥é”å®šä¼šç­‰å¾…ä¸€ä¸ªç¡®è®¤æœŸï¼Œç¡®è®¤æœŸçš„ä½œç”¨æ˜¯ç­‰å¾…é”å®šäº¤æ˜“è¢«æ›´å¤šåŒºå—ç¡®è®¤ï¼Œå¯é˜²æ­¢å‡å†’é”å®šäº¤æ˜“å’Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚</li><li>ç¡®è®¤æœŸç»“æŸåï¼Œç”¨æˆ·åœ¨ä¾§é“¾ä¸Šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„å¸¦æœ‰SPVè¯æ˜çš„äº¤æ˜“ï¼ŒåŒæ—¶éªŒè¯ä¸»é“¾ä¸Šçš„æ•°å­—èµ„äº§å·²ç»è¢«é”ä½ï¼Œç„¶åå°±å¯ä»¥åœ¨ä¾§é“¾ä¸Šæ‰“å¼€å…·æœ‰ç›¸åŒä»·å€¼çš„å¦ä¸€ç§æ•°å­—èµ„äº§ã€‚è¯¥äº¤æ˜“ç§°ä¸ºèµå›äº¤æ˜“ï¼ŒSPVå·¥ä½œé‡è¯æ˜æ˜¯æŒ‡èµå›äº¤æ˜“æ‰€åœ¨åŒºå—çš„å·¥ä½œé‡è¯æ˜ã€‚</li><li>å½“è¿™ç§æ•°å­—èµ„äº§è¿”å›åˆ°ä¸»é“¾ä¸Šæ—¶ï¼Œè¯¥è¿‡ç¨‹ä¼šè¿›è¡Œé‡å¤ã€‚å®ƒä»¬è¢«å‘é€åˆ°ä¾§é“¾ä¸Šé”å®šçš„è¾“å‡ºä¸­ï¼Œé”å®šä¸€ä¸ªç«äº‰æœŸï¼Œç«äº‰æœŸçš„ä½œç”¨æ˜¯é˜²æ­¢åŒèŠ±ã€‚ç„¶åå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªSPVè¯æ˜ï¼Œæ¥å°†å…¶å‘é€å›ä¸»åŒºå—é“¾ä¸Šï¼Œä»¥è§£é”ä¸»é“¾ä¸Šçš„æ•°å­—èµ„äº§ã€‚<br><img src="/images/bitcoin-performance-scaleup-concern/side-chain-two-way-peg.png" alt=""></li></ol><blockquote><p><a href="https://zhuanlan.zhihu.com/p/42769604">å…¨é¢ç†è§£åŒºå—é“¾ä¾§é“¾æŠ€æœ¯</a> ï¼š æåŠå¤šç§ä¾§é“¾å®ç°æ–¹å¼</p></blockquote><h4 id="é—ªç”µç½‘ç»œï¼ˆBitcoin-lightning-networkï¼‰"><a href="#é—ªç”µç½‘ç»œï¼ˆBitcoin-lightning-networkï¼‰" class="headerlink" title="é—ªç”µç½‘ç»œï¼ˆBitcoin lightning networkï¼‰"></a>é—ªç”µç½‘ç»œï¼ˆBitcoin lightning networkï¼‰</h4><p>åœ¨ä¾§é“¾å»ºç«‹ç‚¹å¯¹ç‚¹é€šé“channelï¼Œè¿›è¡Œå°é¢å’ŒæŒç»­å¤šæ¬¡çš„èµ„äº§å¾€æ¥ï¼Œç„¶åç­‰è¾¾æˆå…±è¯†åå…³é—­é€šé“ï¼Œå°†èµ„äº§åˆçº¦å‘ä¸»é“¾ä¸Šå®Œæˆç»“ç®—ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯æé«˜æ¬ºè¯ˆæˆæœ¬ï¼Œè¿›è¡Œæƒ©ç½šã€‚<br><img src="/images/bitcoin-performance-scaleup-concern/lightning-network.png" alt=""></p><p>å‚è€ƒ <a href="https://www.zhihu.com/question/46515457">ä»€ä¹ˆæ˜¯æ¯”ç‰¹å¸çš„é—ªç”µç½‘ç»œï¼Ÿ</a>ä¸€æ–‡ä¸­çš„ä¾‹å­ï¼Œåœ¨åŒæ–¹è¾¾æˆC2aå…±è¯†å(C1aå’ŒC2aå§‹ç»ˆç”±AliceæŒæœ‰ï¼Œè¾¾æˆc2aæ—¶Aliceéœ€è¦å°†Alice2ç§˜é’¥ç»™åˆ°Bobã€‚è¿™é‡ŒC1aåªæœ‰AliceæŒæœ‰ï¼Œå› æ­¤Bobå³ä½¿æ‹¥æœ‰Alcie2ç§˜é’¥ä¹Ÿæ— æ³•ç­¾å‘ç»è¿‡åŒæ–¹åŸå§‹ç§˜é’¥Aliceå’ŒBobç­¾åçš„åˆåŒ)ï¼Œè‹¥ç„¶Aliceå¹¿æ’­C1aå¹¶ä¸”å…³é—­é€šé“ï¼ˆä¸»åŠ¨å…³é—­é€šé“æ–¹éœ€è¦ç­‰å¾…æŒ‡å®šseqæ•°é‡çš„å—åæ‰èƒ½æ‰§è¡ŒRD1aï¼‰ï¼Œæ­¤æ—¶Bobç›‘æ§åˆ°Aliceå¹¿æ’­æ—§çš„åˆ†é…åˆçº¦(è¿™éœ€è¦BobèŠ‚ç‚¹åœ¨çº¿ï¼Œæˆ–è€…äº‹å…ˆæ„å»ºå¥½BR1aäº¤ä»˜ç»™ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹æˆ–è€…æœºå™¨äººåœ¨Aliceæ¬ºè¯ˆæ—¶è‡ªåŠ¨è§¦å‘)ï¼Œå¯ä»¥ä½¿ç”¨Alice2ç§˜é’¥å¯¹BR1aç­¾åå¹¶å¹¿æ’­ï¼Œè¿™ä¸ªæ˜¯æ— éœ€ç­‰å¾…å³æ—¶ç»“ç®—çš„ï¼Œæ‰€ä»¥åŸæœ¬å±äºAliceçš„éƒ½åˆ†é…ç»™Bobã€‚è¿™å°±æ˜¯æ¬ºè¯ˆä½œæ¶æˆæœ¬ã€‚</p><p>ä¹‹æ‰€ä»¥è¯´Segwitéš”ç¦»è§è¯æ˜¯é—ªç”µç½‘ç»œçš„åŸºç¡€ï¼Œæ˜¯å› ä¸ºFunding Txåªæœ‰åœ¨ç¬¬ä¸€ä¸ªCommitment Txå®Œæˆç­¾åå¹¶äº¤æ¢ä¹‹åï¼Œæ‰ä¼šç»§ç»­ç­¾åå’Œå¹¿æ’­ï¼ˆå¦åˆ™ï¼Œå¹¿æ’­Funding Txåè‹¥Bobæ‹’ç»æä¾›ç¬¬ä¸€ä¸ªCommitmentçš„ç­¾åï¼Œè¿™ç¬”èµ„é‡‘å°†è¢«æ°¸ä¹…é”å®šï¼Œæ— æ³•æ¶ˆè´¹ã€‚æ‹¥æœ‰Commitment Txåå¯ä»¥å¹¿æ’­èµå›ï¼‰ã€‚æ­¤æ—¶ç¬¬ä¸€ä¸ªCommitment Txæ¶ˆè´¹çš„Funding Txæœªæ›¾å¹¿æ’­å…¥é“¾ï¼Œå› æ­¤éœ€è¦ä¿è¯è¯¥Funding Txæœªè¢«ç¯¡æ”¹ï¼Œå³txidçš„å›ºå®šæ€§ã€‚</p><p>è€Œå¯¹äºå¤šæ–¹ä¸­è½¬äº¤æ˜“ï¼Œåœ¨ä¸Šæ–‡ä¸­æè¿°æœ‰è¯¯ã€‚æ ¹æ®<a href="https://www.youtube.com/watch?v=SUfBq2nwPek">Bitcoin Lightning Network Payment Channels Explained - Thaddeus Dryja</a>ï¼ˆYoutubeè§†é¢‘ï¼Œéœ€è¦æ¢¯å­ï¼‰ï¼Œåœ¨ä¸Šæ–‡çš„ä¾‹å­ä¸­ï¼ŒAliceå’ŒBobä¹‹é—´æ²¡æœ‰å»ºç«‹ç›´æ¥æ”¯ä»˜é€šé“ï¼Œéœ€è¦ç»è¿‡ç¬¬ä¸‰æ–¹Charlieä¸­è½¬ï¼ˆä¸Aliceå’ŒBobå„è‡ªå»ºç«‹æ”¯ä»˜é€šé“ï¼Œéå¯ä¿¡ç¬¬ä¸‰æ–¹ï¼‰ï¼ŒåŒæ—¶Aliceä¸Bobä¹‹é—´éœ€è¦å»ºç«‹æ­£å¸¸çš„TCP/IPç­‰é€šä¿¡é€šé“ã€‚è‹¥Aliceéœ€è¦å‘Bobè½¬è´¦ï¼ŒBobé€‰æ‹©éšæœºæ•°Rï¼Œå¹¶ä¸”ç”Ÿæˆå“ˆå¸ŒHï¼Œå°†Hé€šè¿‡é€šä¿¡ä¿¡é“å‘ç»™Aliceã€‚Aliceä¸Charlieä¹‹é—´è¾¾æˆåˆçº¦ï¼Œå³Charlieèƒ½åœ¨æŒ‡å®šæ—¶é—´å†…å±•ç¤ºå‡ºæ­£ç¡®çš„Rå€¼ï¼ŒAliceå³æ”¯ä»˜æŒ‡å®šé‡‘é¢ï¼Œå¦åˆ™æ’¤å›è¯¥åˆçº¦ã€‚åŒç†Charlieä¸Bobé—´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>å®é™…ä¸Šï¼Œè¿™æ ·çš„Charlieç›¸å½“äºç›®å‰é‡‘èç³»ç»Ÿé‡Œçš„æ”¯ä»˜å®è§’è‰²ï¼Œä¸€ä¸ªæŒä¹…è€Œä¸”å¤§å¤šæ•°èŠ‚ç‚¹å»ºç«‹æ”¯ä»˜é€šé“çš„èŠ‚ç‚¹ï¼ˆæˆ–è€…èŠ‚ç‚¹ç¾¤ï¼Œç±»ä¼¼ä¸Aliceä¸Bobé—´ç»è¿‡å¤šä¸ªèŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ç¾¤ä¹‹é—´å»ºç«‹æ”¯ä»˜é€šé“ï¼Œå› æ­¤Aliceä¸Bobä¹‹é—´èƒ½æ¯”è¾ƒå®¹æ˜“æ‰¾åˆ°è·¯ç”±ï¼‰ã€‚åŒæ—¶ï¼Œå¯¹äºé¢‘ç¹æ”¯ä»˜æˆ–è€…å¤§é¢æ”¯ä»˜çš„èŠ‚ç‚¹ï¼ˆå‡è®¾Bobæ˜¯å•†å®¶ï¼‰ï¼Œåˆ™Bobä¸Charlieé—´çš„é€šé“å®¹é‡éœ€è¦è¶³å¤Ÿå¤§ï¼Œä¹Ÿå°±æ˜¯åŒæ–¹åœ¨ä¸»é“¾ä¸Šé”šå®šçš„èµ„äº§ä»·å€¼è¶³å¤Ÿé«˜ï¼Œå¦åˆ™éœ€è¦ç»å¸¸çš„å…³é—­ï¼ˆä¸»åŠ¨æ–¹æç°éœ€è¦ç­‰ä¸€å®šåŒºå—æ—¶é—´ï¼‰å’Œå»ºç«‹å¤šä¸ªé€šé“ã€‚è¿™æ ·çš„å¹¶éæç«¯æ„ä¹‰çš„åˆ†å¸ƒå¼å»ä¸­å¿ƒåŒ–ï¼Œä½†å·²ç»åˆ©ç”¨äº†åŒºå—é“¾çš„æ— éœ€ä¿¡ä»»å±æ€§ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Bitcoin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…±è¯†ç®—æ³•(3) - PoS</title>
      <link href="//articles/consensus-pos/"/>
      <url>//articles/consensus-pos/</url>
      
        <content type="html"><![CDATA[<h3 id="PoS-Proof-of-Stakeæƒç›Šè¯æ˜-ç›¸å¯¹äºPoWçš„ä¼˜ç‚¹ï¼š"><a href="#PoS-Proof-of-Stakeæƒç›Šè¯æ˜-ç›¸å¯¹äºPoWçš„ä¼˜ç‚¹ï¼š" class="headerlink" title="PoS(Proof of Stakeæƒç›Šè¯æ˜)ç›¸å¯¹äºPoWçš„ä¼˜ç‚¹ï¼š"></a>PoS(Proof of Stakeæƒç›Šè¯æ˜)ç›¸å¯¹äºPoWçš„ä¼˜ç‚¹ï¼š</h3><ol><li>ä¸éœ€è¦æ¶ˆè€—å¤§é‡ç”µåŠ›æˆæœ¬</li><li>å‘åŠ¨51%æ”»å‡»æˆæœ¬æ›´é«˜ï¼ˆPoWçŸ¿æ± æˆ–è€…å¤§é‡ç§Ÿç”¨çŸ¿æœºé›†ä¸­ç®—åŠ›å‘åŠ¨æ”»å‡»ï¼Œæˆ–è€…å¿«é€Ÿç®—æ³•ï¼Œç¡¬ä»¶å‡çº§å¸¦æ¥çš„ç®—åŠ›æå‡ç­‰ï¼Œéƒ½å¯èƒ½ä¼šå¢åŠ æ”»å‡»é£é™©ã€‚PoSéœ€è¦æ”¶è´­å…¨ç½‘51%çš„Tokenï¼Œå¹¶ä¸”æŒæœ‰è€…çš„æƒç›Šåœ¨äºæ‰€æŒæœ‰çš„Tokenä¹Ÿæ›´å¤§åŠ¨åŠ›ç»´æŠ¤ç³»ç»Ÿå®‰å…¨ï¼‰<blockquote><p><a href="https://36kr.com/p/5173291">PoSä¸ºä»€ä¹ˆæ¯”PoWæ›´èƒ½é¿å…51%æ”»å‡»ï¼Ÿ</a></p></blockquote></li></ol><h3 id="PoSè¿è¡Œè¿‡ç¨‹"><a href="#PoSè¿è¡Œè¿‡ç¨‹" class="headerlink" title="PoSè¿è¡Œè¿‡ç¨‹"></a>PoSè¿è¡Œè¿‡ç¨‹</h3><ol><li>è´¨æŠ¼stakeï¼Œå£°æ˜ä¸ºéªŒè¯èŠ‚ç‚¹ï¼ˆåŒºåˆ«äºå…¨èŠ‚ç‚¹æ‹¥æœ‰å‡ºå—çš„æƒåˆ©ï¼Œä¼šæœ‰ä¸€å®šçš„é—¨æ§›ï¼Œå¦‚æŒæœ‰stakeé‡ï¼Œå æœ‰æ¯”ä¾‹ï¼Œæˆ–è€…top nç­‰æ¡ä»¶ï¼Œæ„åœ¨æ§åˆ¶éªŒè¯èŠ‚ç‚¹æ•°é‡ï¼Œç¼©å°é€‰ä¸¾çš„èŒƒå›´ä»¥åŠè¾¾æˆbftå…±è¯†çš„èŠ‚ç‚¹æ•°ï¼‰</li><li>é€‰ä¸¾ ï¼ˆå‘¨æœŸæ€§é€‰ä¸¾ï¼Œä»¥ä¹‹å‰å·²å‡ºå—çš„å€¼ä½œä¸ºéšæœºç§å­ï¼Œé€‰å–ä¸‹ä¸€å‘¨æœŸçš„å‡ºå—èŠ‚ç‚¹å’Œé¡ºåºï¼Œé€‰ä¸¾ç®—æ³•åŒ…å«Follow-the-Satoshié€‰æ‹©éšæœºstakeçš„æŒæœ‰èŠ‚ç‚¹å’ŒRR-BFTè½®è¯¢ç®—æ³•ï¼‰</li><li>æ‰“åŒ…äº¤æ˜“ ï¼ˆè¯¥è®ºçš„å‡ºå—èŠ‚ç‚¹ä»äº¤æ˜“ç¼“å­˜æ± é€‰æ‹©ï¼Œé€šå¸¸ä¸ºäº¤æ˜“æ‰‹ç»­è´¹é«˜ï¼Œæ—¶é—´æ—©ç­‰ï¼ŒéªŒè¯ï¼ŒåŒ…æ‹¬ç­¾åï¼Œè´¦æˆ·ä½™é¢ç­‰ã€‚å¦‚æœè¯¥è®ºçš„å‡ºå—èŠ‚ç‚¹æ²¡æœ‰å‡ºå—ï¼Œåˆ™è·³è¿‡è¯¥è®ºï¼Œå¹¶ä¸”æƒ©ç½šï¼‰</li><li>å¹¿æ’­äº¤æ˜“ï¼Œç¡®è®¤ï¼ˆPoSåˆ†ä¸ºåŸºäºé“¾çš„PoSå’ŒBFTé£æ ¼çš„PoSã€‚åœ¨<strong>åŸºäºé“¾çš„PoS</strong>ä¸­ï¼Œæœ€é•¿é“¾åŸåˆ™ï¼Œéšæœºç®—æ³•é€‰å‡ºéªŒè¯è€…åˆ›å»ºæ–°åŒºå—ï¼Œä½†æ˜¯éªŒè¯è€…è¦ç¡®ä¿è¯¥å—æŒ‡å‘æœ€é•¿é“¾ï¼Œé€šå¸¸ä¹Ÿéœ€è¦ä¸€å®šæ•°é‡çš„éªŒè¯èŠ‚ç‚¹èƒŒä¹¦ç­¾ååä¸Šé“¾ã€‚åœ¨<strong>BFTé£æ ¼çš„PoS</strong>ä¸­ï¼Œåˆ†é…ç»™éªŒè¯è€…ç›¸å¯¹çš„æƒåŠ›ï¼Œä»¥RRçš„æ–¹å¼æå‡ºå—å¹¶ä¸”ç»™è¢«æå‡ºçš„å—æŠ•ç¥¨ï¼Œä»è€Œå†³å®šå“ªä¸ªå—æ˜¯æ–°å—ï¼Œå¹¶åœ¨æ¯ä¸€è½®é€‰å‡ºä¸€ä¸ªæ–°å—åŠ å…¥åŒºå—é“¾ã€‚åœ¨æ¯ä¸€è½®ä¸­ï¼Œæ¯ä¸€ä¸ªéªŒè¯è€…éƒ½ä¸ºæŸä¸€ç‰¹å®šçš„å—è¿›è¡ŒæŠ•ç¥¨ï¼Œæœ€åæ‰€æœ‰åœ¨çº¿å’Œè¯šå®çš„éªŒè¯è€…éƒ½å°†å•†é‡è¢«ç»™å®šçš„å—æ˜¯å¦å¯ä»¥æ·»åŠ åˆ°åŒºå—é“¾ä¸­ï¼Œå¹¶ä¸”æ„è§ä¸èƒ½æ”¹å˜ï¼‰</li></ol><blockquote><p><a href="https://www.chainnews.com/articles/547932547984.htm">ä¸€æ–‡è¯»æ‡‚ PoS å…±è¯†è¿è¡Œä¸ƒå¤§æ­¥éª¤</a></p></blockquote><span id="more"></span><h3 id="PoSçš„æ”»å‡»é£é™©"><a href="#PoSçš„æ”»å‡»é£é™©" class="headerlink" title="PoSçš„æ”»å‡»é£é™©"></a>PoSçš„æ”»å‡»é£é™©</h3><p>æ¯”è¾ƒçªå‡ºçš„æ˜¯<strong>Nothing-at-stake</strong>(æ— åˆ©å®³å…³ç³»)å’Œ<strong>Long-range-atack</strong>(é•¿ç¨‹æ”»å‡»ï¼‰ä¸¤ç§  </p><ol><li><p>æ— åˆ©å®³å…³ç³» Nothing-at-stake  </p><p> Nothing At Stake, a situation where someone loses nothing when behaving badly, but stands to gain everything. åœ¨å‡ºç°å¤šæ¡åŒºå—é“¾ç›¸äº’ç«äº‰çš„æƒ…å†µä¸‹ï¼Œä¼šæ¿€åŠ±éªŒè¯è€…åœ¨æ¯æ¡é“¾ä¸Šéƒ½åˆ›é€ åŒºå—ï¼Œä»¥ç¡®ä¿åˆ©ç›Šæœ€å¤§åŒ–ã€‚å› ä¸ºPoSåˆ›é€ æ–°åŒºå—åŸºæœ¬ä¸Šæ— éœ€æˆæœ¬ï¼Œåªå—æŒæœ‰çš„èµ„äº§ï¼ˆtokenï¼‰å½±å“ï¼Œè¿™æ ·ä½¿å¾—åŒèŠ±æ”»å‡»æ›´åŠ å®¹æ˜“ï¼Œè€ŒPoWåˆ™å—ç®—åŠ›å½±å“ï¼Œåˆ†æ•£ç®—åŠ›åè€Œé™ä½æ”¶ç›ŠæœŸæœ›å€¼ï¼Œå³ç»æµå­¦æ„ä¹‰ä¸Šçš„æœºä¼šæˆæœ¬ã€‚è¿™ä¸ªå¯ä»¥ä¸€ä¸ªä¾‹å­è¯´æ˜ã€‚</p><blockquote><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»ç„¶æ˜¯ Aã€Bã€C ä¸‰ä¸ªå‡ºå—èŠ‚ç‚¹ï¼Œå‡å¦‚ Aæ˜¯æ”»å‡»èŠ‚ç‚¹ï¼Œå®ƒåœ¨äº§ç”Ÿåˆ†å‰æ—¶åˆ›é€ ä¸¤ç¬”äº¤æ˜“ã€‚ä¸€ç¬”å°†Xä¸ªå¸å‘ç»™è‡ªå·±çš„ä¸€ä¸ªé’±åŒ…åœ°å€ï¼ŒåŒæ—¶åœ¨å¦å¤–ä¸€ä¸ªåˆ†å‰ä¸Šå°†Xä¸ªå¸å‘åˆ°äº¤æ˜“æ‰€ã€‚Bã€Cå‡ºå—èŠ‚ç‚¹å›  Nothing At Stake æ‰€ä»¥åŒæ—¶ä¼šåœ¨ä¸¤æ¡åˆ†å‰é“¾ä¸Šå‡ºå—ã€‚å½“äº¤æ˜“è¢«äº¤æ˜“æ‰€ç¡®è®¤åï¼Œ A å°† X ä¸ªå¸å‡ºå”®å…‘æ¢æˆéšç§å¸ç§ï¼Œç§»å‡ºäº¤æ˜“æ‰€ã€‚ä¹‹å A é€šè¿‡å¢åŠ è´¨æŠ¼å¸é‡ï¼Œæˆ–åˆ›å»ºå¤šä¸ªå…¶ä»–å‡ºå—èŠ‚ç‚¹çš„æ–¹å¼æå‡å‡ºå—æƒé‡ï¼Œåªåœ¨åˆ†å‰é“¾ç»§ç»­å‡ºå—ã€‚æ­¤æ—¶æœ€é•¿é“¾å¾ˆæ˜æ˜¾ï¼Œä¸”é€æ¸æ‹‰å¼€å·®è·ï¼Œä¼šæœ€ç»ˆæˆä¸ºæœ€é•¿é“¾ï¼ŒA æˆåŠŸå°† X ä¸ªå¸åŒèŠ±ã€‚</p><p><img src="/images/token-double-spend.png" alt=""></p><p>æ‘˜è‡ª ï¼š<a href="http://www.gongxiangcj.com/posts/19085">PoSèƒŒåçš„Nothing At Stakeä¸Long-Range Attack</a></p></blockquote><p> è§£å†³æ–¹æ¡ˆ ï¼š æ— æˆæœ¬æ”»å‡»åˆ™å¼•å…¥æƒ©ç½šæœºåˆ¶ã€‚éªŒè¯èŠ‚ç‚¹æå‰æŠµæŠ¼ä¸€å®šçš„stakeåšä¸ºä¿è¯é‡‘ï¼Œå¦‚æœå‘ç°éªŒè¯èŠ‚ç‚¹â€œåœ¨å¤šæ¡é“¾ä¸ŠåŒæ—¶å‡ºå—â€ æˆ–è€… â€œåœ¨é”™è¯¯çš„é“¾ä¸Šå‡ºå—â€ï¼Œç«‹å³æƒ©ç½šæ‰£é™¤ä¸€å®šä¿è¯é‡‘ã€‚åªè¦ä¿è¯é‡‘è®¾ç½®åˆç†ï¼Œä½¿â€œåŒæŒ–â€çš„æ”¶ç›ŠæœŸæœ›å€¼é™ä½ï¼Œå¯ä»¥ä»ç»æµå­¦æ„ä¹‰ä¸Šæ¶ˆé™¤è¿™ä¸ªé£é™©ã€‚</p></li><li><p>é•¿ç¨‹æ”»å‡» Long-range-atack</p><p> æ¶æ„èŠ‚ç‚¹ä»å¾ˆæ—©ä»¥å‰çš„ç”šè‡³æ˜¯åˆ›ä¸–å—å¼€å§‹é‡æ–°å»ºé€ ä¸€æ¡é“¾ï¼Œç›®çš„æ¥ä»£æ›¿æ­£å¸¸è¿è¡Œçš„ä¸»é“¾ã€‚ç”±äºPoSåˆ›å»ºåŒºå—çš„æˆæœ¬æå°ï¼Œæ–°é“¾çš„æ„é€ é€Ÿåº¦å¯ä»¥å¾ˆå¿«ï¼Œèµ¶ä¸Šä¸»é“¾çš„é«˜åº¦ã€‚å¦‚æœä¸è€ƒè™‘timestampï¼Œé‚£ä¹ˆæ¶æ„èŠ‚ç‚¹å¯ä»¥è¶…å‰å½“å‰æ—¶åˆ»ï¼Œåˆ›é€ å¤§é‡çš„æœªæ¥åŒºå—æ—¶é—´ï¼Œä»è€Œå¢åŠ é“¾é«˜åº¦ä»£æ›¿æ­£å¸¸é“¾ã€‚è¿™ç§æƒ…å†µåŠ ä¸Štimestampå³å¯é¿å…ã€‚</p><p> è€ƒè™‘timestampçš„ä¸»è¦æœ‰ä¸¤ç§å½¢æ€ï¼Œä¸€ç§æ˜¯<strong>Posterior Corruption</strong>ã€‚è­¬å¦‚å¦‚æœå½“å‰åŒºå—é«˜åº¦ä¸ºXï¼Œæƒ³ä»ä¹‹å‰çš„åŒºå—Kå¼€å§‹åˆ†æ”¯ã€‚é‚£ä¹ˆä»Kåˆ°Xä¹‹é—´æ‰€æœ‰çš„åŒºå—çš„ç­¾å‘è€…è”åˆèµ·æ¥ï¼ˆæˆ–è€…é€šè¿‡è´¿èµ‚ï¼Œç›—çªƒç§˜é’¥ç­‰æ–¹å¼ï¼‰ï¼Œå°†è´¨æŠ¼çš„stakeå…¨éƒ¨æ’¤å›ï¼Œç„¶ååˆ›å»ºä»Kå¼€å§‹åˆ›å»ºæ–°é“¾ï¼ˆæ²¡æœ‰è´¨æŠ¼å°±ä¸å­˜åœ¨ç­¾å‘Xä¹‹åçš„æ–°çš„åŒºå—ï¼Œä½†æ˜¯å¯ä»¥ç­¾å‘ä¹‹å‰çš„ï¼Œè€Œä¸”é¿å¼€äº†åŒç­¾çš„æƒ©ç½šæªæ–½ï¼‰ï¼Œæ­¤æ—¶åˆ›å»ºçš„æ–°é“¾é•¿åº¦å°±èµ¶ä¸Šç”šè‡³æ›¿ä»£æ­£å¸¸é“¾ã€‚Casperé€šè¿‡â€œæ£€æŸ¥ç‚¹â€ï¼ˆcheckpointï¼‰æœºåˆ¶æ¥åº”å¯¹è¿™ç§æ–¹æ¡ˆã€‚å–æ¶ˆæŠµæŠ¼ä¿è¯é‡‘æœ‰ä¸€ä¸ªâ€œè§£å†»â€æ—¶æœŸã€‚åŒæ—¶é™åˆ¶åŒºå—åˆ†å‰ä¸Šé™ï¼ŒèŠ‚ç‚¹æ‹’ç»å›æ»šæ¯”ä¿è¯é‡‘è¢«é”å®šæ—¶é—´æ›´ä¹…çš„åŒºå—ï¼Œç‰¹å®šçš„ä¸Šé™åŒºå—ç§°ä¹‹ä¸ºâ€œæ£€æŸ¥ç‚¹â€ï¼Œè¿™æ ·è¿™äº›æ’¤å›çš„stakeåœ¨å¯ä»¥ç”¨æ¥é‡ç­¾æ—¶å·²ç»è¿‡äº†æ£€æŸ¥ç‚¹ã€‚ï¼ˆè¦ç†è§£è¿™æ®µéœ€è¦äº†è§£èŠ‚ç‚¹éšæœºé€‰ä¸¾è¿‡ç¨‹çš„Follow-the-Satoshiç®—æ³•ï¼Œé€‰æ‹©éšæœºstakeçš„æŒæœ‰èŠ‚ç‚¹ï¼‰ã€‚å¦å¤–ä¹Ÿæœ‰ç ”ç©¶KECï¼ˆKey-Evolving Cryptographyï¼‰å³ç§˜é’¥ç­¾å‘ä¸€æ¬¡å³å¤±æ•ˆçš„æ–¹æ¡ˆé˜²æ­¢äºŒæ¬¡ç­¾å‘ã€‚è¿˜æœ‰çš„æ–¹æ¡ˆæ˜¯åœ¨äº¤æ˜“æ—¶ä¹Ÿå¸¦ä¸Šå‰ä»»åŒºå—çš„hashå€¼ï¼Œè¿™æ ·é€šè¿‡æ£€æŸ¥äº¤æ˜“çš„è¿™ä¸ªå€¼ï¼Œå¯ä»¥é¿å…é“¾çš„ä¸­é€”æ¶æ„åˆ†å‰ã€‚</p><p> å¦ä¸€ç§æ–¹å¼æ˜¯<strong>Stake Bleeding</strong>ã€‚å¦‚å›¾ï¼Œæ¶æ„èŠ‚ç‚¹Måœ¨æ­£å¸¸é“¾é€‰æ‹©åœ¨Mçš„å‡ºå—æ—¶åˆ»ä¸å‡ºå—ï¼Œå³Liveness Denial attackï¼Œåˆ™è¯¥è½®è¢«è·³è¿‡ï¼Œé“¾é«˜åº¦ä¸å˜ï¼ŒMè¢«æƒ©ç½šï¼Œé€æ¸çš„æ¼”å˜ä¸‹å»stakeå‡å°‘ï¼Œå‡ºå—æœºä¼šå‡å°‘ã€‚è€Œåœ¨æ¶æ„é“¾ï¼ŒMåœ¨å…¶æ—¶åˆ»å‡ºå—ï¼Œå…¶ä»–çš„åˆ™ä¸å¯èƒ½å‡ºå—ï¼Œå¯¼è‡´Mçš„å‡ºå—æœºä¼šå¢åŠ ï¼Œæ¼”å˜åˆ°æœ€ååªæœ‰å…¶å‡ºå—ã€‚éšç€æ—¶é—´çš„æ¨ç§»ä¼šèµ¶ä¸Šä¸»é“¾ã€‚ä½†æ˜¯ç ”ç©¶è¡¨æ˜ï¼Œæ‹¥æœ‰30%stakeçš„æ”»å‡»è€…ä¹Ÿéœ€è¦6å¹´æ‰èƒ½å®ç°ï¼Œç°å®å¯è¡Œæ€§æ¯”è¾ƒä½ã€‚</p><p> <img src="/images/pos-stake-bleeding.png" alt=""></p><p> é•¿ç¨‹æ”»å‡»é€šå¸¸ä¸<strong>Weak Subjectivity</strong>(å¼±ä¸»è§‚æ€§)ç›¸å…³è”ã€‚åŒºå—é“¾ç½‘ç»œä¸­çš„æ–°èŠ‚ç‚¹æˆ–æ˜¯é•¿æœŸç¦»çº¿çš„èŠ‚ç‚¹åŠ å…¥åˆ°ç½‘ç»œä¸­æ—¶ï¼Œä¼šæ”¶åˆ°å½“å‰åŒºå—é“¾ä¸Šæ‰€æœ‰å…¬å¼€çš„åˆ†æ”¯ï¼Œä½†æ˜¯èŠ‚ç‚¹å¹¶ä¸èƒ½åˆ†è¾¨å‡ºå“ªäº›åˆ†æ”¯æ˜¯ä»å±äºä¸»é“¾çš„ï¼ˆPoSé‡Œæœ€é•¿é“¾åŸåˆ™å¹¶ä¸è¶³å¤Ÿï¼Œå› ä¸ºPoSé‡Œåˆ›å»ºåŒºå—æˆæœ¬æå°ï¼Œå¯èƒ½å­˜åœ¨å¤šæ¡ç­‰é•¿é“¾ï¼Œè¿™ä¸PoWæ˜¯åŒºåˆ«çš„ï¼‰ã€‚å› æ­¤ï¼Œåœ¨PoSé‡Œï¼Œæ–°èŠ‚ç‚¹è¦æ±‚éªŒè¯é“¾å¤–æœ€æ–°çŠ¶æ€æ¥è§£å†³ï¼ŒèŠ‚ç‚¹å¯ä»¥é€šè¿‡è¯¢é—®ä»–ä»¬çš„æœ‹å‹ã€åŒºå—æµè§ˆå™¨ç­‰è¿›è¡ŒåŒºå—åŒæ­¥ï¼Œç¦»çº¿çš„èŠ‚ç‚¹è¦æ±‚åœ¨â€œè¿˜åŸä¸Šé™â€æ—¶é—´å†…è‡³å°‘è¦ç™»å½•åŒæ­¥ä¸€æ¬¡ã€‚åœ¨çº¿èŠ‚ç‚¹å› ä¸ºä¸€ç›´ä¸ä¸»é“¾åŒæ­¥ï¼Œåˆ™ä¸å­˜åœ¨è¿™ä¸ªé£é™©ã€‚</p><blockquote><p><a href="https://blog.positive.com/rewriting-history-a-brief-introduction-to-long-range-attacks-54e473acdba9">Rewriting History: A Brief Introduction to Long Range Attacks</a></p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> Consensus &amp; Cryptography </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> Consensus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ethereumæ¦‚å¿µç†è§£</title>
      <link href="//articles/understanding-ethereum/"/>
      <url>//articles/understanding-ethereum/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¿…è¯»ï¼š</p><ul><li><strong><a href="https://github.com/ethereum/wiki/wiki/White-Paper">Ethereum White Paper</a></strong></li><li><strong><a href="https://ethereum.github.io/yellowpaper/paper.pdf">Ethereum Yellow Paper</a></strong></li></ul></blockquote><h2 id="Block-transaction-account-state-objects-and-Ethereum-tries"><a href="#Block-transaction-account-state-objects-and-Ethereum-tries" class="headerlink" title="Block, transaction, account state objects and Ethereum tries"></a>Block, transaction, account state objects and Ethereum tries</h2><p><img src="/images/understanding-ethereum/ethereum-all-structure.jpg" alt=""></p><ul><li><strong>The world state trie contains the mapping between addresses and account states.</strong> The hash of the root node of the world state trie is included in a block (in the stateRoot field) to represent the current state when that block was created. <strong>We only have one world state trie.</strong></li><li><strong>The account storage trie contains the data associated to a smart contract.</strong> The hash of the root node of the Account storage trie is included in the sccount state (in the storageRoot field). <strong>We have one Account storage trie for each account.</strong></li><li><strong>The transaction trie contains all the transactions included in a block.</strong> The hash of the root node of the Transaction trie is included in the block header (in the transactionsRoot field). <strong>We have one transaction trie per block.</strong></li><li><strong>The transaction receipt trie contains all the transaction receipts for the transactions included in a block.</strong> The hash of the root node of the transaction receipts trie is included in also included in the block header (in the receiptsRoot field); <strong>We have one transaction receipts trie per block.</strong></li></ul><p>æ‘˜è‡ª: <a href="https://www.lucassaldanha.com/ethereum-yellow-paper-walkthrough-2/">Merkle Tree and Ethereum Objects - Ethereum Yellow Paper Walkthrough (2/7)</a></p><h2 id="Externally-owned-account-EOA-VS-Contract-account"><a href="#Externally-owned-account-EOA-VS-Contract-account" class="headerlink" title="Externally owned account(EOA) VS. Contract account"></a>Externally owned account(EOA) VS. Contract account</h2><p>ä¸¤è€…éƒ½ä½¿ç”¨20å­—èŠ‚çš„åœ°å€ã€‚EOAå¤–éƒ¨æ‹¥æœ‰è´¦æˆ·æ˜¯ç”±ç”¨æˆ·é€šè¿‡å…¬é’¥/ç§é’¥ç§˜é’¥å¯¹æ§åˆ¶çš„ï¼Œé€šè¿‡ä»¥å¤ªåŠå®¢æˆ·ç«¯åˆ›å»ºï¼Œç”±ç§˜é’¥å¯¹ç”Ÿæˆçš„è´¦æˆ·åœ°å€ã€‚è€ŒContract accountåˆ™æ˜¯EOAé€šè¿‡è°ƒç”¨åˆ›å»ºåˆçº¦çš„æ–¹æ³•åˆ›å»ºçš„è´¦æˆ·ï¼Œè´¦æˆ·å†…åŒ…å«åˆçº¦ä»£ç ï¼Œç”±è°ƒç”¨æ–¹EOAçš„åœ°å€å’Œè°ƒç”¨æ–¹ç­‰nonceï¼ˆè¯¥å€¼é’ˆå¯¹EOAé€’å¢ï¼Œç›®çš„ä¸ºé˜²æ­¢é‡æ”¾æ”»å‡»ï¼‰ç»è¿‡PLPç¼–ç å’ŒKECæ•£åˆ—ç”Ÿæˆè´¦æˆ·åœ°å€ã€‚äº¤æ˜“åªèƒ½ç”±EOAå‘èµ·ï¼Œç›®çš„æ–¹å¯ä»¥æ˜¯EOAï¼ˆå¸¸è§çš„è½¬è´¦è¡Œä¸ºï¼Œäº¤æ˜“transactionçš„dataå­—æ®µä¸ºç©ºï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆçº¦è´¦æˆ·ï¼ˆè°ƒç”¨æ‰§è¡Œæ™ºèƒ½åˆçº¦ï¼Œä¸€æ¬¡è°ƒç”¨ä¸­ä¹Ÿå¯èƒ½åŒ…å«è·¨åˆçº¦è°ƒç”¨ï¼Œå³åˆçº¦è´¦æˆ·åˆ°å¦ä¸€ä¸ªåˆçº¦è´¦æˆ·ï¼Œæ­¤æ—¶äº¤æ˜“transactionçš„dataå­—æ®µå­˜æ”¾çš„æ˜¯åˆçº¦è°ƒç”¨çš„æ–¹æ³•åï¼Œå‚æ•°ç­‰äºŒè¿›åˆ¶æ•°æ®ï¼‰ï¼Œè¿˜æœ‰åˆçº¦éƒ¨ç½²ï¼ˆç›®çš„åœ°å€ä¸º0ï¼Œäº¤æ˜“transactionçš„dataå­—æ®µå­˜æ”¾ï¼‰ã€‚ </p><p><img src="/images/understanding-ethereum/ethereum-account.png" alt=""></p><div class="table-container"><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><strong>nonce</strong></td><td>A scalar value equal to the number of transactions sent from this address or, in the case of accounts with associated code, the number of contract-creations made by this account.</td></tr><tr><td><strong>balance</strong></td><td>A scalar value equal to the number of Wei owned by this address.</td></tr><tr><td><strong>storageRoot</strong></td><td>A 256-bit hash of the root node of a Merkle Patricia tree that encodes the storage contents of the account (a mapping between 256-bit integer values), encoded into the trie as a mapping from the Keccak 256-bit hash of the 256-bit integer keys to the RLP-encoded 256-bit integer values.</td></tr><tr><td><strong>codeHash</strong></td><td>The hash of the EVM code of this accountâ€”this is the code that gets executed should this address receive a message call; it is immutable and thus, unlike all other fields, cannot be changed after construction. All such code fragments are contained in the state database under their corresponding hashes for later retrieval.</td></tr></tbody></table></div><blockquote><p>It is not the code that is executed on subsequent transactions sent to the contract. That code is returned by the initialization code. Essentially, the code in the data field is a program that is going to write a program that gets deployed as a smart contract.ï¼ˆéƒ¨ç½²å­—èŠ‚ç  + åˆçº¦å­—èŠ‚ç  + AUXDATA + Swarm hashï¼‰ The standard initialization code generated by the Solidity compiler does the following:</p><ol><li>Runs the code in the contractâ€™s constructor, setting storage values, etc.</li><li>Copies the code for the rest of the contract into memory and returns it.  </li></ol></blockquote><p>æ–°éƒ¨ç½²çš„åˆçº¦ä»£ç è¢«æ‰“åŒ…æäº¤åˆ°é“¾ä¸Šåï¼Œæ‰€æœ‰åˆ°è¿è¡ŒèŠ‚ç‚¹éƒ½ä¼šæ‰§è¡Œdataå­—æ®µé‡Œçš„éƒ¨ç½²ä»£ç ï¼ˆç‰¹æ®Šæƒ…å†µæ˜¯éƒ¨åˆ†èŠ‚ç‚¹åªæŒ‰éœ€å­˜å‚¨éƒ¨åˆ†æ•°æ®ï¼‰ï¼Œå…¶åˆçº¦å­˜åœ¨äºå„è¿è¡ŒèŠ‚ç‚¹å„è‡ªçš„EVMå†…ï¼Œå¹¶ä¸”å¯¹åº”çš„åœ°å€éƒ½æ˜¯ä¸€è‡´ï¼Œå³åœ°å€ä¸åˆçº¦å¯¹åº”ï¼Œä¿è¯åç»­çš„åˆçº¦è°ƒç”¨ã€‚åˆçº¦ä»£ç å­˜æ”¾åœ¨EVMçš„virtual romå†…ï¼Œcode hashå€¼ä¸ºä»£ç çš„å“ˆå¸Œå€¼ï¼Œstorage hashå­˜æ”¾çš„æ˜¯è´¦æˆ·çš„MPTæ ‘çš„root hashã€‚ç®€ä¹‹ï¼Œéƒ¨ç½²åˆçº¦ä¸‰ä¸ªæ­¥éª¤ï¼š1. åˆ›å»ºåˆçº¦è´¦æˆ· 2. æ‰§è¡Œåˆçº¦çš„åˆå§‹åŒ– 3. æ‹·è´åˆ°virtual rom</p><blockquote><p><a href="https://programtheblockchain.com/posts/2017/12/29/how-ethereum-transactions-work/">How Ethereum Transactions Work</a><br><a href="https://programtheblockchain.com/posts/2018/01/09/how-smart-contract-deployment-works/">How Smart Contract Deployment Works</a></p></blockquote><span id="more"></span><h2 id="MPT"><a href="#MPT" class="headerlink" title="MPT"></a>MPT</h2><p>MPT(Merkle Patricia Tries)æ˜¯ä»¥å¤ªåŠä¸­å­˜å‚¨åŒºå—æ•°æ®çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ Merkle Tree å’Œ Patricia Tree èåˆä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚é™„ä¸Šç»å…¸çš„å®˜æ–¹ç»“æ„ç¤ºä¾‹ã€‚å…·ä½“çš„ä»£ç åˆ†æç½‘ä¸Šèµ„æ–™è¯¦ç»†ã€‚</p><p><img src="/images/understanding-ethereum/ethereum-mpt.png" alt=""></p><p>ä»¥å¤ªåŠé‡‡ç”¨æ”¹è¿›çš„Merkleæ ‘ï¼Œå› ä¸ºå‰åä¸¤ä¸ªblockçš„æ•°æ®ç»å¤§éƒ¨åˆ†éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸éœ€è¦åŒæ—¶å­˜å‚¨ä¸¤ä»½ã€‚æ–°blockçš„æ ‘å¯ä»¥å¼•ç”¨ä¸Šä¸€ä¸ªblockï¼ŒåŠ ä¸Šæ–°blockå†…çš„äº¤æ˜“ä¿®æ”¹çš„è´¦æˆ·ã€‚<br><img src="/images/understanding-ethereum/ethereum-mpt-block.png" alt=""></p><blockquote><p><a href="https://www.yuanxuxu.com/2018/08/17/ethereum-code-analysis-mpt/">ä»¥å¤ªåŠæºç åˆ†æâ€”MPTæ ‘</a><br><a href="https://zhuanlan.zhihu.com/p/50242014">Ethereumä»¥å¤ªåŠæºç åˆ†æï¼ˆä¸‰ï¼‰Trieæ ‘æºç åˆ†æï¼ˆä¸Šï¼‰</a><br><a href="https://zhuanlan.zhihu.com/p/50244166">Ethereumä»¥å¤ªåŠæºç åˆ†æï¼ˆä¸‰ï¼‰Trieæ ‘æºç åˆ†æï¼ˆä¸‹ï¼‰</a>  </p></blockquote><h2 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h2><p>In Ethereum, when a transaction is mined, smart contracts can emit events and write logs to the blockchain that the frontend can then process. Eventåœ¨Ethereumé‡Œä¸»è¦æœ‰ä¸‰ç§ç”¨é€”ï¼š  </p><ol><li><em>smart contract return values for the user interface</em><br> å‘é€äº¤æ˜“è°ƒç”¨åˆçº¦çš„è¿”å›ç»“æœæ˜¯äº¤æ˜“çš„å“ˆå¸Œå€¼ï¼Œè€Œä¸æ˜¯åˆçº¦çš„è¿”å›å€¼ï¼ˆåªæœ‰åœ¨è¢«æ‰“åŒ…è¿›åŒºå—æ—¶æ‰æ‰§è¡Œåˆçº¦ï¼‰ã€‚æ‰§è¡Œåˆçº¦äº§ç”Ÿçš„ç»“æœå¯ä»¥ä½œä¸ºæ—¶é—´å†™å…¥åŒºå—ï¼Œè°ƒç”¨æ–¹å¯ä»¥æ ¹æ®åˆçº¦å“ˆå¸Œå€¼ç›¸åº”è·å–ã€‚</li><li><em>asynchronous triggers with data</em><br> å¼‚æ­¥æ—¶é—´è§¦å‘ï¼Œç±»ä¼¼äºè§‚å¯Ÿè€…æ¨¡å¼ã€‚</li><li><em>a cheaper form of storage</em><br> ç§°ä¸ºlogï¼ˆé€šè¿‡LOGè¿™ä¸ªEVMæ“ä½œç ï¼‰ã€‚ç›¸æ¯”stroageè€—è´¹çš„gaså°å¾—å¤šï¼Œå¯ä»¥ç”¨ä½œå­˜å‚¨ï¼Œä½†æ˜¯ä¸èƒ½åœ¨åˆçº¦ä¸­è¢«è°ƒç”¨ã€‚ä¾‹å¦‚å¯ä»¥å­˜æ”¾å†å²æ•°æ®ï¼Œå‰ç«¯å¯ä»¥é€šè¿‡éå†åŒºå—å»è·å–ã€‚</li></ol><blockquote><p><a href="https://media.consensys.net/technical-introduction-to-events-and-logs-in-ethereum-a074d65dd61e">Technical Introduction to Events and Logs in Ethereum</a></p></blockquote><h2 id="GHOST"><a href="#GHOST" class="headerlink" title="GHOST"></a>GHOST</h2><p>GHOSTåè®®ï¼ˆGreedy Heaviest Observed Subtree protocolï¼‰ã€‚åŒæ ·æ˜¯POWï¼Œæ¯”ç‰¹å¸ç”±äºå‡ºå—æ—¶é—´10minï¼Œå–æœ€é•¿é“¾ã€‚è€ŒEthereumå‡ºå—æ—¶é—´çŸ­ï¼ˆ6sï¼‰ï¼Œä¸è¶³æ‰©æ’’è‡³å…¨ç½‘ï¼Œå¦‚æœå–æœ€é•¿é“¾ï¼Œåˆ™åœ°åŸŸä¼˜åŠ¿æ˜æ˜¾ã€‚å› æ­¤ï¼ŒEthereumé€‰æ‹©æœ€é‡çš„é“¾ï¼Œä¹Ÿå°±æ˜¯å…„å¼ŸèŠ‚ç‚¹ä¹‹é—´å­æ ‘èŠ‚ç‚¹æœ€å¤šçš„è¢«é€‰ä¸ºä¸»é“¾ã€‚ä¾‹å­å¯ä»¥å‚è€ƒ <a href="http://www.jouypub.com/2018/9b19cff7135411bd37356e6c4f5f63b7/">ä»¥å¤ªåŠGhoståè®®å’Œå”å—</a>ã€‚ä¸»è¦æ˜¯è¦è§£å†³ 1. å‡ºå—é€Ÿåº¦å¿«ï¼Œå­˜åœ¨å¤šä¸ªèŠ‚ç‚¹åŒæ—¶å‡ºå—ï¼Œä½†æ˜¯åœ¨è‡ªèº«å‡ºå—åæ‰æ¥æ”¶åˆ°åˆ«çš„èŠ‚ç‚¹ä¼ è¾“çš„å—ï¼Œæµªè´¹ç®—åŠ›ã€‚2. æ›´ä¸¥é‡çš„æ˜¯å› ä¸ºå‡ºå—é€Ÿåº¦å—å¸¦æ¥çš„åœ°åŸŸä¼˜åŠ¿ï¼Œè¶Šæ—©æ¥æ”¶åˆ°åˆæ³•å—çš„èŠ‚ç‚¹å‡ºä¸‹ä¸€ä¸ªå—çš„å¯èƒ½æ€§æ›´å¤§ï¼Œä»è€Œé€ æˆçš„ä¸­å¿ƒåŒ–é£é™©ã€‚é€šè¿‡å¢åŠ å”å—é€‰æ‹©æœ€é‡çš„é“¾ï¼Œä¹Ÿå°±æ˜¯é€‰æ‹©å·¥ä½œé‡æœ€å¤§çš„é“¾ï¼Œé™ä½åœ°åŸŸä¼˜åŠ¿ã€‚åŒæ—¶å¥–åŠ±å”å—ï¼Œæ¿€åŠ±èŠ‚ç‚¹å‡ºå—ã€‚</p><blockquote><p><a href="https://github.com/ethereum/wiki/wiki/White-Paper#modified-ghost-implementation">å®˜æ–¹æ–‡æ¡£ - Modified GHOST Implementation</a> ï¼š è¯¦ç»†ä»‹ç»äº†GHOSTç¨€é‡Šé£é™©ï¼Œä»¥åŠå”å—çš„é€‰æ‹©æ ‡å‡†å’Œå¥–åŠ±æ–¹æ¡ˆã€‚</p></blockquote><h2 id="Transaction-Structure"><a href="#Transaction-Structure" class="headerlink" title="Transaction Structure"></a>Transaction Structure</h2><div class="table-container"><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><strong>nonce</strong></td><td>A scalar value equal to the number of transactions sent by the sender</td></tr><tr><td><strong>gasPrice</strong></td><td>A scalar value equal to the number of Wei to be paid per unit of gas for all computation costs incurred as a result of the execution of this transation</td></tr><tr><td><strong>gasLimit</strong></td><td>A scalar value equal to the maximum amount of gas that should be used in executing this transaction. This is paid up-front, before any computation is done and may not be increased later</td></tr><tr><td><strong>to</strong></td><td>The 160-bit address of the message callâ€™s recipient or, for a contract creation transaction, âˆ…, used here to denote the only member of B0</td></tr><tr><td><strong>value</strong></td><td>A scalar value equal to the number of Wei to be transferred to the message callâ€™s recipient or, in the case of contract creation, as an endowment to the newly created account</td></tr><tr><td><strong>v, r, s</strong></td><td>Values corresponding to the signature of the transaction and used to determine the sender of the transaction.<br>For the signing, Ethereum uses the same elliptic curve as Bitcoinâ€™s, which is <a href="https://en.bitcoin.it/wiki/Secp256k1">secpk256k1</a>.<br>ç”¨äºä»ç­¾åä¸­æ¢å¤ECDSAå…¬é’¥ï¼Œä»è€Œå¾—åˆ°å‘é€æ–¹fromçš„åœ°å€<br>Ref: <a href="https://bitcoin.stackexchange.com/questions/38351/ecdsa-v-r-s-what-is-v">ECDSA: (v, r, s), what is v?</a></td></tr><tr><td><strong>data</strong></td><td>An unlimited size byte array specifying the input data of the message</td></tr></tbody></table></div><blockquote><p><a href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/design/protocol_description.html">FISCO BCOS 2.0+ çš„äº¤æ˜“ç»“æ„</a>åœ¨åŸä»¥å¤ªåŠçš„äº¤æ˜“ç»“æ„çš„åŸºç¡€ä¸Šï¼Œæœ‰æ‰€å¢å‡å­—æ®µã€‚æ¯”è¾ƒé‡è¦çš„æ–°å¢å­—æ®µæ˜¯<strong>blockLimit</strong>ï¼Œè¡¨ç¤º äº¤æ˜“ç”Ÿå‘½å‘¨æœŸï¼Œè¯¥äº¤æ˜“æœ€æ™šè¢«å¤„ç†çš„å—é«˜.</p></blockquote><h2 id="Geth-Sync-Modes"><a href="#Geth-Sync-Modes" class="headerlink" title="Geth Sync Modes"></a>Geth Sync Modes</h2><p><img src="/images/understanding-ethereum/sync-modes.jpeg" alt=""></p><ul><li><strong>Archive nodes</strong>ï¼š å­˜å‚¨åˆ›ä¸–å—è‡³ä»Šçš„æ‰€æœ‰åŒºå—å†å²æ•°æ®ï¼ŒåŒ…æ‹¬æ¯ä¸ªåŒºå—çš„çŠ¶æ€ã€‚é€‚åˆå¯¹å†å²çŠ¶æ€çš„å¿«é€ŸæŸ¥æ‰¾ã€‚</li><li><strong>Full sync mode(Full nodes)</strong>: ä»åˆ›å§‹å—å¼€å§‹æŒ‰ä»¥ä¸‹æ­¥éª¤ä¸‹è½½å’Œé‡æ”¾æ‰§è¡Œäº¤æ˜“ä»¥éªŒè¯æ¯ä¸ªåŒºå—ã€‚å‘¨æœŸæ€§çš„åˆ›å»ºcheckpointã€‚åªä¿ç•™æœ€è¿‘çš„128ä¸ªåŒºå—çš„çŠ¶æ€æ ‘ï¼Œè¿‡æœŸçš„åŒºå—çŠ¶æ€æ ‘å°†è¢«ä¿®å‰ªã€‚<ol><li>download and verify headers</li><li>download block bodies and receipts. In parallel, download raw state data and build state trie</li><li>heal state trie to account for newly arriving data</li></ol></li><li><strong>Snap sync mode(Full nodes)</strong>: ä¸Full sync modeç±»ä¼¼ï¼Œå·®åˆ«åœ¨äºä»ç›¸å¯¹è¿‘æœŸçš„checkpointå¼€å§‹ä»¥ä¸Šçš„ä¸‹è½½æ‰§è¡Œæ ¡éªŒæ­¥éª¤ã€‚</li><li><strong>Light nodes</strong>: åªä¸‹è½½å’Œæ ¡éªŒåŒºå—å¤´ã€‚éå¸¸ä¾èµ–äºæ— ç§çš„å…¨èŠ‚ç‚¹æä¾›æ•°æ®æœåŠ¡ï¼Œæ¥æ”¶å…¨èŠ‚ç‚¹çš„å‡­è¯ï¼Œä¸æœ¬åœ°çš„åŒºå—å¤´æ ¡éªŒã€‚å¸¸ç”¨äºæäº¤äº¤æ˜“ã€‚<blockquote><p><a href="https://geth.ethereum.org/docs/fundamentals/sync-modes#main-content">Gethå®˜æ–¹æ–‡æ¡£ - Sync Modes</a></p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ethereumè®¾è®¡ç†å¿µDesign Rationaleå­¦ä¹ å¿ƒå¾—</title>
      <link href="//articles/ethereum-design-rationale/"/>
      <url>//articles/ethereum-design-rationale/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸ºEthereumè®¾è®¡ç†å¿µå®˜æ–¹æ–‡æ¡£<a href="https://github.com/ethereum/wiki/wiki/Design-Rationale">Design Rationale</a>çš„é˜…è¯»ç†è§£ï¼Œå¹¶éå®Œæ•´çš„ä¸­æ–‡ç¿»è¯‘ï¼Œå¯å‚è€ƒ<a href="https://ethfans.org/posts/510">ä¸­æ–‡ç¿»è¯‘</a>ã€‚è€Œè¿™ä¸ªå®˜æ–¹æ–‡æ¡£é˜è¿°çš„æ˜¯Ethereumæ¼”è¿›è¿‡ç¨‹ä¸­åŒºåˆ«äºä¼ ç»ŸåŠ å¯†è´§å¸ä¹‹å¤„ï¼ŒåŒ…å«ä¼˜ç‚¹ï¼Œä¸€äº›æœ‰äº‰è®®æ€§çš„è¯é¢˜ï¼Œä»¥åŠå„è‡ªçš„é£é™©ã€‚</p><h3 id="åŸºæœ¬å‡†åˆ™"><a href="#åŸºæœ¬å‡†åˆ™" class="headerlink" title="åŸºæœ¬å‡†åˆ™"></a>åŸºæœ¬å‡†åˆ™</h3><ol><li><strong>ä¸‰æ–‡æ²»å¼çš„å¤æ‚åº¦æ¨¡å‹</strong>  </li></ol><ul><li>å°½é‡ç®€å•çš„åº•å±‚ç»“æ„ï¼ˆå¦‚æ ¸å¿ƒå…±è¯†ç®—æ³•ï¼‰ä»¥åŠæ˜“äºä½¿ç”¨ç†è§£çš„æ¥å£å±‚ï¼ˆdevelopers and usersï¼‰ã€‚å¤æ‚åº¦åœ¨ä¸­é—´å±‚ï¼ˆserialization and deserialization scripts, storage data structure models, the leveldb storage interface and the wire protocol, etcï¼‰ã€‚ä¹Ÿå°±æ˜¯ï¼Œåº•å±‚åŸºæœ¬çš„æ ¸å¿ƒæ€æƒ³ç»´æŒç¨³å®šå’Œç®€å•ï¼Œå°†æ˜“å˜çš„å¯æ›¿æ¢çš„å…·ä½“å®ç°æ”¾åœ¨ä¸­é—´å±‚ã€‚</li><li>å°½å¯èƒ½çš„åŒ…å«åº•å±‚æ¦‚å¿µï¼Œä½¿å¾—å¯ä»¥ä»»æ„æ–¹å¼å»ç»„åˆã€‚åŒæ—¶å½“å‰¥ç¦»ä¸å¿…è¦çš„åŠŸèƒ½ä¹Ÿèƒ½ä½¿åº•å±‚è¿è¡Œå¾—æ›´æœ‰æ•ˆç‡ã€‚</li><li>æ ¸å¿ƒå±‚æ‹’ç»å†…åµŒé«˜å±‚åº”ç”¨ç‰¹æ€§ï¼Œè€Œé¼“åŠ±ä»¥åˆçº¦çš„æ–¹å¼æ¥æ¨¡æ‹Ÿå®ç°é«˜å±‚åº”ç”¨åè®®ã€‚</li></ul><ol><li><p><strong>è‡ªç”±åº¦</strong><br>ä¿æŒâ€net neutralityâ€ç½‘ç»œä¸­æ€§ã€‚å¯¹contracts or transactionsæ²¡æœ‰å…ˆå¤©çš„åå¥½æ€§ã€‚é€šè¿‡è®¾ç½®è´¹ç”¨å¼•å…¥æ¿€åŠ±ã€‚è¿™é‡Œæ¶‰åŠåˆ°gasçš„æ¦‚å¿µï¼ŒåŸºæœ¬ç†å¿µå°±æ˜¯å¯¹éœ€è¦è®¡ç®—å’Œå­˜å‚¨çš„æ“ä½œéœ€è¦ä»˜å‡ºä»£ä»·ã€‚å¯¹è®¡ç®—ï¼Œå¯¹å­˜å‚¨çš„å­—èŠ‚æ•°ç­‰è®¡ç®—ä¸€ä¸ªgaså€¼ï¼Œè€Œæ¯ä¸ªå‘é€æ–¹æŒ‡å®šä¸€ä¸ªgaså€¼æ‰€ç­‰å€¼çš„Ether(å³gas fee)ï¼Œç›¸ä¹˜å¾—å‡ºä¸ºå½“å‰çš„äº¤æ˜“è´¹ç”¨ã€‚äº¤æ˜“è´¹ç”¨é«˜çš„å½“ç„¶ä¼˜å…ˆè¢«ç¡®è®¤ã€‚è¿™å°±æ˜¯æ‰€è°“çš„å°†è‡ªç”±åº¦äº¤è¿˜ç»™äº¤æ˜“å‘èµ·æ–¹ï¼Œè€ŒEthereumæœ¬èº«ä¿æŒä¸­æ€§æ— åå¥½ã€‚å¼•å…¥è®¡ç®—å’Œå­˜å‚¨è´¹ç”¨ï¼Œä¹Ÿå¯ä»¥é˜²æ­¢DOSæ”»å‡»ã€‚</p></li><li><p><strong>é«˜é£é™©æ‰¿å—åŠ›</strong><br>å¯ä»¥æ¥å—é«˜æ”¶ç›Šå¸¦æ¥çš„é«˜é£é™©ï¼ˆä¾‹å¦‚å‡ºå—é€Ÿåº¦æå‡50å€ï¼Œå…±è¯†æ•ˆç‡ç­‰ï¼‰ï¼Œæ„å‘³ç€åè®®æ¼”è¿›è¿‡ç¨‹å¯èƒ½ä¼šå˜åŠ¨è¾ƒå¤§</p></li></ol><span id="more"></span><h3 id="ä½¿ç”¨Accountæ¨¡å‹è€ŒéUTXO"><a href="#ä½¿ç”¨Accountæ¨¡å‹è€ŒéUTXO" class="headerlink" title="ä½¿ç”¨Accountæ¨¡å‹è€ŒéUTXO"></a>ä½¿ç”¨Accountæ¨¡å‹è€ŒéUTXO</h3><p>unspent transaction outputs (UTXOs)åœ¨æ•°å­—è´§å¸å†…å¹¿æ³›ä½¿ç”¨ï¼Œå³æ‰€æœ‰è€…å…³è”ç€å¤šç¬”UTXOï¼Œå…¶å’Œä¸ºæ‰€æœ‰è€…å¯¹è´¦æˆ·ä½™é¢ï¼Œæ¯æ¬¡äº¤æ˜“ä»¥å•ç¬”æˆ–è€…å¤šç¬”UTXOä¸ºè¾“å…¥ï¼Œè¾“å‡ºä¹Ÿä¸ºUTXOã€‚ä¸»è¦ç¬¦åˆä¸‰ä¸ªçº¦æŸï¼š</p><ol><li>è¾“å…¥çš„UTXOæœ‰æ•ˆï¼Œå¹¶ä¸”æœªè¢«æ¶ˆè´¹</li><li>äº¤æ˜“è€…èƒ½è¯å®UTXOçš„æ‰€æœ‰æƒï¼ˆç­¾åï¼‰</li><li>è¾“å…¥UTXOç­‰äºæˆ–è€…è¶…è¿‡è¾“å‡ºUTXOï¼ˆæ¶ˆè´¹ï¼Œè½¬è´¦ç­‰ï¼‰  </li></ol><p>UTXOçš„å¥½å¤„åœ¨äºï¼š</p><ol><li><strong>é«˜éšç§åº¦</strong> - æ¯æ¬¡äº¤æ˜“éƒ½ä½¿ç”¨æ–°åœ°å€ï¼Œåˆ™è¿™äº›è´¦æˆ·å¾ˆéš¾è¢«å…³è”èµ·æ¥ã€‚ä½†æ˜¯dappåè€Œé€šå¸¸éœ€è¦å…³è”ç”¨æˆ·çŠ¶æ€ã€‚</li><li><strong>æ½œåœ¨çš„é«˜æ‰©å±•åº¦</strong> - ç”¨æˆ·è‡ªèº«ä¿ç®¡UTXOï¼Œå…¨ç½‘ä¸¢å¤±åªä¼šå½±å“å½“å‰ç”¨æˆ·ã€‚è€Œè´¦æˆ·æ¨¡å‹ä¸‹ï¼Œæ˜¯è®°å½•åœ¨merkle treeå†…çš„ï¼Œå¦‚æœå…¨ç½‘ä¸¢å¤±è¯¥è´¦æˆ·è®°å½•ï¼Œåˆ™æ°¸ä¹…å½±å“è¯¥è´¦æˆ·ã€‚</li></ol><p>ï¼ˆå®é™…ä¸Šï¼ŒUTXOæ¨¡å‹è¿˜æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼‰  </p><ol><li>è´¦æˆ·æ•°æ®åº“ä¼šä¸æ–­è†¨èƒ€ï¼Œå› ä¸ºè´¦æˆ·ä¸ä¼šè¢«åˆ é™¤ï¼Œè€ŒUTXOæ•°æ®åº“ä½“ç§¯ä¼šå°å¾ˆå¤šã€‚</li><li>ç”±äºåªæœ‰æœªèŠ±è´¹çš„è¾“å‡ºä¼šè¢«ä¿ç•™ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªæ¯”ç‰¹å¸ç”¨æˆ·å¯ä»¥æ‹¥æœ‰å‡ ä¹æ— é™å¤šçš„åœ°å€ï¼Œæé«˜äº†åŒ¿åæ€§ã€‚</li><li>UTXOä¸ºé«˜å¹¶å‘çš„äº¤æ˜“å¸¦æ¥å¯èƒ½ï¼Œè¯•æƒ³ä¼ ç»Ÿçš„è´¦æˆ·æ¨¡å‹ï¼Œæ¯ä¸ªäººçš„è´¦æˆ·äº¤æ˜“å¿…é¡»æ˜¯çº¿æ€§çš„ï¼Œæ— æ³•å¹¶å‘ã€‚è€Œç°åœ¨æ¯ä¸ªäººå¯èƒ½æ‹¥æœ‰å¤šä¸ªUTXOï¼Œå¯åŒæ—¶å‘èµ·å¤šç¬”äº¤æ˜“ï¼Œå®ç°äº†å¹¶å‘ã€‚</li></ol><p>è€ŒAccountæ¨¡å‹å¥½å¤„åœ¨äºï¼š</p><ol><li><strong>èŠ‚çº¦å­˜å‚¨ç©ºé—´</strong> - å¤šä¸ªUTXOçš„å­˜å‚¨åˆå¹¶æˆä¸€ä¸ªAccount</li><li>å¯ä»¥åˆ¤æ–­æ¥æºï¼Œä»è€Œå»ºç«‹çº¢é»‘åå•</li><li>ç†è§£å’Œç¼–ç¨‹æ¨¡å‹ç®€å•ï¼Œè€Œä¸”light clientå¯ä»¥ç›´æ¥è·Ÿè¸ªç‰¹å®šçš„accountï¼Œè€Œä¸ç”¨è·Ÿè¸ªæ¯ç¬”äº¤æ˜“å¸¦æ¥çš„å½±å“</li></ol><p>Accountçš„é—®é¢˜åœ¨äºé‡æ”¾æ”»å‡»ï¼Œå› æ­¤å¯ä»¥æ¯ä¸ªäº¤æ˜“æ·»åŠ nonceï¼Œæ¯æ¬¡äº¤æ˜“nonceé€’å¢åŠ 1ã€‚åŒæ—¶ï¼Œäº¤æ˜“åŒ…å«åŒºå—å·ï¼Œå®šæœŸçš„ä¿®å‰ªåˆ é™¤ä¸å†ä½¿ç”¨çš„è´¦æˆ·ã€‚</p><h3 id="Gas-and-Fee"><a href="#Gas-and-Fee" class="headerlink" title="Gas and Fee"></a>Gas and Fee</h3><p>Bitcoinç­‰æ•°å­—è´§å¸æ“ä½œæ¯”è¾ƒç®€å•å’Œå•ä¸€çš„äº¤æ˜“è½¬è´¦è¡Œä¸ºï¼Œè€ŒEthereumåˆ™æ˜¯å›¾çµå®Œå¤‡ï¼Œå…·æœ‰å¾ˆé«˜çš„åˆçº¦è‡ªç”±åº¦ã€‚å¼•å…¥è´¹ç”¨é˜²æ­¢åˆçº¦æ‰§è¡Œæ— é™å¾ªç¯çš„DOSï¼Œå®é™…ä¸Šå°±æ˜¯å¼•å…¥ä½œæ¶æˆæœ¬ã€‚</p><ol><li>å‘èµ·è°ƒç”¨åˆçº¦ä¼šé¢„ç¼´startGas * gasPriceï¼ˆå³ä¸€ä¸ªgasç­‰ä»·äºçš„Etherï¼‰ï¼Œé€”ä¸­æ¯ä¸ªäº¤æ˜“æ“ä½œä¼šç›¸åº”æ‰£é™¤gasï¼Œåˆçº¦ç»“æŸåå‰©ä½™çš„gasé€€è¿˜åˆ°å‘èµ·è´¦æˆ·ï¼Œæ¶ˆè€—çš„gaså¥–åŠ±ç»™minerã€‚å¦‚æœä¸­é€”gaså·²æ¶ˆè€—å®Œï¼Œåˆ™è¯¥æ¬¡äº¤æ˜“å†…ä¹‹å‰å·²æ‰§è¡Œçš„æ“ä½œå›æ»šï¼Œäº¤æ˜“å¤±è´¥ï¼Œgaså¥–åŠ±ç»™minerã€‚åˆçº¦é—´è°ƒç”¨ä¹Ÿéœ€è¦æ¶ˆè€—gasï¼Œç”±å‘èµ·åˆçº¦è®¾ç½®å€¼ã€‚</li><li>æŒ‰ç…§è®¡ç®—å¤æ‚åº¦ï¼ˆopcodeï¼‰ï¼Œæ•°æ®çš„å­—èŠ‚æ•°ï¼Œå­˜å‚¨çš„å­—èŠ‚æ•°ç­‰è®¡ç®—gaså€¼ã€‚æ­¤å¤–è¿˜æœ‰åŸºç¡€gasï¼Œç”¨ä»¥æ”¯ä»˜è®¡ç®—æ¤­åœ†æ›²çº¿ä»ç­¾åç¡®è®¤èº«ä»½ç­‰ã€‚ä¹Ÿå³æ˜¯æŒ‰æ¶ˆè€—ä»˜æ¬¾ã€‚</li><li>åˆ é™¤å­˜å‚¨çš„ç©ºé—´çš„æ“ä½œæœ‰gas refundå¥–åŠ±ï¼Œé¼“åŠ±å‡å°‘å­˜å‚¨ç©ºé—´ã€‚</li><li>gasPriceçš„è®¾ç½®åˆ™å˜æˆç»æµä¾›æ±‚å…³ç³»ï¼Œè‡ªç”±ç«äº‰æœ€ç»ˆè¾¾åˆ°åŠ¨æ€å¹³è¡¡ã€‚å‡ºä»·é«˜æ”¶ç›Šå¤§çš„äº¤æ˜“ä¼šè¢«ä¼˜å…ˆæ‰§è¡Œå’Œç¡®è®¤ã€‚</li></ol><h3 id="RLP"><a href="#RLP" class="headerlink" title="RLP"></a>RLP</h3><p><a href="https://github.com/ethereum/wiki/wiki/RLP">RLP</a> (â€œrecursive length prefixâ€) encoding is the main serialization format used in Ethereumã€‚ä¾‹å¦‚ï¼ŒAccountç­‰æ•°æ®ä»å†…å­˜å†™å…¥æŒä¹…åŒ–å­˜å‚¨æ—¶ä¼šå°†Hex16è¿›åˆ¶è½¬æ¢æˆRLPæŒä¹…åŒ–(ç»“åˆMPTæ ‘ï¼Œå°†Extension node, Leaf node, Branch nodeç­‰æ•°æ®ç»“æ„è¿›è¡ŒRLPç¼–ç )ï¼Œç´§å‡‘èŠ‚çœç©ºé—´ã€‚ç›¸æ¯”protocol bufferå’ŒBSONç­‰ç°å­˜çš„åºåˆ—åŒ–æ–¹æ¡ˆï¼Œä»æ–°å¼€å‘RLPåºåˆ—åŒ–æ–¹æ¡ˆçš„ç›®çš„æ˜¯ï¼Œ1ï¼‰å®ç°ç®€å•ã€‚ç›®çš„å°±æ˜¯è¦é«˜åº¦ç®€åŒ–ï¼Œå­˜å‚¨åµŒå¥—çš„å­—èŠ‚åºåˆ—ï¼Œç”±ä¸Šå±‚åº”ç”¨å†³å®šè¿™äº›å­—èŠ‚åºåˆ—çš„å«ä¹‰ã€‚2ï¼‰ä¿è¯å­—èŠ‚çº§çš„ç»å¯¹ä¸€è‡´æ€§ï¼ˆKey/value mapsçš„æœ‰åºæ€§ï¼Œæµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜ç­‰ï¼‰ã€‚RLPå°† 1ï¼‰å­—ç¬¦ä¸²ï¼ˆå­—èŠ‚åºåˆ—ï¼‰ä½œä¸ºitemï¼Œ2ï¼‰itemåˆ—è¡¨ä¹Ÿçœ‹ä½œä¸€ä¸ªitemï¼Œé’ˆå¯¹è¿™äº›itemä½¿ç”¨å…¶å®šä¹‰çš„åºåˆ—åŒ–ç¼–è§£ç æ–¹å¼ã€‚</p><h3 id="EVMè™šæ‹Ÿæœº"><a href="#EVMè™šæ‹Ÿæœº" class="headerlink" title="EVMè™šæ‹Ÿæœº"></a>EVMè™šæ‹Ÿæœº</h3><p>è®¾è®¡ç†å¿µï¼š</p><ol><li>ç®€å• å°½é‡å°‘çš„æ•°æ®ç±»å‹ï¼Œå°½é‡å°‘çš„æ“ä½œæŒ‡ä»¤ã€‚å°½é‡èŠ‚çœçš„ç©ºé—´ã€‚ç»“åˆèµ·gasæ¶ˆè´¹æ¨¡å‹ï¼Œä¹Ÿä»æ ¹æœ¬ä¸Šä¿è¯å®‰å…¨ä¸è¢«æ— é™åˆ¶åˆ©ç”¨ã€‚</li><li>å®šåˆ¶åŒ– é’ˆå¯¹ä»¥å¤ªåŠå¸¸è§åº”ç”¨ï¼Œå¯¹20å­—èŠ‚åœ°å€ï¼Œ32å­—èŠ‚å¯¹åŠ å¯†ç®—æ³•ï¼ŒåŠ å¯†ç®—æ³•ä¸­çš„æ•°å­¦è¿ç®—ï¼Œè¯»å–å­˜å‚¨åŒºå—åŠäº¤æ˜“ä¿¡æ¯ç­‰ï¼Œä½œè™šæ‹Ÿæœºå±‚é¢çš„å®šåˆ¶åŒ–çš„ä¼˜åŒ–</li></ol><p><img src="/images/ethereum-evm.png" alt=""></p><p>å…·ä½“çš„è®¾è®¡ï¼š</p><ol><li>å­˜å‚¨æ¨¡å‹ EVMæ˜¯åŸºäºæ ˆçš„è®¡ç®—æ¨¡å‹ã€‚stackï¼ˆ32å­—èŠ‚ï¼Œè¿è¡Œå †æ ˆï¼Œæ‰€æœ‰è¿ç®—åœ¨æ ˆä¸Šæ‰§è¡Œï¼Œç®—å­å’Œæ‰§è¡Œä¸­é—´ç»“æœéƒ½ä»æ ˆå­˜å‚¨å’Œè¯»å–ï¼‰ï¼Œmemoryï¼ˆbyteæ•°ç»„ï¼Œå­˜å‚¨å‡½æ•°è°ƒç”¨çš„å‚æ•°ï¼Œæœ¬åœ°å˜é‡ï¼Œè¿”å›å€¼ç­‰ï¼‰ï¼Œstorageï¼ˆKVæŒä¹…åŒ–å­˜å‚¨ï¼Œ256-bit words to 256-bit wordsï¼‰</li><li>åˆçº¦é—´è°ƒç”¨å†…å­˜éš”ç¦»ï¼ŒåŒºåˆ†ä¸´æ—¶å­˜å‚¨å’ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œé€’å½’è°ƒç”¨æ¯æ¬¡éƒ½ä½¿ç”¨ç‹¬ç«‹çš„å®ä¾‹ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜åœ°å€ç©ºé—´ã€‚å…·ä½“å®ä¾‹å‚çœ‹åŸæ–‡ã€‚</li><li>32å­—èŠ‚çš„ä½å®½ åŠ å¯†ç®—æ³•ä½¿ç”¨32å­—èŠ‚ï¼Œå› æ­¤32å­—èŠ‚ä½å®½ä¸éœ€è¦åˆ†å¼€å­˜å‚¨ï¼Œä¹Ÿä¸è‡³äºæµªè´¹ç©ºé—´ã€‚</li><li>1024å±‚çš„æ ˆè°ƒç”¨æ·±åº¦ï¼Œå¹¶ä¸”å•ä¸ªæ“ä½œç æœ€å¤šåªèƒ½æ“ä½œæ ˆé¡¶çš„16ä¸ªå…ƒç´ </li><li>å®šåˆ¶åŒ–VM æ²¡æœ‰ä½¿ç”¨JVMç­‰åŸå› åœ¨äºï¼š1ï¼‰EVMç›¸å¯¹ç®€å•ï¼Œé¿å…å¤æ‚å¸¦æ¥çš„å®‰å…¨æ€§ç­‰é£é™©ï¼›2ï¼‰å¯ä»¥é’ˆå¯¹æ€§å®šåˆ¶åŒ–è®¾è®¡ï¼›3ï¼‰ä¸å­˜åœ¨éƒ¨ç½²çš„å¤–éƒ¨ä¾èµ–ï¼›4ï¼‰ä¸éœ€è¦æ”¹é€ å…¶ä»–VMæ—¶å¸¦æ¥çš„å®‰å…¨æ€§å®¡æ ¸å·¥ä½œ</li></ol><blockquote><p><a href="https://takenobu-hs.github.io/downloads/ethereum_evm_illustrated.pdf">EVMè¯¦è§£</a> : è¯¦ç»†çš„pptç‰ˆæœ¬<br><a href="https://www.mayowatudonu.com/blockchain/deep-dive-into-evm-memory-and-storage">A Deep Dive into the Ethereum Virtual Machine (EVM) - part 2: Memory and Storage</a> : åŒ…å«EVMçš„æ“ä½œæŒ‡ä»¤opcodes</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Blockchain </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ethereum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabricçš„configtxgenå·¥å…·ç”ŸæˆåŒºå—åŠé…ç½®æ–‡ä»¶åˆ†æ</title>
      <link href="//articles/fabric-configtxgen-tool/"/>
      <url>//articles/fabric-configtxgen-tool/</url>
      
        <content type="html"><![CDATA[<p>æœ¬èŠ‚ä¸»è¦åŸºäº<a href="https://github.com/hyperledger/fabric-samples/tree/release-1.4/basic-network">fabric-samples/basic-network</a>åˆ†æã€‚æŸ¥çœ‹<code>generate.sh</code>è¿™ä¸ªè„šæœ¬ï¼Œé‡Œé¢ä¸»è¦æ‰§è¡Œäº†å¦‚ä¸‹å››ä¸ªå‘½ä»¤<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// ç”Ÿæˆmspæ¨¡å—éœ€è¦çš„è¯ä¹¦</span><br><span class="line">cryptogen generate --config=./crypto-config.yaml</span><br><span class="line"></span><br><span class="line">// ç”Ÿæˆåˆ›ä¸–å—</span><br><span class="line">configtxgen -profile OneOrgOrdererGenesis -outputBlock ./config/genesis.block</span><br><span class="line"></span><br><span class="line">// ç”Ÿæˆåˆ›å»ºchannelçš„é…ç½®</span><br><span class="line">configtxgen -profile OneOrgChannel -outputCreateChannelTx ./config/channel.tx -channelID <span class="variable">$CHANNEL_NAME</span></span><br><span class="line"></span><br><span class="line">// ç”Ÿæˆè®¾ç½®anchorèŠ‚ç‚¹çš„é…ç½®</span><br><span class="line">configtxgen -profile OneOrgChannel -outputAnchorPeersUpdate ./config/Org1MSPanchors.tx -channelID <span class="variable">$CHANNEL_NAME</span> -asOrg Org1MSP</span><br></pre></td></tr></table></figure></p><p><code>cryptogen</code>å’Œ<code>configtxgen</code>åˆ†åˆ«ç”¨äºåŠ å¯†å’Œé…ç½®çš„å·¥å…·ï¼Œå…¶ä»£ç è·¯å¾„ä¸º<code>hyperledger/fabric/common/tools/cryptogen</code>å’Œ<code>hyperledger/fabric/common/tools/configtxgen</code>ã€‚cryptogenäº§ç”Ÿäº†å„çº§mspï¼Œåœ¨peerï¼Œordereré‡Œçš†æœ‰ç”¨åˆ°ï¼ŒåŒ…æ‹¬åé¢ä»‹ç»çš„configtxgené‡ŒåŒ…å«mspä¿¡æ¯è¿™äº›ä¹Ÿæ˜¯ç”±æ­¤äº§ç”Ÿã€‚è¿™é‡Œæš‚ä¸”ä¸å±•å¼€åˆ†æã€‚</p><p>åœ¨<code>configtxgen/main.go</code>é‡Œï¼Œä¾ç„¶ä½¿ç”¨viperä½œä¸ºå‘½ä»¤è¡Œç®¡ç†å·¥å…·ã€‚ä»£ç æ¯”è¾ƒç›´è§‚ï¼Œé˜…è¯»ç®€å•ä¸å±•å¼€åˆ†æï¼Œæ„Ÿå…´è¶£å¯ä»¥å‚è€ƒ<a href="https://www.chaindesk.cn/witbook/30/503">Hyperledger Fabricï¼ˆV1.2ï¼‰æºç æ·±åº¦è§£æï¼configtxgenå‘½ä»¤è§£æ</a>ï¼Œå†™çš„æ¯”è¾ƒæ¦‚è¿°ã€‚å…¶ä¸­è¯»å–é…ç½®æ–‡ä»¶çš„<code>common/tools/configtxgen/localconfig/config.go#Load</code>æ–¹æ³•é‡Œï¼Œä¸»è¦ç”±ä»¥ä¸‹å‡ è¡Œ<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Prefix <span class="keyword">string</span> = <span class="string">&quot;CONFIGTX&quot;</span></span><br><span class="line"><span class="keyword">var</span> configName = strings.ToLower(Prefix)</span><br><span class="line"></span><br><span class="line">viper.SetConfigName(configName)</span><br></pre></td></tr></table></figure><br>å¯è§ï¼Œé»˜è®¤è¯»å–çš„æ˜¯å½“å‰ç›®å½•çš„<code>configtx.yaml</code>é…ç½®æ–‡ä»¶ã€‚ç”Ÿæˆåˆ›ä¸–å—å’Œåˆ›å»ºchannelçš„é…ç½®å¯¹åº”çš„åˆ†åˆ«æ˜¯<code>doOutputBlock</code>å’Œ<code>doOutputChannelCreateTx</code>è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚<code>doOutputBlock</code>ç”Ÿæˆ<code>cb.Block</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é€šè¿‡<code>ioutil.WriteFile(outputBlock, utils.MarshalOrPanic(genesisBlock), 0644)</code>å†™åˆ°æŒ‡å®šçš„<code>genesis.block</code>è¿™ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥ä½¿ç”¨<code>configtxgen -inspectBlock genesis.block</code>è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹ã€‚ç”Ÿæˆçš„JSONæ ¼å¼æ–‡ä»¶å¯å‚è§<a href="https://github.com/simplexity-ckcclc/gofabric/blob/master/doc/fabric-samples/basic-network/genesis_block.json">JSONç»“æ„</a>ã€‚å…¶ä¸­ChannelHeaderTypeè®¾ç½®ä¸ºHeaderType_CONFIGï¼Œblock.numberä¸º0ï¼ŒpreviousHashä¸ºnilã€‚payloadé‡Œä¸»è¦æ˜¯ConfigGroupå¯¹è±¡ï¼ŒåŒ…å«æœ‰åºå·sequenceï¼Œä»¥åŠchannel_groupå¯¹è±¡ã€‚channel_groupä¸»è¦æ˜¯Consortiumï¼ˆåŒ…å«versionï¼Œpoliciesï¼Œconfigtx.yamlé‡Œå®šä¹‰çš„orgsï¼Œæ­¤å¤„orgsé‡ŒåˆåŒ…å«MSPå’Œpoliciesï¼‰å’ŒOrdererï¼ˆåŒ…å«policiesï¼Œmspï¼‰ã€‚åŒæ—¶ConfigGroupè¿˜åŒ…å«OrdererAddress,hashAlgorithm,BlockDataHashiungStructureè¿™äº›ã€‚ä»ä¸­ï¼Œè¿˜å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸€çº§çš„è®¾ç½®ï¼Œéƒ½åŒ…å«ä¸åŒçš„polociesã€‚</p><p><code>doOutputChannelCreateTx</code>ç”Ÿæˆ<code>cb.Envelope</code>å¯¹è±¡ï¼Œå†™åˆ°<code>channel.tx</code>ã€‚ChannelHeaderTypeè®¾ç½®ä¸ºHeaderType_CONFIG_UPDATEï¼Œchannel_idä¸ºå‘½ä»¤åå‚æ•°$CHANNEL_NAMEã€‚payloadé‡Œæ˜¯<code>cb.ConfigUpdateEnvelope</code>å¯¹è±¡ï¼ŒåŒ…å«channel_id, read_set, write_set. è¿™é‡Œï¼Œread_seté‡Œpoliciesä¸ºç©ºï¼Œversionä¸º0ï¼›write_seté‡Œversionä¸º1ï¼Œå¹¶ä¸”å®šä¹‰äº†policiesã€‚æ‰€ä»¥å½“ä½¿ç”¨è¯¥channel.txæ–‡ä»¶å†æ¬¡åˆ›å»ºå·²ç»å­˜åœ¨çš„channelæ—¶ï¼Œä¼šæŠ¥é”™verifyReadsetå¤±è´¥ã€‚åŒæ ·çš„å¯ä»¥ç”¨<code>configtxgen --inspectChannelCreateTx channel.tx</code>è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹å…¶<a href="https://github.com/simplexity-ckcclc/gofabric/blob/master/doc/fabric-samples/basic-network/channel_tx.json">JSONç»“æ„</a>ã€‚</p><p>æŸ¥çœ‹<code>start.sh</code>è„šæœ¬ï¼Œå®é™…ä¸Šåœ¨peerèŠ‚ç‚¹ä½¿ç”¨Adminè§’è‰²æ‰§è¡Œäº†åˆ›å»ºchannelå‘½ä»¤ã€‚<code>peer channel create -o orderer.example.com:7050 -c mychannel -f /etc/hyperledger/configtx/channel.tx</code>ã€‚å½“é¡ºåˆ©æ‰§è¡Œåï¼Œç»“æœè¿”å›ä¸€ä¸ªå½“å‰channelçš„é¦–ä¸ªblockï¼Œåç§°ä¸º<code>$&#123;CHANNEL_NAME&#125;.block</code>ã€‚è¿™é‡Œblockçš„numberä¸º0ï¼Œpre_hashä¸ºnullï¼Œchannel_headeré‡Œçš„channel_idæ˜¯å½“å‰channelåç§°ï¼ŒChannelHeaderTypeè¿˜æ˜¯HeaderType_CONFIGã€‚è¿™é‡Œå› ä¸ºä½¿ç”¨äº†Adminè§’è‰²åˆ›å»ºï¼Œå› æ­¤signature_headeré‡Œè®°å½•äº†creatorçš„ä¿¡æ¯ã€‚è€ŒpayloadåŒæ—¶åŒ…å«äº†åˆ›ä¸–å—genesis.blockå’Œåˆ›å»ºchannelé…ç½®æ–‡ä»¶channel.txçš„ä¿¡æ¯ï¼Œç‰¹åˆ«çš„æ˜¯ï¼Œé‡Œé¢last_updateå­—æ®µåˆ™å®Œæ•´è®°å½•äº†<code>channel.tx</code>ã€‚åŒæ ·çš„å¯ä»¥ç”¨<code>configtxgen -inspectBlock $&#123;CHANNEL_NAME&#125;.block</code>è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹å…¶<a href="https://github.com/simplexity-ckcclc/gofabric/blob/master/doc/fabric-samples/basic-network/mychannel.json">JSONç»“æ„</a>ã€‚è¿™ä¸ªåŒºå—åœ¨<code>start.sh</code>è„šæœ¬é‡Œåç»­ç”¨äº<code>channel join -b mychannel.block</code>å°†èŠ‚ç‚¹åŠ å…¥åˆ°è¯¥channelã€‚</p><h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h3><blockquote><p><a href="https://tech.lock-in.cn/news/a74a120208ac49c0a457e54e9efed4bb">Hyperledger Fabricæƒé™è¿›é˜¶ç¯‡</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯†ç å­¦åŸºç¡€çŸ¥è¯†æ±‡æ€»åŠFabricçš„MSPä½“ç³»</title>
      <link href="//articles/fabric-cryptography-msp-summary/"/>
      <url>//articles/fabric-cryptography-msp-summary/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡åªæ˜¯æ±‡æ€»åœ¨å­¦ä¹ å¯†ç å­¦å’ŒFabricçš„MSPä½“ç³»è¿‡ç¨‹ä¸­çš„é˜…è¯»ï¼Œæ–¹ä¾¿æ—¥åå›å¤´ç¿»é˜…ï¼Œå¯ä»¥è¿…é€Ÿå›å¿†ã€‚æ¶‰åŠå†…å®¹è¾ƒå¤šä¸»ä½“è¾ƒä¸ºåˆ†æ•£ï¼ŒæŒ‚ä¸€æ¼ä¸‡ã€‚ä»æœ‰å¾…æ·±å…¥ç ”ç©¶å­¦ä¹ ã€‚</p><ol><li><p>å¯†ç å­¦çš„åŸºç¡€çŸ¥è¯†æ¦‚è¿°ï¼ˆHashç®—æ³•ï¼Œå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ŒX.509è¯ä¹¦ï¼‰</p><blockquote><ul><li><a href="https://blog.csdn.net/ckcclc/article/details/89361898">CSDNç¬”è®° - MD5, SHA, AES, DES, X.509, PKCSæ¦‚è¿°</a> : è®°å½•åŸºç¡€çŸ¥è¯† </li><li><a href="https://knowledge.digicert.com/solution/SO4583.html">Structure of X509 Certificates</a> : X.509ç»“æ„  </li></ul></blockquote></li><li><p>RSA</p><blockquote><ul><li><a href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">RSAç®—æ³•åŸç†(ä¸€)</a></li><li><a href="http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html">RSAç®—æ³•åŸç†(äºŒ)</a> : æ•°å­¦åŸç†ä»‹ç»ï¼Œæ¬§æ‹‰å‡½æ•°ï¼Œå¤§æ•°å› æ•°åˆ†è§£</li></ul></blockquote></li><li><p>ECCï¼ˆæ¤­åœ†æ›²çº¿ï¼‰</p><blockquote><ul><li><a href="https://andrea.corbellini.name/2015/05/17/elliptic-curve-cryptography-a-gentle-introduction/">Elliptic Curve Cryptography: a gentle introduction</a> : è‹±æ–‡ä»‹ç»ç³»åˆ—ï¼ŒåŸç†è§£é‡Šã€‚éæ¬§å¼å‡ ä½•ï¼Œæœ‰é™åŸŸç¦»æ•£å¯¹æ•°é—®é¢˜ã€‚å¼ºåŠ›æ¨è  </li><li><a href="https://www.ssl.com/article/comparing-ecdsa-vs-rsa/">Comparing ECDSA vs RSA</a> : ECDSAå’ŒRSAçš„å…¨æ–¹ä½å¯¹æ¯”ã€‚RSAå†å²æ›´æ‚ ä¹…æ›´æˆç†Ÿï¼Œéƒ¨åˆ†CAè¿˜ä¸æ”¯æŒECDSAã€‚åœ¨æä¾›ç›¸åŒå®‰å…¨ç¨‹åº¦ä¸Šï¼ŒECDSAéœ€è¦çš„bitæ›´å°‘ã€‚åŒæ—¶ï¼ŒRSA seems to be significantly faster than ECDSA in verifying signatures, though it is slower while signing. Higher security level require more bits, this results in RSAâ€™s performance to decline dramatically, whereas ECDSA is only slightly affected.</li></ul></blockquote><p>å½“å‰ï¼ŒFabricçš„ç­¾åç®—æ³•åªæ”¯æŒECDSAï¼ˆThe signing key used for signing by the node <strong>(currently only ECDSA keys are supported)</strong>ï¼‰ï¼Œæ‘˜è‡ª<a href="https://hyperledger-fabric.readthedocs.io/en/master/msp.html#how-to-generate-msp-certificates-and-their-signing-keys">Fabricå®˜ç½‘-Membership Service Providers (MSP)</a></p><p>Ref: Bitcoinå’ŒEthereumä¸­çš„vrsï¼ˆvï¼šrecovery idï¼‰</p><blockquote><ul><li><a href="https://bitcoin.stackexchange.com/questions/38351/ecdsa-v-r-s-what-is-v">ECDSA: (v, r, s), what is v?</a> ï¼š Strictly speaking the recid is not necessary, as we can just cycle through all the possible coordinate pairs and check if any of them match the signature. The recid just speeds up this verification.</li><li><a href="https://crypto.stackexchange.com/questions/18105/how-does-recovering-the-public-key-from-an-ecdsa-signature-work">How does recovering the public key from an ECDSA signature work?</a></li></ul></blockquote></li><li><p>é›¶çŸ¥è¯†è¯æ˜ Zero-Knowledge-Proof</p><blockquote><ul><li><a href="https://en.wikipedia.org/wiki/Zero-knowledge_proof">Zero-Knowledge-Proof Wikipedia</a>  </li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/idemix.html">MSP Implementation with Identity Mixer</a> : Fabricé‡Œå¯¹é›¶çŸ¥è¯†è¯æ˜çš„ä½¿ç”¨  </li></ul></blockquote></li><li><p>Fabricå®˜ç½‘çš„MSPç›¸å…³æ–‡æ¡£æ±‡æ€»</p><blockquote><ul><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/identity/identity.html">Identity</a> : æœ€åŸºæœ¬çš„æ¦‚å¿µï¼ŒPKIä½“ç³»ï¼ŒX.509è¯ä¹¦ï¼ŒCAï¼ŒCRLï¼Œæ¦‚å¿µä»‹ç»  </li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/membership/membership.html">Membership</a> : æ¦‚å¿µä»‹ç»ï¼ŒMSPçš„å±‚æ¬¡è®¾è®¡ï¼ˆLocal MSPï¼ŒChannel MSPï¼‰ï¼ŒMSPçš„ç»“æ„ï¼ˆä¸»è¦æ˜¯åœ¨èŠ‚ç‚¹å†…çš„è¯ä¹¦å­˜æ”¾ç›®å½•ï¼‰ï¼Œä»¥åŠä¸Orgçš„å…³ç³»  </li><li><a href="https://hyperledger-fabric.readthedocs.io/en/master/msp.html#how-to-generate-msp-certificates-and-their-signing-keys">Membership Service Providers (MSP)</a> : é…ç½®ï¼Œåå®è·µåº”ç”¨  </li></ul></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> Consensus &amp; Cryptography </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
            <tag> Cryptography </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabricå®˜ç½‘Commercial Paperæ¡ˆä¾‹chaincodeçš„golangå®ç°</title>
      <link href="//articles/fabric-commercial-paper-go/"/>
      <url>//articles/fabric-commercial-paper-go/</url>
      
        <content type="html"><![CDATA[<p>å®˜ç½‘ä¸Šæè¿°äº†<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/developapps/developing_applications.html">Commercial Paper</a>è¿™ä¸ªåº”ç”¨åœºæ™¯ï¼Œå¹¶ä¸”æä¾›äº†<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/tutorial/commercial_paper.html#">nodejså®ç°</a>ã€‚è¿™é‡Œè¡¥å……chaincodeçš„golangå®ç°ï¼Œä¿æŒé€»è¾‘ä¸€è‡´ï¼Œä»¥åŠè®°å½•å®é™…æ“ä½œä¸­çš„ä¸€äº›æ­¥éª¤å’Œè¦ç‚¹ã€‚å®ç°çš„æºç å·²ä¸Šä¼ <a href="https://github.com/simplexity-ckcclc/gofabric/tree/master/chaincode/commercial-paper/go">github</a>ã€‚</p><ol><li><p>æŒ‰ç…§å®˜ç½‘Commercial Paper nodejså®ç°é‡Œçš„æ­¥éª¤ï¼Œå¯åŠ¨<code>net_basic</code>ç½‘ç»œï¼Œå¹¶ä¸”å¯åŠ¨äº†<code>peer0.org1.example.com</code>, <code>couchdb</code>, <code>ca.example.com</code>, <code>orderer.example.com</code>, <code>cliDigiBank</code>, <code>cliMagnetoCorp</code>è¿™äº›å®¹å™¨ï¼ˆæŒ‰ç…§æ­¥éª¤é‡Œæ‰§è¡Œä¸‹æ¥ï¼Œdocker psèƒ½çœ‹åˆ°è¿™äº›å®¹å™¨ï¼‰ã€‚</p></li><li><p>install chaincodeã€‚æ‰§è¡Œ<code>docker inspect cliMagnetoCorp</code>ï¼Œèƒ½çœ‹åˆ°<code>/Users/ckcclc/github/fabric-samples/commercial-paper/organization/magnetocorp:/opt/gopath/src/github.com</code>è¿™ä¸ªè·¯å¾„ç»‘å®šã€‚åœ¨<code>/Users/ckcclc/github/fabric-samples/commercial-paper/organization/magnetocorp</code>åˆ›å»ºç›®å½•<code>gocontract</code>ï¼Œå°†golangå®ç°æ”¾åœ¨è¿™ä¸ªç›®å½•é‡Œã€‚è¿™æ—¶å€™ç™»å½•åˆ°<code>cliMagnetoCorp</code>å®¹å™¨ï¼Œå¯ä»¥çœ‹åˆ°å®¹å™¨å†…<code>/opt/gopath/src/github.com/application</code>ä¸‹æœ‰<code>gocontract</code>è¿™ä¸ªç›®å½•ï¼Œå¹¶ä¸”goå®ç°åœ¨å†…ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode install -n gopapercontract -v 0 -p github.com/gocontract</span><br></pre></td></tr></table></figure><p> åŒæ—¶ï¼Œ<code>docker inspect cliMagnetoCorp</code>(æˆ–è€…<code>cliMagnetoCorp</code>å®¹å™¨æ‰§è¡Œ<code>env</code>æŸ¥çœ‹ï¼‰ï¼Œ<code>GOPATH=/opt/gopath, CORE_PEER_ADDRESS=peer0.org1.example.com:7051</code>ã€‚<code>install</code>ä¼šåˆ°<code>$&#123;GOPATH&#125;/src</code>ä¸‹å¯»æ‰¾source codeã€‚ç„¶åinstall chaincodeåˆ°<code>$&#123;CORE_PEER_ADDRESS&#125;</code>ã€‚</p><p> ç™»å½•<code>peer0.org1.example.com</code>å®¹å™¨ã€‚<code>env</code>å‡ºæ¥<code>FABRIC_CFG_PATH=/etc/hyperledger/fabric</code>ï¼ŒæŸ¥çœ‹æ”¹è·¯å¾„ä¸‹çš„<code>core.yaml</code>é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­<code>peer.fileSystemPath : /var/hyperledger/production</code>ã€‚æŸ¥çœ‹<code>/var/hyperledger/production/chaincodes</code>ç›®å½•ï¼Œå­˜åœ¨æ–‡ä»¶<code>gopapercontract.0</code>(å³${chaincodeName}.${chaincodeVersion}).</p></li><li><p>instantiate chaincodeã€‚ç™»å½•<code>cliMagnetoCorp</code>å®¹å™¨ï¼Œæ‰§è¡Œ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode instantiate -n gopapercontract -v 0 -c <span class="string">&#x27;&#123;&quot;Args&quot;:[]&#125;&#x27;</span> -C mychannel -P <span class="string">&quot;AND (&#x27;Org1MSP.member&#x27;)&quot;</span></span><br></pre></td></tr></table></figure><p> æ­¤æ—¶ï¼Œ<code>docker ps</code>å¯ä»¥çœ‹åˆ°dev-peer0.org1.example.com-gopapercontract-0è¿™ä¸ªå®¹å™¨ã€‚å¯ä»¥åœ¨<code>cliMagnetoCorp</code>å®¹å™¨æ‰§è¡Œã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;issue&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;, &quot;2020-05-31&quot;, &quot;2020-11-30&quot;, &quot;5000000&quot;]&#125;&#x27;</span> -C mychannel -n gopapercontract</span><br><span class="line">peer chaincode query -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;]&#125;&#x27;</span> -C mychannel -n gopapercontract</span><br></pre></td></tr></table></figure><p> å¦‚æœåç»­æ›´æ–°chaincodeï¼Œå‡è®¾æ›´æ–°ç‰ˆæœ¬ä¸º1ï¼Œåˆ™æ‰§è¡Œ</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode upgrade -n gopapercontract -v 1 -c <span class="string">&#x27;&#123;&quot;Args&quot;:[]&#125;&#x27;</span> -C mychannel -P <span class="string">&quot;AND (&#x27;Org1MSP.member&#x27;)&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>fabric-samples/commercial-paper/organization/magnetocorp/application/issue.js</code>è¿™ä¸ªæ–‡ä»¶</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 63è¡Œ const contract = await network.getContract(&#x27;papercontract&#x27;, &#x27;org.papernet.commercialpaper&#x27;);</span></span><br><span class="line">    <span class="keyword">const</span> contract = <span class="keyword">await</span> network.getContract(<span class="string">&#x27;gopapercontract&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 73è¡Œ let paper = CommercialPaper.fromBuffer(issueResponse);</span></span><br><span class="line">    <span class="keyword">let</span> paper = <span class="built_in">JSON</span>.parse(issueResponse);</span><br></pre></td></tr></table></figure><p> ç„¶åï¼Œå°±å¯ä»¥æ­£å¸¸è°ƒç”¨<code>node issue.js</code>è®¿é—®åˆšå¯åŠ¨çš„golang commercial paperå®¹å™¨äº†ã€‚åœ¨æ•´ä¸ªæµç¨‹ä¸­ï¼Œå¯ä»¥æ‰§è¡Œ<code>./monitordocker.sh net_basic</code>æŸ¥çœ‹chaincodeçš„æ—¥å¿—ã€‚</p></li></ol><span id="more"></span><p>å¦å¤–ï¼Œåœ¨peer0.org1.example.comèŠ‚ç‚¹ä¸Šå¯ä»¥ä½¿ç”¨<code>peer chaincode list</code>å‘½ä»¤æŸ¥è¯¢channelå†…instantiatedçš„chaincodeä»¥åŠpeerä¸Šinstalledçš„chaincodeã€‚</p><ol><li>æŸ¥è¯¢channelå†…instantiatedçš„chaincodeã€‚   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ peer chaincode list -C mychannel --instantiated</span><br><span class="line"></span><br><span class="line">Get instantiated chaincodes on channel mychannel:</span><br><span class="line">Name: gopapercontract, Version: 1, Path: github.com/gocontract, Escc: escc, Vscc: vscc</span><br><span class="line">Name: papercontract, Version: 0, Path: /opt/gopath/src/github.com/contract, Escc: escc, Vscc: vscc</span><br></pre></td></tr></table></figure></li><li>æŸ¥è¯¢peerä¸Šinstalledçš„chaincodeã€‚ <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ peer chaincode list  -C mychannel --installed</span><br><span class="line"></span><br><span class="line">Error: Bad response: 500 - access denied <span class="keyword">for</span> [getinstalledchaincodes]: Failed verifying that proposal<span class="string">&#x27;s creator satisfies local MSP principal during channelless check policy with policy [Admins]: [This identity is not an admin]</span></span><br></pre></td></tr></table></figure> ä»è¿”å›ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå½“å‰ä½¿ç”¨çš„è§’è‰²å¹¶éAdminï¼ˆè¿™ä¸MSPç›¸å…³ï¼Œä½¿ç”¨çš„éAdminçš„X509è¯ä¹¦ï¼‰ã€‚å› æ­¤å¯ä»¥æŒ‡å®šä½¿ç”¨Adminã€‚ <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ä½¿ç”¨çš„MSP config</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$CORE_PEER_MSPCONFIGPATH</span></span><br><span class="line">/etc/hyperledger/msp/peer/</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒºåˆ«åœ¨äºkeystoreå­˜æ”¾çš„ç”¨æ¥ç­¾åè¯·æ±‚çš„ç§é’¥ã€‚</span></span><br><span class="line">$ ls <span class="variable">$CORE_PEER_MSPCONFIGPATH</span></span><br><span class="line">admincerts  cacerts  keystore  signcerts  tlscacerts</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ä½¿ç”¨Adminçš„MSP config</span></span><br><span class="line">$ CORE_PEER_MSPCONFIGPATH=/etc/hyperledger/msp/users/Admin@org1.example.com/msp</span><br><span class="line"></span><br><span class="line">$ peer chaincode list  -C mychannel --installed</span><br><span class="line"></span><br><span class="line">Get installed chaincodes on peer:</span><br><span class="line">Name: gopapercontract, Version: 0, Path: github.com/gocontract, Id: 44777e9463329c5b03a93abd48975980a795152907d0c6226b0b85589f4a0ca7</span><br><span class="line">Name: gopapercontract, Version: 1, Path: github.com/gocontract, Id: d000a5b0e4ed415ae1739e716c13a481096b947cb31dd5f25ab1d67633d18bb0</span><br><span class="line">Name: papercontract, Version: 0, Path: /opt/gopath/src/github.com/contract, Id: f09e75abcf455f6fb83257080ebd739f1d2397cf50ce2e52cd805d992a64bc03</span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨opensslæŸ¥çœ‹X.509è¯ä¹¦ã€‚ä¸‹é¢æ˜¯Adminè¯ä¹¦çš„ç¤ºä¾‹ <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ openssl x509 -noout -text -<span class="keyword">in</span> Admin\@org1.example.com-cert.pem</span><br><span class="line"></span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number:</span><br><span class="line">            15:2c:67:2c:01:ac:bb:4e:33:ac:59:00:13:0c:e7:eb</span><br><span class="line">    Signature Algorithm: ecdsa-with-SHA256</span><br><span class="line">        Issuer: C=US, ST=California, L=San Francisco, O=org1.example.com, CN=ca.org1.example.com</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Aug 31 09:14:32 2017 GMT</span><br><span class="line">            Not After : Aug 29 09:14:32 2027 GMT</span><br><span class="line">        Subject: C=US, ST=California, L=San Francisco, CN=Admin@org1.example.com</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: id-ecPublicKey</span><br><span class="line">                Public-Key: (256 bit)</span><br><span class="line">                pub:</span><br><span class="line">                    04:57:57:5f:98:ac:6c:14:a5:a8:ee:8e:83:34:12:</span><br><span class="line">                    1a:21:57:9b:08:23:c0:33:d0:bf:b0:b0:6d:e2:92:</span><br><span class="line">                    51:ad:ef:69:58:4f:7c:ec:38:d7:66:86:77:82:57:</span><br><span class="line">                    38:f8:3a:0f:32:d4:e6:05:1a:9b:3d:5c:18:71:4b:</span><br><span class="line">                    e9:6d:86:3c:a7</span><br><span class="line">                ASN1 OID: prime256v1</span><br><span class="line">                NIST CURVE: P-256</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Key Usage: critical</span><br><span class="line">                Digital Signature</span><br><span class="line">            X509v3 Basic Constraints: critical</span><br><span class="line">                CA:FALSE</span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                keyid:42:39:AA:0D:CD:76:DA:EE:B8:BA:0C:DA:70:18:51:D1:45:04:D3:1A:AD:1B:2D:DD:DB:AC:6A:57:36:5E:49:7C</span><br><span class="line"></span><br><span class="line">    Signature Algorithm: ecdsa-with-SHA256</span><br><span class="line">        30:44:02:20:5c:cc:b6:e8:01:14:<span class="built_in">fc</span>:65:0c:3d:f0:8c:b3:f9:</span><br><span class="line">        d0:8d:03:04:d5:9c:41:1c:06:19:b4:a1:2e:45:1d:fa:d4:9b:</span><br><span class="line">        02:20:48:3d:04:e6:5d:22:88:a8:46:2b:c9:0b:e6:54:ce:f2:</span><br><span class="line">        54:9e:45:ee:a3:61:e4:5a:2b:b1:2e:c8:9b:1b:1b:44</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…±è¯†ç®—æ³•(2) - Practical Byzantine Fault Toleranceè®ºæ–‡å­¦ä¹ ç¬”è®°</title>
      <link href="//articles/consensus-pbft-paper/"/>
      <url>//articles/consensus-pbft-paper/</url>
      
        <content type="html"><![CDATA[<h3 id="Service-Properties"><a href="#Service-Properties" class="headerlink" title="Service Properties"></a>Service Properties</h3><ol><li>ç®—æ³•çš„é€‚ç”¨èŒƒå›´<blockquote><p>Our algorithm can be used to implement any deterministic replicated service with a state and some operations.</p></blockquote></li></ol><ul><li><em>deterministic</em> ï¼šç¡®å®šæ€§æœåŠ¡ï¼Œå³ç›¸åŒçš„å‚æ•°æ‰§è¡Œç›¸åŒæ“ä½œï¼Œæ¯æ¬¡å¾—åˆ°çš„ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œä¸å­˜åœ¨éšæœºæ€§ï¼ˆthe execution of an operation in a given state and with a given set of arguments must always produce the same resultï¼‰</li><li><em>replicated</em> : å¤šå‰¯æœ¬</li><li><em>a state and some operations</em> : æœåŠ¡æœ‰ç›¸åŒçš„åˆå§‹çŠ¶æ€åŠç›¸åŒçš„æ“ä½œï¼Œä¿è¯å½“æŒ‰ç›¸åŒé¡ºåºæ‰§è¡Œå®Œç›¸åŒçš„æ“ä½œï¼Œå„ä¸ªå‰¯æœ¬çš„å³æ—¶çŠ¶æ€æ˜¯å®Œå…¨ä¸€è‡´çš„ (must start in the same state)</li></ul><ol><li>åœ¨å¼‚æ­¥ç³»ç»Ÿä¸­è¦å®¹å¿<code>f</code>ä¸ªæ¶æ„èŠ‚ç‚¹ï¼Œåˆ™è‡³å°‘éœ€è¦<code>3f+1</code>ä¸ªèŠ‚ç‚¹æ‰èƒ½æä¾›safety and livenessï¼ˆ<em>Asynchronous Consensus and Broadcast Protocols</em>è¿™ç¯‡è®ºæ–‡ä¸­è¯æ˜ï¼‰ã€‚</li></ol><ul><li><em>safety</em> : å‰¯æœ¬æœåŠ¡æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§ï¼Œåƒåœ¨ä¸­å¿ƒåŒ–æœåŠ¡ä¸­åŒæ—¶åŸå­æ€§çš„æ‰§è¡Œæ“ä½œã€‚ä¸å—æ¶æ„clientæ•°é‡å½±å“ï¼Œæ¶æ„clientçš„æ“ä½œå¯ä»¥é€šè¿‡è¢«æ­£å¸¸clientæ„ŸçŸ¥ï¼Œåˆ©ç”¨access controlæ¥é™åˆ¶ã€‚</li><li><em>liveness</em> : åˆ©ç”¨åŒæ­¥æä¾›livenessï¼ˆè®ºæ–‡è¯æ˜ï¼‰ã€‚åªè¦æ»¡è¶³<code>3f+1</code>ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥ä¿è¯clientæŒç»­é‡ä¼ ï¼Œå¹¶ä¸”åˆ°è¾¾destinationçš„ä¼ è¾“æ—¶é—´æ²¡æœ‰æ— é™çš„å¢é•¿æƒ…å†µä¸‹ï¼Œclientæœ€ç»ˆä¼šæ”¶åˆ°å›å¤ã€‚</li></ul><ol><li>ç®—æ³•ä¸æä¾›éšç§å®¹é”™æ€§ï¼Œå³éšç§ä¿¡æ¯ä¼šæ³„æ¼ç»™æ¶æ„èŠ‚ç‚¹<blockquote><p>The algorithm does not address the problem of fault- tolerant privacy: a faulty replica may leak information to an attacker.</p></blockquote></li></ol><span id="more"></span><h3 id="The-Algorithm"><a href="#The-Algorithm" class="headerlink" title="The Algorithm"></a>The Algorithm</h3><h4 id="0-æœ¯è¯­"><a href="#0-æœ¯è¯­" class="headerlink" title="0. æœ¯è¯­"></a>0. æœ¯è¯­</h4><ul><li><em>view</em> ï¼šç±»ä¼¼raftçš„termï¼Œview numberåœ¨å˜æ›´æ—¶+1</li><li><em>primary</em> ï¼šåœ¨ä¸€ä¸ªviewä¸­åªæœ‰å•ç‹¬ä¸€ä¸ªèŠ‚ç‚¹pæˆä¸ºprimaryï¼Œé€‰æ‹©çš„æ–¹å¼ä¸º<code>p = v mod |R|</code>(pä¸ºèŠ‚ç‚¹çš„idï¼Œvæ˜¯å½“å‰view numberï¼Œ|R| = 3f+1)</li><li><em>backup</em> ï¼š ä¸€ä¸ªviewå†…é™¤primaryå¤–çš„å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¸primaryéƒ½ç§°ä¸ºreplica<br>ç®—æ³•çš„ç²—ç•¥è¿‡ç¨‹ï¼š<blockquote><ol><li>A client sends a request to invoke a service operation to the primary</li><li>The primary multicasts the request to the backups</li><li>Replicas execute the request and send a reply to the client</li><li>The client waits for <strong><em>f + 1</em></strong> replies from different replicas with the <strong><em>same result</em></strong>; this is the result of the operation.</li></ol></blockquote></li></ul><h4 id="1-The-Client"><a href="#1-The-Client" class="headerlink" title="1. The Client"></a>1. The Client</h4><p>client <code>c</code>ç‚¹å¯¹ç‚¹å‘é€<code>&lt;REQUEST,o,t,c&gt;$c</code>åˆ°primaryï¼Œç„¶åç”±primaryå¹¿æ’­åˆ°æ‰€æœ‰backupã€‚<code>o</code>æ˜¯æ“ä½œï¼Œ<code>t</code>æ˜¯æ—¶é—´ï¼ˆå¦‚æœ¬åœ°æœºå™¨æ—¶é—´ï¼‰ï¼Œç”¨æ¥ä¿è¯exactly-onceè¯­ä¹‰ï¼Œ<code>&lt;&gt;$c</code>è¡¨ç¤ºå¯¹æ¶ˆæ¯ç­¾åï¼ˆä¸‹åŒï¼‰ã€‚replica <code>i</code>ç›¸åº”çš„å›å¤<code>&lt;REPLY,v,t,c,i,r&gt;$i</code>ã€‚<code>v</code>æ˜¯å½“å‰view numberï¼ˆå­˜åœ¨view-changeæƒ…å†µï¼‰ï¼Œ<code>r</code>æ˜¯æ‰§è¡Œç»“æœï¼Œç„¶åå„è‡ªå¯¹æ¶ˆæ¯ç­¾åã€‚clientå¯ä»¥æ ¹æ®å›å¤çš„view numberè·Ÿè¸ªå½“å‰viewï¼Œç›¸åº”çš„å¾—çŸ¥å½“å‰primaryã€‚clientæ¥æ”¶åˆ°f+1ä¸ªç›¸åŒç»“æœçš„æœ‰æ•ˆå›å¤ï¼ˆæ ¡éªŒç­¾åï¼‰ï¼Œåˆ™ç»“æœæœ‰æ•ˆï¼Œå®Œæˆã€‚</p><p>å¦‚æœclientåœ¨æœ‰æ•ˆæ—¶é—´å†…æ²¡æ³•æ”¶åˆ°f+1ä¸ªæœ‰æ•ˆç»“æœï¼Œåˆ™å¹¿æ’­requeståˆ°æ‰€æœ‰çš„replicaã€‚å¦‚æœè¯¥requestå·²ç»è¢«å¤„ç†è¿‡ï¼Œreplicaå°±ç®€å•çš„é‡æ–°å‘é€replyåˆ°clientã€‚å¦‚æœæ²¡æœ‰ï¼Œbackupä¼šå°†æ”¹requesté‡å®šå‘åˆ°primaryã€‚å¦‚æœprimaryæ²¡æœ‰å†æ¬¡å°†è¯¥requestå¹¿æ’­ï¼Œåˆ™ä¼šè¢«è®¤ä¸ºæ˜¯å¼‚å¸¸èŠ‚ç‚¹ï¼Œæœ€ç»ˆè§¦çŠ¯view changeã€‚</p><h4 id="2-Normal-Case-Operation"><a href="#2-Normal-Case-Operation" class="headerlink" title="2. Normal-Case Operation"></a>2. Normal-Case Operation</h4><p>replicaè®°å½•çš„çŠ¶æ€</p><blockquote><p>The state of each replica includes <strong>the state of the service</strong>, a <strong>message log</strong> containing messages the replica has accepted, and an integer denoting the replicaâ€™s <strong>current view</strong>.</p></blockquote><p>æ•´ä¸ªæµç¨‹åˆ†ä¸ºä¸‰é˜¶æ®µï¼Œ<em>pre-prepare</em>, <em>prepare</em>, <em>commit</em> (<em>pre-prepare</em>, <em>prepare</em>ç”¨äºä¿æŒåŒä¸€ä¸ªviewå†…requestçš„æœ‰åºæ€§ï¼Œ<em>prepare</em>, <em>commit</em>ç”¨äºä¿è¯è·¨viewçš„reqeustçš„æœ‰åºæ€§ï¼‰ã€‚</p><p><img src="/images/pbft-normal-case-operation.png" alt=""></p><ol><li><p><em>pre-prepare</em> é˜¶æ®µ<br> primaryå¹¿æ’­<code>&lt;&lt;PRE-PREPARE,v,n,d&gt;$p, m&gt;</code>åˆ°æ‰€æœ‰çš„backupã€‚<code>n</code>æ˜¯primaryåˆ†é…ç»™è¯¥æ¶ˆæ¯çš„åºå·ï¼Œå…¨å±€é€’å¢ï¼Œ<code>m</code>æ˜¯clientçš„è¯·æ±‚æ¶ˆæ¯ï¼Œ<code>d</code>æ˜¯æ¶ˆæ¯çš„digestæ‘˜è¦ã€‚ç„¶åç­¾åã€‚</p><p> å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™backupä¼šæ¥å—è¯¥pre-prepareè¯·æ±‚ï¼Œå¹¶ä¸”è¿›å…¥prepareé˜¶æ®µ(The last condition prevents a faulty primary from exhausting the space of sequence numbers by selecting a very large one.):</p> <figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* the signatures in the request and the pre-prepare message are correct and `d` is the digest for `m`;</span><br><span class="line">* it is in view `v`;</span><br><span class="line">* it has not accepted a pre-prepare message for view `v` and sequence number `n` containing a different digest; </span><br><span class="line">* the sequence number in the pre-prepare message is between a low water mark, `h`, and a high water mark, `H`.</span><br></pre></td></tr></tbody></table></figure></li><li><p><em>prepare</em> é˜¶æ®µ<br> backupå¹¿æ’­<code>&lt;PREPARE,v,n,d,i&gt;$i</code>æ¶ˆæ¯åˆ°æ‰€æœ‰replicaï¼ˆåŒ…å«primaryå’Œbackupï¼‰ï¼Œ<code>i</code>ä¸ºè¯¥èŠ‚ç‚¹idã€‚å¹¶ä¸”å°†<code>&lt;PRE-PREPARE&gt;</code>å’Œ<code>PREPARE</code>æ¶ˆæ¯ä¿å­˜åˆ°æœ¬åœ°logã€‚replicaæ¥æ”¶åˆ°prepareæ¶ˆæ¯åï¼Œæ ¡éªŒç­¾åæ­£ç¡®ï¼Œ<code>v</code>æ˜¯å½“å‰viewï¼Œ<code>n</code>åœ¨æ°´ä½<code>h</code>å’Œ<code>H</code>ä¹‹é—´ï¼Œæ‘˜è¦<code>d</code>å’Œæœ¬åœ°ä¿å­˜çš„<code>PRE-PREPARE</code>æ¶ˆæ¯é‡Œçš„<code>d</code>ç›¸ç­‰ã€‚å½“replica iæ”¶åˆ°<code>2f</code>ä¸ªè¿™æ ·çš„<code>PREPARE</code>æ¶ˆæ¯åï¼Œå°±è¾¾åˆ°äº†<code>prepared(m,v,n,i)</code> çŠ¶æ€ï¼Œè¿›å…¥commité˜¶æ®µã€‚</p></li><li><p><em>commit</em> é˜¶æ®µ<br> replica iå¹¿æ’­<code>&lt;COMMIT,v,n,D(m),i&gt;$i</code>æ¶ˆæ¯åˆ°æ‰€æœ‰replicaã€‚replicaæ”¶åˆ°åæ ¡éªŒé€šè¿‡åï¼Œå†™å…¥logã€‚å¦‚æœreplica iè¾¾åˆ°äº†<code>prepared(m,v,n,i)</code> çŠ¶æ€ï¼Œå¹¶ä¸”æ”¶åˆ°<code>2f+1</code>ä¸ªï¼ˆåŒ…æ‹¬è‡ªèº«çš„commitæ¶ˆæ¯ï¼‰æ ¡éªŒé€šè¿‡çš„commitï¼ˆ<code>v</code>,<code>n</code>,<code>d</code>ç›¸åŒä¸”ä¸logé‡Œè®°å½•çš„prepareå»åˆï¼‰ï¼Œåˆ™è¾¾åˆ°<code>committed-local(m,v,n,i)</code>çŠ¶æ€ï¼Œå¹¶ä¸”å…¶å½“å‰çŠ¶æ€æ˜¯æ¶ˆæ¯åºå·å°äº<code>n</code>çš„ä¹‹å‰æ‰€æœ‰æ¶ˆæ¯æŒ‰åºæ‰§è¡Œåçš„æœ€æ–°æœ€å…¨ç»“æœï¼Œåˆ™è¯¥replicaæ‰§è¡Œ<code>m</code>é‡ŒæŒ‡å®šçš„æ“ä½œã€‚æ“ä½œçš„ç»“æœè¿”å›åˆ°clientã€‚</p><blockquote><p>The commit phase ensures the following invariant: if committed-local(m,v,n,i) is true for some non-faulty then committed(m,v,n) is true. This invariant and the view-change protocol described in Section 4.4 ensure that non-faulty replicas agree on the sequence numbers of requests that commit locally even if they commit in different views at each replica. Furthermore, it ensures that any request that commits locally at a non-faulty replica will commit at <strong>f+1 or more</strong> non-faulty replicas eventually.</p></blockquote><p> è¿™é‡ŒæŒ‡çš„æ˜¯ï¼Œè¾¾åˆ°committed(m,v,n)åªèƒ½ä¿è¯è‡³å°‘f+1ä¸ªæ­£å¸¸èŠ‚ç‚¹è¢«æœ€ç»ˆcommitï¼Œè€Œå¹¶ä¸æ˜¯æ‰€æœ‰æ­£å¸¸èŠ‚ç‚¹éƒ½æ‰§è¡Œã€‚è¿™å°±é€ æˆæ­£å¸¸èŠ‚ç‚¹é—´éƒ½çŠ¶æ€ä¸ä¸€è‡´ï¼Œéœ€è¦æœ€ç»ˆåŒæ­¥çŠ¶æ€ã€‚æˆ–è€…ä½¿ç”¨ä¸Šæ–‡æåˆ°Section 4.4é‡Œæåˆ°éƒ½view-changeåœºæ™¯ä¸‹é‡èµ°commitæµç¨‹æœ€ç»ˆè¾¾æˆçŠ¶æ€ä¸€è‡´ã€‚[å¼•ç”¨2:Fabric0.6é‡Œçš„æœ€ç»ˆçŠ¶æ€åŒæ­¥æ–¹æ¡ˆ,3:ä»‹ç»å®æ—¶å…¨æ­£å¸¸èŠ‚ç‚¹åŒæ­¥çš„æ–¹æ¡ˆ]</p></li></ol><h4 id="3-Garbage-Collection"><a href="#3-Garbage-Collection" class="headerlink" title="3. Garbage Collection"></a>3. Garbage Collection</h4><p>replicaå‘¨æœŸæ€§å¯¹å…¶æœ¬åœ°çŠ¶æ€ç”Ÿæˆå¿«ç…§ï¼Œç§°ä¸ºcheckpointã€‚å½“replica iç”ŸæˆcheckpointåŒæ—¶ï¼Œå¹¿æ’­<code>&lt;CHECKPOINT,n,d,i&gt;$i</code>æ¶ˆæ¯åˆ°å…¶ä»–æ‰€æœ‰replicaï¼Œå…¶ä¸­ï¼Œ<code>n</code>æ˜¯ç”Ÿæˆè¯¥çŠ¶æ€æ‰§è¡Œçš„æœ€åçš„è¯·æ±‚æ¶ˆæ¯çš„åºå·ï¼Œ<code>d</code>æ˜¯è¯¥çŠ¶æ€çš„æ‘˜è¦digestã€‚replicaæ¥æ”¶checkpointæ¶ˆæ¯ï¼Œå¹¶ä¸”è®°å½•åˆ°logé‡Œï¼Œå½“æ”¶åˆ°<code>2f+1</code>ä¸ªç›¸åŒçš„checkpointæ¶ˆæ¯ï¼ˆ<code>n</code>,<code>d</code>ï¼‰ç›¸åŒï¼Œåˆ™è¯¥checkpointå˜æˆ<strong>stable checkpoint</strong>ã€‚æ­¤æ—¶ï¼Œå°äºç­‰äº<code>n</code>çš„æ¶ˆæ¯ï¼ˆpre-prepare, prepare, commitï¼‰éƒ½ä¼šè¢«ä¸¢å¼ƒï¼ŒåŒæ—¶ï¼Œä¹‹å‰çš„stable checkpointä¹Ÿè¢«ä¸¢å¼ƒã€‚</p><p>å®é™…ä¸Šï¼Œä¸€ä¸ªreplicaä¼šåŒæ—¶æŒæœ‰è¿™æ ·å‡ ä¸ªçŠ¶æ€å‰¯æœ¬ï¼šä¸€ä¸ªstable checkpointï¼Œè‹¥å¹²ä¸ªæœªè¾¾åˆ°ç¨³å®šçŠ¶æ€çš„checkpointï¼ˆç”Ÿæˆåæš‚æœªæ”¶é›†åˆ°2f+1ä¸ªè¯¥çŠ¶æ€çš„checkpointæ¶ˆæ¯ï¼‰ï¼Œä»¥åŠå½“å‰çŠ¶æ€ã€‚stable checkpointçš„æœ€åçš„æ¶ˆæ¯åºå·<code>n</code>å°±æ˜¯ä½æ°´ä½<code>h</code>,é«˜æ°´ä½<code>H = h + k</code>(where   is big enough so that replicas do not stall waiting for a checkpoint to become stable).</p><h4 id="4-View-Changes"><a href="#4-View-Changes" class="headerlink" title="4. View Changes"></a>4. View Changes</h4><p>clientåœ¨æœ‰æ•ˆæ—¶é—´å†…æ²¡æ³•æ”¶åˆ°f+1ä¸ªæœ‰æ•ˆç»“æœï¼Œåˆ™å¹¿æ’­requeståˆ°æ‰€æœ‰çš„replicaã€‚backupæ”¶åˆ°åï¼Œè‹¥è¯¥è¯·æ±‚ä»æœªæ‰§è¡Œï¼Œåˆ™è½¬å‘ç»™primaryï¼Œå¹¶ä¸”å¯åŠ¨timerï¼Œåœ¨timeråˆ°æœŸå‰è‹¥æ²¡æœ‰æ”¶åˆ°primaryå‘å‡ºçš„pre-prepareï¼Œåˆ™åˆ¤æ–­è¯¥primaryå¼‚å¸¸ï¼Œå‘å‡ºview-changeæ¶ˆæ¯ã€‚backup i,<code>&lt;VIEW-CHANGE,v+1,n,C,P,i&gt;$i</code>ï¼Œ<code>v+1</code>æ˜¯æ–°çš„view numberï¼Œ<code>n</code>æ˜¯è¯¥backupçš„stable checkpoint <code>s</code>çš„æœ€åæ¶ˆæ¯åºå·ï¼Œ<code>C</code>æ˜¯è¯æ˜<code>s</code>çš„2f+1ä¸ªcheckpointæ¶ˆæ¯ï¼Œ<code>P</code>æ˜¯<code>Pm</code>çš„é›†åˆï¼Œ<code>Pm</code>æ˜¯è¾¾åˆ°<code>prepared(m,v,n,i)</code> çŠ¶æ€çš„æ¶ˆæ¯ï¼ˆåŒ…å«pre-prepareæ¶ˆæ¯å’Œ2fä¸ªæ¥è‡ªå…¶ä»–replicaçš„matchingæ¶ˆæ¯ï¼Œå…¶ä¸­æ¶ˆæ¯<code>m</code>çš„åºå·å¤§äº<code>n</code>ï¼‰ã€‚</p><p><code>v+1</code>çš„primaryï¼ˆé€šè¿‡<code>p = ï¼ˆv+1ï¼‰mod |R|</code>è®¡ç®—ï¼‰æ”¶åˆ°2fä¸ªæœ‰æ•ˆview-changeæ¶ˆæ¯åï¼Œå¹¿æ’­<code>&lt;NEW-VIEW,v+1,V,O&gt;$p</code>ï¼Œ<code>V</code>æ˜¯æ”¶åˆ°çš„å’Œprimaryè‡ªèº«çš„view-changeæ¶ˆæ¯çš„é›†åˆï¼Œ<code>O</code>æ˜¯pre-prepareæ¶ˆæ¯çš„é›†åˆã€‚è®¡ç®—å¦‚ä¸‹ï¼Œæ¯”è¾ƒå¤æ‚<br></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. The primary determines the sequence number `min-s` of the latest stable checkpoint in `V` and the highest sequence number `max-s` in a prepare message in `V`.</span><br><span class="line">2. The primary creates a new pre-prepare message for view `v+1` for each sequence number `n` between `min-s` and `max-s`.</span><br><span class="line"> There are two cases: (1) there is at least one set in the component of some view-change message in with sequence number `n`, or (2) there is no such set. </span><br><span class="line"> In the first case, the primary creates a new message `&lt;PRE-PREPARE,v+1,n,d&gt;$p` where `d` is the request digest in the pre-prepare message for sequence number `n` with the highest view number in `V`. </span><br><span class="line"> In the second case, it creates a new pre-prepare message `&lt;PRE-PREPARE,v+1,n,d(null)&gt;$p` where `d(null)` is the digest of a special null request; a null request goes through the protocol like other requests, but its execution is a no-op. (Paxos [18] used a similar technique to fill in gaps.)</span><br></pre></td></tr></tbody></table></figure><br>ä¹Ÿå°±æ˜¯è¯´ï¼Œprimaryä»latest stable checkpointé‡æ”¾ä¹‹åæ‰€æœ‰è¾¾åˆ°<code>prepared(m,v,n,i)</code>çŠ¶æ€çš„æ¶ˆæ¯ï¼ˆ<code>min-s</code>&lt;<code>n</code>&lt;=<code>max-s</code>ï¼‰ï¼Œé‡å‘pre-prepareã€‚replicaä¼šå¯¹è¿™äº›æ¶ˆæ¯é‡èµ°æµç¨‹ï¼Œprepareå’Œcommité˜¶æ®µï¼Œä½†æ˜¯ä¸å†é‡æ–°æ‰§è¡Œè¯·æ±‚ï¼Œå› ä¸ºåœ¨ä¸Šä¸€ä¸ªviewå†…ï¼Œå¯¹è¿™äº›è¾¾åˆ°<code>prepared(m,v,n,i)</code>çŠ¶æ€çš„æ¶ˆæ¯å·²ç»æ‰§è¡Œè¿‡ã€‚<p></p><p>åŒæ—¶ï¼Œreplicaè®°å½•æ”¶åˆ°çš„æ‰€æœ‰replicaçš„view-changeé‡Œæœ€æ–°çš„ï¼ˆ<code>n</code>æœ€å¤§ï¼‰stable checkpointè®°å½•åˆ°logé‡Œï¼Œå¹¶ä¸”å¯¹ç¼ºå¤±çš„æ¶ˆæ¯må’Œæœ€æ–°çš„stable checkpointï¼ˆè‡ªèº«çš„stable checkpointä¸æ˜¯å…¨å±€æœ€æ–°çš„stable checkpointæƒ…å†µä¸‹ï¼‰ä»å…¶ä»–çš„replicaåŒæ­¥ã€‚</p><h4 id="5-Correctnessï¼ˆé‡ç‚¹ï¼‰"><a href="#5-Correctnessï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="5. Correctnessï¼ˆé‡ç‚¹ï¼‰"></a>5. Correctnessï¼ˆé‡ç‚¹ï¼‰</h4><ol><li>Safety<blockquote><p>if prepared(m,v,n,i) is true then prepared(mâ€™,v,n,j) is false for any  non-faulty replica j(including i=j) and any mâ€™ such that D(mâ€™)!=D(m)  </p></blockquote></li></ol><ul><li><p>è¿™æ˜¯å› ä¸ºï¼Œåˆ°è¾¾prepareï¼ˆmï¼‰æ„å‘³ç€2f+1ä¸ªreplicaé€‰æ‹©å‘é€prepareï¼ˆmï¼‰ï¼Œå‡è®¾å¼‚å¸¸èŠ‚ç‚¹ä¸ªæ•°ä¸ºk(k&lt;=f), åˆ™è‡³å°‘æœ‰2f+1-kä¸ªæ­£å¸¸replicaå‘é€prepareï¼ˆmï¼‰ï¼ŒåŒæ—¶ä¹Ÿæ„å‘³ç€è‡³å°‘æœ‰2f+1-kä¸ªreplicaå‘é€prepareï¼ˆmâ€™ï¼‰ã€‚ç”±äº(2f+1-k)*2&gt;3f+1-kï¼Œè¯´æ˜è¿™ä¸¤éƒ¨åˆ†æ­£å¸¸èŠ‚ç‚¹æœ‰é‡å ï¼Œåˆ™è‡³å°‘æœ‰ä¸€ä¸ªæ­£å¸¸èŠ‚ç‚¹å‘é€ä¸¤ä¸ªä¸åŒæ¶ˆæ¯ï¼ŒçŸ›ç›¾ã€‚</p><blockquote><p>The view-change protocol ensures that non-faulty replicas also agree on the sequence number of requests that commit locally in different views at different replicas. committed(m,v,n) is true if and only if prepared(m,v,n,i) is true for all i in some set of f+1 non-faulty replicas. if committed-local(m,v,n,i) is true for some non-faulty i then committed(m,v,n) is true.</p></blockquote></li><li><p>è¿™æ˜¯å› ä¸ºï¼Œåˆ°è¾¾<code>committed-local(m,v,n,i)</code>çŠ¶æ€ï¼Œåˆ™æ„å‘³ç€è‡³å°‘æ”¶åˆ°f+1ä¸ªæ­£å¸¸replicaçš„commitæ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è‡³å°‘æœ‰f+1ä¸ªæ­£å¸¸èŠ‚ç‚¹åˆ°è¾¾preparedï¼ˆm,v,n,i)çŠ¶æ€ã€‚è€Œæ­£å¸¸èŠ‚ç‚¹åªæœ‰åœ¨æ¥æ”¶åˆ°new-viewæ¶ˆæ¯æ‰ä¼šä»view vè¿›å…¥view v+1ï¼Œè€Œnew-viewæ¶ˆæ¯é‡ŒåŒ…å«2f+1ä¸ªview-changeæ¶ˆæ¯ã€‚ä¸ä¸Šé¢æ¨å¯¼æ–¹å¼ç›¸ä¼¼ï¼Œåˆ™è¿™ä¸¤ä¸ªé›†åˆå¿…å®šæœ‰ä¸€ä¸ªäº¤é›†åŒ…å«æ­£å¸¸èŠ‚ç‚¹kã€‚è‹¥ç„¶må·²ç»åŒ…å«åœ¨kçš„stable checkpontå†…ï¼Œåˆ™æœ€ç»ˆè¢«åŒæ­¥åˆ°æ‰€æœ‰æ­£å¸¸èŠ‚ç‚¹ï¼›è‹¥ç„¶æ²¡æœ‰ï¼Œåˆ™åŒ…å«kçš„view-changeæ¶ˆæ¯å†…ï¼Œç„¶ååœ¨view v+1ä¸­è¢«é‡æ–°æ‰§è¡Œä¸‰é˜¶æ®µæµç¨‹ï¼Œæœ€ç»ˆä¹Ÿè¾¾åˆ°æäº¤ä¸€è‡´ã€‚</p></li></ul><ol><li>Liveness</li></ol><ul><li>replicaå¹¿æ’­view-changeè¿›å…¥v+1ï¼Œç­‰å¾…2f+1ä¸ªview-changeæ¶ˆæ¯åå¯åŠ¨è®¡æ—¶å™¨Tã€‚å¦‚æœåœ¨Tåˆ°æ—¶å‰æ²¡æœ‰æ”¶åˆ°new-viewï¼ˆæ–°çš„primaryæ˜¯å¼‚å¸¸èŠ‚ç‚¹ï¼‰ï¼Œåˆ™è¿›å…¥v+2ï¼Œè®¡æ—¶å™¨æ—¶é—´æ‰©å¤§æˆ2Tï¼Œè¿™æ˜¯ä¸ºäº†é¿å…viewæ”¹å˜çš„è¿‡å¿«ã€‚</li><li>åœ¨å®šæ—¶å™¨è¿‡æœŸå‰ï¼Œå¦‚æœæ”¶åˆ°f+1ä¸ªview-changeæ¶ˆæ¯ï¼Œå¹¶ä¸”æ¯”è‡ªèº«çš„view numberå¤§ï¼Œåˆ™å‘é€è¿™äº›å¤§view numberä¸­æœ€å°çš„ä¸€ä¸ª</li><li>f+1ä¸ªview-changeæ¶ˆæ¯æ‰èƒ½è§¦å‘viewå˜æ›´ï¼Œè€Œä¸”primaryçš„è½®æµé€‰æ‹©æ–¹æ¡ˆä¹Ÿé™å®šè¿ç»­æœ€å¤šfè½®é€‰æ‹©å°±èƒ½é€‰ä¸¾åˆ°æ­£å¸¸çš„primaryã€‚</li></ul><h3 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h3><h4 id="1-Reducing-Communication"><a href="#1-Reducing-Communication" class="headerlink" title="1. Reducing Communication"></a>1. Reducing Communication</h4><ol><li><p>é¿å…ä¼ è¾“large result</p><blockquote><p>A client request designates a replica to send the result; all other replicas send replies containing just the digest of the result.(æŒ‡å®šå•ä¸ªreplcaå›å¤å®Œæ•´resultï¼Œå…¶ä»–å›å¤è¯¥resultçš„æ‘˜è¦ç”¨ä»¥æ ¡éªŒ)ã€‚ If the client does not receive a correct result from the designated replica, it retransmits the request as usual, requesting all replicas to send full replies.</p></blockquote></li><li><p>å‡å°‘æµç¨‹æ­¥éª¤ï¼Œreplicaæå‰è¿”å›replyã€‚å½“replicaæ”¶åˆ°è¶³å¤Ÿprepareæ¶ˆæ¯ï¼Œè¾¾åˆ°äº†<code>prepared(m,v,n,i)</code> çŠ¶æ€ï¼Œå°†è¦è¿›å…¥commité˜¶æ®µã€‚è¿™æ—¶ï¼Œå¦‚æœå°äºè¯¥æ¶ˆæ¯åºå·<code>n</code>çš„ä¹‹å‰çš„æ¶ˆæ¯éƒ½å·²ç»æ‰§è¡Œç”Ÿæˆäº†å½“å‰çŠ¶æ€ï¼Œåˆ™replicaæ‰§è¡Œè¯¥è¯·æ±‚ï¼Œå¹¶ä¸”ç›´æ¥è¿”å›åˆ°clientï¼ŒåŒæ—¶ç»§ç»­åç»­çš„commité˜¶æ®µã€‚</p><blockquote><ul><li>The client waits for 2f + 1 matching tentative replies. If it receives this many, the request is guaranteed to commit eventually. Otherwise, the client retransmits the request and waits for f + 1 non-tentative replies.   </li><li>A request that has executed tentatively may abort if there is a view change and it is replaced by a null request. In this case the replica reverts its state to the last stable checkpoint in the new-view message or to its last checkpointed state (depending on which one has the higher sequence number). </li></ul></blockquote></li><li><p>ä¼˜åŒ–read-onlyæ“ä½œã€‚å¯¹äºread-onlyè¯·æ±‚ï¼Œclientç›´æ¥å‘é€åˆ°æ‰€æœ‰replicaï¼Œreplicaç›´æ¥è¿”å›ç»“æœåˆ°clientã€‚clientæ”¶é›†2f+1ä¸ªç›¸åŒç»“æœçš„å›å¤ï¼Œå¦åˆ™æŒ‰ç…§æ­£å¸¸æµç¨‹é‡æ–°å‘èµ·è¯·æ±‚ã€‚</p><blockquote><p>They(replica) send the reply only after all requests reflected in the tentative state have committed; this is necessary to prevent the client from observing uncommitted state.</p></blockquote></li></ol><h3 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h3><p>æ‰€æœ‰çš„replicaé—´éœ€è¦å…¨è”æ¥å¹¶ä¸”å¤šæ¬¡äº¤äº’é€šä¿¡ï¼Œç³»ç»Ÿä¸­è¿™äº›æ¶ˆæ¯éšç€èŠ‚ç‚¹æ•°æŒ‡æ•°å¢é•¿ã€‚å•æ¬¡è¯·æ±‚çš„æœ€å°‘æ¶ˆæ¯æ•°ä¸º<code>1 + 3f + 3f(3f-f) + (3f-f+1)(3f+1) + 3f-1</code>.</p><blockquote><p><a href="https://medium.com/coinmonks/pbft-understanding-the-algorithm-b7a7869650ae">pBFTâ€” Understanding the Consensus Algorithm</a></p></blockquote><h3 id="ç§è´§"><a href="#ç§è´§" class="headerlink" title="ç§è´§"></a>ç§è´§</h3><ol><li>ä¸ºä»€ä¹ˆéœ€è¦è‡³å°‘3f+1ä¸ªèŠ‚ç‚¹ï¼Ÿ<br>é¦–å…ˆæœ€åè¾¾æˆå…±è¯†çš„æ­£å¸¸èŠ‚ç‚¹æ•°éœ€è¦å¤§äºfï¼Œå¦åˆ™è¿™fä¸ªå¼‚å¸¸èŠ‚ç‚¹å°±å¯ä»¥è¾¾æˆé”™è¯¯çš„å…±è¯†ã€‚å³è‡³å°‘éœ€è¦f+1ä¸ªæ­£å¸¸èŠ‚ç‚¹è¾¾æˆå…±è¯†ã€‚è€Œè¾¾æˆå…±è¯†æ—¶ï¼Œæœ‰å¯èƒ½ç»™æœ€åå…±è¯†æŠ•ç¥¨çš„åŒ…å«è¿™fä¸ªå¼‚å¸¸èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦è‡³å°‘2f+1ä¸ªèŠ‚ç‚¹æŠ•ç¥¨è¾¾æˆå…±è¯†ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å…¶ä¸­è‡³å°‘å«æœ‰f+1ä¸ªæ­£å¸¸èŠ‚ç‚¹ã€‚ï¼ˆä¾‹å¦‚Pä¸ºå¼‚å¸¸èŠ‚ç‚¹å‘ä¸åŒçš„æ­£å¸¸èŠ‚ç‚¹æè®®ä¸åŒçš„å€¼ï¼Œè¿™ä¹Ÿæ˜¯é€ æˆä¸Šæ–‡æåˆ°3f+1ä¸ªèŠ‚ç‚¹æœ€åè¾¾æˆå…±è¯†æ—¶åªèƒ½ä¿è¯å¤šäºf+1ä¸ªï¼‰ã€‚è€Œæœ€åçš„å…±è¯†åªèƒ½æœ‰ä¸€ä¸ªï¼Œå³è¾¾æˆå…±è¯†çš„æ­£å¸¸èŠ‚ç‚¹åº”è¯¥è¶…è¿‡æ‰€æœ‰æ­£å¸¸èŠ‚ç‚¹æ•°çš„è¿‡åŠï¼Œå¦åˆ™fä¸ªå¼‚å¸¸èŠ‚ç‚¹å¯ä»¥é‡å¤æŠ•ç¥¨å¯¼è‡´æœ€åæ­£å¸¸èŠ‚ç‚¹åˆ†è£‚æˆä¸¤ç»„ä»¥ä¸Šå„è‡ªè¾¾æˆå…±è¯†ã€‚å› æ­¤ï¼Œå®é™…ä¸Šæœ€åçš„é˜ˆå€¼<code>T&gt;=lower((R-f)/2)+1+f</code>ï¼Œè¿™æ ·å°±ä¿è¯äº†correctnessæ­£ç¡®æ€§ã€‚æ¥ä¸‹æ¥è€ƒè™‘livenesså¯ç”¨æ€§ã€‚å› ä¸ºå¼‚å¸¸èŠ‚ç‚¹æœ‰å¯èƒ½ä¸å‚ä¸æŠ•ç¥¨ï¼ˆPä¸ºæ­£å¸¸èŠ‚ç‚¹ï¼‰ï¼Œéœ€è¦ä¿è¯æ­£å¸¸èŠ‚ç‚¹æ€»æ•°åº”è¯¥å¤§äºé˜ˆå€¼ï¼Œå³<code>R-f&gt;=T</code>ã€‚</li></ol><p><strong>References</strong></p><blockquote><p>[1] M. Castro and B. Liskov.   <a href="http://pmg.csail.mit.edu/papers/osdi99.pdf">Practical Byzantine Fault Tolerance</a>.  <em>Proceedings of the Third Symposium on Operating Systems Design and Implementation, New Orleans, USA, February 1999</em></p><p>[2] <a href="https://zhuanlan.zhihu.com/p/40684348">åŒºå—é“¾PBFTå…±è¯†ç®—æ³•èŠ‚ç‚¹ä¸»åŠ¨æ¢å¤è®¾è®¡ä¸å®ç°</a><br>[3] <a href="https://www.8btc.com/article/70370">æ‹œå åº­å°†å†›é—®é¢˜æ·±å…¥æ¢è®¨</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Consensus &amp; Cryptography </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blockchain </tag>
            
            <tag> Consensus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - peerçš„deliverè¿‡ç¨‹(1) peerä¸ordererçš„äº¤äº’</title>
      <link href="//articles/fabric-source-deliver-peer-to-order/"/>
      <url>//articles/fabric-source-deliver-peer-to-order/</url>
      
        <content type="html"><![CDATA[<p>peerç«¯çš„gossipå’Œdeliveræ˜¯ç´§å¯†ç»“åˆçš„ã€‚åœ¨fabricçš„ç»“æ„ä¸­ï¼Œå­˜åœ¨leader peerèŠ‚ç‚¹ï¼Œè´Ÿè´£ä¸ordereräº¤äº’ï¼Œé€šè¿‡deliveræœåŠ¡ä»ordererå¾—åˆ°blockã€‚ç„¶åé€šè¿‡gossipæœåŠ¡æ‰©æ•£åˆ°å…¶ä»–çš„æ™®é€špeerï¼Œä»è€Œè¾¾åˆ°å…¨ç½‘åŒæ­¥ã€‚è¿™é‡Œå…ˆä»‹ç»deliveræœåŠ¡ã€‚</p><p>ä»å‰æ–‡<a href="https://simplexity.cn/2019/03/12/fabric-source-orderer-deliver/">ordererçš„deliverè¿‡ç¨‹</a>å¯çŸ¥ï¼Œdeliverçš„grpcæœåŠ¡æ˜¯â€/orderer.AtomicBroadcast/Deliverâ€,åœ¨æºç ä¸­æœç´¢å¹¶ä¸”ä¸€è·¯å›æº¯åˆ°æ–¹æ³•<code>peer/node/start.go#serve</code>ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æ‰§è¡Œå‘½ä»¤<code>peer node start</code>æ—¶çš„æ‰§è¡Œã€‚ï¼ˆè¿™é‡Œå…ˆä»‹ç»çš„å½“å‰peeré‡å¯çš„æƒ…å†µï¼Œæ–°å»ºç«‹channelçš„æƒ…å†µåé¢ä»‹ç»ï¼‰ã€‚ç„¶åæ‰§è¡Œåˆ°<code>core/peer/peer.go:Initialize</code>ï¼Œè¿™é‡Œé¢æ‰§è¡Œ<code>ledgermgmt.Initialize(ConfigTxProcessors)</code>æ¢å¤å†å²è´¦æœ¬ã€‚ç„¶åä»è¿™äº›å†å²è´¦æœ¬ä¿¡æ¯å¯ä»¥è·å–åˆ°ledgerIdï¼ˆå³channelIdï¼‰ã€‚ç„¶åå¯¹æ¯ä¸ªchannelåŠ è½½è´¦æœ¬ï¼Œå¹¶ä¸”ä»è´¦æœ¬ä¸­è·å–æœ€æ–°çš„ConfigBlockï¼Œç„¶åè°ƒç”¨<code>createChain</code>é‡æ–°æ„é€ channelä¿¡æ¯ã€‚åœ¨<code>core/peer/peer.go:createChain</code>è¿™ä¸ªæ–¹æ³•é‡Œï¼Œä¹Ÿæ˜¯ä»ledgeré‡Œè·å–åˆ°é…ç½®ä¿¡æ¯ï¼Œä»è€Œå¾—åˆ°ordereråœ°å€<code>ordererAddresses :=  bundle.ChannelConfig().OrdererAddresses()</code>,ç„¶åè°ƒç”¨<code>service.GetGossipService().InitializeChannel</code>ã€‚åœ¨<code>gossip/service/gossip_service.go:InitializeChannel</code>é‡Œï¼Œå¯åŠ¨deliveræœåŠ¡éœ€è¦ç»è¿‡åˆ¤æ–­æ˜¯å¦èŠ‚ç‚¹æ˜¯leader peerï¼Œå³<code>peer.gossip.useLeaderElection</code>ï¼ˆé€šè¿‡é€‰ä¸¾çš„æ–¹å¼åŠ¨æ€å†³å®šleader peerï¼‰å’Œ<code>peer.gossip.orgLeader</code>ï¼ˆé™æ€æŒ‡å®šå½“å‰peerä¸ºleader peerï¼‰ï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯äº’æ–¥çš„ã€‚å‰é¢æåˆ°è¿‡ï¼Œåªæœ‰leaderæ‰ä¸ordererè¿›è¡Œäº¤äº’ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¿”å›ï¼Œæ— éœ€ç»§ç»­å¾€ä¸‹å¯åŠ¨deliveræœåŠ¡ã€‚<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parameters:</span></span><br><span class="line"><span class="comment">//      - peer.gossip.useLeaderElection</span></span><br><span class="line"><span class="comment">//      - peer.gossip.orgLeader</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// are mutual exclusive, setting both to true is not defined, hence peer will panic and terminate</span></span><br><span class="line">leaderElection := viper.GetBool(<span class="string">"peer.gossip.useLeaderElection"</span>)</span><br><span class="line">isStaticOrgLeader := viper.GetBool(<span class="string">"peer.gossip.orgLeader"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> leaderElection &amp;&amp; isStaticOrgLeader {</span><br><span class="line">    logger.Panic(<span class="string">"Setting both orgLeader and useLeaderElection to true isn't supported, aborting execution"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> leaderElection {</span><br><span class="line">    logger.Debug(<span class="string">"Delivery uses dynamic leader election mechanism, channel"</span>, chainID)</span><br><span class="line">    g.leaderElection[chainID] = g.newLeaderElectionComponent(chainID, g.onStatusChangeFactory(chainID, support.Committer))</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> isStaticOrgLeader {</span><br><span class="line">    logger.Debug(<span class="string">"This peer is configured to connect to ordering service for blocks delivery, channel"</span>, chainID)</span><br><span class="line">    g.deliveryService[chainID].StartDeliverForChannel(chainID, support.Committer, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {})</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    logger.Debug(<span class="string">"This peer is not configured to connect to ordering service for blocks delivery, channel"</span>, chainID)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><span id="more"></span><p>å‡è®¾å½“å‰èŠ‚ç‚¹æ˜¯é€šè¿‡é™æ€æŒ‡å®šä¸ºleaderï¼Œåˆ™è¿›å…¥åˆ›å»ºdeliveræœåŠ¡<code>g.deliveryService[chainID].StartDeliverForChannel</code>.åœ¨è¿™ä¸ªæ–¹æ³•é‡Œä¸»è¦åˆ†ä¸¤éƒ¨ã€‚</p><ol><li><p>è°ƒç”¨<code>client := d.newClient(chainID, ledgerInfo)</code>æ„é€ clientã€‚</p> <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *deliverServiceImpl)</span> <span class="title">newClient</span><span class="params">(chainID <span class="keyword">string</span>, ledgerInfoProvider blocksprovider.LedgerInfo)</span> *<span class="title">broadcastClient</span></span> {</span><br><span class="line">    requester := &amp;blocksRequester{</span><br><span class="line">        tls:     viper.GetBool(<span class="string">"peer.tls.enabled"</span>),</span><br><span class="line">        chainID: chainID,</span><br><span class="line">    }</span><br><span class="line">    broadcastSetup := <span class="function"><span class="keyword">func</span><span class="params">(bd blocksprovider.BlocksDeliverer)</span> <span class="title">error</span></span> {</span><br><span class="line">        <span class="keyword">return</span> requester.RequestBlocks(ledgerInfoProvider)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    connProd := comm.NewConnectionProducer(d.conf.ConnFactory(chainID), d.conf.Endpoints)</span><br><span class="line">    bClient := NewBroadcastClient(connProd, d.conf.ABCFactory, broadcastSetup, backoffPolicy)</span><br><span class="line">    requester.client = bClient</span><br><span class="line">    <span class="keyword">return</span> bClient</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBroadcastClient</span><span class="params">(prod comm.ConnectionProducer, clFactory clientFactory, onConnect broadcastSetup, bos retryPolicy)</span> *<span class="title">broadcastClient</span></span> {</span><br><span class="line">    <span class="keyword">return</span> &amp;broadcastClient{prod: prod, onConnect: onConnect, shouldRetry: bos, createClient: clFactory, stopChan: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>{}, <span class="number">1</span>)}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>æ„å»º<code>blocksProviderImpl</code>ï¼Œå¹¶ä¸channelå¯¹åº”å­˜å‚¨<code>d.blockProviders[chainID] = blocksprovider.NewBlocksProvider</code>.ç„¶åè°ƒç”¨<code>go d.launchBlockProvider(chainID, finalizer)</code>,è¿›è€Œè°ƒç”¨äº†<code>core/deliverservice/blocksprovider/blocksprovider.go#DeliverBlocks</code>ã€‚åœ¨è¿™é‡Œè°ƒç”¨<code>core/deliverservice/client.go#Recv</code>æ–¹æ³•ï¼Œä¸€è·¯è°ƒç”¨ç›´åˆ°è°ƒç”¨<code>client.go#connect</code>ã€‚</p> <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *broadcastClient)</span> <span class="title">doAction</span><span class="params">(action <span class="keyword">func</span>()</span> <span class="params">(<span class="keyword">interface</span>{}, error)</span>, <span class="title">actionOnNewConnection</span> <span class="title">func</span><span class="params">()</span>) <span class="params">(<span class="keyword">interface</span>{}, error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> bc.conn == <span class="literal">nil</span> {</span><br><span class="line">        err := bc.connect()</span><br><span class="line">        actionOnNewConnection()</span><br><span class="line">    }</span><br><span class="line">    resp, err := action()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        bc.Disconnect(<span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> resp, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *broadcastClient)</span> <span class="title">connect</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    abc, err := bc.createClient(conn).Deliver(ctx)</span><br><span class="line">    err = bc.afterConnect(conn, abc, cf, endpoint)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *broadcastClient)</span> <span class="title">afterConnect</span><span class="params">(conn *grpc.ClientConn, abc orderer.AtomicBroadcast_DeliverClient, cf context.CancelFunc, endpoint <span class="keyword">string</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    bc.BlocksDeliverer = abc</span><br><span class="line">    err := bc.onConnect(bc)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></li></ol><ul><li><p>è¿™é‡Œå…ˆæ„å»ºgrpc client <code>abc, err := bc.createClient(conn).Deliver(ctx)</code>.è¿™é‡Œçš„<code>createClient</code>å³ä¸Šé¢æ„é€ <code>broadcastClient</code>æ—¶ä¼ å…¥çš„å‚æ•°<code>d.conf.ABCFactory</code>ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥å›æº¯åˆ°<code>gossip/service/gossip_service.go#Service</code>æ„é€ æ—¶ï¼ˆè¿™ä¸ªæ–¹æ³•åœ¨å‰é¢æåŠçš„<code>InitializeChannel</code>é‡Œè¢«è°ƒç”¨ï¼‰ï¼ŒæŒ‡å®š<code>ABCFactory:  deliverclient.DefaultABCFactory</code>ã€‚å¯è§ï¼Œè¿™é‡Œå¯¹åº”çš„grpcæ–¹æ³•å³<code>/orderer.AtomicBroadcast/Deliver</code>.</p>  <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DefaultABCFactory</span><span class="params">(conn *grpc.ClientConn)</span> <span class="title">orderer</span>.<span class="title">AtomicBroadcastClient</span></span> {</span><br><span class="line">    <span class="keyword">return</span> orderer.NewAtomicBroadcastClient(conn)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewAtomicBroadcastClient</span><span class="params">(cc *grpc.ClientConn)</span> <span class="title">AtomicBroadcastClient</span></span> {</span><br><span class="line">    <span class="keyword">return</span> &amp;atomicBroadcastClient{cc}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *atomicBroadcastClient)</span> <span class="title">Deliver</span><span class="params">(ctx context.Context, opts ...grpc.CallOption)</span> <span class="params">(AtomicBroadcast_DeliverClient, error)</span></span> {</span><br><span class="line">    stream, err := grpc.NewClientStream(ctx, &amp;_AtomicBroadcast_serviceDesc.Streams[<span class="number">1</span>], c.cc, <span class="string">"/orderer.AtomicBroadcast/Deliver"</span>, opts...)</span><br><span class="line"></span><br><span class="line">    x := &amp;atomicBroadcastDeliverClient{stream}</span><br><span class="line">    <span class="keyword">return</span> x, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>ç„¶ååœ¨<code>connect</code>æ–¹æ³•é‡Œè®¾ç½®<code>bc.BlocksDeliverer = abc</code>,å¹¶ä¸”è°ƒç”¨<code>err = bc.afterConnect(conn, abc, cf, endpoint)</code>ï¼Œè¿›è€Œè°ƒç”¨äº†<code>err := bc.onConnect(bc)</code>.åœ¨ä¸Šé¢çš„<code>broadcastClient</code>æ„é€ æ—¶ä¼ å…¥å‚æ•°<code>onConnect</code>ä¸º<code>broadcastSetup</code>,å³æ‰§è¡Œ<code>requester.RequestBlocks(ledgerInfoProvider)</code>ã€‚è¿™é‡Œå®é™…ä¸Šæ˜¯å‘ordererè¯·æ±‚blockï¼Œheaderä¸º<code>common.HeaderType_DELIVER_SEEK_INFO</code>,åŒæ—¶åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œæ–°çš„channelä»oldestå¼€å§‹æ¶ˆè´¹åŒæ­¥ï¼Œè€Œé‡å¯çš„channelåˆ™ä»æŒ‡å®šçš„blockå¼€å§‹ï¼ˆ<code>ledgerInfoProvider.LedgerHeight()</code>ï¼‰ã€‚ä»¥ä¸Šä¸º<code>start</code>å€¼ï¼Œ<code>stop</code>é€‰æ‹©math.MaxUint64,<code>Behavior</code>é€‰æ‹©<code>orderer.SeekInfo_BLOCK_UNTIL_READY</code>.å›é¡¾å‰æ–‡ï¼Œè¿™é‡Œè¡¨æ˜æ˜¯ä¸€ç›´åŒæ­¥ã€‚è¿™é‡Œå‘å‡ºçš„Envelopeä¹Ÿå°±æ˜¯ordereræ¥æ”¶ã€‚</p>  <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *blocksRequester)</span> <span class="title">RequestBlocks</span><span class="params">(ledgerInfoProvider blocksprovider.LedgerInfo)</span> <span class="title">error</span></span> {</span><br><span class="line">    height, err := ledgerInfoProvider.LedgerHeight()</span><br><span class="line">    <span class="keyword">if</span> height &gt; <span class="number">0</span> {</span><br><span class="line">        <span class="keyword">if</span> err := b.seekLatestFromCommitter(height); err != <span class="literal">nil</span>{ <span class="keyword">return</span> err }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">if</span> err := b.seekOldest(); err != <span class="literal">nil</span> { <span class="keyword">return</span> err}</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *blocksRequester)</span> <span class="title">seekOldest</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    seekInfo := &amp;orderer.SeekInfo{</span><br><span class="line">        Start:    &amp;orderer.SeekPosition{Type: &amp;orderer.SeekPosition_Oldest{Oldest: &amp;orderer.SeekOldest{}}},</span><br><span class="line">        Stop:     &amp;orderer.SeekPosition{Type: &amp;orderer.SeekPosition_Specified{Specified: &amp;orderer.SeekSpecified{Number: math.MaxUint64}}},</span><br><span class="line">        Behavior: orderer.SeekInfo_BLOCK_UNTIL_READY,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//TODO- epoch and msgVersion may need to be obtained for nowfollowing usage in orderer/configupdate/configupdate.go</span></span><br><span class="line">    msgVersion := <span class="keyword">int32</span>(<span class="number">0</span>)</span><br><span class="line">    epoch := <span class="keyword">uint64</span>(<span class="number">0</span>)</span><br><span class="line">    tlsCertHash := b.getTLSCertHash()</span><br><span class="line">    env, err := utils.CreateSignedEnvelopeWithTLSBinding(common.HeaderType_DELIVER_SEEK_INFO, b.chainID, localmsp.NewSigner(), seekInfo, msgVersion, epoch, tlsCertHash)</span><br><span class="line">    <span class="keyword">return</span> b.client.Send(env)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *blocksRequester)</span> <span class="title">seekLatestFromCommitter</span><span class="params">(height <span class="keyword">uint64</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">    seekInfo := &amp;orderer.SeekInfo{</span><br><span class="line">        Start:    &amp;orderer.SeekPosition{Type: &amp;orderer.SeekPosition_Specified{Specified: &amp;orderer.SeekSpecified{Number: height}}},</span><br><span class="line">        Stop:     &amp;orderer.SeekPosition{Type: &amp;orderer.SeekPosition_Specified{Specified: &amp;orderer.SeekSpecified{Number: math.MaxUint64}}},</span><br><span class="line">        Behavior: orderer.SeekInfo_BLOCK_UNTIL_READY,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul><ol><li>æ¥ä¸‹æ¥è½¬å‘æ¶ˆæ¯çš„æ¥æ”¶ã€‚çœŸæ­£å¤„ç†<code>DeliverResponse</code>çš„åœ°æ–¹åœ¨<code>blocksprovider.go#DeliverBlocks</code>ï¼Œè¿™é‡Œforå¾ªç¯åˆ¤æ–­<code>!b.isDone()</code>åˆ™ä½¿ç”¨<code>msg, err := b.client.Recv()</code>æ¥æ”¶ä¿¡æ¯ã€‚<code>core/deliverservice/client.go#Recv</code>è¿™ä¸ªæ–¹æ³•é‡Œï¼Œä½¿ç”¨<code>try</code>æ–¹æ³•ï¼Œå®é™…ä¸Šå°±æ˜¯é‡è¯•æœºåˆ¶ï¼Œå½“å¤±è´¥æ—¶ï¼Œå¹¶ä¸”æ²¡æœ‰è¾¾åˆ°é‡è¯•é˜ˆå€¼æ—¶ï¼ˆå‰æ–‡æ„é€ clientæ—¶ä¼ å…¥çš„å‚æ•°<code>backoffPolicy</code>ï¼‰åˆ™é‡æ–°æ‰§è¡Œï¼Œè¿™é‡ŒåŒ…æ‹¬å…ˆåˆ¤æ–­connectionæ˜¯å¦ä¸ºnilï¼Œå¦‚æœæ˜¯åˆ™è°ƒç”¨å‰é¢åˆ†æè¿‡çš„<code>connect</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨<code>action</code>ï¼Œä¹Ÿå°±æ˜¯<code>b.client.Recv()</code>ä¼ å…¥çš„æ–¹æ³•å‚æ•°ï¼Œå®é™…ä¸Šæ˜¯æ‰§è¡Œ<code>bc.BlocksDeliverer.Recv()</code>ã€‚è¿™é‡Œæ³¨æ„ï¼Œåœ¨å‰é¢åˆ†æçš„<code>afterConnect</code>æ–¹æ³•é‡Œï¼Œå·²ç»è®¾ç½®<code>bc.BlocksDeliverer=abc</code>(å³<code>orderer.AtomicBroadcast_DeliverClient</code>)ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯ä»ordererçš„deliver grpc streamé‡Œè¯»å–ï¼Œç„¶åé€çº§è¿”å›åˆ°<code>blocksprovider.go#DeliverBlocks</code>ã€‚å¤„ç†æ¥æ”¶åˆ°çš„blockè¿™éƒ¨åˆ†ä¸gossipç›¸å…³ï¼Œç•™å¾…åç»­å†ä¸€èµ·åˆ†æã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - ordererçš„deliverè¿‡ç¨‹</title>
      <link href="//articles/fabric-source-orderer-deliver/"/>
      <url>//articles/fabric-source-orderer-deliver/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ordererç«¯ï¼Œdeliverå’Œbroadcastæ˜¯å¯¹ç­‰çš„ï¼Œæœ€åˆå›æº¯åˆ°<code>protos/orderer/ab.pb.go</code>é‡Œçš„grpcå®šä¹‰ï¼Œå¯¹åº”çš„grpcæ–¹æ³•æ˜¯<code>/orderer.AtomicBroadcast/Deliver</code>ã€‚å¯¹åº”æºç <code>orderer/common/server/server.go#Deliver</code> -&gt; <code>common/deliver/deliver.go#Handle</code> -&gt; <code>deliver.go#deliverBlocks</code>ã€‚åœ¨<code>deliverBlocks</code>è¿™ä¸ªæ–¹æ³•é‡Œï¼Œå…ˆååºåˆ—åŒ–cb.Envelopeï¼Œè·å–å¹¶ä¸”æ ¡éªŒHeaderï¼Œç„¶åæ ¡éªŒaccess controlï¼Œåˆ¤æ–­clientçš„identityè¯ä¹¦æ˜¯å¦è¿‡æœŸï¼Œä»¥åŠç­–ç•¥æ ¡éªŒæ˜¯å¦æ‹¥æœ‰è¯»æƒé™ï¼ˆpolicies.ChannelReadersï¼Œä»£ç ä¸º<code>orderer/common/server/server.go#Deliver : sf := msgprocessor.NewSigFilter(policies.ChannelReaders, chain)</code>ï¼‰ã€‚æ ¡éªŒé€šè¿‡åï¼Œå°†envelopeååºåˆ—åŒ–ä¸º<code>ab.SeekInfo</code>ç»“æ„ã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SeekInfo specifies the range of requested blocks to return</span></span><br><span class="line"><span class="comment">// If the start position is not found, an error is immediately returned</span></span><br><span class="line"><span class="comment">// Otherwise, blocks are returned until a missing block is encountered, then behavior is dictated by the SeekBehavior specified.  </span></span><br><span class="line"><span class="comment">// If BLOCK_UNTIL_READY is specified, the reply will block until the requested blocks are available</span></span><br><span class="line"><span class="comment">// if FAIL_IF_NOT_READY is specified, the reply will return an error indicating that the block is not found.  </span></span><br><span class="line"><span class="comment">// To request that all blocks be returned indefinitely as they are created, behavior should be set to BLOCK_UNTIL_READY and the stop should be set to specified with a number of MAX_UINT64</span></span><br><span class="line"><span class="keyword">type</span> SeekInfo <span class="keyword">struct</span> {</span><br><span class="line">    Start    *SeekPosition </span><br><span class="line">    Stop     *SeekPosition </span><br><span class="line">    Behavior SeekInfo_SeekBehavior </span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">deliverBlocks</span><span class="params">(ctx context.Context, srv *Server, envelope *cb.Envelope)</span> <span class="title">error</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... æ ¡éªŒï¼Œç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®seekInfo.Stopè®¡ç®—rangeçš„ç»ˆæ­¢block number</span></span><br><span class="line">    cursor, number := chain.Reader().Iterator(seekInfo.Start)</span><br><span class="line">    <span class="keyword">defer</span> cursor.Close()</span><br><span class="line">    <span class="keyword">switch</span> stop := seekInfo.Stop.Type.(<span class="keyword">type</span>) {</span><br><span class="line">    <span class="keyword">case</span> *ab.SeekPosition_Oldest:</span><br><span class="line">        stopNum = number</span><br><span class="line">    <span class="keyword">case</span> *ab.SeekPosition_Newest:</span><br><span class="line">        stopNum = chain.Reader().Height() - <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> *ab.SeekPosition_Specified:</span><br><span class="line">        stopNum = stop.Specified.Number</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> {</span><br><span class="line">        <span class="comment">// å¦‚æœrangeè¶…è¶Šå½“å‰åˆ°chainé«˜åº¦ï¼Œfail fast</span></span><br><span class="line">        <span class="keyword">if</span> seekInfo.Behavior == ab.SeekInfo_FAIL_IF_NOT_READY {</span><br><span class="line">            <span class="keyword">if</span> number &gt; chain.Reader().Height()<span class="number">-1</span> {</span><br><span class="line">                <span class="keyword">return</span> srv.SendStatusResponse(cb.Status_NOT_FOUND)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        iterCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>{})</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">            <span class="comment">// è¯»å–ä¸‹ä¸€ä¸ªblock</span></span><br><span class="line">            block, status = cursor.Next()</span><br><span class="line">            <span class="built_in">close</span>(iterCh)</span><br><span class="line">        }()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">select</span> {</span><br><span class="line">        <span class="keyword">case</span> &lt;-ctx.Done(): <span class="comment">// "context finished before block retrieved"</span></span><br><span class="line">            <span class="keyword">return</span> errors.Wrapf(ctx.Err(), <span class="string">"context finished before block retrieved"</span>)</span><br><span class="line">        <span class="keyword">case</span> &lt;-erroredChan: <span class="comment">// "Aborting deliver for request because of background error"</span></span><br><span class="line">            <span class="keyword">return</span> srv.SendStatusResponse(cb.Status_SERVICE_UNAVAILABLE)</span><br><span class="line">        <span class="keyword">case</span> &lt;-iterCh:</span><br><span class="line">            <span class="comment">// Iterator has set the block and status varsï¼Œå®Œæˆè¯»å–</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// increment block number to support FAIL_IF_NOT_READY deliver behavior</span></span><br><span class="line">        number++</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†æ¬¡é€šè¿‡æƒé™æ ¡éªŒ access control</span></span><br><span class="line">        <span class="keyword">if</span> err := accessControl.Evaluate(); err != <span class="literal">nil</span> {</span><br><span class="line">            <span class="keyword">return</span> srv.SendStatusResponse(cb.Status_FORBIDDEN)</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€ä¸ªblockå‘é€</span></span><br><span class="line">        <span class="keyword">if</span> err := srv.SendBlockResponse(block); err != <span class="literal">nil</span> {</span><br><span class="line">            <span class="keyword">return</span> err</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> stopNum == block.Header.Number {</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¨éƒ¨blockå‘é€å®Œæˆåï¼Œå†å›å¤å½“å‰deliver rpcè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> err := srv.SendStatusResponse(cb.Status_SUCCESS); err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><span id="more"></span><p>åœ¨é…ç½®æ–‡ä»¶<code>orderer.yaml</code>é‡ŒæŒ‡å®šäº†<code>General.LedgerType: file</code>(å¯é€‰æœ‰fileï¼Œjsonï¼Œramä¸‰ç§æ¨¡å¼)ï¼Œè¿™é‡Œä»¥fileä¸ºä¾‹åˆ†æordererçš„æœ¬åœ°è´¦æœ¬ï¼Œå®ç°åœ¨<code>common/ledger/blockledger/file/impl.go</code>ã€‚<code>file/imple.go#Next</code>æ–¹æ³•é‡Œè°ƒç”¨çš„<code>i.commonIterator.Next()</code>ï¼Œå¦‚æ³¨é‡Šé‡Œæ‰€è¿°ï¼Œå°†ä¼šblockç›´åˆ°å¯ä»¥è·å–åˆ°ä¸‹ä¸€ä¸ªblockï¼Œå› æ­¤åªè¦clientçš„è¯·æ±‚é‡ŒseekInfo.stopä¸ºæœ€å¤§å€¼MAX_UINT64ï¼ŒSeekInfo_SeekBehavioré€‰æ‹©BLOCK_UNTIL_READYï¼Œåˆ™æ–°äº§ç”Ÿçš„blockä¼šæºæºä¸æ–­çš„å‘é€åˆ°clientã€‚(ä½¿ç”¨æ ‡å‡†åŒ…çš„sync.cond)ï¼Œ<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(fl *FileLedger)</span> <span class="title">Iterator</span><span class="params">(startPosition *ab.SeekPosition)</span> <span class="params">(blockledger.Iterator, <span class="keyword">uint64</span>)</span></span> {</span><br><span class="line">    <span class="keyword">var</span> startingBlockNumber <span class="keyword">uint64</span></span><br><span class="line">    <span class="keyword">switch</span> start := startPosition.Type.(<span class="keyword">type</span>) {</span><br><span class="line">    <span class="keyword">case</span> *ab.SeekPosition_Oldest:</span><br><span class="line">        <span class="comment">// ç»“åˆdeliverBlocksé‡Œçš„stopNumï¼Œå¾—çŸ¥SeekPosition_Oldestè¿”å›æœ€æ—©çš„ä¸€ä¸ªblockï¼Œstart=stop=0</span></span><br><span class="line">        startingBlockNumber = <span class="number">0</span></span><br><span class="line">    <span class="keyword">case</span> *ab.SeekPosition_Newest:</span><br><span class="line">        <span class="comment">// ç»“åˆdeliverBlocksé‡Œçš„stopNumï¼Œå¾—çŸ¥SeekPosition_Newestè¿”å›æœ€æ–°çš„ä¸€ä¸ªblockï¼Œstart=stop=chain.height-1</span></span><br><span class="line">        info, err := fl.blockStore.GetBlockchainInfo()</span><br><span class="line">        newestBlockNumber := info.Height - <span class="number">1</span></span><br><span class="line">        startingBlockNumber = newestBlockNumber</span><br><span class="line">    <span class="keyword">case</span> *ab.SeekPosition_Specified:</span><br><span class="line">        startingBlockNumber = start.Specified.Number</span><br><span class="line">        height := fl.Height()</span><br><span class="line">        <span class="keyword">if</span> startingBlockNumber &gt; height {</span><br><span class="line">            <span class="keyword">return</span> &amp;blockledger.NotFoundErrorIterator{}, <span class="number">0</span></span><br><span class="line">        }</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> &amp;blockledger.NotFoundErrorIterator{}, <span class="number">0</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    iterator, err := fl.blockStore.RetrieveBlocks(startingBlockNumber)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;fileLedgerIterator{ledger: fl, blockNumber: startingBlockNumber, commonIterator: iterator}, startingBlockNumber</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Next blocks until there is a new block available, or until Close is called.</span></span><br><span class="line"><span class="comment">// It returns an error if the next block is no longer retrievable.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *fileLedgerIterator)</span> <span class="title">Next</span><span class="params">()</span> <span class="params">(*cb.Block, cb.Status)</span></span> {</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ ‡å‡†åŒ…sync.cond</span></span><br><span class="line">    result, err := i.commonIterator.Next()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        logger.Error(err)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, cb.Status_SERVICE_UNAVAILABLE</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// Cover the case where another thread calls Close on the iterator.</span></span><br><span class="line">    <span class="keyword">if</span> result == <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, cb.Status_SERVICE_UNAVAILABLE</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result.(*cb.Block), cb.Status_SUCCESS</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>å…·ä½“è·Ÿè¸ªä¸‹è¿™ä¸ªç­‰å¾…å¯¹æ–°blockçš„æœºåˆ¶ï¼Œ<br><code>impl.go#Next : result, err := i.commonIterator.Next()</code><br>-&gt;<code>fsblkstorage/blocks_itr.go#Next() : itr.waitForBlock(itr.blockNumToRetrieve)</code><br>-&gt;<code>fsblkstorage/blocks_itr.go#waitForBlock()</code>ï¼Œè¿™é‡Œæ‰§è¡Œäº†<code>itr.mgr.cpInfoCond.Wait()</code>ï¼Œå°±æ˜¯ç­‰å¾…æ–°blockã€‚  </p><p>è€Œç›¸åº”çš„åœ¨æ·»åŠ blockæ—¶ï¼Œä»¥soloæ–¹å¼ä¸ºä¾‹ï¼Œ<br><code>orderer/consensus/solo/consensus.go#main : ch.support.WriteBlock(block, nil)</code><br>-&gt;<code>orderer/common/multichannel/blockwriter.go#WriteBlock : bw.commitBlock(encodedMetadataValue)</code><br>-&gt;<code>blockwriter.go#commitBlock :  bw.support.Append(bw.lastBlock)</code><br>-&gt;<code>common/ledger/blockledger/file/impl.go#Append : fl.blockStore.AddBlock(block)</code><br>-&gt;<code>fsblkstorage/fs_blockstore.go#AddBlock</code><br>-&gt;<code>fsblkstorage/blockfile_mgr.go#addBlock : mgr.updateCheckpoint(newCPInfo)</code><br>-&gt;<code>/fsblkstorage/blockfile_mgr.go#updateCheckpoint</code>é‡Œï¼Œæ‰§è¡Œäº†<code>mgr.cpInfoCond.Broadcast()</code>ï¼Œä¹Ÿå°±æ˜¯å½“å†™å…¥blockåï¼Œé€šçŸ¥åˆ°å‰é¢çš„waitï¼Œå®ç°äº†äº§ç”Ÿæ¯ä¸€ä¸ªæ–°blockï¼Œç«‹åˆ»deliverè¯¥blockçš„é€»è¾‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Kafka-based Ordering Service for Fabric ï¼ˆordererçš„åº”ç”¨kafkaè®¾è®¡æ€æƒ³ï¼‰å­¦ä¹ ç¬”è®°</title>
      <link href="//articles/fabric-orderer-kafka-design/"/>
      <url>//articles/fabric-orderer-kafka-design/</url>
      
        <content type="html"><![CDATA[<p><a href="https://docs.google.com/document/d/19JihmW-8blTzN99lAubOfseLUZqdrB6sBR0HsRgCAnY/edit">A Kafka-based Ordering Service for Fabric</a>è¿™ç¯‡æ–‡ç« æ˜¯ordererçš„kafkaè®¾è®¡æ–‡æ¡£ï¼Œè¯¦ç»†ä»‹ç»ordereråº”ç”¨kafkaçš„è®¾è®¡æ€æƒ³æ¼”è¿›è¿‡ç¨‹ï¼Œä»åŸºæœ¬ç‚¹é€æ­¥æ·±å…¥ï¼Œç”±é—®é¢˜åˆ°è§£å†³æ–¹æ¡ˆï¼Œå€¼å¾—é˜…è¯»ã€‚è¿™é‡Œåˆ—ä¸¾å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ã€‚</p><ul><li><em>Solution 0ï¼ˆS0ï¼‰</em> ï¼š å•ä¸ªtxï¼ˆtransactionï¼‰æ„æˆblockã€‚  </li><li><em>Problem 1ï¼ˆP1ï¼‰</em> ï¼š å•ä¸ªblockçš„sizeå¾ˆå°ï¼Œå½“ç½‘ç»œæœ‰å¤§é‡txæ—¶ä¼šäº§ç”Ÿå¤§é‡çš„blockã€‚è€ŒOSNï¼ˆordering service nodeï¼‰éœ€è¦å¯¹blockè¿›è¡Œæ‰“åŒ…ï¼Œç­¾åï¼Œclientéœ€è¦è§£åŒ…ï¼ŒéªŒè¯ç­¾åã€‚overheadå¤ªå¤§ï¼Œæ•ˆç‡å¤ªä½ã€‚  </li><li><em>S1</em> ï¼šå¤šä¸ªtxæ‰“åŒ…æˆä¸€ä¸ªblockã€‚  </li><li><em>P2</em> : ä½†æ˜¯éœ€è¦ç¼“å­˜åˆ°æŒ‡å®šæ•°é‡çš„txï¼Œå¦‚æœç½‘ç»œtxå¤ªå°‘ï¼Œå¯èƒ½éœ€è¦ç­‰å¾ˆé•¿æ—¶é—´æ‰äº§ç”Ÿä¸€ä¸ªblockï¼Œtxéœ€è¦ç­‰å¾…å¾ˆä¹…æ‰å¾—ä»¥ç¡®è®¤ã€‚</li><li><em>S2</em> ï¼š å¢åŠ æ—¶é’Ÿï¼Œå¦‚æœæŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è¾¾åˆ°æ•°é‡è¦æ±‚ï¼Œæ—¶é’Ÿåˆ°æ—¶åˆ‡åˆ†blockã€‚  </li><li><em>P3</em> ï¼š å„ä¸ªOSNæ—¶é’Ÿä¸åŒæ­¥ï¼Œå¯èƒ½å¯¼è‡´blocké—´åˆ‡åˆ†çš„ä½ç½®å·®å¼‚ã€‚</li><li><em>S3</em> ï¼š OSNåŠ å…¥TTC-Xï¼ˆTime to Cut block-Xï¼‰ï¼Œæ—¶é’Ÿåˆ°æ—¶å‘é€è¯¥messageåˆ°kafkaï¼Œå„ä¸ªOSNæ”¶åˆ°æ”¹æ¶ˆæ¯ååˆ‡åˆ†blockã€‚</li></ul><h2 id=""><a href="#" class="headerlink" title=""></a><span id="more"></span></h2><ul><li><em>P4</em> ï¼š DeliveræœåŠ¡éœ€è¦è¯»å–æŒ‡å®šblockã€‚</li><li><em>S4a</em> ï¼š blockå¤´éƒ¨åŠ ä¸Šmetadataï¼Œä»block X-1å¯ä»¥çŸ¥é“block Xçš„å¼€å§‹çš„kafka offsetã€‚OSNä»è¯¥offsetå¼€å§‹é‡è¯»kafkaï¼Œreplayé‡æ–°æ„å»ºblockã€‚</li><li><em>P4a</em> ï¼š å¦‚æœclientç¼ºå°‘block X-1ï¼Œå°±æ— æ³•å¾—çŸ¥block Xçš„å¼€å§‹offsetã€‚</li><li><em>S4b</em> ï¼š OSNä¿å­˜tableï¼Œblock number &lt;-&gt; offset numberã€‚</li><li><em>P5</em> ï¼š è¯»å–block Xéœ€è¦ä»kafkaé‡è¯»æ¶ˆæ¯ï¼Œé‡æ–°æ‰“åŒ…ï¼Œç­¾åã€‚</li><li><em>P6</em> ï¼š ç½‘ç»œä¸­å­˜åœ¨é‡å¤çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚re-orderçš„æ¶ˆæ¯</li><li><em>S5a</em> ï¼š kafka partition 0 ä¿å­˜txï¼Œpartition 1ä¿å­˜æ‰“åŒ…åçš„blockï¼Œç®€å†partition 1çš„tableï¼Œblock number &lt;-&gt; offset numberã€‚å¦‚æœéœ€è¦è¯»å–blcok Xï¼Œåˆ™æŸ¥è¡¨ï¼Œä»partition 1è¯»å–ç›¸åº”offsetçš„blockã€‚ä½†æ˜¯ï¼Œéœ€è¦æ¯æ¬¡æŸ¥è¡¨ï¼Œè€Œä¸”æ— æ³•è§£å†³P6ã€‚partiton 1ä¸­çš„æ¯ä¸ªblockä¼šè¢«æ¯ä¸ªOSNéƒ½å‘é€ä¸€æ¬¡ï¼Œå¤§é‡é‡å¤çš„blockã€‚</li><li><em>S6a</em> ï¼šOSNå‘é€å‰åˆ¤æ–­partition 1ä¸­æ˜¯å¦æœ‰é‡å¤çš„block numberï¼Œå¦‚æœå·²å­˜åœ¨åˆ™ä¸åœ¨å‘é€ã€‚ä½†æ˜¯æ‰€æœ‰çš„OSNä¹‹é—´æ— æ³•åšåˆ°ä¸¥æ ¼åŒæ­¥ï¼Œå¯èƒ½æœ‰å¤šä¸ªblockå‰¯æœ¬ï¼ˆæ¥è‡ªä¸åŒçš„OSNçš„åŒä¸€ä¸ªblockåŒæ—¶å‘é€ï¼‰å¤„åœ¨in-flightçŠ¶æ€ï¼Œä»ç„¶æ²¡æœ‰è§£å†³é‡å¤çš„é—®é¢˜ã€‚</li><li><em>S6b</em> ï¼š é€‰ä¸¾OSN leaderï¼Œåªæœ‰leaderæ‰èƒ½å‘é€åˆ°partition 1ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°±leaderå‘é€block Xåcrashï¼Œé€‰ä¸¾çš„æ–°leaderé‡å‘block Xï¼Œå¯¼è‡´é‡å¤ï¼ˆæ—§leaderå‘çš„block Xå¤„åœ¨in flightçŠ¶æ€ï¼‰ã€‚æ— æ³•ä½¿å¾—block number = offset numberï¼Œä»ç„¶éœ€è¦å­˜è¡¨æŸ¥è¡¨ã€‚</li><li><p><em>S6c</em> ï¼š ä½¿ç”¨kafkaçš„logå‹ç¼©ç‰¹æ€§ï¼Œä¿ç•™keyç›¸åŒï¼ˆå¯ä»¥ä½¿ç”¨block number Xä½œä¸ºkeyï¼‰åªæœ‰ä¸€ä¸ªoffsetï¼Œåˆ é™¤å†—ä½™çš„ã€‚ä½†æ˜¯ï¼ŒOSNè¦ä¿ç•™tableï¼Œblock number &lt;-&gt; offset numberï¼Œå¹¶ä¸”logå‹ç¼©ååˆ é™¤æ—§å€¼ï¼Œè¡¨é‡Œå¦‚æœæ›´æ–°ä¸åŠæ—¶ä¼šè¯»å–åˆ°æ—§offsetï¼ˆå®é™…ä¸Šå·²ç»è¢«åˆ é™¤ï¼‰ã€‚è€Œä¸”å‹ç¼©åçš„blockä¸offseté—´æ˜¯ä¹±åºçš„ã€‚</p></li><li><p><strong><em>S5b,S6d</em></strong> : OSNæŠŠblockå­˜å‚¨æœ¬åœ°è´¦æœ¬ã€‚æ— éœ€ä½¿ç”¨tableï¼Œä»txæ„å»ºè´¦æœ¬é“¾å¯ä»¥ä¿è¯é¡ºåºæ€§ï¼Œè€Œä¸”deliverä¹Ÿå¯ä»¥å¤ç”¨orderer broadcastä»£ç ã€‚</p><blockquote><p>The OSN will need to keep track of the last offset number it read though, just so that it knows where to seek to when consuming from Kafka upon reconnection.</p><p>A downside of serving Deliver requests from the local ledger could be that it would be slower than serving them straight from Kafka. But we never serve straight from Kafka; thereâ€™s always some processing happening on the OSNs. (å…¶ä»–çš„æ–¹æ¡ˆåœ¨OSNä¹Ÿä¼šå¼•å…¥å¼€é”€)</p></blockquote></li></ul><blockquote><p><strong>Overall an ordering service that uses a single partition (per chain) for incoming client transactions and TTC-X messages (as shown in Solution 3), and which stores the resulting blocks in a local ledger (again, per chain) strikes a nice balance between performance and complexity.</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - ordererçš„kafkaå®ç°</title>
      <link href="//articles/fabric-source-orderer-kafka/"/>
      <url>//articles/fabric-source-orderer-kafka/</url>
      
        <content type="html"><![CDATA[<p>åœ¨instantiateï¼ˆ8ï¼‰é‡Œæåˆ°ï¼Œordereræ€»å…±æœ‰soloå’Œkafka,etcdraftä¸‰ç§æ–¹å¼ï¼Œå¹¶ä¸”ä»‹ç»äº†å•ordererèŠ‚ç‚¹çš„soloæ–¹å¼ã€‚è¿™é‡Œç»§ç»­è¡¥å……ä»‹ç»å¤šordererèŠ‚ç‚¹ä¸‹é‡‡ç”¨çš„kafkaæ–¹å¼ã€‚kafkaå®ç°çš„ä»£ç æ”¾åœ¨<code>orderer/consensus/kafka/chain.go</code>é‡Œï¼Œä¸soloä¸€æ ·å®ç°äº†<code>orderer/common/broadcast/broadcast.go#Consenter</code>è¿™ä¸ªæ¥å£ã€‚åœ¨ordererçš„å¤„ç†æ¶ˆæ¯æ—¶<code>orderer/common/broadcast/broadcast.go#Handle</code>ï¼Œè°ƒç”¨äº†å…¶<code>Order</code>æ–¹æ³•ã€‚<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(chain *chainImpl)</span> <span class="title">Order</span><span class="params">(env *cb.Envelope, configSeq <span class="keyword">uint64</span>)</span> <span class="title">error</span></span> {</span><br><span class="line"><span class="keyword">return</span> chain.order(env, configSeq, <span class="keyword">int64</span>(<span class="number">0</span>))</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(chain *chainImpl)</span> <span class="title">order</span><span class="params">(env *cb.Envelope, configSeq <span class="keyword">uint64</span>, originalOffset <span class="keyword">int64</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">    marshaledEnv, err := utils.Marshal(env)</span><br><span class="line">    <span class="keyword">if</span> !chain.enqueue(newNormalMessage(marshaledEnv, configSeq, originalOffset)) {</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"cannot enqueue"</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// enqueue accepts a message and returns true on acceptance, or false otheriwse.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(chain *chainImpl)</span> <span class="title">enqueue</span><span class="params">(kafkaMsg *ab.KafkaMessage)</span> <span class="title">bool</span></span> {</span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> &lt;-chain.startChan: <span class="comment">// The Start phase has completed</span></span><br><span class="line">        <span class="keyword">select</span> {</span><br><span class="line">        <span class="keyword">case</span> &lt;-chain.haltChan: <span class="comment">// The chain has been halted, stop here</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">// The post path</span></span><br><span class="line">            payload, err := utils.Marshal(kafkaMsg)</span><br><span class="line"></span><br><span class="line">            message := newProducerMessage(chain.channel, payload)</span><br><span class="line">            <span class="keyword">if</span> _, _, err = chain.producer.SendMessage(message); err != <span class="literal">nil</span> {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        }</span><br><span class="line">    <span class="keyword">default</span>: <span class="comment">// Not ready yet</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newProducerMessage</span><span class="params">(channel channel, pld []<span class="keyword">byte</span>)</span> *<span class="title">sarama</span>.<span class="title">ProducerMessage</span></span> {</span><br><span class="line">    <span class="keyword">return</span> &amp;sarama.ProducerMessage{</span><br><span class="line">        Topic: channel.topic(),</span><br><span class="line">        Key:   sarama.StringEncoder(strconv.Itoa(<span class="keyword">int</span>(channel.partition()))), </span><br><span class="line">        Value: sarama.ByteEncoder(pld),</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>é¦–å…ˆæ„å»ºäº†æ¶ˆæ¯å®ä½“<code>orderer/consensus/kafka/chain.go:KafkaMessage</code>ï¼Œå…¥å‚ä¸ºä¼ é€’çš„æ¶ˆæ¯<code>cb.Envelope</code>ï¼Œå½“å‰é…ç½®åºåˆ—å·<code>configSeq</code>ï¼Œå›ºå®šçš„<code>originalOffset</code>å€¼ä¸º0(è¿™ä¸ªå€¼çš„å«ä¹‰åé¢ä¼šæåˆ°ï¼Œè¡¨ç¤ºçš„æ˜¯æ˜¯å¦å½“å‰æ¶ˆæ¯æ˜¯é‡æ–°å‘é€é‡æ’ï¼Œå€¼ä¸º0åˆ™è¯´æ˜å½“å‰æ¶ˆæ¯æ˜¯æ–°æ¶ˆæ¯)ã€‚ç„¶åæ„å»ºä¼ é€’kafkaæ¶ˆæ¯<code>sarama.ProducerMessage</code>ï¼Œè¿™é‡Œkafkaç›¸å…³çš„ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“<a href="https://github.com/Shopify/sarama">Shopify/sarama</a>ã€‚æ¶ˆæ¯é‡ŒæŒ‡å®šäº†topicï¼Œç”±partitionæ„å»ºkeyï¼Œç„¶åå°±æ˜¯å°†åˆšæ‰æ„å»ºçš„æ¶ˆæ¯ä½œä¸ºpayloadã€‚åé¢å¯ä»¥çœ‹åˆ°topicå’Œpartitionéƒ½æ˜¯channelçš„é…ç½®å‚æ•°ï¼ˆåˆå§‹åŒ–æˆ–è€…åé¢çš„æ›´æ–°ï¼‰ã€‚è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„kafkaæ¶ˆæ¯çš„keyéƒ½æ˜¯ç›¸åŒçš„ï¼Œæ„å‘³è¿™æ‰€æœ‰æ¶ˆæ¯éƒ½å‘é€åˆ°åŒä¸€ä¸ªpartitionå†…ï¼ŒæŒ‰ç…§keyçš„ç®—æ³•ä¹Ÿå°±æ˜¯<code>channel.partition()</code>ã€‚è¿™é‡Œä¿è¯äº†å•ä¸ªordererå‘å‡ºçš„envelopçš„æœ‰åºæ€§ï¼Œä½†åŒæ—¶ä»å…¨å±€æ¥è¯´ï¼Œåªä½¿ç”¨ä¸€ä¸ªpartitionï¼Œå¹¶æ²¡æœ‰å……åˆ†åˆ©ç”¨kafkaå¤špartitionçš„å¸¦æ¥çš„é«˜æ€§èƒ½ã€‚ç„¶åä½¿ç”¨<code>sarama.SyncProducer</code>å‘é€æ¶ˆæ¯<code>chain.producer.SendMessage</code>ã€‚</p><span id="more"></span><p>æ¥ä¸‹æ¥åˆ†æ<code>sarama.SyncProducer</code>çš„åˆå§‹åŒ–ï¼Œä»¥åŠç›¸åº”çš„kafka consumeræ¶ˆè´¹è¿‡ç¨‹ã€‚kafkaçš„åˆå§‹åŒ–æ–¹æ³•æ˜¯<code>orderer/consensus/kafka/chain.go#startThread</code>ã€‚ä»è¿™ä¸ªä¸€ç›´å›æº¯åˆ°<code>chainsupport.go#start</code>ï¼Œæ€»å…±æœ‰ä¸¤ä¸ªåœ°æ–¹è°ƒç”¨ã€‚ä¸€æ˜¯<code>registar.go#NewRegistrar</code>ï¼Œè¿™é‡Œä»ledgerFactoryé‡Œçš„è®°å½•æ‰¾å‡ºexistingChainsé‡å»ºï¼›äºŒæ˜¯<code>registar.go#newChain</code>,æ¥æ”¶åˆ°æ¶ˆæ¯çš„payload.Header.ChannelHeader.Typeä¸º<code>cb.HeaderType_ORDERER_TRANSACTION</code>æ—¶æ–°å»ºã€‚è¿™é‡Œä»¥æ–°å»ºchainï¼ˆchannelï¼‰ä¸ºä¾‹ã€‚<code>newChain</code>æ–¹æ³•é‡Œè°ƒç”¨äº†<code>newChainSupport</code>,é‡Œé¢åˆå§‹åŒ–chainsupportçš„Chainå‚æ•°<code>cs.Chain, err = consenter.HandleChain(cs, metadata)</code>ã€‚è¿™é‡Œçš„consenteræ˜¯<code>consensus.go#Consenter</code>æ¥å£,è¿™é‡Œçš„å®ç°ç±»æ˜¯<code>orderer/consensus/kafka/consenter.go:consenterImpl</code>.<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newChainSupport</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">registrar *Registrar,</span></span></span><br><span class="line"><span class="params"><span class="function">ledgerResources *ledgerResources,</span></span></span><br><span class="line"><span class="params"><span class="function">consenters <span class="keyword">map</span>[<span class="keyword">string</span>]consensus.Consenter,</span></span></span><br><span class="line"><span class="params"><span class="function">signer crypto.LocalSigner,</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> *<span class="title">ChainSupport</span></span> {</span><br><span class="line">    <span class="comment">// Read in the last block and metadata for the channel</span></span><br><span class="line">    lastBlock := blockledger.GetBlock(ledgerResources, ledgerResources.Height()<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    metadata, err := utils.GetMetadataFromBlock(lastBlock, cb.BlockMetadataIndex_ORDERER)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Construct limited support needed as a parameter for additional support</span></span><br><span class="line">    cs := &amp;ChainSupport{</span><br><span class="line">        ledgerResources: ledgerResources,</span><br><span class="line">        LocalSigner:     signer,</span><br><span class="line">        cutter:          blockcutter.NewReceiverImpl(ledgerResources),</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set up the msgprocessor</span></span><br><span class="line">    cs.Processor = msgprocessor.NewStandardChannel(cs, msgprocessor.CreateStandardChannelFilters(cs))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set up the block writer</span></span><br><span class="line">    cs.BlockWriter = newBlockWriter(lastBlock, registrar, cs)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set up the consenter</span></span><br><span class="line">    cs.Chain, err = consenter.HandleChain(cs, metadata)</span><br><span class="line">    <span class="keyword">return</span> cs</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// HandleChain creates/returns a reference to a consensus.Chain object for the given set of support resources. Implements the consensus.Consenter interface. </span></span><br><span class="line"><span class="comment">// Called by consensus.newChainSupport(), which is itself called by multichannel.NewManagerImpl() when ranging over the ledgerFactory's existingChains.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(consenter *consenterImpl)</span> <span class="title">HandleChain</span><span class="params">(support consensus.ConsenterSupport, metadata *cb.Metadata)</span> <span class="params">(consensus.Chain, error)</span></span> {</span><br><span class="line">    lastOffsetPersisted, lastOriginalOffsetProcessed, lastResubmittedConfigOffset := getOffsets(metadata.Value, support.ChainID())</span><br><span class="line">    <span class="keyword">return</span> newChain(consenter, support, lastOffsetPersisted, lastOriginalOffsetProcessed, lastResubmittedConfigOffset)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getOffsets</span><span class="params">(metadataValue []<span class="keyword">byte</span>, chainID <span class="keyword">string</span>)</span> <span class="params">(persisted <span class="keyword">int64</span>, processed <span class="keyword">int64</span>, resubmitted <span class="keyword">int64</span>)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> metadataValue != <span class="literal">nil</span> {</span><br><span class="line">        <span class="comment">// Extract orderer-related metadata from the tip of the ledger first</span></span><br><span class="line">        kafkaMetadata := &amp;ab.KafkaMetadata{}</span><br><span class="line">        proto.Unmarshal(metadataValue, kafkaMetadata);</span><br><span class="line">        <span class="keyword">return</span> kafkaMetadata.LastOffsetPersisted,</span><br><span class="line">            kafkaMetadata.LastOriginalOffsetProcessed,</span><br><span class="line">            kafkaMetadata.LastResubmittedConfigOffset</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> sarama.OffsetOldest - <span class="number">1</span>, <span class="keyword">int64</span>(<span class="number">0</span>), <span class="keyword">int64</span>(<span class="number">0</span>) <span class="comment">// default</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><ol><li>ä»ä¸Šä¸€ä¸ªåŒºå—<code>blockledger.GetBlock(ledgerResources, ledgerResources.Height()-1)</code>è·å–å…ƒæ•°æ®ï¼Œä¹Ÿå°±æ˜¯<code>BlockMetadata.Metadata</code>å†…keyä¸º<code>cb.BlockMetadataIndex_SIGNATURES</code>çš„å€¼ï¼Œåœ¨instantiateï¼ˆ8ï¼‰é‡ŒæåŠå…¶ä»–ä¸‰ç§ã€‚ä»<code>getOffsets</code>é‡Œçœ‹åˆ°ï¼Œå¦‚æœè¯´å½“å‰channelå·²ç»å­˜åœ¨ä¹Ÿæ¶ˆè´¹è¿‡æ•°æ®ï¼Œä¾‹å¦‚é‡å¯å›å¤çš„æƒ…å†µä¸‹ï¼Œåˆ™ä½¿ç”¨çš„æ˜¯metadataé‡Œè®°å½•çš„å€¼ã€‚å¦‚æœæ˜¯æ–°å»ºchannelï¼Œåˆ™ä½¿ç”¨äº†é»˜è®¤<code>LastOffsetPersisted</code>,<code>LastOriginalOffsetProcessed</code>,<code>LastResubmittedConfigOffset</code>è¿™ä¸‰ä¸ªå€¼åˆ†åˆ«å–<code>sarama.OffsetOldest - 1</code>,0,0ã€‚å…·ä½“å‚æ•°çš„å«ä¹‰åé¢åˆ†æã€‚</li><li>æ¥ç€è°ƒç”¨<code>chain.go#newChain</code>ï¼Œé‡Œé¢ä¸»è¦æ˜¯æ„å»ºäº†<code>orderer/consensus/kafka/chain.go:chainImpl</code>è¿™ä¸ªå®ä½“ã€‚å…¶ä¸­éœ€è¦å…³æ³¨çš„æ˜¯<code>chainImpl.channel</code>è¿™ä¸ªå‚æ•°åˆå§‹åŒ–ä¸º<code>newChannel(support.ChainID(), defaultPartition)</code>.å³kafkaçš„topicä¸º<code>support.ChainID()</code>ï¼ˆå³channelåï¼‰ï¼Œpartitionä¸ºå›ºå®šå€¼0ï¼Œè¿™ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„channelçš„topicå’Œpartitionã€‚<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// channel.go</span></span><br><span class="line"><span class="keyword">const</span> defaultPartition = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Returns a new channel for a given topic name and partition number.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newChannel</span><span class="params">(topic <span class="keyword">string</span>, partition <span class="keyword">int32</span>)</span> <span class="title">channel</span></span> {</span><br><span class="line">    <span class="keyword">return</span> &amp;channelImpl{</span><br><span class="line">        tpc: fmt.Sprintf(<span class="string">"%s"</span>, topic),</span><br><span class="line">        prt: partition,</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ol><hr><p>ä¸‹é¢å†å…·ä½“åˆ†æ<code>chain.go#startThread</code><br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Called by Start().</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startThread</span><span class="params">(chain *chainImpl)</span></span> {</span><br><span class="line">    <span class="comment">// Set up the producer</span></span><br><span class="line">    chain.producer, err = setupProducerForChannel(chain.consenter.retryOptions(), chain.haltChan, chain.SharedConfig().KafkaBrokers(), chain.consenter.brokerConfig(), chain.channel)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Have the producer post the CONNECT message</span></span><br><span class="line">    <span class="keyword">if</span> err = sendConnectMessage(chain.consenter.retryOptions(), chain.haltChan, chain.producer, chain.channel); err != <span class="literal">nil</span> {}</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set up the parent consumer</span></span><br><span class="line">    chain.parentConsumer, err = setupParentConsumerForChannel(chain.consenter.retryOptions(), chain.haltChan, chain.SharedConfig().KafkaBrokers(), chain.consenter.brokerConfig(), chain.channel)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set up the channel consumer</span></span><br><span class="line">    chain.channelConsumer, err = setupChannelConsumerForChannel(chain.consenter.retryOptions(), chain.haltChan, chain.parentConsumer, chain.channel, chain.lastOffsetPersisted+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    chain.doneProcessingMessagesToBlocks = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>{})</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(chain.startChan)                <span class="comment">// Broadcast requests will now go through</span></span><br><span class="line">    chain.errorChan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>{}) <span class="comment">// Deliver requests will also go through</span></span><br><span class="line"></span><br><span class="line">    chain.processMessagesToBlocks() <span class="comment">// Keep up to date with the channel</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><ol><li><code>setupProducerForChannel</code>å°è¯•ç”¨é…ç½®å¥½çš„å‚æ•°åˆ›å»ºkafkaçš„producer(<code>sarama.SyncProducer</code>)ï¼Œå¹¶ä¸”åŠ ä¸Šäº†å¤±è´¥é‡è¯•æœºåˆ¶ã€‚é…ç½®åœ¨<code>orderer.yaml</code>æ–‡ä»¶é‡Œã€‚</li><li><code>sendConnectMessage</code>ä½¿ç”¨åˆšåˆ›å»ºçš„kafka producerå‘é€<code>ab.KafkaMessage_Connect</code>æ¶ˆæ¯ï¼Œpayloadä¸ºnilï¼Œåªæ˜¯ä¸ºäº†ä¿è¯é…ç½®æ­£ç¡®èƒ½æ­£å¸¸è¿”é€ã€‚ï¼ˆ<em>Post a CONNECT message to the channel using the given retry options. This prevents the panicking that would occur if we were to set up a consumer and seek on a partition that hadnâ€™t been written to yet.</em> ï¼‰è¿™é‡Œä¹ŸåŠ ä¸Šå¤±è´¥é‡è¿æœºåˆ¶ã€‚</li><li><code>setupParentConsumerForChannel</code>å’Œ<code>setupChannelConsumerForChannel</code>æ„é€ <code>sarama.PartitionConsumer</code>,åªæ¶ˆè´¹æŒ‡å®špartitionçš„æ•°æ®ï¼Œè¿™é‡Œæ¶ˆè´¹çš„å°±æ˜¯åˆå§‹åŒ–æ—¶è®¾ç½®çš„channle.Partition(),å®é™…ä¸Šæ˜¯<code>const defaultPartition = 0</code>ã€‚å¤±è´¥é‡è¯•ã€‚</li><li><code>processMessagesToBlocks</code>çœŸæ­£çš„<code>sarama.PartitionConsumer</code>æ¶ˆè´¹æ•°æ®ï¼Œå¤„ç†æ•°æ®ã€‚è¿™ä¸ªæ–¹æ³•é‡Œæœ‰æ¯”è¾ƒå¤šçš„<code>select-case</code>ï¼Œé¦–å…ˆæ˜¯å¤„ç†<code>case kafkaErr := &lt;-chain.channelConsumer.Errors():</code>ï¼Œè¿™é‡Œé”™è¯¯åˆ†ä¸¤ç§ï¼Œä¸€ç§æ˜¯<code>sarama.ErrOffsetOutOfRange:</code>,è¿™ç±»é”™è¯¯æ— æ³•é€šè¿‡è‡ªåŠ¨é‡è¯•å›å¤ï¼Œåˆ™é‡æ–°å‘é€è¿æ¥æ¶ˆæ¯æ¨è¿›offset,<code>go sendConnectMessage(chain.consenter.retryOptions(), chain.haltChan, chain.producer, chain.channel)</code>ï¼›å¦ä¸€ç§é”™è¯¯åˆ™æ˜¯å¯ä»¥é€šè¿‡è‡ªå¸¦çš„é‡è¯•æœºåˆ¶å›å¤ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå˜é‡å’Œcaseåˆ†æ”¯ã€‚1)<code>case &lt;-topicPartitionSubscriptionResumed:</code>é”™è¯¯æ—¶æ·»åŠ ç›‘å¬å™¨ï¼ŒæˆåŠŸé‡è¿åæ‰“å°æ—¥å¿—ï¼›2ï¼‰<code>case &lt;-deliverSessionTimedOut:</code>é‡è¿è¶…æ—¶ï¼Œåˆ™å†æ¬¡å‘é€è¿æ¥æ¶ˆæ¯<code>go sendConnectMessage(...)</code>ã€‚è¿™ä¸ª<code>select-case</code>é‡Œäº¤ç»‡ç€å¤„ç†è¿™ä¸¤ä¸ªå˜é‡åˆ†æ”¯çš„ä»£ç ã€‚</li></ol><hr><p> æ¥ä¸‹æ¥æ˜¯é‡è¦çš„ä¸¤ä¸ªcaseã€‚ç¬¬ä¸€ä¸ª<code>case &lt;-chain.timer:</code>è¿™é‡Œæ˜¯åœ¨å½“å‰channelè®¾ç½®çš„timeråˆ°æœŸåï¼Œå‘é€<code>&amp;ab.KafkaMessage_TimeToCut</code>æ¶ˆæ¯åˆ°kafkaé€šçŸ¥æ‰€æœ‰ordererï¼Œè¿™é‡Œçš„å‚æ•°ä¸ºä¸‹ä¸€ä¸ªblockçš„numberï¼ˆ<code>chain.lastCutBlockNumber+1</code>ï¼‰ã€‚ç¬¬äºŒä¸ª<code>case in, ok := &lt;-chain.channelConsumer.Messages():</code>é‡Œkafkaæ”¶åˆ°çš„æ¶ˆæ¯ç±»å‹æ€»å…±æœ‰ä¸‰ç§ã€‚</p>  <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> {</span><br><span class="line">   <span class="keyword">select</span> {</span><br><span class="line">   <span class="keyword">case</span> in, ok := &lt;-chain.channelConsumer.Messages():</span><br><span class="line">       <span class="keyword">switch</span> msg.Type.(<span class="keyword">type</span>) {</span><br><span class="line">       <span class="keyword">case</span> *ab.KafkaMessage_Connect:</span><br><span class="line">           _ = chain.processConnect(chain.ChainID())</span><br><span class="line">       <span class="keyword">case</span> *ab.KafkaMessage_TimeToCut:</span><br><span class="line">           <span class="keyword">if</span> err := chain.processTimeToCut(msg.GetTimeToCut(), in.Offset); err != <span class="literal">nil</span> {...}</span><br><span class="line">       <span class="keyword">case</span> *ab.KafkaMessage_Regular:</span><br><span class="line">           <span class="keyword">if</span> err := chain.processRegular(msg.GetRegular(), in.Offset); err != <span class="literal">nil</span> {...}</span><br><span class="line">       }</span><br><span class="line">   <span class="keyword">case</span> &lt;-chain.timer:</span><br><span class="line">       <span class="keyword">if</span> err := sendTimeToCut(chain.producer, chain.channel, chain.lastCutBlockNumber+<span class="number">1</span>, &amp;chain.timer); err != <span class="literal">nil</span> {...}</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure><ol><li><code>case *ab.KafkaMessage_Connect:</code>å‰é¢æåˆ°çš„åœ¨<code>startThread</code>å¯åŠ¨æ—¶å‘é€è¿æ¥æ¶ˆæ¯å’Œé‡åˆ°é”™è¯¯æ—¶å°è¯•é‡è”éƒ½å›å‘é€æ­¤ç±»æ¶ˆæ¯ä»¥æ¨è¿›offsetã€‚è¿™é‡Œå¯¹è¿™ç±»æ¶ˆæ¯ä¸éœ€è¦å¤„ç†ï¼Œä»…ä»…ä½œä¸ºè®°å½•ã€‚</li><li><p><code>case *ab.KafkaMessage_TimeToCut:</code>åˆ¤æ–­æ¶ˆæ¯é‡Œè¦æ±‚cutçš„blocknumæ˜¯å¦æ˜¯å½“å‰èŠ‚ç‚¹æœ¬åœ°blockæ•°æ®çš„ä¸‹ä¸€ä¸ªblockï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œç›´æ¥å°†å½“å‰æ±‡é›†çš„batchåˆ‡å‰²ï¼Œå‰©ä¸‹çš„è·Ÿinstantiateï¼ˆ8ï¼‰é‡Œsoloçš„æµç¨‹ä¸€è‡´ï¼Œå†™å…¥blockã€‚è¿™é‡Œæœ‰æ‰€åŒºåˆ«çš„æ˜¯è¿™é‡Œè¦æäº¤kafkaçš„metadataåˆ°blocké‡Œï¼Œè€Œè¿™éƒ¨åˆ†metadataå†™å…¥äº†<code>bw.lastBlock.Metadata.Metadata[cb.BlockMetadataIndex_ORDERER</code>é‡Œï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°åœ¨é‡å¯chainæ—¶å€™ä»blockçš„<code>BlockMetadata.Metadata</code>å†…å–keyä¸º<code>cb.BlockMetadataIndex_SIGNATURES</code>çš„å€¼æ¥è·å–kafkaæ¶ˆè´¹æ¶ˆæ¯ã€‚å›é¡¾å¯¹æ¯”soloæ–¹å¼ï¼Œåœ¨è°ƒç”¨<code>chain.WriteBlock()</code>æ—¶ï¼Œä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºnilã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">func</span> <span class="params">(chain *chainImpl)</span> <span class="title">processTimeToCut</span><span class="params">(ttcMessage *ab.KafkaMessageTimeToCut, receivedOffset <span class="keyword">int64</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">ttcNumber := ttcMessage.GetBlockNumber()</span><br><span class="line"><span class="keyword">if</span> ttcNumber == chain.lastCutBlockNumber+<span class="number">1</span> {</span><br><span class="line">chain.timer = <span class="literal">nil</span></span><br><span class="line">batch := chain.BlockCutter().Cut()</span><br><span class="line">block := chain.CreateNextBlock(batch)</span><br><span class="line">metadata := utils.MarshalOrPanic(&amp;ab.KafkaMetadata{</span><br><span class="line">            LastOffsetPersisted:         receivedOffset,</span><br><span class="line">            LastOriginalOffsetProcessed: chain.lastOriginalOffsetProcessed,</span><br><span class="line">})</span><br><span class="line">chain.WriteBlock(block, metadata)</span><br><span class="line">chain.lastCutBlockNumber++</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> ttcNumber &gt; chain.lastCutBlockNumber+<span class="number">1</span> {</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(...)</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bw *BlockWriter)</span> <span class="title">WriteBlock</span><span class="params">(block *cb.Block, encodedMetadataValue []<span class="keyword">byte</span>)</span></span> {</span><br><span class="line">bw.committingBlock.Lock()</span><br><span class="line">bw.lastBlock = block</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line"><span class="keyword">defer</span> bw.committingBlock.Unlock()</span><br><span class="line">bw.commitBlock(encodedMetadataValue)</span><br><span class="line">}()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bw *BlockWriter)</span> <span class="title">commitBlock</span><span class="params">(encodedMetadataValue []<span class="keyword">byte</span>)</span></span> {</span><br><span class="line"><span class="comment">// Set the orderer-related metadata field</span></span><br><span class="line"><span class="keyword">if</span> encodedMetadataValue != <span class="literal">nil</span> {</span><br><span class="line">bw.lastBlock.Metadata.Metadata[cb.BlockMetadataIndex_ORDERER] = utils.MarshalOrPanic(&amp;cb.Metadata{Value: encodedMetadataValue})</span><br><span class="line">}</span><br><span class="line">    <span class="comment">// çœç•¥...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ol><ol><li><p><code>case *ab.KafkaMessage_Regular:</code>å¤„ç†æ¶ˆæ¯ï¼ˆenvelopï¼‰</p> <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(chain *chainImpl)</span> <span class="title">processRegular</span><span class="params">(regularMessage *ab.KafkaMessageRegular, receivedOffset <span class="keyword">int64</span>)</span> <span class="title">error</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// When committing a normal message, we also update `lastOriginalOffsetProcessed` with `newOffset`. It is caller's responsibility to deduce correct value of `newOffset` based on following rules:</span></span><br><span class="line">    <span class="comment">// - if Resubmission is switched off, it should always be zero</span></span><br><span class="line">    <span class="comment">// - if the message is committed on first pass, meaning it's not re-validated and re-ordered, this value should be the same as current `lastOriginalOffsetProcessed`</span></span><br><span class="line">    <span class="comment">// - if the message is re-validated and re-ordered, this value should be the `OriginalOffset` of that Kafka message, so that `lastOriginalOffsetProcessed` is advanced</span></span><br><span class="line">    <span class="comment">// å…¶å®ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯å®Œæˆ3ä»¶äº‹æƒ…ã€‚</span></span><br><span class="line">    <span class="comment">// 1ï¼‰å¦‚æœä¸éœ€è¦åˆ‡å‰²ï¼Œå¹¶ä¸”å¦‚æœchain.timeræ²¡æœ‰è®¾ç½®åˆ™é‡è®¾timerï¼ˆç”¨ä»¥å€’è®¡æ—¶å‘é€*ab.KafkaMessage_TimeToCutï¼‰ï¼›</span></span><br><span class="line">    <span class="comment">// 2ï¼‰åˆ‡å‰²ï¼Œæ›´æ–°KafkaMetadata.LastOffsetPersistedä¸ºè¿™ä¸ªblockæœ€åenvelopeçš„offsetï¼›</span></span><br><span class="line">    <span class="comment">// 3ï¼‰æ›´æ–°chain.lastOriginalOffsetProcessedï¼Œå¹¶ä¸”ç”¨ä½œKafkaMetadata.LastOriginalOffsetProcessedã€‚</span></span><br><span class="line">    commitNormalMsg := <span class="function"><span class="keyword">func</span><span class="params">(message *cb.Envelope, newOffset <span class="keyword">int64</span>)</span></span> {</span><br><span class="line">        batches, pending := chain.BlockCutter().Ordered(message)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(batches) == <span class="number">0</span> {</span><br><span class="line">            <span class="comment">// If no block is cut, we update the `lastOriginalOffsetProcessed`, start the timer if necessary and return</span></span><br><span class="line">            chain.lastOriginalOffsetProcessed = newOffset</span><br><span class="line">            <span class="keyword">if</span> chain.timer == <span class="literal">nil</span> {</span><br><span class="line">                <span class="comment">// configtx.yamlé‡Œçš„Orderer: &amp;OrdererDefaults.BatchTimeout</span></span><br><span class="line">                chain.timer = time.After(chain.SharedConfig().BatchTimeout())</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        chain.timer = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">        offset := receivedOffset</span><br><span class="line">        <span class="keyword">if</span> pending || <span class="built_in">len</span>(batches) == <span class="number">2</span> {</span><br><span class="line">            offset--</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            chain.lastOriginalOffsetProcessed = newOffset</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Commit the first block</span></span><br><span class="line">        block := chain.CreateNextBlock(batches[<span class="number">0</span>])</span><br><span class="line">        metadata := utils.MarshalOrPanic(&amp;ab.KafkaMetadata{</span><br><span class="line">            <span class="comment">// LastOffsetPersistedè®°å½•çš„æ˜¯è¿™ä¸ªblockçš„æœ€åenvelopeçš„offsetï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹çš„æœ€åoffset</span></span><br><span class="line">            LastOffsetPersisted:         offset,</span><br><span class="line">            <span class="comment">// LastOriginalOffsetProcessedè®°å½•æŒ‡çš„æ˜¯æˆªæ­¢è¯¥blockï¼ŒoriginalOffsetå°äºè¿™ä¸ªå€¼çš„æ‰€æœ‰messageéƒ½å·²ç»è¢«æ’åºï¼Œå³æœ€æ–°å¤„ç†çš„originalOffset</span></span><br><span class="line">            LastOriginalOffsetProcessed: chain.lastOriginalOffsetProcessed,</span><br><span class="line">            <span class="comment">// LastResubmittedConfigOffsetè¿™ä¸ªè®°å½•çš„æ˜¯æœ€è¿‘æäº¤çš„é‡æ–°æ ¡éªŒæ’åºçš„configMsgçš„offset</span></span><br><span class="line">            LastResubmittedConfigOffset: chain.lastResubmittedConfigOffset,</span><br><span class="line">        })</span><br><span class="line">        chain.WriteBlock(block, metadata)</span><br><span class="line">        chain.lastCutBlockNumber++</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Commit the second block if exists</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(batches) == <span class="number">2</span> {...}</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    seq := chain.Sequence()</span><br><span class="line">    env := &amp;cb.Envelope{}</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™éƒ¨åˆ†ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹v1.1å‰çš„ç‰ˆæœ¬ï¼Œå‰é¢çš„ç‰ˆæœ¬ä¸æ”¯æŒre-submission</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„é…ç½®åœ¨configtx.yamlé‡Œï¼ŒV1_1:trueåˆ™`chain.SharedConfig().Capabilities().Resubmission()`è¿”å›ä¸ºtrueã€‚è¿™é‡Œåˆ†æé»˜è®¤éƒ½ä½¿ç”¨V1.1åçš„ç‰ˆæœ¬</span></span><br><span class="line">    <span class="comment">//Capabilities:</span></span><br><span class="line">    <span class="comment">//  Orderer: &amp;OrdererCapabilities</span></span><br><span class="line">    <span class="comment">//      V1_1: true</span></span><br><span class="line">    <span class="keyword">if</span> regularMessage.Class == ab.KafkaMessageRegular_UNKNOWN || !chain.SharedConfig().Capabilities().Resubmission() {...}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> regularMessage.Class {</span><br><span class="line">    <span class="keyword">case</span> ab.KafkaMessageRegular_NORMAL:</span><br><span class="line">        <span class="comment">// This is a message that is re-validated and re-ordered</span></span><br><span class="line">        <span class="comment">// æ™®é€šæ¶ˆæ¯çš„OriginalOffsetä¸º0ï¼Œå› ä¸ºconfigSeqæ”¹å˜è¢«é‡æ–°éªŒè¯å’ŒåŠ å…¥é‡æ’åº</span></span><br><span class="line">        <span class="keyword">if</span> regularMessage.OriginalOffset != <span class="number">0</span> {</span><br><span class="line">            <span class="comment">// chain.lastOriginalOffsetProcessedè®°å½•ç€æœ€è¿‘çš„å¤„ç†çš„é‡æ’æ¶ˆæ¯çš„offsetï¼Œæ„å‘³ç€å°äºè¿™ä¸ªçš„æ¶ˆæ¯éƒ½å·²ç»å¤„ç†è¿‡ï¼Œæ•…è¿”å›ä¸å†é‡å¤å¤„ç†ã€‚</span></span><br><span class="line">            <span class="comment">// ä»ä¸‹é¢çš„`regularMessage.ConfigSeq &lt; seq`å¯çŸ¥ï¼Œè¿™æ˜¯å› ä¸ºæœ‰å¤šä¸ªordererèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå¾€kafkaé‡å‘æ¶ˆæ¯ï¼Œæ•…å¯èƒ½ä¼šå­˜åœ¨å¤šæ¡åŒæ ·çš„æ¶ˆæ¯ï¼ˆOriginalOffsetç›¸åŒä½†offsetä¸åŒï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> regularMessage.OriginalOffset &lt;= chain.lastOriginalOffsetProcessed {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// æœªå¤„ç†çš„é‡æ’æ¶ˆæ¯æŒ‰ç…§æ­£å¸¸æµç¨‹å¾€ä¸‹å¤„ç†</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The config sequence has advancedï¼Œå½“å‰çš„é…ç½®å·²ç»æ›´æ–°ï¼Œå› æ­¤éœ€è¦é‡æ–°éªŒè¯ï¼Œé‡å‘kafkaè¿›è¡Œre-order</span></span><br><span class="line">        <span class="keyword">if</span> regularMessage.ConfigSeq &lt; seq {</span><br><span class="line">            configSeq, err := chain.ProcessNormalMsg(env)</span><br><span class="line">            <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">                <span class="keyword">return</span> fmt.Errorf(<span class="string">"discarding bad normal message because = %s"</span>, err)</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ–°é…ç½®ä¸‹é‡æ–°æ ¡éªŒé€šè¿‡</span></span><br><span class="line">            <span class="comment">// For both messages that are ordered for the first time or re-ordered, we set original offset to current received offset and re-order it.</span></span><br><span class="line">            <span class="keyword">if</span> err := chain.order(env, configSeq, receivedOffset); err != <span class="literal">nil</span> {...}</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸‹é¢çš„commitNormalMsgæ–¹æ³•é‡Œå¯ä»¥çœ‹åˆ°ç”¨offsetæ›´æ–°chain.lastOriginalOffsetProcessedï¼Œ</span></span><br><span class="line">        <span class="comment">// å› æ­¤ï¼Œoffsetæˆ–è€…ä¿æŒåŸå€¼chain.lastOriginalOffsetProcessedï¼ˆå½“å‰æ¶ˆæ¯ä¸æ˜¯re-orderæ¶ˆæ¯ï¼‰ï¼Œæˆ–è€…é‡‡ç”¨å½“å‰æ¶ˆæ¯çš„OriginalOffsetï¼ˆå½“å‰æ¶ˆæ¯æ˜¯re-orderæ¶ˆæ¯ï¼‰</span></span><br><span class="line">        offset := regularMessage.OriginalOffset</span><br><span class="line">        <span class="keyword">if</span> offset == <span class="number">0</span> {</span><br><span class="line">            offset = chain.lastOriginalOffsetProcessed</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        commitNormalMsg(env, offset)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> ab.KafkaMessageRegular_CONFIG:</span><br><span class="line">        <span class="comment">// This is a message that is re-validated and re-orderedï¼ŒåŒä¸Š</span></span><br><span class="line">        <span class="keyword">if</span> regularMessage.OriginalOffset != <span class="number">0</span> {</span><br><span class="line">            <span class="comment">// åŒä¸Š, normalMsg</span></span><br><span class="line">            <span class="keyword">if</span> regularMessage.OriginalOffset &lt;= chain.lastOriginalOffsetProcessed {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// lastResubmittedConfigOffsetè¿™ä¸ªè®°å½•çš„æ˜¯æœ€è¿‘æäº¤çš„è¢«é‡æ–°æ ¡éªŒæ’åºçš„configMsgçš„offsetï¼Œå¦‚æœæ¶ˆæ¯çš„OriginalOffsetç­‰äºè¯¥å€¼ï¼Œå¹¶ä¸”configSeqä¹Ÿç›¸ç­‰ï¼Œåˆ™è¯´æ˜å·²ç»æœ¬åœ°å·²æ›´æ–°äº†é…ç½®ï¼Œå¹¶ä¸”æ˜¯æœ€æ–°çš„é…ç½®ï¼Œå¯ä»¥å…³é—­doneReprocessingMsgInFlightè¿™ä¸ªchannelï¼Œç»§ç»­æ¶ˆè´¹ï¼ˆåé¢è¯¦è¿°ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> regularMessage.OriginalOffset == chain.lastResubmittedConfigOffset &amp;&amp; <span class="comment">// This is very last resubmitted config message</span></span><br><span class="line">                regularMessage.ConfigSeq == seq { <span class="comment">// AND we don't need to resubmit it again</span></span><br><span class="line">                <span class="built_in">close</span>(chain.doneReprocessingMsgInFlight) <span class="comment">// Therefore, we could finally close the channel to unblock broadcast</span></span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Somebody resubmitted message at offset X, whereas we didn't. This is due to non-determinism where</span></span><br><span class="line">            <span class="comment">// that message was considered invalid by us during revalidation, however somebody else deemed it to</span></span><br><span class="line">            <span class="comment">// be valid, and resubmitted it. We need to advance lastResubmittedConfigOffset in this case in order</span></span><br><span class="line">            <span class="comment">// to enforce consistency across the network.</span></span><br><span class="line">            <span class="keyword">if</span> chain.lastResubmittedConfigOffset &lt; regularMessage.OriginalOffset {</span><br><span class="line">                chain.lastResubmittedConfigOffset = regularMessage.OriginalOffset</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The config sequence has advanced</span></span><br><span class="line">        <span class="keyword">if</span> regularMessage.ConfigSeq &lt; seq { </span><br><span class="line">            <span class="comment">// ProcessConfigUpdateMsg will attempt to apply the config impetus msg to the current configuration, and if successful</span></span><br><span class="line">            <span class="comment">// return the resulting config message and the configSeq the config was computed from.  If the config impetus message</span></span><br><span class="line">            <span class="comment">// is invalid, an error is returned.</span></span><br><span class="line">            <span class="comment">// åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œå°†envelopé‡ŒæŒ‡å®šçš„é…ç½®å°è¯•ä½œç”¨äºæœ¬åœ°</span></span><br><span class="line">            configEnv, configSeq, err := chain.ProcessConfigMsg(env)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åŒä¸Š, normalMsgã€‚For both messages that are ordered for the first time or re-ordered, we set original offset to current received offset and re-order it.</span></span><br><span class="line">            <span class="keyword">if</span> err := chain.configure(configEnv, configSeq, receivedOffset); err != <span class="literal">nil</span> {</span><br><span class="line">                <span class="keyword">return</span> fmt.Errorf(<span class="string">"error re-submitting config message because = %s"</span>, err)</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ›´æ–°lastResubmittedConfigOffsetï¼Œæœ€æ–°çš„é‡æ–°æäº¤configMsgçš„offset</span></span><br><span class="line">            chain.lastResubmittedConfigOffset = receivedOffset      <span class="comment">// Keep track of last resubmitted message offset</span></span><br><span class="line">            chain.doneReprocessingMsgInFlight = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>{}) <span class="comment">// Create the channel to block ingress messages</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒä¸Šï¼ŒnormalMsg</span></span><br><span class="line">        offset := regularMessage.OriginalOffset</span><br><span class="line">        <span class="keyword">if</span> offset == <span class="number">0</span> {</span><br><span class="line">            offset = chain.lastOriginalOffsetProcessed</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŒä¸Šï¼ŒcommitNormalMsg</span></span><br><span class="line">        commitConfigMsg(env, offset)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p> å›é¡¾instantiateï¼ˆ8ï¼‰é‡Œ<code>orderer/common/broadcast/broadcast.go#Handle</code>æåˆ°çš„ï¼Œordererçš„broacastæœåŠ¡è°ƒç”¨<code>processor.WaitReady()</code>, è¿™é‡Œ<code>select-case case &lt;-chain.doneReprocessingMsgInFlight:</code>,ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨configMsgè¿›è¡Œre-orderæ—¶ï¼Œä¸å†å¯¹å¤–æä¾›æœåŠ¡æ¥æ”¶å¤„ç†æ–°æ•°æ®ï¼Œç›´åˆ°æœ€æ–°çš„é…ç½®å·²æ›´æ–°ï¼Œå…³é—­doneReprocessingMsgInFlightè¿™ä¸ªchannelã€‚</p> <figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Handle starts a service thread for a given gRPC connection and services the broadcast connection</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bh *handlerImpl)</span> <span class="title">Handle</span><span class="params">(srv ab.AtomicBroadcast_BroadcastServer)</span> <span class="title">error</span></span> {</span><br><span class="line"><span class="keyword">for</span> {</span><br><span class="line">    msg, err := srv.Recv()</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    <span class="keyword">if</span> err = processor.WaitReady(); err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> srv.Send(&amp;ab.BroadcastResponse{Status: cb.Status_SERVICE_UNAVAILABLE, Info: err.Error()})</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> !isConfig {</span><br><span class="line">        configSeq, err := processor.ProcessNormalMsg(msg)</span><br><span class="line">        err = processor.Order(msg, configSeq)</span><br><span class="line">    } <span class="keyword">else</span> { <span class="comment">// isConfig</span></span><br><span class="line">        config, configSeq, err := processor.ProcessConfigUpdateMsg(msg)</span><br><span class="line">        err = processor.Configure(config, configSeq)</span><br><span class="line">    }</span><br><span class="line">    err = srv.Send(&amp;ab.BroadcastResponse{Status: cb.Status_SUCCESS})</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(chain *chainImpl)</span> <span class="title">WaitReady</span><span class="params">()</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> &lt;-chain.startChan: <span class="comment">// The Start phase has completed</span></span><br><span class="line">        <span class="keyword">select</span> {</span><br><span class="line">        <span class="keyword">case</span> &lt;-chain.haltChan: <span class="comment">// The chain has been halted, stop here</span></span><br><span class="line">            <span class="keyword">return</span> error</span><br><span class="line">            <span class="comment">// Block waiting for all re-submitted messages to be reprocessed</span></span><br><span class="line">        <span class="keyword">case</span> &lt;-chain.doneReprocessingMsgInFlight:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ol><p>æ€»ç»“æ¥è¯´ï¼Œfabricçš„å…±è¯†ç®—æ³•éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€æ˜¯äº¤æ˜“æ¶ˆæ¯çš„æœ‰åºæ€§ï¼ŒäºŒæ˜¯æ¶æ„èŠ‚ç‚¹çš„æ‹œå åº­é—®é¢˜ã€‚å½“å‰æä¾›çš„ä¸¤ç§å…±è¯†æœºåˆ¶å•èŠ‚ç‚¹soloå’Œå¤šèŠ‚ç‚¹kafkaã€‚kafkaåœ¨fabricçš„åº”ç”¨ä¸­ï¼Œå§‹ç»ˆä½¿ç”¨äº†å•ä¸ªpartitionï¼Œè¿™æ ·å‰Šå¼±äº†kafkaæœ¬èº«æä¾›çš„å¤šåˆ†åŒºå¸¦æ¥çš„é«˜æ€§èƒ½ã€‚è¿™æ ·çš„è€ƒè™‘å¤„äºè¦æœ€å¤§ç¨‹åº¦ä¿è¯äº¤æ˜“æ’åºå’Œæœ€åæ‰§è¡Œçš„æœ‰åºæ€§ï¼Œè™½ç„¶åœ¨v1.1ç‰ˆæœ¬åæä¾›çš„å¯ä»¥re-validateå’Œre-orderç‰¹æ€§åœ¨ä¸€å®šç¨‹åº¦ä¸Šè¿èƒŒäº†è¿™ç§å¼ºæœ‰åºæ€§ï¼Œä½†æ˜¯åœ¨fabricé‡Œå…±è¯†æ›´é‡è¦çš„æ˜¯å…¨å±€ä¸€è‡´æ€§ï¼Œå³å…³é”®çš„æ˜¯blockæ˜¯æœ‰åºçš„ï¼Œè€Œä¸”æ˜¯ä¸€è‡´çš„ï¼Œè€Œä¸åœ¨ä¹é¡ºåºæ˜¯æ€æ ·çš„ã€‚ä½†æ˜¯æœ€é‡è¦çš„æ˜¯ï¼Œkafkaæœ¬èº«çš„å…±è¯†ç®—æ³•å¹¶ä¸èƒ½è§£å†³æ‹œå åº­é—®é¢˜ï¼Œæ— æ³•å®¹å¿ç½‘ç»œé‡Œæ¶æ„èŠ‚ç‚¹çš„å­˜åœ¨ã€‚è¿™ä¸ªé€šè¿‡fabricæœ¬èº«çš„å‡†å…¥å®¡æ ¸ï¼Œç­¾åå’Œç­–ç•¥ç­‰æœºåˆ¶å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé¢„é˜²è¿™ä¸ªé—®é¢˜ã€‚å¯¹äºæ‹œå åº­é—®é¢˜ï¼Œç›¸å¯¹æˆç†Ÿçš„ç®—æ³•æ˜¯pbftã€‚åœ¨fabricçš„v0.6ç‰ˆæœ¬æä¾›pbftå…±è¯†æœºåˆ¶ï¼Œv1.0åé‡‡ç”¨äº†åˆ†å‰²å‡ºordereråï¼Œç›®å‰ä»æœªæä¾›pbftçš„ç›¸å…³å®ç°ã€‚è¿™ä¸ªå€¼å¾—åç»­æŒç»­å…³æ³¨ã€‚</p><blockquote><p><a href="https://github.com/hyperledger/fabric/tree/release-1.4/orderer">Hyperledger Fabric Ordering Service</a><br><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/kafka.html">HyperLeger Fabric - Bringing up a Kafka-based Ordering Service</a><br><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/blockchain.html">HyperLeger Fabric - Introduction - Consensus</a><br><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/fabric_model.html#consensus">Hyperledger Fabric Model - Consensus</a><br><a href="https://docs.google.com/document/d/19JihmW-8blTzN99lAubOfseLUZqdrB6sBR0HsRgCAnY/edit">A Kafka-based Ordering Service for Fabric</a> : è¯¦ç»†ä»‹ç»fabri ordereråº”ç”¨kafkaçš„è®¾è®¡æ€æƒ³æ¼”è¿›è¿‡ç¨‹</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…±è¯†ç®—æ³•(1) - paxos &amp; raft</title>
      <link href="//articles/consensus-paxos-raft/"/>
      <url>//articles/consensus-paxos-raft/</url>
      
        <content type="html"><![CDATA[<ol><li><p>Paxos  </p><p> ç®—æ³•çš„ä»‹ç»åœ¨wikipediaé‡Œè§£é‡Šå¾ˆæ¸…æ¥šï¼Œå¯ä»¥ç»“åˆexampleé‡Œçš„ä¾‹å­åŠ æ·±ç†è§£ã€‚æ¦‚æ‹¬æ¥è¯´ï¼Œpaxosåˆ†ä¸ºprepareå’Œacceptä¸¤ä¸ªé˜¶æ®µï¼Œå°†è§’è‰²åˆ†ä¸ºproposerï¼Œacceptorå’Œlearnerï¼Œæœ€åŸºæœ¬çš„æ ‡å‡†æ˜¯majority quorumã€‚æ¯æ¬¡proposerä»¥ï¼ˆsequence number n, value vï¼‰çš„å½¢å¼å‘acceptoræè®®ï¼ˆnä¸ºæ¯ä¸ªproposerèŠ‚ç‚¹è‡ªè¡Œç®¡ç†çš„å•å¢å€¼ï¼Œæ³¨æ„ï¼Œè¿™é‡Œä¼šæœ‰å¤šä¸ªproposeråœ¨å¹¶è¡Œçš„æè®®ï¼‰ã€‚å¦‚æœå°†prepare requeståˆ°æœ€ç»ˆacceptè§†ä½œä¸€è½®ï¼Œé‚£ä¹ˆæœ€ç»ˆacceptçš„æè®®æ˜¯æ¥è‡ªnæœ€é«˜çš„proposerï¼Œä½†æ˜¯væ˜¯åœ¨prepareé˜¶æ®µæœ€æ—©å¾—åˆ°quorum acceptçš„ï¼Œå› ä¸ºacceptoræ”¶åˆ°prepare requestä½œå‡ºè¿™æ ·çš„promiseï¼ˆå³æ‰¿è¯ºä¸å†acceptæ¯”è¯¥proposalçš„næ›´å°æˆ–ç›¸ç­‰çš„å€¼ï¼‰ï¼Œå¹¶ä¸”è¿”å›æ”¶åˆ°å¹¶å›å¤çš„prepare requestçš„å€¼ã€‚</p></li></ol><blockquote><ul><li><a href="https://en.wikipedia.org/wiki/Paxos_%28computer_science%29">Paxos (computer science) - wiki</a></li><li><a href="https://angus.nyc/2012/paxos-by-example/">Paxos By Example</a></li></ul></blockquote><ol><li><p>Raft</p><p> å¤§è‡´æ€è·¯æ˜¯ï¼Œraftè§’è‰²åˆ†ä¸ºleaderï¼Œfollowerå’Œcandidateï¼ˆåœ¨leader electioné˜¶æ®µï¼‰ã€‚æ¯ä¸ªleaderçš„å½“é€‰ä»»æœŸæœ‰å…¨å±€ç»Ÿä¸€ä¸”å†å²é€’å¢çš„term numberã€‚æ‰€æœ‰çš„å†™è¯·æ±‚è¢«è·¯ç”±æˆ–è€…followé‡å®šå‘æäº¤åˆ°leaderï¼Œç›¸å½“äºå°†proposerç¼©å‡æˆå”¯ä¸€ä¸€ä¸ªleaderï¼Œleaderç»™æ¯ä¸ªè¯·æ±‚log entryæ·»åŠ indexã€‚æ•´ä¸ªè¿‡ç¨‹ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œprepareé˜¶æ®µleaderå°†log entryåŒæ­¥åˆ°æ‰€æœ‰followerï¼Œæ”¶åˆ°majority quorumå›å¤åŒæ­¥åè¿›å…¥commité˜¶æ®µï¼Œleaderå…ˆcommitæœ¬åœ°ï¼Œå‘é€commitæ¶ˆæ¯åˆ°followerï¼Œå¹¶ä¸”å›å¤clientã€‚followerå†commitæœ¬åœ°æ‰§è¡Œï¼Œcommitè¯¥indexä¹Ÿæ„å‘³ç€ä¹‹å‰å°äºè¯¥indexçš„æ¶ˆæ¯éƒ½å·²åŒæ­¥å¹¶ä¸”å…¨ç½‘ä¸€è‡´ã€‚leaderå¤±è´¥ååˆ™è¿›å…¥æ–°ä¸€è½®çš„é€‰ä¸¾ï¼ˆtermå€¼å¢åŠ ï¼‰ï¼Œæœ€æ–°æœ€å…¨æ•°æ®çš„èŠ‚ç‚¹å½“é€‰ï¼Œæ–°leaderå°†å…¶æœ¬åœ°æ•°æ®å…¨ç½‘åŒæ­¥ï¼Œfollowerç›¸åº”è¡¥å……æˆ–è€…å‰ªæï¼Œä¿è¯å…¨å±€æ•°æ®ä¸€è‡´ã€‚</p></li></ol><blockquote><ul><li><a href="https://raft.github.io/">The Raft Consensus Algorithm</a> : Raftçš„github page</li><li><a href="http://thesecretlivesofdata.com/raft/">Raft example</a> : å›½å¤–çš„åŠ¨ç”»ï¼Œéå¸¸å½¢è±¡</li><li><a href="https://medium.freecodecamp.org/in-search-of-an-understandable-consensus-algorithm-a-summary-4bc294c97e0d">Understanding the Raft consensus algorithm: an academic article summary</a></li><li><a href="https://infoq.cn/article/coreos-analyse-etcd">Raft å…±è¯†ç®—æ³•</a> ï¼š å¯ä»¥å‚çœ‹è¿™ç¯‡etcdé‡Œä»‹ç»raftå…±è¯†ç®—æ³•çš„èŠ‚ç‚¹å¼‚å¸¸æƒ…å†µ</li></ul></blockquote><ol><li><p>ç»¼è¿°</p><p> paxosæœ€æ—©çš„ç†è®ºåŸºç¡€ï¼Œä½†æ˜¯å·¥ç¨‹ä¸Šå®ç°éš¾åº¦æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥zookeeperï¼ˆ07å¹´ï¼‰è‡ªå·±è®¾è®¡äº†zabã€‚13å¹´raftå‡ºç°ï¼Œå€Ÿé‰´äº†zabçš„è®¾è®¡æ€æƒ³ï¼ŒåŒæ—¶å·¥ç¨‹ä¸Šç›¸å¯¹paxosæ›´å®¹æ˜“å®ç°å’Œç†è§£ã€‚è¿™äº›ç®—æ³•å¤§é‡ç”¨äºåˆ†å¸ƒå¼åº”ç”¨åŠç»„ä»¶è®¾è®¡ï¼Œå‡è®¾å‰ææ˜¯æ²¡æœ‰æ¶æ„èŠ‚ç‚¹ï¼Œä½†å¹¶ä¸èƒ½è§£å†³æ‹œå åº­å°†å†›é—®é¢˜ï¼ˆPaxoså¯ä»¥é’ˆå¯¹æ€§æ‰©å±•ä¸ºByzantine Paxosï¼‰ã€‚</p></li></ol><blockquote><ul><li><a href="https://zhuanlan.zhihu.com/p/52617675">åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³ï¼šæ·±å…¥æµ…å‡ºå…±è¯†ç®—æ³•</a> ï¼š å…±è¯†ç®—æ³•çš„ç»¼è¿°ï¼Œæ¶µç›–äº†paxosï¼Œraftï¼Œzab</li><li><a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/Zab+vs.+Paxos">Zab vs. Paxos</a></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> Consensus &amp; Cryptography </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Consensus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode install(2ï¼‰endorsorçš„installæµç¨‹</title>
      <link href="//articles/fabric-source-chaincode-install-endorsor/"/>
      <url>//articles/fabric-source-chaincode-install-endorsor/</url>
      
        <content type="html"><![CDATA[<p>endorsorç«¯æµç¨‹ä¹Ÿä¸€è‡´ï¼Œå…¥å£éƒ½æ˜¯<code>core/endorser/endorser.go#ProcessProposal</code>,å…·ä½“ä¸å†é‡å¤å±•å¼€ï¼Œå¯ä»¥å‚çœ‹instantiate(3)ã€‚ä¸»è¦çš„åŒºåˆ«åœ¨äº<code>core/endorser/endorser.go#callChaincode</code>é‡Œï¼Œ(â€œlsccâ€, â€œdeployâ€)çš„<code>if</code>æ¡ä»¶ä¸å†æ»¡è¶³ï¼Œä¸éœ€è¦è¿›å…¥ï¼ˆå›é¡¾ä¸€ä¸‹ï¼Œè¿™é‡Œä¸»è¦æ˜¯launchç”¨æˆ·application chaincodeçš„å®¹å™¨ï¼Œæ‰§è¡Œapplication chaincodeçš„Initæ–¹æ³•ç­‰ï¼Œåœ¨installé˜¶æ®µå½“ç„¶ä¸éœ€è¦ï¼‰ã€‚çœŸæ­£çš„åŒºåˆ«åœ¨äº<code>lscc.go#Invoke</code>çš„<code>select-case</code>é‡Œï¼Œè¿›å…¥çš„æ˜¯<code>INSTALL</code>åˆ†æ”¯ï¼ˆéƒ¨ç½²chaincodeæ—¶è¿›å…¥çš„æ˜¯<code>DEPLOY</code>åˆ†æ”¯ï¼‰ã€‚INSTALLé¦–å…ˆæ‰§è¡Œ<code>lscc.policyChecker.CheckPolicyNoChannel(mgmt.Admins, sp)</code>æ£€æŸ¥ç­–ç•¥ï¼Œè¿™éƒ¨åˆ†ä»¥åè¯¦è¿°ã€‚ä»åå­—ä¹Ÿå°è¯å‡ºinstallæ˜¯ä¸æŒ‡å®šchannelçš„ã€‚ç„¶åæ‰§è¡Œlsccçš„<code>executeInstall</code>æ–¹æ³•.</p><span id="more"></span><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// executeInstall implements the "install" Invoke transaction</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lscc *lifeCycleSysCC)</span> <span class="title">executeInstall</span><span class="params">(stub shim.ChaincodeStubInterface, ccbytes []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">    ccpack, err := ccprovider.GetCCPackage(ccbytes)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get any statedb artifacts from the chaincode package, e.g. couchdb index definitions</span></span><br><span class="line">    statedbArtifactsTar, err := ccprovider.ExtractStatedbArtifactsFromCCPackage(ccpack)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err = isValidStatedbArtifactsTar(statedbArtifactsTar); err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> InvalidStatedbArtifactsErr(err.Error())</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    chaincodeDefinition := &amp;cceventmgmt.ChaincodeDefinition{</span><br><span class="line">        Name:    ccpack.GetChaincodeData().Name,</span><br><span class="line">        Version: ccpack.GetChaincodeData().Version,</span><br><span class="line">        Hash:    ccpack.GetId()} <span class="comment">// Note - The chaincode 'id' is the hash of chaincode's (CodeHash || MetaDataHash), aka fingerprint</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// HandleChaincodeInstall will apply any statedb artifacts (e.g. couchdb indexes) to</span></span><br><span class="line">    <span class="comment">// any channel's statedb where the chaincode is already instantiated</span></span><br><span class="line">    <span class="comment">// Note - this step is done prior to PutChaincodeToLocalStorage() since this step is idempotent and harmless until endorsements start,</span></span><br><span class="line">    <span class="comment">// that is, if there are errors deploying the indexes the chaincode install can safely be re-attempted later.</span></span><br><span class="line">    err = cceventmgmt.GetMgr().HandleChaincodeInstall(chaincodeDefinition, statedbArtifactsTar, lscc.sccprovider)</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        cceventmgmt.GetMgr().ChaincodeInstallDone(err == <span class="literal">nil</span>)</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Finally, if everything is good above, install the chaincode to local peer file system so that endorsements can start</span></span><br><span class="line">    <span class="keyword">if</span> err = lscc.support.PutChaincodeToLocalStorage(ccpack); err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol><li><code>ccpack, err := ccprovider.GetCCPackage(ccbytes)</code>è¿™é‡Œè®²ä¼ å…¥çš„<code>ChaincodeDeploymentSpec</code>å­—èŠ‚ååºåˆ—åŒ–ï¼ŒæŠ½å–ä¿¡æ¯æ„å»º<code>CDSPackage</code>æˆ–è€…<code>SignedCDSPackage</code>ï¼Œæ ¹æ®æ˜¯å¦æ‰§è¡Œ<code>peer chaincode package</code>å¹¶ç­¾åã€‚</li><li><code>ccprovider.ExtractStatedbArtifactsFromCCPackage(ccpack)</code>å’Œ<code>cceventmgmt.GetMgr().HandleChaincodeInstall(chaincodeDefinition, statedbArtifactsTar, lscc.sccprovider)</code>æ¶‰åŠcouchdbç›¸å…³ï¼Œç¬”è€…å°šæœªæ·±å…¥åˆ†æï¼Œä»¥åä¸“é¢˜è¯¦è¿°ã€‚</li><li><code>lscc.support.PutChaincodeToLocalStorage(ccpack)</code>å°†ä»£ç packageæ”¾åˆ°æœ¬åœ°è·¯å¾„ï¼Œåœ¨instantiateé‡Œlaunchæ—¶å€™å–å‡ºã€‚è¿™é‡Œç¡®å®šçš„æ”¾ç½®packageè·¯å¾„ä¸º<code>path := fmt.Sprintf("%s/%s.%s", chaincodeInstallPath, ChaincodeId.Name, ChaincodeId.Version)</code>,è¿™é‡Œçš„pathä¸ºchaincodeInstallPath<code>(config.GetPath("peer.fileSystemPath") + string(filepath.Separator) + "chaincodes")</code>, é…ç½®é¡¹<code>peer.fileSystemPath</code>æ˜¯peerå¯åŠ¨æ—¶ä»é…ç½®æ–‡ä»¶core.yamlé‡Œè¯»å–çš„ã€‚</li></ol><p>è‡³æ­¤å®Œæˆäº†installå·¥ä½œï¼Œåœ¨endorserèŠ‚ç‚¹çš„chaincodeInstallPathè·¯å¾„ä¸‹ï¼Œå­˜åœ¨åä¸ºChaincodeName.ChaincodeVersionçš„æºç åŒ…ï¼Œä¾›instantiateï¼ˆ3ï¼‰ä¸­åœ¨å®‰è£…æ—¶ä»è¯¥è·¯å¾„å–å‡ºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode install(1ï¼‰peerç«¯çš„installæµç¨‹</title>
      <link href="//articles/fabric-source-chaincode-install-peer/"/>
      <url>//articles/fabric-source-chaincode-install-peer/</url>
      
        <content type="html"><![CDATA[<p><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/build_network.html">Building Your First Network</a>ä¾‹å­ä¸­ï¼Œå‘½ä»¤ä¸º</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode install -n mycc -v 1.0 -p github.com/chaincode/chaincode_example02/go/</span><br></pre></td></tr></tbody></table></figure><p>å®¢æˆ·ç«¯è°ƒç”¨<code>peer chaincode install</code>å‘½ä»¤å®‰è£…chaincodeï¼Œä»£ç åœ¨â€˜peer/chaincode/install.goâ€™è¿™ä¸ªæ–‡ä»¶ä¸‹ï¼Œå‘½ä»¤å…³è”çš„æ–¹æ³•æ˜¯<code>chaincodeInstall</code>ã€‚<em>[installçš„æµç¨‹ä¸å‰é¢ä»‹ç»çš„instantiateå¤§ä½“ç›¸ä¼¼ï¼Œé‡å¤ä¸å†å±•å¼€ï¼Œåªå‹¾å‹’å·®åˆ«å¤„]</em></p><span id="more"></span><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// chaincodeInstall installs the chaincode. If remoteinstall, does it via a lscc call</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chaincodeInstall</span><span class="params">(cmd *cobra.Command, ccpackfile <span class="keyword">string</span>, cf *ChaincodeCmdFactory)</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">if</span> cf == <span class="literal">nil</span> {</span><br><span class="line">        cf, err = InitCmdFactory(cmd.Name(), <span class="literal">true</span>, <span class="literal">false</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ccpackmsg proto.Message</span><br><span class="line">    <span class="comment">// ccpackfile = args[0]</span></span><br><span class="line">    <span class="keyword">if</span> ccpackfile == <span class="string">""</span> {</span><br><span class="line">        <span class="comment">// æ£€æŸ¥æä¾›çš„flagå‚æ•°, ä¾‹å¦‚chaincodePath(-p), chaincodeVersion(-v), chaincodeName(-n)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//generate a raw ChaincodeDeploymentSpec</span></span><br><span class="line">        ccpackmsg, err = genChaincodeDeploymentSpec(cmd, chaincodeName, chaincodeVersion)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">//read in a package generated by the "package" sub-command (and perhaps signed by multiple owners with the "signpackage" sub-command)</span></span><br><span class="line">        ccpackmsg, cds, err = getPackageFromFile(ccpackfile)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//get the chaincode details from cds and validate ChaincodeId.Name, ChaincodeId.Version if user provided</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    err = install(ccpackmsg, cf)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//install the depspec to "peer.address"</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">install</span><span class="params">(msg proto.Message, cf *ChaincodeCmdFactory)</span> <span class="title">error</span></span> {</span><br><span class="line">    creator, err := cf.Signer.Serialize()</span><br><span class="line">    prop, _, err := utils.CreateInstallProposalFromCDS(msg, creator)</span><br><span class="line">    signedProp, err = utils.GetSignedProposal(prop, cf.Signer)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// install is currently only supported for one peer</span></span><br><span class="line">    proposalResponse, err := cf.EndorserClients[<span class="number">0</span>].ProcessProposal(context.Background(), signedProp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol><li>installä¸instantiateæ–¹æ³•ç±»ä¼¼ï¼Œé¦–å…ˆ<code>InitCmdFactory</code>åˆå§‹åŒ–å‘½ä»¤å·¥å‚è¾…åŠ©ï¼Œå‚è§instantiateï¼ˆ1ï¼‰.</li><li><p>è·å–chaincodeçš„æ–‡ä»¶æè¿°ã€‚è¿™é‡Œåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼ŒåŒºåˆ«åœ¨äºæ˜¯å¦å…ˆä½¿ç”¨<code>peer chaincode package</code>å‘½ä»¤ï¼Œå¾—åˆ°çš„packageä½œä¸º<code>chaincode istall</code>å‚æ•°ï¼Œé€šå¸¸è¿˜ç»è¿‡å¤šä¸ªå‚ä¸è€…ç­¾åã€‚å…·ä½“å¯ä»¥å‚çœ‹<a href="https://hyperledger-fabric.readthedocs.io/en/latest/chaincode4noah.html">chaincode lifecycle</a>ã€‚packageå‘½ä»¤ä»¥åå†è¯¦è¿°ã€‚Tutorialé‡Œçš„ä¾‹å­æ²¡æœ‰å…ˆç»è¿‡packageï¼Œå‚æ•°<code>ccpackfile</code>ä¸ºç©ºï¼Œåˆ™è¿›å…¥<code>genChaincodeDeploymentSpec</code>ç¬¬ä¸€ç§æ–¹å¼äº§ç”Ÿcdsã€‚</p><p> <code>genChaincodeDeploymentSpec</code>è¿‡ç¨‹ä¸instantiateå¤§è‡´ä¸€è‡´ï¼Œå¯ä»¥å‚è€ƒinstantiateï¼ˆ2ï¼‰ï¼Œè¿™é‡Œä¸åŒçš„æ˜¯<code>peer/chaincode/common.go:getChaincodeDeploymentSpec</code>é‡Œä¼šè¿›å…¥åˆ°<code>if</code>æ¡ä»¶é‡Œï¼Œæ‰§è¡Œåˆ°<code>codePackageBytes, err = container.GetChaincodePackageBytes(spec)</code>ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåŒºåˆ†ä¸åŒçš„è¯­è¨€å¹³å°ï¼ˆè¿™ä¸ªè¯­è¨€é€‰æ‹©æ˜¯å‘½ä»¤è¡Œé‡Œ-læŒ‡å®šçš„ï¼‰å°†ä»£ç gzipå‹ç¼©ï¼Œtaræ‰“åŒ…ï¼ˆä»¥golangä¸ºä¾‹ï¼Œä¸ºäº†ç²¾ç®€åŒ…å¤§å°ï¼Œå»é™¤golangæ ‡å‡†åº“ï¼Œfabricæ¡†æ¶åŒ…ç­‰ï¼ŒåŠ å…¥ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼ŒMETA-INFä¿¡æ¯ç­‰ï¼‰ï¼Œè¿”å›[]byteã€‚åé¢çš„æµç¨‹ä¸instantiateç±»ä¼¼ï¼Œå¯å‚è€ƒä¸å†è¯¦è¿°ï¼Œå¯ä»¥è®¤çœŸå¯¹æ¯”ä¸‹åŒºåˆ«åœ¨äºcisçš„Inputå’Œcdsã€‚</p></li></ol><p>äº§ç”Ÿ<code>ccpackmsg</code>(<code>pb.ChaincodeDeploymentSpec</code>ç»“æ„)æ‰§è¡Œ<code>install</code>ã€‚æ­£å¦‚æºç é‡Œçš„æ³¨é‡Šå’Œå‰é¢instantiateï¼ˆ1ï¼‰ä»‹ç»çš„InitCmdFactoryï¼Œinstallæ–¹æ³•åªèƒ½ä½œç”¨äºå”¯ä¸€ä¸€ä¸ªendorserï¼ˆâ€peer.addressâ€ï¼‰ã€‚æ³¨æ„ï¼Œè¿™é‡Œä¸instantiateä¸åŒï¼Œåœ¨instantiateé‡Œè¿˜æœ‰ç¬¬ä¸‰æ­¥<code>cf.BroadcastClient.Send(env)</code>.è¿™é‡Œè¯´æ˜ï¼Œinstallå‘½ä»¤ä¸éœ€è¦å°†messageå‘å¾€ordererå»æ’åºå’Œäº§ç”ŸåŒºå—ã€‚</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// peer.ChaincodeInvokeSpec(cis)</span></span><br><span class="line">{</span><br><span class="line">    <span class="attr">"ChaincodeInvokeSpec"</span> : {</span><br><span class="line">        <span class="attr">"ChaincodeSpec"</span> : { <span class="comment">// pb.ChaincodeSpec</span></span><br><span class="line">            <span class="attr">"Type"</span> : <span class="string">"ChaincodeSpec_GOLANG"</span>,</span><br><span class="line">            <span class="attr">"ChaincodeId"</span> : {</span><br><span class="line">                <span class="attr">"Name"</span> : <span class="string">"lscc"</span></span><br><span class="line">            },</span><br><span class="line">            <span class="attr">"Input"</span> : {</span><br><span class="line">                <span class="attr">"Args"</span> : [<span class="string">"install"</span>, <span class="string">"${chaincodDeploySpec}"</span>]</span><br><span class="line">            }    </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// pb.chaincodDeploySpec(cds)</span></span><br><span class="line">{</span><br><span class="line">    <span class="attr">"ChaincodeSpec"</span>: {</span><br><span class="line">        <span class="attr">"Type"</span> : <span class="string">"ChaincodeSpec_GOLANG"</span>,</span><br><span class="line">        <span class="attr">"ChaincodeId"</span> : {</span><br><span class="line">            <span class="attr">"Path"</span> : <span class="string">"${chaincodePath}"</span>,</span><br><span class="line">            <span class="attr">"Name"</span> : <span class="string">"${chaincodeName}"</span>,</span><br><span class="line">            <span class="attr">"Version"</span> : <span class="string">"${chaincodeVersion}"</span></span><br><span class="line">        },</span><br><span class="line">        <span class="attr">"Input"</span> : <span class="string">"nil"</span>   </span><br><span class="line">    },</span><br><span class="line">    <span class="attr">"CodePackage"</span>: <span class="string">"#{container.GetChaincodePackageBytes(spec)}"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è‡³æ­¤ï¼Œpeerç«¯çš„installå®Œæˆï¼Œè¯¥èŠ‚ç‚¹ä»…ä»…æ˜¯ä½œä¸ºæ‰§è¡Œinstallå‘½ä»¤ï¼Œéœ€è¦æœ¬åœ°æ‹¥æœ‰installçš„ä»£ç åŒ…ï¼Œinstallå¹¶ä¸æ˜¯å®‰è£…åˆ°è¯¥peerèŠ‚ç‚¹è€Œæ˜¯endorserèŠ‚ç‚¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode instantiate(8ï¼‰ordererçš„æ’åºè¿‡ç¨‹</title>
      <link href="//articles/fabric-source-chaincode-instantiate-orderer-order/"/>
      <url>//articles/fabric-source-chaincode-instantiate-orderer-order/</url>
      
        <content type="html"><![CDATA[<p>åœ¨instantiate(1)é‡Œæåˆ°ï¼Œpeeræ”¶é›†å®Œendorsementsååˆ›å»ºcommon.Envelope, é€šè¿‡grpcå‘é€åˆ°<code>/orderer.AtomicBroadcast/Broadcast</code>. common.Envelopeçš„æ•°æ®ç»“æ„å¦‚ä¸‹</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common.Envelope</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Payload"</span>: ${common.Payload}.byte,</span><br><span class="line">  <span class="attr">"Signature"</span>: #signer.Sign(${common.Payload}.byte)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// common.Payload</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Header"</span>: ${proposal.Header},   <span class="comment">// proposalå‚è€ƒinstantiateï¼ˆ2ï¼‰</span></span><br><span class="line">  <span class="attr">"Data"</span>: ${peer.Transaction}.byte</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// peer.Transaction</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Actions"</span>:  taas := make([]*peer.TransactionAction, 1), taas[0] = ${peer.TransactionAction}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// peer.TransactionAction</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Header"</span>: ${proposal.Header.SignatureHeader}, </span><br><span class="line">  <span class="attr">"Payload"</span>: ${peer.ChaincodeActionPayload}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// peer.ChaincodeActionPayload</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"ChaincodeProposalPayload"</span>: ${peer.ChaincodeProposalPayload}.byte, </span><br><span class="line">  <span class="attr">"Action"</span>: ${peer.ChaincodeEndorsedAction}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"> <span class="comment">// peer.ChaincodeProposalPayload</span></span><br><span class="line"> {</span><br><span class="line">   <span class="attr">"Input"</span>: ${proposal.Payload.Input}, </span><br><span class="line">   <span class="attr">"TransientMap"</span>: nil</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// peer.ChaincodeEndorsedActionï¼Œ responseç»“æ„å‚è€ƒinstantiateï¼ˆ7ï¼‰</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"ProposalResponsePayload"</span>: ${resps[0].Payload},  <span class="comment">// æ‰€æœ‰responseçš„payloadéƒ½åº”è¯¥æ˜¯ä¸€è‡´çš„ï¼Œåœ¨å‰é¢å·²ç»æ ¡éªŒè¿‡ </span></span><br><span class="line">  <span class="attr">"Endorsements"</span>: #endorsements := make([]*peer.Endorsement, len(resps)) <span class="comment">// æ‰€æœ‰çš„endorsement</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><span id="more"></span><p>å…¨å±€æœç´¢ï¼Œordererç«¯æ‰§è¡Œ<code>protos/orderer/ab.pb.go#_AtomicBroadcast_Broadcast_Handler</code> -&gt; <code>orderer/common/server/server.go#Broadcast</code> -&gt; <code>orderer/common/broadcast/broadcast.go#Handle</code>.</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Handle starts a service thread for a given gRPC connection and services the broadcast connection</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bh *handlerImpl)</span> <span class="title">Handle</span><span class="params">(srv ab.AtomicBroadcast_BroadcastServer)</span> <span class="title">error</span></span> {</span><br><span class="line">  <span class="keyword">for</span> {</span><br><span class="line">      msg, err := srv.Recv()</span><br><span class="line"></span><br><span class="line">      chdr, isConfig, processor, err := bh.sm.BroadcastChannelSupport(msg)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">          <span class="keyword">return</span> srv.Send(&amp;ab.BroadcastResponse{Status: cb.Status_BAD_REQUEST, Info: err.Error()})</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> err = processor.WaitReady(); err != <span class="literal">nil</span> {</span><br><span class="line">          <span class="keyword">return</span> srv.Send(&amp;ab.BroadcastResponse{Status: cb.Status_SERVICE_UNAVAILABLE, Info: err.Error()})</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> !isConfig {</span><br><span class="line">          configSeq, err := processor.ProcessNormalMsg(msg)</span><br><span class="line">          <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">              <span class="keyword">return</span> srv.Send(&amp;ab.BroadcastResponse{Status: ClassifyError(err), Info: err.Error()})</span><br><span class="line">          }</span><br><span class="line">          err = processor.Order(msg, configSeq)</span><br><span class="line">      } <span class="keyword">else</span> { <span class="comment">// isConfig</span></span><br><span class="line">          config, configSeq, err := processor.ProcessConfigUpdateMsg(msg)</span><br><span class="line">          <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">              <span class="keyword">return</span> srv.Send(&amp;ab.BroadcastResponse{Status: ClassifyError(err), Info: err.Error()})</span><br><span class="line">          }</span><br><span class="line">          err = processor.Configure(config, configSeq)</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      err = srv.Send(&amp;ab.BroadcastResponse{Status: cb.Status_SUCCESS})</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol><li><code>for</code>å¾ªç¯é‡Œ<code>srv.Recv()</code>ä»grpc streamé‡Œæ¥æ”¶æ•°æ®ã€‚</li><li><code>bh.sm.BroadcastChannelSupport(msg)</code>æ£€æŸ¥å¹¶è¿”å›<code>proposal.header.channelHeader.Type</code>,è¿™é‡Œçš„HeaderTypeä¸º<code>HeaderType_ENDORSER_TRANSACTION</code>(å‚è€ƒinstantiate-2)ï¼Œåˆ¤æ–­ä¸ºnormalMsgã€‚</li><li><code>processor.WaitReady()</code>ã€‚è¿™é‡Œåˆ†ä¸‰ä¸ªå®ç°ï¼Œsolo(orderer/consensus/solo/consensus.go), etcdraft(orderer/consensus/etcdraft/chain.goï¼Œ<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/whatsnew.html">V1.4.1ç‰ˆæœ¬</a>å¼•å…¥)å’Œkafkaï¼ˆorderer/consensus/kafka/chain.goï¼‰ã€‚soloæ–¹æ³•æ˜¯ordererå•èŠ‚ç‚¹ï¼Œä¸å­˜åœ¨æ•°æ®äº¤æ¢æ±‡é›†ï¼Œä¸ä¼šé˜»å¡ï¼Œä¸åšä»»ä½•æ“ä½œç›´æ¥è¿”å›ã€‚è€Œetcdraftï¼Œkafkaå®ç°æ˜¯å¤šèŠ‚ç‚¹ordererï¼ŒèŠ‚ç‚¹é—´éœ€è¦é€šä¿¡ã€‚è¿™ä¸ªåé¢è¯¦è¿°ã€‚</li><li><code>configSeq, err := processor.ProcessNormalMsg(msg)</code>ï¼Œè¿”å›å½“å‰é…ç½®çš„seqï¼ˆå•å¢ï¼‰ï¼Œå¹¶ä¸”ç­–ç•¥æ£€æŸ¥msgã€‚è¿™äº›ç­–ç•¥å¯ä»¥å›æº¯åˆ°<code>fabric/orderer/common/multichannel/chainsupport.go#newChainSupport</code>é‡Œåˆ›å»º<code>cs.Processor = msgprocessor.NewStandardChannel(cs, msgprocessor.CreateStandardChannelFilters(cs))</code>æ—¶åˆå§‹åŒ–ã€‚ç­–ç•¥fliterçš„è§„åˆ™å¯ä»¥é€šè¿‡åç§°å¤§è‡´çŒœæµ‹ã€‚<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ProcessNormalMsg will check the validity of a message based on the current configuration.  It returns the current configuration sequence number and nil on success, or an error if the message is not valid</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StandardChannel)</span> <span class="title">ProcessNormalMsg</span><span class="params">(env *cb.Envelope)</span> <span class="params">(configSeq <span class="keyword">uint64</span>, err error)</span></span> {</span><br><span class="line">    configSeq = s.support.Sequence()</span><br><span class="line">    err = s.filters.Apply(env)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;orderer/common/msgprocessor/standardchannel.go&gt;</span></span><br><span class="line"><span class="comment">// CreateStandardChannelFilters creates the set of filters for a normal (non-system) chain</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CreateStandardChannelFilters</span><span class="params">(filterSupport channelconfig.Resources)</span> *<span class="title">RuleSet</span></span> {</span><br><span class="line">    ordererConfig, ok := filterSupport.OrdererConfig()</span><br><span class="line">    <span class="keyword">return</span> NewRuleSet([]Rule{</span><br><span class="line">        EmptyRejectRule,  <span class="comment">// æ ¡éªŒenvelopçš„payloadä¸ä¸ºnil</span></span><br><span class="line">        NewExpirationRejectRule(filterSupport),  <span class="comment">// æ ¡éªŒpayload.Header.SignatureHeade.Creatorçš„x509è¯ä¹¦æœªè¿‡æœŸ</span></span><br><span class="line">        NewSizeFilter(ordererConfig), <span class="comment">// æ ¡éªŒenveloyçš„sizeä¸èƒ½è¶…è¿‡é…ç½®çš„batch.AbsoluteMaxBytesï¼Œå¯¹åº”äºconfigtx.yamlä¸­çš„Orderer.BatchSize.AbsoluteMaxBytesï¼ˆ10MBï¼‰</span></span><br><span class="line">        NewSigFilter(policies.ChannelWriters, filterSupport), <span class="comment">// æ£€æŸ¥policyå½“å‰è¯·æ±‚æ‹¥æœ‰å½“å‰channelçš„å†™æƒé™</span></span><br><span class="line">    })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li>è¿™é‡Œç®€è¿°ä¸‹soloçš„æ–¹å¼ï¼Œkafkaåé¢ä¸“é¢˜è¯¦è¿°ã€‚soloæŠŠmessageç›´æ¥æ”¾å…¥<code>ch.sendChan</code>å†…, soloçš„ç›¸å…³ä»£ç åœ¨<code>orderer/consensus/solo/consensus.go</code><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// soloï¼š Order accepts normal messages for ordering</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ch *chain)</span> <span class="title">Order</span><span class="params">(env *cb.Envelope, configSeq <span class="keyword">uint64</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> ch.sendChan &lt;- &amp;message{</span><br><span class="line">        configSeq: configSeq,</span><br><span class="line">        normalMsg: env,</span><br><span class="line">    }:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">case</span> &lt;-ch.exitChan:</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"Exiting"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ol><hr><p>åœ¨<code>orderer/consensus/solo/consensus.go:main</code>å†…å¤„ç†channle sendChané‡Œçš„æ¶ˆæ¯<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ch *chain)</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> timer &lt;-<span class="keyword">chan</span> time.Time</span><br><span class="line">    <span class="keyword">var</span> err error</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> {</span><br><span class="line">        seq := ch.support.Sequence()</span><br><span class="line">        err = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">select</span> {</span><br><span class="line">        <span class="keyword">case</span> msg := &lt;-ch.sendChan:</span><br><span class="line">            <span class="keyword">if</span> msg.configMsg == <span class="literal">nil</span> {</span><br><span class="line">                <span class="comment">// NormalMsg</span></span><br><span class="line">                <span class="keyword">if</span> msg.configSeq &lt; seq {</span><br><span class="line">                    _, err = ch.support.ProcessNormalMsg(msg.normalMsg)</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                batches, _ := ch.support.BlockCutter().Ordered(msg.normalMsg)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> _, batch := <span class="keyword">range</span> batches {</span><br><span class="line">                    block := ch.support.CreateNextBlock(batch)</span><br><span class="line">                    ch.support.WriteBlock(block, <span class="literal">nil</span>)</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// ConfigMsg</span></span><br><span class="line">                ...</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><ol><li><code>msg.configSeq &lt; seq</code>åˆ¤æ–­é…ç½®åœ¨å†™å…¥channelå’Œè¯»å‡ºchannelè¿‡ç¨‹ä¸­æ˜¯å¦æœ‰æ›´æ”¹ï¼Œå¦‚æœæœ‰ï¼Œåˆ™é‡æ–°æ‰§è¡Œ<code>ProcessNormalMsg</code>ç”¨æ–°çš„è§„åˆ™æ ¡éªŒæ¶ˆæ¯æ˜¯å¦åˆæ³•ã€‚</li><li><code>batches, _ := ch.support.BlockCutter().Ordered(msg.normalMsg)</code>å°†æ¶ˆæ¯åˆ‡ç‰‡ï¼ŒçŸ­å°æ¶ˆæ¯åˆå¹¶æˆä¸€ä¸ªæ‰¹æ¬¡ï¼Œå¤§æ¶ˆæ¯åˆ‡åˆ†å¤šä¸ªæ‰¹æ¬¡ï¼Œä½¿å…¶ä¸è¶…è¿‡blockè§„å®šé•¿åº¦ã€‚æºç æ³¨é‡Šæœ‰è¯¦ç»†ä»‹ç»ã€‚<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// messageBatches length: 0, pending: false</span><br><span class="line">//   - impossible, as we have just received a message</span><br><span class="line">// messageBatches length: 0, pending: true</span><br><span class="line">//   - no batch is cut and there are messages pending.</span><br><span class="line">//   - æ²¡æœ‰åˆ‡åˆ†blockï¼Œå¹¶ä¸”åŠ ä¸Šå½“å‰envelopåç»§ç»­ç­‰å¾…æ·»åŠ </span><br><span class="line">// messageBatches length: 1, pending: false</span><br><span class="line">//   - the message count reaches BatchSize.MaxMessageCountã€‚ </span><br><span class="line">//   - åˆ‡åˆ†blockï¼Œå› ä¸ºåŠ ä¸Šå½“å‰envelopåè¾¾åˆ°æ•°é‡é™åˆ¶ï¼Œå¯¹åº”configtx.yamlä¸­çš„Orderer.BatchSize.MaxMessageCount(10)</span><br><span class="line">// messageBatches length: 1, pending: true</span><br><span class="line">//   - the current message will cause the pending batch size in bytes to exceed BatchSize.PreferredMaxBytes. </span><br><span class="line">//   - åˆ‡åˆ†blockï¼Œå› ä¸ºå¦‚æœåŠ ä¸Šå½“å‰envelopåï¼Œæ‰€æœ‰çš„batchå¤§å°è¶…è¿‡é…ç½®çš„configtx.yamlä¸­çš„Orderer.BatchSize.PreferredMaxBytes(512KB)ï¼Œæ‰€ä»¥å°†ä¹‹å‰çš„åˆ‡åˆ†blockï¼Œè€Œå½“å‰çš„envelopç»§ç»­ç­‰å¾…åç»­æ·»åŠ ï¼ˆå½“å‰envelopå¤§å°å°äºPreferredMaxBytesï¼‰</span><br><span class="line">// messageBatches length: 2, pending: false</span><br><span class="line">//   - the current message size in bytes exceeds BatchSize.PreferredMaxBytes, therefore isolated in its own batch.</span><br><span class="line">//   - å½“å‰envelopå¤§å°å¤§äºPreferredMaxBytesï¼Œå°†ä¹‹å‰çš„ä½œä¸ºç¬¬ä¸€ä¸ªblockï¼Œå°†å½“å‰çš„ä½œä¸ºç¬¬äºŒä¸ªblockï¼ˆå‰é¢å·²ç»æ ¡éªŒè¿‡ï¼Œenvelopå¤§å°ä¸ä¼šè¶…è¿‡AbsoluteMaxBytesï¼ˆ10MBï¼‰ï¼‰</span><br><span class="line">// messageBatches length: 2, pending: true</span><br><span class="line">//   - impossible</span><br></pre></td></tr></tbody></table></figure></li><li><p><code>CreateNextBlock</code>åˆ›å»ºä¸‹ä¸€ä¸ªåŒºå—ï¼Œå¯ä»¥çœ‹å‡ºï¼Œheaderçš„numberï¼ˆæ·±åº¦ï¼‰+1ï¼Œå¹¶ä¸”é™„å¸¦ä¸Šå‰ä¸€ä¸ªåŒºå—çš„hashï¼Œå¹¶ä¸”è®¡ç®—å½“å‰åŒºå—dataæ•°æ®çš„å“ˆå¸Œï¼Œè¿™äº›æ„æˆåŒºå—çš„ä¿¡æ¯ã€‚</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"Header"</span>: ${BlockHeader},</span><br><span class="line">    <span class="attr">"Data"</span>: ${BlockData},</span><br><span class="line">    <span class="attr">"Metadata"</span>: ${BlockMetadata}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// BlockHeader</span></span><br><span class="line">{</span><br><span class="line">    <span class="attr">"Number"</span>: ${lastBlock.Header.Number}+<span class="number">1</span>,</span><br><span class="line">    <span class="attr">"PreviousHash"</span>: #lastBlock.Header.Hash(),</span><br><span class="line">    <span class="attr">"DataHash"</span>: #${BlockData}.Hash()</span><br><span class="line">}</span><br><span class="line"><span class="comment">// BlockData</span></span><br><span class="line">{</span><br><span class="line">    <span class="attr">"Data"</span>: #make([][]byte, len(envelop))</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// BlockMetadata</span></span><br><span class="line">{</span><br><span class="line">    <span class="attr">"Metadata"</span>: [][]byte</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p><code>WriteBlock</code>æäº¤åŒºå—ã€‚è¿™é‡Œä¼šåŠ ä¸Šblockçš„ç­¾åï¼Œç„¶åæäº¤ã€‚ <code>BlockWriter.support</code>ä¸»è¦æœ‰ä¸‰ç§å®ç°ï¼Œfileï¼Œjsonï¼ˆä¸€ä¸ªåŒºå—åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œä»¥æ·±åº¦å‘½åï¼Œå†™å…¥jsonæ ¼å¼ï¼‰ï¼Œramã€‚è¿™é‡Œå†™å…¥ordereræœ¬åœ°ï¼Œåé¢é€šè¿‡deleiveræœåŠ¡åŒæ­¥åˆ°peerèŠ‚ç‚¹çœŸæ­£çš„æäº¤åˆ°å„è‡ªçš„æœ¬åœ°è´¦æœ¬dbã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WriteBlock should be invoked for blocks which contain normal transactions.</span></span><br><span class="line"><span class="comment">// It sets the target block as the pending next block, and returns before it is committed.</span></span><br><span class="line"><span class="comment">// Before returning, it acquires the committing lock, and spawns a go routine which will</span></span><br><span class="line"><span class="comment">// annotate the block with metadata and signatures, and write the block to the ledger</span></span><br><span class="line"><span class="comment">// then release the lock.  This allows the calling thread to begin assembling the next block</span></span><br><span class="line"><span class="comment">// before the commit phase is complete.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bw *BlockWriter)</span> <span class="title">WriteBlock</span><span class="params">(block *cb.Block, encodedMetadataValue []<span class="keyword">byte</span>)</span></span> {</span><br><span class="line">    bw.committingBlock.Lock()</span><br><span class="line">    bw.lastBlock = block</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">      <span class="keyword">defer</span> bw.committingBlock.Unlock()</span><br><span class="line">      bw.commitBlock(encodedMetadataValue)</span><br><span class="line">    }()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// commitBlock should only ever be invoked with the bw.committingBlock held</span></span><br><span class="line"><span class="comment">// this ensures that the encoded config sequence numbers stay in sync</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bw *BlockWriter)</span> <span class="title">commitBlock</span><span class="params">(encodedMetadataValue []<span class="keyword">byte</span>)</span></span> {</span><br><span class="line">    <span class="comment">// Set the orderer-related metadata field</span></span><br><span class="line">    <span class="comment">// åœ¨BlockMetadata.Metadataå†…åŠ ä¸Škeyä¸ºcb.BlockMetadataIndex_ORDERERçš„å€¼</span></span><br><span class="line">    <span class="keyword">if</span> encodedMetadataValue != <span class="literal">nil</span> {</span><br><span class="line">        bw.lastBlock.Metadata.Metadata[cb.BlockMetadataIndex_ORDERER] = utils.MarshalOrPanic(&amp;cb.Metadata{Value: encodedMetadataValue})</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// åœ¨BlockMetadata.Metadataå†…åŠ ä¸Škeyä¸ºcb.BlockMetadataIndex_SIGNATURESçš„å€¼</span></span><br><span class="line">    bw.addBlockSignature(bw.lastBlock)</span><br><span class="line">    <span class="comment">// åœ¨BlockMetadata.Metadataå†…åŠ ä¸Škeyä¸ºcb.BlockMetadataIndex_LAST_CONFIGçš„å€¼</span></span><br><span class="line">    bw.addLastConfigSignature(bw.lastBlock)</span><br><span class="line"></span><br><span class="line">    err := bw.support.Append(bw.lastBlock)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ol><p>å¯¹äºconfigMsgï¼Œæµç¨‹éå¸¸ç›¸ä¼¼ï¼Œ<code>processor.ProcessConfigUpdateMsg(msg)</code>ç›¸å¯¹è€Œè¨€ï¼Œé™¤äº†normalMsgçš„æ­¥éª¤å¤–ï¼Œè¿˜é€šè¿‡æäº¤è¿‡æ¥çš„configå’Œæœ¬åœ°å­˜å‚¨çš„ç°è¡Œconfigæ¯”è¾ƒï¼Œè®¡ç®—å‡ºreadSetå’ŒwriteSetï¼Œæ ¡éªŒé€šè¿‡åï¼Œç­¾åç”Ÿæˆenvelope(<code>utils.CreateSignedEnvelope(cb.HeaderType_CONFIG, s.support.ChainID(), s.support.Signer(), configEnvelope, msgVersion, epoch)</code>).è€Œ<code>processor.Configure(config, configSeq)</code>åˆ™ä¸<code>processor.Order(msg, configSeq)</code>å®Œå…¨ä¸€è‡´äº†ï¼Œä»…æ˜¯åç§°ä¸åŒã€‚</p><p>è‡³æ­¤ï¼Œå®Œæˆäº†ordererç«¯çš„å·¥ä½œï¼Œè¿™äº›æäº¤åˆ°æœ¬åœ°çš„åŒºå—ï¼Œåç»­å°†é€šè¿‡deliveræœåŠ¡åŒæ­¥åˆ°peerã€‚å…·ä½“åé¢ä¸“é¢˜ä»‹ç»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode instantiate(7ï¼‰endoserçš„endorseProposalè¿‡ç¨‹</title>
      <link href="//articles/fabric-source-chaincode-instantiate-endorser-endorse-proposal/"/>
      <url>//articles/fabric-source-chaincode-instantiate-endorser-endorse-proposal/</url>
      
        <content type="html"><![CDATA[<p>å›é¡¾åˆ°<code>endorser.go#SimulateProposal</code>,æ‰§è¡Œå®Œ<code>callChaincode</code>åï¼Œå›é¡¾å‰é¢ï¼Œåœ¨è¿™é‡Œæœ‰ä¸¤æ¬¡è°ƒç”¨chaincodeï¼Œåˆ†åˆ«æ˜¯lsccçš„Inovkeå’Œaccçš„Initï¼Œ<code>callChaincode</code>è¿™é‡Œè¿”å›çš„æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨çš„lsccçš„responseã€‚è°ƒç”¨acc Initçš„ç»“æœåªåˆ¤æ–­è°ƒç”¨æ˜¯å¦æ­£å¸¸å®Œæˆè¿”å›<code>pb.ChaincodeMessage_COMPLETED</code>ã€‚è¿™æ˜¯å› ä¸ºåœ¨<code>handleInit</code>é‡Œå¯¹åˆå§‹åŒ–å¤±è´¥ï¼Œå³<code>pb.Response.status</code>ä¸ç­‰äº200çš„ç»Ÿä¸€è¿”å›<code>pb.ChaincodeMessage_ERROR</code>ï¼Œè¿™ç‚¹ä¸Invokeçš„å¤„ç†æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚Invokeå…è®¸<code>pb.ChaincodeMessage.Type</code>=<code>pb.ChaincodeMessage_COMPLETED</code>,ä½†æ˜¯å†…å±‚çš„<code>pb.Response.status</code>ä¸ç­‰äº200. è‹¥è¿”å›<code>pb.ChaincodeMessage_ERROR</code>ï¼Œåˆ™å‘ä¸Šå±‚è¿”å›errorï¼Œæœ€ç»ˆè¿”å›<code>&amp;pb.ProposalResponse{Response: &amp;pb.Response{Status: 500, Message: err.Error()}}</code>åˆ°<code>peer chainncode instantiate...</code>è¿™ä¸ªå‘½ä»¤çš„æ‰§è¡ŒèŠ‚ç‚¹peerã€‚</p><p>ç´§æ¥ç€è°ƒç”¨<code>txsim.GetTxSimulationResults()</code>è·å–ä¸ŠèŠ‚æåˆ°çš„<code>lockbased_tx_simulator</code>çš„è¯»å†™é›†åˆã€‚å…ˆçœ‹ä¸‹è¿™ä¸ª<code>txsim</code>æ˜¯å¦‚ä½•ä¼ é€’çš„ã€‚é¦–å…ˆåˆå§‹åŒ–ååœ¨<code>callChaincode</code>åŠ å…¥context<code>ctxt = context.WithValue(ctxt, chaincode.TXSimulatorKey, txsim)</code>ã€‚ä¹‹ååœ¨<code>chaincode/handler</code>é‡Œæ„å»º<code>TransactionContext</code>å®ä½“å¯¹è±¡æ—¶å°†txsimä»contextå–å‡ºï¼ŒåŒ…è£¹è¿›è¿™ä¸ªæ–°å»ºçš„TransactionContextå¯¹è±¡å†…ã€‚è¿™ä¸ªå¯¹è±¡å‰é¢æœ‰æåŠï¼Œæ˜¯å…³è”äº<code>chainID, txID</code>è¿™ä¸¤ä¸ªå­˜æ”¾äº<code>chaincode/handler.TXContexts.map[string]*TransactionContext</code>é‡Œã€‚åé¢åœ¨<code>chaincode/handler.go#handlerTranction</code>é‡Œè°ƒç”¨<code>txContext, err = h.isValidTxSim(msg.ChannelId, msg.Txid)}</code>ä¹Ÿæ˜¯ä»¥æ­¤å–å‡ºè¯¥txsimï¼Œå°†è¯»å†™ç»“æœæ”¾è¿›è¯»å†™é›†readwriteSetã€‚</p><p><code>txsim.GetTxSimulationResults()</code>è¿™é‡Œåœ¨è¿”å›å‰ï¼Œå…ˆå¯¹è¯»å†™é›†åˆæŒ‰ç…§keyæ’åºã€‚è¿™é‡ŒåŒ…å«pubå’Œpriä¸¤éƒ¨åˆ†æ•°æ®ï¼Œå…ˆå…³æ³¨pubéƒ¨åˆ†ã€‚rwsetè¿™éƒ¨åˆ†ä»¥åå±•å¼€ä¸“é¢˜ä»‹ç»ã€‚ç„¶åè°ƒç”¨<code>txsim.Done()</code>ï¼Œç­¾ååˆå§‹åŒ–txsimæ—¶å€™æåˆ°è·å–äº†ledgerçš„è¯»é”ï¼Œå› æ­¤è¿™é‡Œéœ€è¦é‡Šæ”¾<code>h.txmgr.commitRWLock.RUnlock()</code>ã€‚è¿”å›å…±æœ‰æ•°æ®çš„è¯»å†™é›†åˆ°<code>endorser#ProcessProposal</code>ã€‚</p><span id="more"></span><p>ç¬¬äºŒæ­¥ï¼ŒèƒŒä¹¦æ¨¡æ‹Ÿç»“æœã€‚ä¸»è¦æ˜¯signerå¯¹payloadè¿›è¡Œç­¾åï¼Œå¹¶ä¸”é™„ä¸Šè‡ªèº«ç­¾åçš„identityBytesæ„é€ æˆresponseã€‚ç„¶åè¿™ä¸ªrespå°±è¿”å›æ–¹æ³•ï¼Œé€šè¿‡grpcå‘é€å›è°ƒç”¨æ–¹peer.<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// endorse the proposal by calling the ESCC</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Endorser)</span> <span class="title">endorseProposal</span><span class="params">(_ context.Context, chainID <span class="keyword">string</span>, txid <span class="keyword">string</span>, signedProp *pb.SignedProposal, proposal *pb.Proposal, response *pb.Response, simRes []<span class="keyword">byte</span>, event *pb.ChaincodeEvent, visibility []<span class="keyword">byte</span>, ccid *pb.ChaincodeID, txsim ledger.TxSimulator, cd ccprovider.ChaincodeDefinition)</span> <span class="params">(*pb.ProposalResponse, error)</span></span> {</span><br><span class="line">    isSysCC := cd == <span class="literal">nil</span></span><br><span class="line">    <span class="comment">// 1) extract the name of the escc that is requested to endorse this chaincode, ie, "lscc" or system chaincodes</span></span><br><span class="line">    <span class="keyword">if</span> isSysCC {</span><br><span class="line">        escc = <span class="string">"escc"</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        escc = cd.Endorsement()</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// marshalling event bytes</span></span><br><span class="line">    <span class="keyword">if</span> event != <span class="literal">nil</span> {</span><br><span class="line">        eventBytes, err = putils.GetBytesChaincodeEvent(event)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    ctx := Context{</span><br><span class="line">        PluginName:     escc,</span><br><span class="line">        Channel:        chainID,</span><br><span class="line">        SignedProposal: signedProp,</span><br><span class="line">        ChaincodeID:    ccid,</span><br><span class="line">        Event:          eventBytes,</span><br><span class="line">        SimRes:         simRes,</span><br><span class="line">        Response:       response,</span><br><span class="line">        Visibility:     visibility,</span><br><span class="line">        Proposal:       proposal,</span><br><span class="line">        TxID:           txid,</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> e.s.EndorseWithPlugin(ctx)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// EndorseWithPlugin endorses the response with a plugin</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pe *PluginEndorser)</span> <span class="title">EndorseWithPlugin</span><span class="params">(ctx Context)</span> <span class="params">(*pb.ProposalResponse, error)</span></span> {</span><br><span class="line">    plugin, err := pe.getOrCreatePlugin(PluginName(ctx.PluginName), ctx.Channel)</span><br><span class="line"></span><br><span class="line">    prpBytes, err := proposalResponsePayloadFromContext(ctx)</span><br><span class="line"></span><br><span class="line">    endorsement, prpBytes, err := plugin.Endorse(prpBytes, ctx.SignedProposal)</span><br><span class="line">      </span><br><span class="line">    resp := &amp;pb.ProposalResponse{</span><br><span class="line">      Version:     <span class="number">1</span>,</span><br><span class="line">      Endorsement: endorsement,</span><br><span class="line">      Payload:     prpBytes,</span><br><span class="line">      Response:    ctx.Response,</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> resp, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;é»˜è®¤çš„escc ï¼š github.com/hyperledger/fabric/core/handlers/endorsement/builtin/default_endorsement.go&gt;</span></span><br><span class="line"><span class="comment">// Endorse signs the given payload(ProposalResponsePayload bytes), and optionally mutates it.</span></span><br><span class="line"><span class="comment">// Returns:</span></span><br><span class="line"><span class="comment">// The Endorsement: A signature over the payload, and an identity that is used to verify the signature</span></span><br><span class="line"><span class="comment">// The payload that was given as input (could be modified within this function)</span></span><br><span class="line"><span class="comment">// Or error on failure</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *DefaultEndorsement)</span> <span class="title">Endorse</span><span class="params">(prpBytes []<span class="keyword">byte</span>, sp *peer.SignedProposal)</span> <span class="params">(*peer.Endorsement, []<span class="keyword">byte</span>, error)</span></span> {</span><br><span class="line">    signer, err := e.SigningIdentityForRequest(sp)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// serialize the signing identity</span></span><br><span class="line">    identityBytes, err := signer.Serialize()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sign the concatenation of the proposal response and the serialized endorser identity with this endorser's key</span></span><br><span class="line">    signature, err := signer.Sign(<span class="built_in">append</span>(prpBytes, identityBytes...))</span><br><span class="line"></span><br><span class="line">    endorsement := &amp;peer.Endorsement{Signature: signature, Endorser: identityBytes}</span><br><span class="line">    <span class="keyword">return</span> endorsement, prpBytes, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>æœ€åï¼Œè¿”å›çš„ç»“æ„ä½“ä¸º<code>pb.ProposalResponse</code><br><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"Version"</span>: <span class="number">1</span>, <span class="comment">// å›ºå®šå€¼</span></span><br><span class="line">  <span class="attr">"Response"</span>: ${pb.Response}, <span class="comment">// ä¸ŠèŠ‚instantiate(6)é‡Œä»`chaincode/handler`è¿”å›çš„`pb.Response`. A response message indicating whether the endorsement of the action was successful</span></span><br><span class="line">  <span class="attr">"Payload"</span>: ${peer.ProposalResponsePayload},</span><br><span class="line">  <span class="attr">"Endorsement"</span>:  ${peer.Endorsement} <span class="comment">// æ¥æºäº`fabric/core/handlers/endorsement/plugin/plugin.go#Endorse`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// peer.ProposalResponsePayload</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Extension"</span>: ${&amp;peer.ChaincodeAction}.byte[], </span><br><span class="line">  <span class="attr">"ProposalHash"</span>: #putils.GetProposalHash1(proposal.hdr, proposal.Payload, ctx.Visibility)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// peer.ChaincodeAction</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Events"</span>: ${pb.chaincodeEvent}, <span class="comment">// ä¸ŠèŠ‚instantiate(6)é‡Œä»`chaincode/handler`è¿”å›çš„`pb.chaincodeEvent`</span></span><br><span class="line">  <span class="attr">"Results"</span>: ${txSim.PubSimulationResults}, <span class="comment">// æ¨¡æ‹Ÿç»“æœï¼Œread-write set</span></span><br><span class="line">  <span class="attr">"Response"</span>: ${pb.Response}, <span class="comment">// ä¸ŠèŠ‚instantiate(6)é‡Œä»`chaincode/handler`è¿”å›çš„`pb.Response`, ä¸å¤–å±‚çš„Responseä¸€è‡´ </span></span><br><span class="line">  <span class="attr">"ChaincodeId"</span>: {<span class="attr">"Name"</span>:<span class="string">"lscc"</span>,<span class="attr">"version"</span>:<span class="string">"latests"</span>}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// peer.Endorsement</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Signature"</span>: #signer.Sign(append(prpBytes, identityBytes...)) <span class="comment">// å°†payloadå’Œdentityè”åˆèµ·æ¥äº§ç”Ÿç­¾å</span></span><br><span class="line">  <span class="attr">"Endorser"</span>: #identityBytes = signer.Serialize()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode instantiate(6ï¼‰application chaincodeçš„åˆå§‹åŒ–</title>
      <link href="//articles/fabric-source-chaincode-instantiate-chaincode-init/"/>
      <url>//articles/fabric-source-chaincode-instantiate-chaincode-init/</url>
      
        <content type="html"><![CDATA[<p>æ¥ç€ç»§ç»­åˆ†æaccçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œåœ¨instantiate(3)é‡Œæåˆ°<code>endorser.callChaincode</code>æœ‰ä¸¤æ¬¡çš„<code>ChaincodeSupport#Execute</code>è°ƒç”¨,ç”±ä»£ç åˆ†æä¸¤æ¬¡ä¸åŒçš„<code>ChaincodeMessage</code>çš„<code>MessageType</code>åˆ†åˆ«ä¸º<code>MessageType_TRANSACTION</code>ï¼ˆå¯¹åº”cisï¼‰å’Œ<code>MessageType_INIT</code>ï¼ˆå¯¹åº”cdsï¼‰ï¼Œç›¸åº”è°ƒç”¨lsccçš„Invokeå’Œaccçš„Initã€‚å…·ä½“è¿‡ç¨‹å¯ä»¥å‚è€ƒä¸ŠèŠ‚åˆ†æã€‚</p><p>å…ˆçœ‹lsccçš„<code>Invoke</code>.å‚è€ƒä¸ŠèŠ‚æåŠçš„<code>execute</code>åœ¨ä¸¤ç«¯<code>chaincode/handler.go</code>ï¼ˆpeerç«¯ï¼‰å’Œ<code>shim/handler.go</code>ï¼ˆchaincodeå®¹å™¨ç«¯ï¼‰çš„æµç¨‹ï¼Œlsccç›¸å½“äºchaincodeå®¹å™¨ï¼ˆå°½ç®¡æ˜¯inproccontainerï¼‰ï¼Œä½¿ç”¨<code>shim/handler.go#handleReady</code>é‡Œ<code>select-case</code>ï¼Œlsccçš„<code>ChaincodeMessage_TRANSACTION</code>è¿›å…¥<code>handleTransaction</code>æ–¹æ³•ã€‚è¿™é‡Œçš„ä¸»è¦æµç¨‹ä¸ä¸ŠèŠ‚ä»‹ç»çš„<code>handleInit</code>ä¸€è‡´ï¼Œä¸åŒçš„æ˜¯è¿™é‡Œè°ƒç”¨çš„æ˜¯lsccçš„<code>Invoke</code>æ–¹æ³•ã€‚è¿™é‡Œéœ€è¦å¼ºè°ƒä¸€ç‚¹ï¼Œåœ¨<code>handleTransaction</code>,<code>handleInit</code>è¿™äº›<code>handleXXX</code>æ–¹æ³•é‡Œï¼Œè¿›å…¥å°±æ˜¯å¯åŠ¨goroutinneæ¥è¿è¡Œæ‰€æœ‰çš„é€»è¾‘ï¼Œè¿™æ ·å¯ä»¥ç«‹åˆ»è¿”å›å¹¶è¡Œæ¥å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</p><span id="more"></span><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Invoke implements lifecycle functions "deploy", "start", "stop", "upgrade".</span></span><br><span class="line"><span class="comment">// Deploy's arguments -  {[]byte("deploy"), []byte(&lt;chainname&gt;), &lt;unmarshalled pb.ChaincodeDeploymentSpec&gt;}</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Invoke also implements some query-like functions</span></span><br><span class="line"><span class="comment">// Get chaincode arguments -  {[]byte("getid"), []byte(&lt;chainname&gt;), []byte(&lt;chaincodename&gt;)}</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lscc *lifeCycleSysCC)</span> <span class="title">Invoke</span><span class="params">(stub shim.ChaincodeStubInterface)</span> <span class="title">pb</span>.<span class="title">Response</span></span> { </span><br><span class="line"></span><br><span class="line">  function := <span class="keyword">string</span>(args[<span class="number">0</span>])</span><br><span class="line">  <span class="keyword">switch</span> function {</span><br><span class="line">  <span class="keyword">case</span> DEPLOY, UPGRADE:</span><br><span class="line">      channel := <span class="keyword">string</span>(args[<span class="number">1</span>])</span><br><span class="line">      <span class="comment">// è·å–channelçš„è®¾ç½®ï¼Œè¿™ä¸ªåœ¨create channelæ—¶ä¼ å…¥é…ç½®</span></span><br><span class="line">      ac, exists := lscc.sccprovider.GetApplicationConfig(channel)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// the maximum number of arguments depends on the capability of the channel</span></span><br><span class="line">      <span class="comment">// æ ¡éªŒå½“å‰ä¼ å…¥å‚æ•°ä¸channelé…ç½®ï¼ˆacï¼‰æ˜¯å¦å†²çªï¼Œè¿™é‡Œæ ¡éªŒä¸»è¦æ˜¯ac.Capabilities().PrivateChannelData()</span></span><br><span class="line"></span><br><span class="line">      depSpec := args[<span class="number">2</span>]</span><br><span class="line">      cds, err := utils.GetChaincodeDeploymentSpec(depSpec)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// optional arguments here (they can each be nil and may or may not be present)</span></span><br><span class="line">      <span class="comment">// args[3] is a marshalled SignaturePolicyEnvelope representing the endorsement policy</span></span><br><span class="line">      <span class="comment">// args[4] is the name of escc, default "escc"(ç³»ç»Ÿè‡ªå¸¦)</span></span><br><span class="line">      <span class="comment">// args[5] is the name of vscc, default "vscc"(ç³»ç»Ÿè‡ªå¸¦ï¼‰</span></span><br><span class="line">      <span class="comment">// args[6] is a marshalled CollectionConfigPackage struct</span></span><br><span class="line">      <span class="keyword">var</span> EP []<span class="keyword">byte</span></span><br><span class="line">      p := cauthdsl.SignedByAnyMember(peer.GetMSPIDs(channel))</span><br><span class="line">      EP, err = utils.Marshal(p)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> collectionsConfig []<span class="keyword">byte</span></span><br><span class="line">      <span class="comment">// we proceed with a non-nil collection configuration only if we support the PrivateChannelData capability</span></span><br><span class="line">      <span class="comment">// PrivateChannelDataï¼Œ channelå†…çš„ç§æœ‰æ•°æ®</span></span><br><span class="line">      <span class="keyword">if</span> ac.Capabilities().PrivateChannelData() &amp;&amp; <span class="built_in">len</span>(args) &gt; <span class="number">6</span> {</span><br><span class="line">        collectionsConfig = args[<span class="number">6</span>]</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      cd, err := lscc.executeDeployOrUpgrade(stub, channel, cds, EP, escc, vscc, collectionsConfig, function)</span><br><span class="line">      cdbytes, err := proto.Marshal(cd)</span><br><span class="line">      <span class="keyword">return</span> shim.Success(cdbytes)</span><br><span class="line">  }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿›å…¥lsccçš„<code>Invoke</code>æ–¹æ³•ã€‚å›é¡¾instantiate(2)é‡Œcisçš„æ•°æ®ç»“æ„<code>"Args" : ["deploy", "${channelId}", "${chaincodDeploySpec}"]</code>,è¿™é‡Œçš„<code>select-case</code>è¿›å…¥<code>DEPLOY,UPGRADE</code>åˆ†æ”¯ã€‚åˆ†æ”¯é‡Œä¸»è¦æ˜¯æ ¡éªŒä»¥åŠå¤„ç†ä¼ å…¥å‚æ•°ï¼ŒåŒ…æ‹¬æŒ‡å®šçš„sccå’Œprivate dataç›¸å…³ï¼Œé‡è¦çš„æ–¹æ³•æ˜¯<code>lscc.executeDeployOrUpgrade</code>ï¼Œä¼ å‚å°±æ˜¯åˆšè·å–å’Œæ ¡éªŒè¿‡çš„å‚æ•°ã€‚</p><p>è¿›å…¥<code>executeDeployOrUpgrade</code>ã€‚é¦–å…ˆæ‰§è¡Œ<code>lscc.support.GetChaincodeFromLocalStorage(chaincodeName, chaincodeVersion)</code>ï¼Œè·å–<code>ccprovider.CCPackage</code>,è¿™æ˜¯å®‰è£…é˜¶æ®µæ‰§è¡Œ<code>peer chaincode install</code>å‘½ä»¤æ—¶æ‰“åŒ…å¹¶ä¸”ä¸Šä¼ åˆ°è¯¥èŠ‚ç‚¹çš„chaincodeå®šä¹‰ï¼Œæ”¾åœ¨peerèŠ‚ç‚¹æœ¬åœ°ç›®å½•çš„ï¼ˆè¿™ä¸ªåœ¨installé‡Œå…·ä½“åˆ†æå…¶ç»“æ„ï¼‰ã€‚ç„¶åæ‰§è¡Œ<code>lscc.executeDeploy</code>ã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// executeDeploy implements the "instantiate" Invoke transaction</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lscc *lifeCycleSysCC)</span> <span class="title">executeDeploy</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">stub shim.ChaincodeStubInterface,</span></span></span><br><span class="line"><span class="params"><span class="function">chainname <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">cds *pb.ChaincodeDeploymentSpec,</span></span></span><br><span class="line"><span class="params"><span class="function">policy []<span class="keyword">byte</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">escc []<span class="keyword">byte</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">vscc []<span class="keyword">byte</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">cdfs *ccprovider.ChaincodeData,</span></span></span><br><span class="line"><span class="params"><span class="function">ccpackfs ccprovider.CCPackage,</span></span></span><br><span class="line"><span class="params"><span class="function">collectionConfigBytes []<span class="keyword">byte</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> <span class="params">(*ccprovider.ChaincodeData, error)</span></span> {</span><br><span class="line">  <span class="comment">//just test for existence of the chaincode in the LSCC</span></span><br><span class="line">  chaincodeName := cds.ChaincodeSpec.ChaincodeId.Name</span><br><span class="line">  _, err := lscc.getCCInstance(stub, chaincodeName)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//retain chaincode specific data and fill channel specific ones</span></span><br><span class="line">  cdfs.Escc = <span class="keyword">string</span>(escc)</span><br><span class="line">  cdfs.Vscc = <span class="keyword">string</span>(vscc)</span><br><span class="line">  cdfs.Policy = policy</span><br><span class="line"></span><br><span class="line">  <span class="comment">// retrieve and evaluate instantiation policy</span></span><br><span class="line">  cdfs.InstantiationPolicy, err = lscc.support.GetInstantiationPolicy(chainname, ccpackfs)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the signed instantiation proposal</span></span><br><span class="line">  signedProp, err := stub.GetSignedProposal()</span><br><span class="line">  err = lscc.support.CheckInstantiationPolicy(signedProp, chainname, cdfs.InstantiationPolicy)</span><br><span class="line"></span><br><span class="line">  err = lscc.putChaincodeData(stub, cdfs)</span><br><span class="line"></span><br><span class="line">  err = lscc.putChaincodeCollectionData(stub, cdfs, collectionConfigBytes)</span><br><span class="line">  <span class="keyword">return</span> cdfs, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿™é‡Œå…ˆæ£€æŸ¥è¯¥chaincodeæ˜¯å¦å·²ç»éƒ¨ç½²è¿‡<code>lscc.getCCInstance(stub, chaincodeName)</code>ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨<code>stub.GetState(ccname)</code>,æ„å»º<code>&amp;pb.ChaincodeMessage{Type: pb.ChaincodeMessage_PUT_STATE, Payload: payloadBytes, Txid: txid, ChannelId: channelId}</code>å‘é€åˆ°å¯¹ç«¯<code>chaincode/handler</code>ã€‚è¿™é‡Œä¼šæ‰§è¡Œåˆ°<code>handler.callPeerWithChaincodeMsg</code>æ–¹æ³•ã€‚å…¶å®é‡Œé¢å°±æ˜¯hanlderæœ¬èº«ç»´æŠ¤ç€ä¸€ä¸ªåå«responseChannelçš„<code>map[string]chan pb.ChaincodeMessage</code>, å…ˆåˆ›å»ºä¸€ä¸ªchannelæ”¾å…¥mapä¸­ï¼Œkeyæ˜¯ç”±channelIDå’Œtxidæ„é€ è€Œæˆï¼Œå³å…³è”å½“å‰è¯·æ±‚ï¼Œåœ¨é€€å‡ºæ–¹æ³•æ—¶ä½¿ç”¨deferä»mapä¸­åˆ é™¤è¿™ä¸ªchannleã€‚è€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåœ¨<code>handler.sendReceive</code>é‡Œä½¿ç”¨<code>handler.serialSendAsync</code>å‘é€ChaincodeMessageï¼Œç„¶å<code>select-case</code>ä¸€ç›´ç­‰å¾…ä»channelé‡Œè¯»å–æ¶ˆæ¯ã€‚</p><p>ç›¸åº”çš„ï¼Œå½“å¯¹ç«¯å›å¤æ¶ˆæ¯<code>pb.ChaincodeMessage_RESPONSE</code>ï¼Œ<code>shim/handler</code>ä¼šè¿›å…¥<code>fabric/core/chaincode/shim/handler.go:handleReady</code>-&gt;<code>handler.sendChannel(msg)</code>,è¿™é‡Œä»responseChannelè¿™ä¸ªmapé‡Œæ‹¿å‡ºç›¸åº”çš„channelï¼Œæ”¾å…¥æ¶ˆæ¯ã€‚å®é™…ä¸Šï¼Œé€šè¿‡è¿™ä¸ªå®ç°äº†å¼‚æ­¥é€šä¿¡ï¼Œç»“åˆä¸Šé¢æåˆ°çš„æ¯æ¬¡è¿›å…¥<code>handlerXXX</code>æ–¹æ³•éƒ½ä½¿ç”¨goroutineå¤„ç†è€Œç«‹åˆ»è¿”å›ï¼Œå®ç°äº†å…¶å¹¶å‘é€šä¿¡ã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// callPeerWithChaincodeMsg sends a chaincode message (for e.g., GetState along with the key) to the peer for a given txid and receives the response.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(handler *Handler)</span> <span class="title">callPeerWithChaincodeMsg</span><span class="params">(msg *pb.ChaincodeMessage, channelID, txid <span class="keyword">string</span>)</span> <span class="params">(pb.ChaincodeMessage, error)</span></span> {</span><br><span class="line">    <span class="comment">// Create the channel on which to communicate the response from the peer</span></span><br><span class="line">    <span class="keyword">var</span> respChan <span class="keyword">chan</span> pb.ChaincodeMessage</span><br><span class="line">    <span class="keyword">var</span> err error</span><br><span class="line">    <span class="keyword">if</span> respChan, err = handler.createChannel(channelID, txid); err != <span class="literal">nil</span> {</span><br><span class="line">      <span class="keyword">return</span> pb.ChaincodeMessage{}, err</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> handler.deleteChannel(channelID, txid)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> handler.sendReceive(msg, respChan)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//sends a message and selects</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(handler *Handler)</span> <span class="title">sendReceive</span><span class="params">(msg *pb.ChaincodeMessage, c <span class="keyword">chan</span> pb.ChaincodeMessage)</span> <span class="params">(pb.ChaincodeMessage, error)</span></span> {</span><br><span class="line">    errc := <span class="built_in">make</span>(<span class="keyword">chan</span> error, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> {</span><br><span class="line">      <span class="keyword">select</span> {</span><br><span class="line">      <span class="keyword">case</span> outmsg, val := &lt;-c:</span><br><span class="line">        <span class="keyword">return</span> outmsg, <span class="literal">nil</span></span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(handler *Handler)</span> <span class="title">sendChannel</span><span class="params">(msg *pb.ChaincodeMessage)</span> <span class="title">error</span></span> {</span><br><span class="line">    handler.Lock()</span><br><span class="line">    <span class="keyword">defer</span> handler.Unlock()</span><br><span class="line">    txCtxID := handler.getTxCtxId(msg.ChannelId, msg.Txid)</span><br><span class="line">    handler.responseChannel[txCtxID] &lt;- *msg</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><code>chaincode/handler</code>å¯¹è¯¥ç±»å‹è¯·æ±‚åœ¨<code>hanldeMessage</code>é‡Œ<code>HandleGetState</code>ä¸€è·¯åˆ¤æ–­æœ€åæ‰§è¡Œ<code>res, err = txContext.TXSimulator.GetState(chaincodeName, getState.Key)</code>,ä»æœ¬åœ°è´¦æœ¬dbè·å–namespaceä¸ºlsccï¼Œkeyä¸º${chaincodeName}çš„æ•°æ®ï¼ˆæœ€ç»ˆæ‰§è¡Œ<code>queryHelper.txmgr.db.GetState(ns, key</code>ï¼‰ã€‚åœ¨<code>executeDeploy</code>ç¨åå¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œ<code>lscc.putChaincodeData(stub, cdfs)</code>æ“ä½œæ—¶æ‰§è¡Œç›¸å¯¹åº”çš„put stateæ“ä½œï¼Œå³deployä¹‹åä¼šæŠŠè¯¥chaincodeå†™å…¥peeræœ¬åœ°dbçš„lsccçš„namespaceé‡Œã€‚å› æ­¤ï¼Œé€šè¿‡æ ¡éªŒgetå›æ¥çš„æ•°æ®ä¸ºç©ºæ¥åˆ¤æ–­è¯¥chaincodeæ²¡æœ‰deployè¿‡ã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/helper.go:40</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *queryHelper)</span> <span class="title">getState</span><span class="params">(ns <span class="keyword">string</span>, key <span class="keyword">string</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> err := h.checkDone(); err != <span class="literal">nil</span> {</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    }</span><br><span class="line">    versionedValue, err := h.txmgr.db.GetState(ns, key)</span><br><span class="line">    val, ver := decomposeVersionedValue(versionedValue)</span><br><span class="line">    <span class="keyword">if</span> h.rwsetBuilder != <span class="literal">nil</span> {</span><br><span class="line">      h.rwsetBuilder.AddToReadSet(ns, key, ver)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> val, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/helper.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decomposeVersionedValue</span><span class="params">(versionedValue *statedb.VersionedValue)</span> <span class="params">([]<span class="keyword">byte</span>, *version.Height)</span></span> {</span><br><span class="line">  <span class="keyword">var</span> value []<span class="keyword">byte</span></span><br><span class="line">    <span class="keyword">var</span> ver *version.Height</span><br><span class="line">    <span class="keyword">if</span> versionedValue != <span class="literal">nil</span> {</span><br><span class="line">      value = versionedValue.Value</span><br><span class="line">      ver = versionedValue.Version</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> value, ver</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// core/ledger/kvledger/txmgmt/rwsetutil/rwset_builder.go</span></span><br><span class="line"><span class="comment">// AddToReadSet adds a key and corresponding version to the read-set</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *RWSetBuilder)</span> <span class="title">AddToReadSet</span><span class="params">(ns <span class="keyword">string</span>, key <span class="keyword">string</span>, version *version.Height)</span></span> {</span><br><span class="line">    nsPubRwBuilder := b.getOrCreateNsPubRwBuilder(ns)</span><br><span class="line">    nsPubRwBuilder.readMap[key] = NewKVRead(key, version)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä»ä¸Šé¢çœ‹å‡ºï¼Œè´¦æœ¬çš„valueæ˜¯<code>statedb.VersionedValue</code>ç»“æ„ï¼ŒåŒ…å«valueå’Œversion(ç»“æ„ä¸º<code>*version.Height{BlockNum uint64, TxNum uint64}</code>)ã€‚è·å–çš„ç»“æœåŠ å…¥<code>readSet</code>,å…¶ä¸­å‚æ•°ï¼ˆnamesapceï¼šlsccï¼Œkeyï¼š${chaincodeName}, ver: ç‰ˆæœ¬ï¼‰</p><p>ç„¶åè·å–å¹¶æ£€æŸ¥éƒ¨ç½²ç­–ç•¥<code>lscc.support.CheckInstantiationPolicy</code>ã€‚ç„¶åæ‰§è¡Œ<code>lscc.putChaincodeData(stub, cdfs)</code>ï¼Œè°ƒç”¨çš„æ˜¯<code>stub.PutState(cd.Name, cdbytes)</code>ã€‚å…¥å‚æ˜¯chaincode.Nameå’Œ<code>ccprovider.ChaincodeData</code>åºåˆ—åŒ–å­—èŠ‚ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡ä»æœ¬åœ°å­˜å‚¨çš„codepackageå’Œåˆšåˆšä¼ å…¥çš„esccï¼Œvsccç­‰å‚æ•°æ„å»ºæˆçš„ã€‚å‘å¯¹ç«¯<code>chaincode/handler</code>å‘é€<code>pb.ChaincodeMessage_PUT_STATE</code>ã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-------- ChaincodeData is stored on the LSCC -------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ChaincodeData defines the datastructure for chaincodes to be serialized by proto</span></span><br><span class="line"><span class="comment">// Type provides an additional check by directing to use a specific package after instantiation</span></span><br><span class="line"><span class="comment">// Data is Type specifc (see CDSPackage and SignedCDSPackage)</span></span><br><span class="line"><span class="keyword">type</span> ChaincodeData <span class="keyword">struct</span> {</span><br><span class="line">    <span class="comment">// Name of the chaincode</span></span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`protobuf:"bytes,1,opt,name=name"`</span></span><br><span class="line">    Version <span class="keyword">string</span> <span class="string">`protobuf:"bytes,2,opt,name=version"`</span></span><br><span class="line">    Escc <span class="keyword">string</span> <span class="string">`protobuf:"bytes,3,opt,name=escc"`</span></span><br><span class="line">    Vscc <span class="keyword">string</span> <span class="string">`protobuf:"bytes,4,opt,name=vscc"`</span></span><br><span class="line">    <span class="comment">// Policy endorsement policy for the chaincode instance</span></span><br><span class="line">    Policy []<span class="keyword">byte</span> <span class="string">`protobuf:"bytes,5,opt,name=policy,proto3"`</span></span><br><span class="line">    <span class="comment">// Data data specific to the package</span></span><br><span class="line">    Data []<span class="keyword">byte</span> <span class="string">`protobuf:"bytes,6,opt,name=data,proto3"`</span></span><br><span class="line">    <span class="comment">// Id of the chaincode that's the unique fingerprint for the CC This is not currently used anywhere but serves as a good eyecatcher </span></span><br><span class="line">    Id []<span class="keyword">byte</span> <span class="string">`protobuf:"bytes,7,opt,name=id,proto3"`</span></span><br><span class="line">    <span class="comment">// InstantiationPolicy for the chaincode</span></span><br><span class="line">    InstantiationPolicy []<span class="keyword">byte</span> <span class="string">`protobuf:"bytes,8,opt,name=instantiation_policy,proto3"`</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ•°æ®åˆ†ä¸ºæ™®é€šchannleå…¬å¼€ä¿¡æ¯å’Œprivateæ¶ˆæ¯ï¼Œè¿™é‡Œåªè®¨è®ºå‰è€…ã€‚ç›¸åº”çš„ï¼Œå¯¹ç«¯<code>chaincode/handler</code>åœ¨<code>hanldeMessage</code>é‡Œ<code>HandlePutState</code>ä¸€è·¯åˆ¤æ–­æœ€åæ‰§è¡Œ<code>res, err = txContext.TXSimulator.SetState(chaincodeName, putState.Key, putState.Value)</code>.è·Ÿä¸Šé¢åŒºåˆ«çš„æ˜¯ï¼Œè¿™é‡Œåœ¨<code>ockbased_tx_simulator.go</code>æ–‡ä»¶é‡Œï¼Œæ¸…æ¥šæŒ‡æ˜è¿™æ˜¯æ¨¡æ‹Ÿäº¤æ˜“ã€‚åŒæ—¶ï¼ŒåªæŠŠ(namespace:lscc, key:${chaincode.Name}, value:${ChaincodeData}åºåˆ—åŒ–å­—èŠ‚ï¼‰çš„ç»„åˆåŠ å…¥åˆ°writeSetå†…ï¼Œç„¶åå°±è¿”å›ç»“æœ<code>ChaincodeMessage_RESPONSE</code>æˆ–è€…é”™è¯¯æ¶ˆæ¯    <code>ChaincodeMessage_ERROR</code>ï¼Œå¹¶æ²¡æœ‰çœŸæ­£ä½œç”¨äºè´¦æœ¬dbã€‚åŒæ—¶ï¼Œæ²¡æœ‰æŒ‡å®šversionï¼Œè¿™ä¸ªæ˜¯åœ¨ordereræ’åºæ‰“åŒ…æ—¶æ·»åŠ çš„ã€‚å…³äºè¿™é‡Œçš„read-write setï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘æ¦‚å¿µ<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/readwrite.html">Read-Write set semantics</a>ã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/lockbased_tx_simulator.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *lockBasedTxSimulator)</span> <span class="title">SetState</span><span class="params">(ns <span class="keyword">string</span>, key <span class="keyword">string</span>, value []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> {</span><br><span class="line">  err := s.helper.checkDone()</span><br><span class="line">  err := s.checkBeforeWrite()</span><br><span class="line">  err := s.helper.txmgr.db.ValidateKeyValue(key, value)</span><br><span class="line">  s.rwsetBuilder.AddToWriteSet(ns, key, value)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æœ€ååˆ—ä¸¾ä¸‹Invoke lsccåä»<code>shim/handler</code>è¿”å›åˆ°<code>chaincode/handler</code>çš„æ•°æ®ç»“æ„<code>pb.ChaincodeMessage</code><br></p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pb.ChaincodeMessage</span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Type"</span>: pb.ChaincodeMessage_COMPLETED, </span><br><span class="line">  <span class="attr">"Payload"</span>: ${pb.Response}.byte[], </span><br><span class="line">  <span class="attr">"Txid"</span>: ${msg.Txid}, </span><br><span class="line">  <span class="attr">"ChaincodeEvent"</span>: ${pb.chaincodeEvent}, <span class="comment">// nil </span></span><br><span class="line">  <span class="attr">"ChannelId"</span>: ${stub.ChannelId}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// pb.Response </span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Status"</span>:  <span class="number">200</span>, <span class="comment">// ok</span></span><br><span class="line">  <span class="attr">"Payload"</span>: ${ChaincodeData}.byte[]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// pb.ChaincodeData </span></span><br><span class="line">{</span><br><span class="line">  <span class="attr">"Name"</span>: ${application chaincode.name}, <span class="comment">// CDSPackage.depSpec.ChaincodeSpec.ChaincodeId.Name, åŒâ€œDataâ€</span></span><br><span class="line">  <span class="attr">"Version"</span>: {application chaincode.version}, <span class="comment">// CDSPackage.depSpec.ChaincodeSpec.ChaincodeId.Version, åŒâ€œDataâ€</span></span><br><span class="line">  <span class="attr">"Escc"</span>: <span class="string">"escc"</span>,</span><br><span class="line">  <span class="attr">"Vscc"</span>: <span class="string">"vscc"</span>,</span><br><span class="line">  <span class="attr">"Policy"</span>: ${cb.SignaturePolicyEnvelope}.byte[], <span class="comment">// endorsement policy, æ¥æºäºlscc.go#Invoke, cauthdsl.SignedByAnyMember(peer.GetMSPIDs(channel))</span></span><br><span class="line">  <span class="attr">"Data"</span>: ,  <span class="comment">// CDSPackage.datab, æ‰§è¡Œlscc.support.GetChaincodeFromLocalStorage(chaincodeName, chaincodeVersion).GetChaincodeData()ï¼Œæ¥æºäºinstall chaincodeæ‰“åŒ…æ„å»ºçš„fabric/core/common/ccprovider/ccprovider.go:GetCCPackage</span></span><br><span class="line">  <span class="attr">"Id"</span>: , <span class="comment">// CDSPackage.id, åŒâ€œDataâ€</span></span><br><span class="line">  <span class="attr">"InstantiationPolicy"</span>: ${InstantiationPolicy}.byte[] <span class="comment">// æ¥æºäºlscc.go#executeDeploy, lscc.support.GetInstantiationPolicy(chainname, ccpackfs)</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><hr><p>è¿™é‡Œç»§ç»­ç›´æ¥çœ‹accçš„<code>Init</code>ï¼Œä¹‹å‰çš„æ­¥éª¤ä¸lsccå®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥å‚è€ƒä¸ŠèŠ‚ã€‚Tutorialé‡Œçš„ä¾‹å­çš„chaincodeä»£ç åœ¨<code>github.com/hyperledger/fabric/examples/chaincode/go/example02/chaincode.go</code>,é‡Œé¢çš„Initæ–¹æ³•ä¸»è¦æ˜¯è¯»å…¥å‚æ•°ï¼Œç„¶åè°ƒç”¨<code>stub.PutState</code>åè¿”å›successã€‚ç»†èŠ‚å¦‚ä¸Šï¼Œä¸å†å¤è¿°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode instantiate(5ï¼‰system chaincodeçš„åˆå§‹åŒ–</title>
      <link href="//articles/fabric-source-chaincode-instantiate-system-chaincode/"/>
      <url>//articles/fabric-source-chaincode-instantiate-system-chaincode/</url>
      
        <content type="html"><![CDATA[<p>æ¥ä¸‹æ¥åˆ†ælsccçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œå…ˆçœ‹ä¸‹å…¶åˆå§‹åŒ–æ³¨å†Œè¿‡ç¨‹ã€‚åœ¨<code>peer/node/start.go#Serve</code>é‡Œ<code>registerChaincodeSupport(ccSrv, ccEndpoint, ca, aclProvider)</code>ã€‚è¿›å…¥æ–¹æ³•ï¼Œä¸»è¦æ˜¯<code>scc.CreateSysCCs(ccp, sccp, aclProvider)</code>ï¼Œå°±æ˜¯å¼•å…¥äº†<code>scc/importsysccs.go#builtInSystemChaincodes</code>é‡Œå®šä¹‰çš„SCC,å³<code>cscc</code>,<code>lscc</code>å’Œ<code>gscc</code>ï¼ˆåŒ…å«chaincodeçš„Nameï¼ŒPathä»£ç åœ°å€ï¼ŒChaincodeå¯¹è±¡ï¼Œaclï¼Œpolicyç­‰ï¼‰ã€‚ç„¶åé€ä¸ªæ‰§è¡Œ<code>sccp.RegisterSysCC(cc)</code>æ³¨å†ŒSCC,å®é™…ä¸Šå°±æ˜¯åŠ å…¥<code>SystemChaincodeProvider.Registrar.typeRegistry</code>ï¼ˆmap[string]*inprocContainerï¼‰é‡Œï¼Œkeyæ˜¯chaincodeçš„Nameï¼Œè¿™ä¸ªåé¢åˆå§‹åŒ–æ—¶å€™ä¼šä½¿ç”¨åˆ°ã€‚</p><p>è¿™é‡Œå®Œæˆæ³¨å†Œåï¼Œåœ¨<code>serve()</code>é‡Œç¨åçš„ä½ç½®æ‰§è¡Œ<code>sccp.DeploySysCCs("", ccp)</code>è¿›è¡Œéƒ¨ç½²ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯channelIdä¸ºâ€œâ€ï¼Œè¯´æ˜è¿™äº›sccæ˜¯chainlessçš„ï¼Œå¯ä»¥ä¾›æ‰€æœ‰çš„channelä½¿ç”¨ã€‚è¿›å…¥æ–¹æ³•ï¼Œé¦–å…ˆæ„é€ cds<code>&amp;pb.ChaincodeDeploymentSpec{ExecEnv: pb.ChaincodeDeploymentSpec_SYSTEM, ChaincodeSpec: spec}</code>.è¿™é‡Œæ³¨æ„åˆ°ï¼Œéƒ¨ç½²ç±»å‹æ˜¯ChaincodeDeploymentSpec_SYSTEMï¼Œå›é¡¾ä¸ŠèŠ‚accç±»å‹æ˜¯ChaincodeDeploymentSpec_DOCKERï¼Œè¯´æ˜SCCæ˜¯éƒ¨ç½²åœ¨peerå†…çš„ï¼Œè€Œaccæ˜¯éƒ¨ç½²åœ¨å¦å¤–æ–°çš„chaincode dockerå®¹å™¨é‡Œã€‚ç„¶åæ‰§è¡Œ<code>ccprov.Execute(ctxt, cccid, chaincodeDeploymentSpec)</code>,æœ€ç»ˆå®é™…ä¸Šåˆå›åˆ°å‰é¢ä»‹ç»è¿‡çš„<code>ChaincodeSupport.Execute</code>æ–¹æ³•ä¸Šã€‚åé¢çš„æ‰§è¡Œä¸accæ˜¯ä¸€è‡´çš„ï¼Œæ‰€åŒºåˆ«çš„åœ¨äºlaunchã€‚åŒºåˆ«äºaccä½¿ç”¨çš„æ˜¯<code>dockercontroller/DockerVM#start</code>,sccä½¿ç”¨çš„æ˜¯<code>inproccontroller.InprocVM#start</code>.é¦–å…ˆ<code>vm.registry.typeRegistry[path]</code>,è¿™ä¸ªåœ¨å‰é¢å·²ç»æ³¨å†Œäº†å¯ä»¥è·å–å‡ºæ¥ã€‚ç„¶åå¼€å§‹çœŸæ­£çš„launchã€‚</p><span id="more"></span><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ipc *inprocContainer)</span> <span class="title">launchInProc</span><span class="params">(ctxt context.Context, id <span class="keyword">string</span>, args []<span class="keyword">string</span>, env []<span class="keyword">string</span>, ccSupport ccintf.CCSupport)</span> <span class="title">error</span></span> {</span><br><span class="line">    peerRcvCCSend := <span class="built_in">make</span>(<span class="keyword">chan</span> *pb.ChaincodeMessage)</span><br><span class="line">    ccRcvPeerSend := <span class="built_in">make</span>(<span class="keyword">chan</span> *pb.ChaincodeMessage)</span><br><span class="line">    ccchan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>{}, <span class="number">1</span>)</span><br><span class="line">    ccsupportchan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>{}, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">defer</span> <span class="built_in">close</span>(ccchan)</span><br><span class="line">        err := shim.StartInProc(env, args, ipc.chaincode, ccRcvPeerSend, peerRcvCCSend)</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">defer</span> <span class="built_in">close</span>(ccsupportchan)</span><br><span class="line">        inprocStream := newInProcStream(peerRcvCCSend, ccRcvPeerSend)</span><br><span class="line">        err := ccSupport.HandleChaincodeStream(ctxt, inprocStream)</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> &lt;-ccchan:</span><br><span class="line">        <span class="built_in">close</span>(peerRcvCCSend)</span><br><span class="line">    <span class="keyword">case</span> &lt;-ccsupportchan:</span><br><span class="line">        <span class="built_in">close</span>(ccRcvPeerSend)</span><br><span class="line">    <span class="keyword">case</span> &lt;-ipc.stopChan:</span><br><span class="line">        <span class="built_in">close</span>(ccRcvPeerSend)</span><br><span class="line">        <span class="built_in">close</span>(peerRcvCCSend)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// StartInProc is an entry point for system chaincodes bootstrap. It is not an API for chaincodes.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StartInProc</span><span class="params">(env []<span class="keyword">string</span>, args []<span class="keyword">string</span>, cc Chaincode, recv &lt;-<span class="keyword">chan</span> *pb.ChaincodeMessage, send <span class="keyword">chan</span>&lt;- *pb.ChaincodeMessage)</span> <span class="title">error</span></span> {</span><br><span class="line">    stream := newInProcStream(recv, send)</span><br><span class="line">    err := chatWithPeer(chaincodename, stream, cc)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> inProcStream <span class="keyword">struct</span> {</span><br><span class="line">    recv &lt;-<span class="keyword">chan</span> *pb.ChaincodeMessage</span><br><span class="line">    send <span class="keyword">chan</span>&lt;- *pb.ChaincodeMessage</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªgoroutineï¼Œåˆ†åˆ«å¤„ç†chaincode shimå’Œpeerçš„handle streamã€‚åŒæ—¶ï¼Œæœ‰ä¸¤ä¸ªchannelï¼Œ<code>peerRcvCCSend</code>,<code>ccRcvPeerSend</code>,å¯ä»¥ä»åå­—åˆ¤æ–­å‡ºæ¶ˆæ¯çš„æµå‘ã€‚</p><p>å¯åŠ¨ç¬¬ä¸€ä¸ªgoroutine<code>shim.StartInProc</code>,å‘<code>chaincodeSupport</code>å‘é€æ³¨å†Œã€‚ç”¨äºè¿™é‡Œçš„<code>chatWithPeer</code>è·Ÿaccä»‹ç»çš„æ˜¯åŒä¸€ä¸ªéƒ½åœ¨<code>chaincode.go</code>ä¸‹ï¼Œåœ¨è¿™é‡Œé¢æ„é€ äº†è¯¥sccçš„handlerï¼ˆè®¾ç½®<code>inProcStream</code>è¿™ä¸ªstreamï¼‰å‘é€äº†<code>&amp;pb.ChaincodeMessage{Type: pb.ChaincodeMessage_REGISTER, Payload: payload})</code>è¿™ä¸ªæ¶ˆæ¯ã€‚è¿™ä¸ªç±»æ¯”äºaccé‡Œåœ¨chaincodeå®¹å™¨çš„handlerã€‚</p><p>å¯åŠ¨ç¬¬äºŒä¸ªgoroutine<code>ccSupport.HandleChaincodeStream(ctxt, inprocStream)</code>ï¼Œç”¨äºå¤„ç†æ³¨å†Œè¯·æ±‚ï¼Œè¿™ä¸ªç±»æ¯”äºaccé‡Œçš„peerçš„handlerï¼Œæ‰€ä¸åŒçš„æ˜¯ï¼Œaccé‡Œçš„streamæ˜¯grpc server streamï¼Œæ˜¯ç”±grpc serveræ„å»ºçš„ï¼Œè€Œè¿™é‡Œåˆ™æ˜¯å°è£…äº†<code>peerRcvCCSend</code>,<code>ccRcvPeerSend</code>è¿™ä¸¤ä¸ªchannelã€‚æ€»è€Œè¨€ä¹‹ï¼Œåœ¨accå†…ï¼Œæ–°chaincodeå®¹å™¨å†…é€šè¿‡grpcæ–¹å¼ä¸peeré€šä¿¡ï¼Œè€Œsccç”±äºéƒ½å¤„åœ¨åŒä¸€ä¸ªpeerå®¹å™¨å†…ï¼Œæ˜¯é€šè¿‡go channelçš„æ–¹æ³•å®ç°ã€‚å…¶ä»–çš„ä¸»è¦æµç¨‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚</p><p>ç¬¬ä¸‰éƒ¨åˆ†çš„<code>select-case</code>åˆ™æ˜¯åœ¨å¤„ç†chaincodeé€€å‡ºçš„æƒ…å†µã€‚è¿™ä¸ªæ–¹æ³•åœ¨å¤–å±‚<code>InprocVM#Start</code>æ˜¯go routineå¯åŠ¨çš„ï¼Œæœ€å¤–å±‚ç­‰å¾…çš„æ˜¯<code>select-case</code>ç­‰å¾…<code>launchState.Done()</code>channelçš„è¿”å›ï¼Œè¿™ä¸ªè·Ÿaccæ˜¯ä¸€è‡´çš„ã€‚</p><p>ä¸€è·¯è¿”å›åˆ°<code>core/chaincode/chaincode_support.go#Invoke</code>æ–¹æ³•ï¼Œåœ¨æ‰§è¡Œå®Œ<code>Launch</code>åï¼Œæœ€åæ‰§è¡Œ<code>ChaincodeSupport#execute</code>.åœ¨å‰é¢instantiateï¼ˆ3ï¼‰é‡Œä»‹ç»è¿‡executeæ–¹æ³•ï¼Œè¿™é‡Œç›´æ¥çœ‹å‘é€çš„<code>ChaincodeMessage</code>ã€‚åœ¨<code>chaincode_support.go#Invoke</code>é‡ŒæŒ‡å®šéƒ¨ç½²<code>ChaincodeDeploymentSpec</code>çš„<code>ChaincodeMessage_Type</code>ä¸º<code>pb.ChaincodeMessage_INIT</code>,ç”±<code>chaincode/handler.go#serialSendAsync</code>,å¯¹ç«¯çš„<code>shim/handler.go#handleMessage</code>ã€‚å‰é¢åˆå§‹åŒ–å®Œæˆåï¼Œä¸¤ç«¯handlerçŠ¶æ€éƒ½ä¸ºreadyï¼Œ<code>select-case</code>è¿›å…¥<code>hanlder.state=ready</code>,<code>ChaincodeMessageType=ChaincodeMessage_INIT</code>æ‰§è¡Œåˆ°<code>#handleInit</code>.<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(handler *Handler)</span> <span class="title">handleInit</span><span class="params">(msg *pb.ChaincodeMessage, errc <span class="keyword">chan</span> error)</span></span> {</span><br><span class="line">    <span class="comment">// The defer followed by triggering a go routine dance is needed to ensure that the previous state transition</span></span><br><span class="line">    <span class="comment">// is completed before the next one is triggered. The previous state transition is deemed complete only when</span></span><br><span class="line">    <span class="comment">// the beforeInit function is exited. Interesting bug fix!!</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">var</span> nextStateMsg *pb.ChaincodeMessage</span><br><span class="line">        <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">            handler.triggerNextState(nextStateMsg, errc)</span><br><span class="line">        }()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Call chaincode's Run</span></span><br><span class="line">        <span class="comment">// Create the ChaincodeStub which the chaincode can use to callback</span></span><br><span class="line">        <span class="comment">// ç”¨ä¼ å…¥çš„æ•°æ®åˆå§‹åŒ–stub</span></span><br><span class="line">        stub := <span class="built_in">new</span>(ChaincodeStub)</span><br><span class="line">        err := stub.init(handler, msg.ChannelId, msg.Txid, input, msg.Proposal)</span><br><span class="line"></span><br><span class="line">        res := handler.cc.Init(stub)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Send COMPLETED message to chaincode support and change state</span></span><br><span class="line">        nextStateMsg = &amp;pb.ChaincodeMessage{Type: pb.ChaincodeMessage_COMPLETED, Payload: resBytes, Txid: msg.Txid, ChaincodeEvent: stub.chaincodeEvent, ChannelId: stub.ChannelId}</span><br><span class="line">    }()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"># github.com/hyperledger/fabric/core/scc/lscc</span><br><span class="line"><span class="comment">//Init is mostly useless for SCC</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lscc *lifeCycleSysCC)</span> <span class="title">Init</span><span class="params">(stub shim.ChaincodeStubInterface)</span> <span class="title">pb</span>.<span class="title">Response</span></span> {</span><br><span class="line"><span class="keyword">return</span> shim.Success(<span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>åœ¨è¿™é‡Œï¼Œä¸»è¦æ˜¯<code>stub.init</code>æ„å»ºstubï¼Œè¿™ä¸ªæ¡©çš„æ¦‚å¿µåœ¨è¿œç¨‹è°ƒç”¨é‡Œå¸¸è§ã€‚ç„¶åæ‰§è¡Œ<code>handler.cc.Init(stub)</code>ã€‚è¿™é‡Œçœ‹<code>lscc.go#Init</code>.å¯¹äºlscc(å¤§å¤šæ•°scc)æ¥è¯´ï¼Œåˆå§‹åŒ–å¹¶ä¸éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå› æ­¤è¿™é‡Œåªæ˜¯ç®€å•è¿”å›<code>shim.Success</code>çš„resp.åœ¨<code>handleInit</code>é‡Œï¼Œ<code>defer func</code>å°†ç»“æœè¿”å›ï¼Œè¿™é‡Œå¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œè¿”å›<code>pb.ChaincodeMessage_COMPLETED</code>ï¼Œå¦åˆ™è¿”å›<code>pb.ChaincodeMessage_ERROR</code>.åŒæ ·çš„ï¼Œåœ¨<code>chaincode/handler.go#handleMessage</code>é‡Œå¯¹<code>pb.ChaincodeMessage_COMPLETED, pb.ChaincodeMessage_ERROR</code>è¿™ä¸¤ä¸ªè°ƒç”¨chaincode shimçš„å›å¤æ¶ˆæ¯è°ƒç”¨<code>handler.Notify(msg)</code>ï¼Œå³<code>tctx.ResponseNotifier &lt;- msg</code>.è¿™ä¸ªåœ¨å‰é¢çš„instantiate(3)å°èŠ‚æè¿‡ï¼Œå¼‚æ­¥è°ƒç”¨çš„é”™è¯¯ä»¥åŠç»“æœéƒ½å‘é€åˆ°txctx.ResponseNotifieè¿™ä¸ªchanå†…å†åšåç»­çš„å¤„ç†ã€‚è‡³æ­¤ï¼Œå®Œæˆlsccçš„åˆå§‹åŒ–å’Œæ³¨å†Œï¼Œåé¢å†ä»‹ç»accçš„åˆå§‹åŒ–çš„rpcè¿‡ç¨‹ã€‚<p></p><blockquote><p>å‘½åç¼©å†™å‚è€ƒ<br>cc : chaincode<br>scc : system chaincode<br>ccp, ccprov : chaincode provider<br>sccp : system chaincode provider<br>cccid : ccprovider.CCContext</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode instantiate(4ï¼‰chaincodeå®¹å™¨å¯åŠ¨åŠæ³¨å†Œ</title>
      <link href="//articles/fabric-source-chaincode-instantiate-chaincode-launch/"/>
      <url>//articles/fabric-source-chaincode-instantiate-chaincode-launch/</url>
      
        <content type="html"><![CDATA[<p>æ¥ä¸‹æ¥å›åˆ°å®¹å™¨å¯åŠ¨ååœ¨å®¹å™¨ä¸­åˆå§‹åŒ–å’Œæ³¨å†Œchaincodeã€‚åœ¨ä¸Šä¸€èŠ‚æ„å»ºdockeré‡Œæåˆ°ï¼Œå®¹å™¨çš„å¯åŠ¨å‘½ä»¤ï¼ˆæŒ‡é»˜è®¤è¯­è¨€æˆ–è€…æ˜¾å¼è®¾ç½®è¯­è¨€-l golangï¼‰ä¸º<code>lc.Args = []string{"chaincode", fmt.Sprintf("-peer.address=%s", c.PeerAddress)}</code>ã€‚åœ¨æ„å»ºå®¹å™¨æ—¶<code>fabric/core/chaincode/platforms/golang/platform.go#GenerateDockerBuild</code>ï¼ŒæŒ‡å®šäº†æ„å»ºå‚æ•°<code>DockerBuildOptions</code></p><pre><code class="lang-go">util.DockerBuildOptions{  Cmd:          fmt.Sprintf("GOPATH=/chaincode/input:$GOPATH go build -tags \"%s\" %s -o /chaincode/output/chaincode %s", gotags, ldflagsOpt, pkgname),  InputStream:  codepackage,  OutputStream: binpackage,}</code></pre><p>è¿™é‡ŒæŒ‡çš„æ˜¯ï¼Œå°†<code>pkgname</code>(spec.ChaincodeId.Path)æŒ‡å®šçš„chaincodeä»£ç è¿è¡Œ<code>go build -o chaincode</code>æ‰“åŒ…æˆåä¸º<code>chaincode</code>çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å› æ­¤å®¹å™¨å¯åŠ¨æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨äº†installçš„chaincodeä»£ç é‡Œçš„mainæ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯åˆ†æçš„å…¥å£ã€‚åœ¨<a href="https://hyperledger-fabric.readthedocs.io/en/latest/build_network.html">Building Your First Network</a>å®˜æ–¹æ•™ç¨‹ï¼Œåœ¨fabric-samples/first-network/scriptsçš„<code>scripts.sh</code>å’Œ<code>utils.sh</code>é‡Œæ‰¾åˆ°install chaincodeè·¯å¾„ä¸º<code>${CC_SRC_PATH}</code>,åœ¨<code>scripts.sh</code>é‡Œå¯ä»¥å¾—åˆ°<code>CC_SRC_PATH="github.com/chaincode/chaincode_example02/go/"</code>. è¯¥ç›®å½•ä¸‹<code>chaincode_example02.go</code>çš„mainæ–¹æ³•<code>err := shim.Start(new(SimpleChaincode))</code>å¯åŠ¨ã€‚è¿›å…¥åˆ°<code>chaincode.Start(cc Chaincode)</code>æ–¹æ³•</p><span id="more"></span><ol><li><code>SetupChaincodeLogging()</code>è®¾ç½®æ—¥å¿—ç›¸å…³</li><li>è·å–å˜é‡chaincodeåç§°<code>viper.GetString("chaincode.id.name")</code>ã€‚å›é¡¾ä¸ŠèŠ‚åœ¨åˆ›å»ºchaincodeå®¹å™¨æ—¶åœ¨<code>container_runtime.go</code>è®¾ç½®äº†å˜é‡<code>append(c.CommonEnv, "CORE_CHAINCODE_ID_NAME="+cname)</code>ã€‚</li><li><code>factory.InitFactories(factory.GetDefaultOpts())</code>åˆå§‹åŒ–BCCSPï¼ˆblockchain crypto serviceï¼‰æœåŠ¡ã€‚å¾…è¯¦è¿°ã€‚</li><li><code>userChaincodeStreamGetter</code>æ„å»ºä¸peerèŠ‚ç‚¹çš„grpc clientã€‚é¦–å…ˆï¼Œè·å–<code>peerAddress</code>,è¿™ä¸ªåœ¨<code>container_runtime.go</code>è®¾ç½®äº†flagå¯åŠ¨å‚æ•°<code>-peer.address</code>ï¼Œå³endorserçš„peerAddressã€‚ç„¶åï¼Œä¸è¯¥peerå»ºç«‹è¿æ¥ï¼Œæ„é€ <code>/protos.ChaincodeSupport/Register</code>çš„grpc streamã€‚</li><li><code>chatWithPeer(chaincodename string, stream PeerChaincodeStream, cc Chaincode)</code>.æ–°å»º<code>handler := newChaincodeHandler(stream, cc)</code>ï¼Œï¼ˆè¿™é‡Œæ˜¯shim/handler.goï¼‰ï¼Œè¿™æ—¶å€™<code>handler.state = created</code>ã€‚è¿™æ˜¯åœ¨chaincodeå®¹å™¨é‡Œçš„ï¼Œä¸ä¹‹ç›¸å¯¹çš„ï¼Œåœ¨peerå®¹å™¨é‡Œä¹Ÿæœ‰<code>handler</code>ï¼Œå¯¹ç­‰å¤„ç†. ç„¶å<code>handler.serialSend(&amp;pb.ChaincodeMessage{Type: pb.ChaincodeMessage_REGISTER, Payload: payload});</code>è¿™é‡Œpayloadæ˜¯<code>&amp;pb.ChaincodeID{Name: chaincodename}</code>ã€‚å°†æ³¨å†Œä¿¡æ¯å‘é€åˆ°peerèŠ‚ç‚¹åï¼Œå¯åŠ¨goroutineã€‚è¿™ä¸ªgoroutineé‡Œæ˜¯forå¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯éƒ½æ–°å¯åŠ¨ä¸€ä¸ªå­goroutineï¼Œè¿™ä¸ªå­go routineè´Ÿè´£ä»streamé‡Œæ¥å—ä¸€æ¡æ¶ˆæ¯ï¼Œæ”¾åˆ°ä¸¤ä¸ªchannelï¼ˆmsgAvail, errcï¼‰é‡Œã€‚<code>msgAvail, errc = stream.Recv()</code>ï¼Œæ¥æ”¶å®Œä¸€æ¡å³å®Œæˆå­goroutineçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸‹æ¬¡å¾ªç¯å†å¦èµ·ä¸€ä¸ªã€‚çˆ¶goroutineè¯»å–è¿™ä¸¤ä¸ªchannelï¼Œå¯¹æ¥æ”¶åˆ°çš„æ¶ˆæ¯msgAvailï¼Œåˆ™è°ƒç”¨<code>handler.handleMessage(in, errc)</code>å¤„ç†ã€‚æœ€å¤–å±‚<code>waitC</code>ç­‰å¾…ç»ˆæ­¢ä¿¡å·ï¼ŒæœŸé—´åŒ…å«å®šæœŸå‘é€çš„<code>pb.ChaincodeMessage_KEEPALIVE</code>ï¼Œç›´åˆ°é‡åˆ°æ¥æ”¶é”™è¯¯ç­‰æ‰ç»ˆæ­¢é€šä¿¡streamï¼Œè¿”å›å¼‚å¸¸ã€‚</li></ol><p>å†çœ‹peerç«¯çš„å¯¹ç­‰handleræ³¨å†Œã€‚ï¼ˆè¿™é‡Œæ˜¯chaincode/handler.goï¼‰è¿™éƒ¨åˆ†åœ¨<code>peer node start</code>å¯åŠ¨æ—¶å€™æ‰§è¡Œï¼Œæ³¨å†Œ<code>pb.ChaincodeSupportServer(chaincodeSupport)</code>ã€‚æ¯æ¬¡æ”¶åˆ°shim/handlerçš„registeræ–¹æ³•æ„å‘³ç€æ–°çš„<code>Register(&amp;chaincodeSupportRegisterServer{stream}</code>,ä¸€è·¯ä¸‹å»åœ¨<code>fabric/core/chaincode/chaincode_support#HandleChaincodeStream</code>é‡Œæ–°å»º<code>chaincode/handler</code>ï¼Œhandler.stateæ²¡æœ‰æ˜¾å¼è®¾ç½®åˆ™ä¸º0å€¼ï¼Œå³Createdã€‚ç„¶åè¿›å…¥ä¸»è¦æ–¹æ³•<code>chaincode/handler.ProcessStream</code>ã€‚è¿™æ–¹æ³•æµç¨‹è·Ÿä¸Šé¢çš„<code>chatWithPeer</code>éå¸¸ç›¸ä¼¼ï¼Œå¤šäº†ä¸»åŠ¨å‘èµ·KeepAliveï¼Œä»¥åŠåœ¨å¼‚å¸¸é€€å‡ºæ—¶å–æ¶ˆæ³¨å†Œhanlderã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œchaincodeå®¹å™¨ä¸peerå®¹å™¨å§‹ç»ˆå»ºç«‹è¿æ¥ã€‚hanlderä»steamé‡Œè¯»å–messageï¼Œç„¶å<code>handleMessage</code>ã€‚è¿™é‡Œå®é™…ä¸Šä¹Ÿå°±æ˜¯åœ¨<code>Handler.Registryï¼ˆå³ChaincodeSupport.HandlerRegistry)</code>é‡Œæ³¨å†Œè¯¥hanlderï¼Œè·Ÿä¸ŠèŠ‚ä»registryé‡Œé€šè¿‡chaincode.cnameæŸ¥æ‰¾hanlderå‘¼åº”ã€‚æ­¤å¤–ï¼Œåœ¨è¿™ä¸ªå¤„ç†è¿‡ç¨‹ä¸­ï¼Œpeerç›¸åº”çš„æ”¹å˜registryé‡Œhandlerçš„çŠ¶æ€ï¼Œç»™chaincodeå®¹å™¨å›å¤<code>&amp;pb.ChaincodeMessage{Type: pb.ChaincodeMessage_REGISTERED}</code>ã€‚ç„¶åï¼Œhandlerç½®æˆestablishedçŠ¶æ€ï¼Œå¯¹ç«¯çš„handleræ”¶åˆ°pb.ChaincodeMessage_REGISTEREDï¼Œä¹Ÿå°†çŠ¶æ€ç½®ä¸ºestablishedã€‚</p><p>chaincode/handleråœ¨ç½®æˆestablishedçŠ¶æ€åé©¬ä¸Šæ‰§è¡Œ<code>notifyRegistry</code>ï¼Œè¿™é‡Œä¸»è¦ä¸¤ä»¶äº‹æƒ…ï¼Œ1.å‘é€pb.ChaincodeMessage_READYï¼Œå¹¶ä¸”çŠ¶æ€æ”¹ä¸ºreadyï¼›2. é€šçŸ¥HandlerRegistryå·²å®Œæˆæ³¨å†Œï¼ˆå³ä»launchingé‡Œdeleteå½“å‰chaincodenameï¼Œå…³é—­LaunchState.done channelå¯ä»¥åˆ¤æ–­ä»¥å®Œæˆæ³¨å†Œï¼Œè¿™æ ·ï¼Œåœ¨<code>core/chaincode/runtime_launcher.go#start</code>é‡Œçš„<code>select {case &lt;-launchState.Done():</code>å¯ä»¥ç»§ç»­å¾€ä¸‹èµ°ï¼Œå› ä¸ºè¿™é‡Œè°ƒç”¨çš„<code>RuntimeLauncher.Runtime.Start</code>æ˜¯é€šè¿‡goroutineå¼‚æ­¥å¯åŠ¨çš„ï¼‰ï¼Œè¿™é‡Œä¸ä¸ŠèŠ‚ä»‹ç»å¯åŠ¨æ—¶æ³¨å†Œaunchingé˜²æ­¢é‡å¤éƒ¨ç½²å¯¹åº”ã€‚å¯¹ç«¯æ”¶åˆ°é€šçŸ¥åï¼Œä¹Ÿç½®çŠ¶æ€ä¸ºreadyã€‚è‡³æ­¤å®Œæˆäº†chaincodeçš„å¯åŠ¨å·¥ä½œï¼Œåç»­ä¸¤ç«¯handlerè¿›å…¥å¤„ç†Initï¼Invokeè¯·æ±‚æµç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode instantiate(3ï¼‰endorserçš„propocessProposalä¸»è¿‡ç¨‹</title>
      <link href="//articles/fabric-source-chaincode-instantiate-endorser-process-proposal/"/>
      <url>//articles/fabric-source-chaincode-instantiate-endorser-process-proposal/</url>
      
        <content type="html"><![CDATA[<p>ç”±peerçš„grpcè¯·æ±‚åˆ°<code>/protos.Endorser/ProcessProposal</code>ï¼Œåœ¨endorseré‡Œå¯¹åº”ç€<code>protos/peer/peer.pb.go#_Endorser_ProcessProposal_Handler</code>ï¼Œè¿›å…¥å¤„ç†æ–¹æ³•<code>core/endorser/endorser.go#ProcessProposal</code>ã€‚endorserçš„å¤„ç†è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼ŒpreProcess, simulateå’Œendorseã€‚å…¶ä¸­ï¼ŒpreProcessä¸»è¦åšæ ¡éªŒå·¥ä½œï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„çš„å®Œæ•´æ€§(header)ï¼Œå”¯ä¸€æ€§é˜²æ­¢é‡æ”¾æ”»å‡»ï¼Œæ ¡éªŒç­¾åï¼Œå¯¹application chaincodeï¼ˆä»¥åç®€ç§°accï¼‰æ£€æŸ¥ACLç­–ç•¥ç­‰ç­‰ã€‚è¿™éƒ¨åˆ†æ ¡éªŒæ¯”è¾ƒç›´è§‚å’Œç®€å•ï¼Œè¿™é‡Œä¸åšæ·±å…¥åˆ†æã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™é‡Œè¿˜è·å–äº†TXæ¨¡æ‹Ÿå™¨<code>txsim, err = e.s.GetTxSimulator(chainID, txid);</code>å’Œå†å²è¯·æ±‚æ‰§è¡Œå™¨<code>historyQueryExecutor, err = e.s.GetHistoryQueryExecutor(chainID);</code>ã€‚<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetTxSimulator returns the transaction simulator for the specified ledger</span></span><br><span class="line"><span class="comment">// a client may obtain more than one such simulator; they are made unique</span></span><br><span class="line"><span class="comment">// by way of the supplied txid</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SupportImpl)</span> <span class="title">GetTxSimulator</span><span class="params">(ledgername <span class="keyword">string</span>, txid <span class="keyword">string</span>)</span> <span class="params">(ledger.TxSimulator, error)</span></span> {</span><br><span class="line">    lgr := s.Peer.GetLedger(ledgername)</span><br><span class="line">    <span class="keyword">return</span> lgr.NewTxSimulator(txid)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewTxSimulator implements method in interface `txmgmt.TxMgr`</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(txmgr *LockBasedTxMgr)</span> <span class="title">NewTxSimulator</span><span class="params">(txid <span class="keyword">string</span>)</span> <span class="params">(ledger.TxSimulator, error)</span></span> {</span><br><span class="line">    s, err := newLockBasedTxSimulator(txmgr, txid)</span><br><span class="line">    txmgr.commitRWLock.RLock()</span><br><span class="line">    <span class="keyword">return</span> s, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>è¿™ä¸ªæ¨¡æ‹Ÿå™¨å’Œæ‰§è¡Œå™¨æ˜¯å¯¹åº”äºè´¦æœ¬ledgerçš„ï¼Œä¹Ÿå°±æ˜¯channelï¼Œå…¥å‚ledgernameå°±æ˜¯channelIdã€‚chainlessçš„proposalsçš„ledger.TxSimulatorå’Œledger.HistoryQueryExecutoréƒ½æ˜¯nilã€‚æ¨¡æ‹Ÿå™¨æ˜¯åŸºäºé”çš„ï¼Œåœ¨ç”Ÿæˆæ¨¡æ‹Ÿå™¨æ—¶ï¼ŒåŒæ—¶åŠ ä¸Šäº†è¯»é”ï¼Œåœ¨ä¸‹ä¸€é˜¶æ®µsimulateç»“æŸåå°±ç«‹å³é‡Šæ”¾ã€‚åŒæ—¶ï¼Œä¹Ÿç”Ÿæˆäº†å†å²æ•°æ®æŸ¥è¯¢å™¨ã€‚å…³äºè¿™ä¸ªé”ï¼Œä»£ç é‡Œæœ‰ä¸‹é¢ä¸€æ®µè§£é‡Šã€‚<p></p><blockquote><p>txsim acquires a shared lock on the stateDB. As this would impact the block commits (i.e., commit of valid write-sets to the stateDB), we must release the lock as early as possible. Hence, this txsim object is closed in simulateProposal() as soon as the tx is simulated and rwset is collected before gossip dissemination if required for privateData. </p></blockquote><span id="more"></span><p>æ¥ä¸‹æ¥ä¸»è¦åˆ†æsimulateè¿‡ç¨‹ã€‚åœ¨<code>endorser.SimulateProposal</code>è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å­˜åœ¨å¤šå¤„å¯¹å½“å‰chaincodeæ˜¯å¦System chaincodeç³»ç»Ÿé“¾ç çš„åˆ¤æ–­ã€‚ï¼ˆæ³¨æ„ï¼Œå½“å‰è¯·æ±‚channelæ˜¯lsccï¼‰åœ¨å½“å‰ç¯‡å¹…é‡Œä¸»è¦åˆ†æinstantiateçš„è¿‡ç¨‹ï¼Œå…¶ä»–çš„åˆ¤æ–­åˆ†æ”¯ä»¥åå†è¯¦è¿°ã€‚åœ¨<code>SimulateProposal</code>é‡Œï¼Œé¦–å…ˆåˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯sccï¼Œè¿™é‡Œæ˜¯lsccï¼Œè¿›å…¥åˆ†æ”¯è·å–<code>util.GetSysCCVersion()</code>ï¼Œsccçš„ç‰ˆæœ¬å›ºå®šä¸ºstringå¸¸é‡â€˜latestâ€™.<br>æ•´ä¸ªæµç¨‹æ–¹æ³•è°ƒç”¨é¡ºåºä¸º<code>SimulateProposal</code>-&gt;<code>endorser.callChaincode</code>-&gt;<code>endorser.support.Execute</code>-&gt;<code>endorser.support.ChaincodeSupport.Execute</code>-&gt;<code>ChaincodeSupport.Invoke</code>-&gt;<code>ChaincodeSupport.execute</code>-&gt;<code>cs.HandlerRegistry.Handler(cname).Execute</code><br>åœ¨è¿™é‡Œï¼Œé¦–å…ˆå…³é”®æ–¹æ³•æ˜¯<code>e.callChaincode</code><br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/ call specified chaincode (system or user)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Endorser)</span> <span class="title">callChaincode</span><span class="params">(ctxt context.Context, chainID <span class="keyword">string</span>, version <span class="keyword">string</span>, txid <span class="keyword">string</span>, signedProp *pb.SignedProposal, prop *pb.Proposal, cis *pb.ChaincodeInvocationSpec, cid *pb.ChaincodeID, txsim ledger.TxSimulator)</span> <span class="params">(*pb.Response, *pb.ChaincodeEvent, error)</span></span> {</span><br><span class="line">    ctxt = context.WithValue(ctxt, chaincode.TXSimulatorKey, txsim)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// is this a system chaincode</span></span><br><span class="line">    scc := e.s.IsSysCC(cid.Name)</span><br><span class="line">    res, ccevent, err = e.s.Execute(ctxt, chainID, cid.Name, version, txid, scc, signedProp, prop, cis)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ----- BEGIN -  SECTION THAT MAY NEED TO BE DONE IN LSCC ------</span></span><br><span class="line">    <span class="comment">// if this a call to deploy a chaincode, We need a mechanism</span></span><br><span class="line">    <span class="comment">// to pass TxSimulator into LSCC. Till that is worked out this</span></span><br><span class="line">    <span class="comment">// special code does the actual deploy, upgrade here so as to collect</span></span><br><span class="line">    <span class="comment">// all state under one TxSimulator</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// NOTE that if there's an error all simulation, including the chaincode table changes in lscc will be thrown away</span></span><br><span class="line">    <span class="keyword">if</span> cid.Name == <span class="string">"lscc"</span> &amp;&amp; <span class="built_in">len</span>(cis.ChaincodeSpec.Input.Args) &gt;= <span class="number">3</span> &amp;&amp; (<span class="keyword">string</span>(cis.ChaincodeSpec.Input.Args[<span class="number">0</span>]) == <span class="string">"deploy"</span> || <span class="keyword">string</span>(cis.ChaincodeSpec.Input.Args[<span class="number">0</span>]) == <span class="string">"upgrade"</span>) {</span><br><span class="line">        userCDS, err := putils.GetChaincodeDeploymentSpec(cis.ChaincodeSpec.Input.Args[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment">// this should not be a system chaincode</span></span><br><span class="line"></span><br><span class="line">        _, _, err = e.s.Execute(ctxt, chainID, cds.ChaincodeSpec.ChaincodeId.Name, cds.ChaincodeSpec.ChaincodeId.Version, txid, <span class="literal">false</span>, signedProp, prop, cds)</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ----- END -------</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res, ccevent, err</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>æ­¤å¤„å°†æ¨¡æ‹Ÿå™¨<code>txsim</code>åŠ å…¥contextã€‚æ­¤å¤„å­˜åœ¨ä¸¤æ¬¡è°ƒç”¨<code>endorser.support.Execute</code>.ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ˜¯å¤–å±‚çš„<code>ChaincodeInvokeSpec</code>cisã€‚åœ¨<code>endorser.support.Execute</code>é‡Œå…ˆæ„å»º<code>ccprovider.NewCCContext</code>ï¼ˆcccidï¼‰ï¼Œè¿™é‡Œçš„<code>cccid.canonicalName</code>è®¾ç½®ä¸º<code>name + ":" + version</code>ï¼Œå³lscc:latestã€‚ç„¶åè·å–ç³»ç»Ÿå®šä¹‰çš„<code>decorator</code>ï¼Œè¿™ä¸ªæ˜¯åœ¨nodeå¯åŠ¨æ—¶<code>peer/node.go#Serve</code>é‡Œåˆå§‹åŒ–çš„ï¼Œä»é…ç½®æ–‡ä»¶<code>core.yaml</code>é‡Œè¯»å–é…ç½®ã€‚é…ç½®æ–‡ä»¶é‡Œçš„å®šä¹‰:â€append or mutate the chaincode input passed to the chaincodeâ€. <code>library: /opt/lib/decorator.so</code>ã€‚è¿™é‡Œå°†decoratorä½œç”¨äºæ­¤cisã€‚ä¸‹ä¸€æ­¥å°±æ˜¯è°ƒç”¨<code>ChaincodeSupport.Execute</code>ã€‚<br><code>ChaincodeSupport.Execute</code>å…ˆæ‰§è¡Œ<code>ChaincodeSupport.Invoke</code>ã€‚åœ¨invokeæ–¹æ³•é‡Œï¼Œå…ˆæ‰§è¡Œ<code>cs.Launch(ctxt, cccid, spec)</code>ã€‚è¿™é‡Œæ‰§è¡Œçš„chaincodeæ˜¯lsccï¼Œç³»ç»Ÿé“¾ç å·²ç»åœ¨å¯åŠ¨é˜¶æ®µlaunchçŠ¶æ€ä¸ºrunningäº†ï¼Œè¿™ä¸ªåœ¨åé¢ä¼šè¯´åˆ°ï¼Œå› æ­¤ç›´æ¥è¿”å›åˆ°<code>ChaincodeSupport.Invoke</code>ã€‚ç„¶åç”¨<code>chaincodeSpec.Input</code>(è¿™é‡Œå…¶å®æ˜¯<code>["deploy", "${channelId}", "${chaincodDeploySpec}"]</code>)æ„å»º<code>pb.ChaincodeMessage</code>ï¼Œè¿›å…¥åˆ°<code>Chaincode.execute</code>æ–¹æ³•æ‰§è¡Œ<code>cs.execute(ctxt, cccid, ccMsg)</code>ã€‚è¿™é‡Œçš„<code>pb.ChaincodeMessage</code>ç±»å‹ä¸º<code>pb.ChaincodeMessage_TRANSACTION</code>(cis).<p></p><blockquote><p>Launch starts executing chaincode if it is not already running. This method blocks until the peer side handler gets into ready state or encounters a fatal error. If the chaincode is already running, it simply returns.  </p></blockquote><p>ä¸‹é¢æ˜¯ä¸‰ä¸ªå…¥å‚çš„ç»“æ„<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ctx = context.WithValue(ctx, chaincode.HistoryQueryExecutorKey, historyQueryExecutor)</span><br><span class="line">ctxt = context.WithValue(ctxt, chaincode.TXSimulatorKey, txsim)</span><br><span class="line"></span><br><span class="line">cccid := &amp;CCContext{</span><br><span class="line">    ChainID:             cname,<span class="comment">// channelID</span></span><br><span class="line">    Name:                name,<span class="comment">// ChaincodeID.name (lscc)</span></span><br><span class="line">    Version:             version,<span class="comment">// metadata.Version (latest)</span></span><br><span class="line">    TxID:                txid,</span><br><span class="line">    Syscc:               syscc,<span class="comment">// is this a system chaincode (true)</span></span><br><span class="line">    SignedProposal:      signedProp,</span><br><span class="line">    Proposal:            prop,</span><br><span class="line">    canonicalName:       name + <span class="string">":"</span> + version,</span><br><span class="line">    ProposalDecorations: <span class="literal">nil</span>,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">ccmsg := &amp;pb.ChaincodeMessage{</span><br><span class="line">    Type:      messageType,<span class="comment">// pb.ChaincodeMessage_TRANSACTION</span></span><br><span class="line">    Payload:   payload,<span class="comment">// chaincodeSpec.Input (cis.cs.Input)</span></span><br><span class="line">    Txid:      txid,</span><br><span class="line">    ChannelId: cid,</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>åœ¨<code>ChaincodeSupport.execute</code>å…ˆåˆ¤æ–­å¤„ç†å½“å‰chaincodeï¼ˆæ ¹æ®canonicalNameåŒºåˆ†,lscc:latestï¼‰çš„handleræ˜¯å¦å·²ç»æ³¨å†Œï¼Œè¿™ä¸ªhandleræ³¨å†Œçš„è¿‡ç¨‹åé¢ä»‹ç»ã€‚ç„¶åè·å–è¿™ä¸ªhandleræ‰§è¡Œã€‚<br><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">Execute</span><span class="params">(ctxt context.Context, cccid *ccprovider.CCContext, msg *pb.ChaincodeMessage, timeout time.Duration)</span> <span class="params">(*pb.ChaincodeMessage, error)</span></span> {</span><br><span class="line">    txctx, err := h.TXContexts.Create(ctxt, msg.ChannelId, msg.Txid, cccid.SignedProposal, cccid.Proposal)</span><br><span class="line">    <span class="keyword">defer</span> h.TXContexts.Delete(msg.ChannelId, msg.Txid)</span><br><span class="line"></span><br><span class="line">    h.setChaincodeProposal(cccid.SignedProposal, cccid.Proposal, msg)</span><br><span class="line"></span><br><span class="line">    h.serialSendAsync(msg, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ccresp *pb.ChaincodeMessage</span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> ccresp = &lt;-txctx.ResponseNotifier:</span><br><span class="line">        <span class="comment">// response is sent to user or calling chaincode. ChaincodeMessage_ERROR are typically treated as error</span></span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(timeout):</span><br><span class="line">        err = errors.New(<span class="string">"timeout expired while executing transaction"</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ccresp, err</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// serialSendAsync serves the same purpose as serialSend (serialize msgs so gRPC will be happy). In addition, it is also asynchronous so send-remoterecv--localrecv loop can be nonblocking. Only errors need to be handled and these are handled by communication on supplied error channel. A typical use will be a non-blocking or nil channel</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">serialSendAsync</span><span class="params">(msg *pb.ChaincodeMessage, sendErr <span class="keyword">bool</span>)</span></span> {</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">if</span> err := h.serialSend(msg); err != <span class="literal">nil</span> {</span><br><span class="line">            <span class="keyword">if</span> sendErr {</span><br><span class="line">                <span class="comment">// provide an error response to the caller</span></span><br><span class="line">                h.Notify(resp)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">Notify</span><span class="params">(msg *pb.ChaincodeMessage)</span></span> {</span><br><span class="line">tctx := h.TXContexts.Get(msg.ChannelId, msg.Txid)</span><br><span class="line">tctx.ResponseNotifier &lt;- msg</span><br><span class="line">tctx.CloseQueryIterators()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// serialSend serializes msgs so gRPC will be happy</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">serialSend</span><span class="params">(msg *pb.ChaincodeMessage)</span> <span class="title">error</span></span> {</span><br><span class="line">h.serialLock.Lock()</span><br><span class="line"><span class="keyword">defer</span> h.serialLock.Unlock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := h.chatStream.Send(msg); err != <span class="literal">nil</span> {}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><ol><li>æ„é€ <code>TransactionContext</code>,å…¶ä¸­æœ‰ä¸ªå‚æ•°ä¸º<code>ResponseNotifier: make(chan *pb.ChaincodeMessage, 1),</code>ç”¨ä»¥å¼‚æ­¥æ‰§è¡Œæ—¶æ¥æ”¶ç»“æœã€‚æ„é€ å‰å…ˆåˆ¤æ–­channelIDå’ŒtxIdçš„ç»„åˆæ˜¯å¦å·²å­˜åœ¨ï¼Œæ„é€ è¿‡ç¨‹åŠ é”ï¼Œé¿å…é‡å¤å¤„ç†ã€‚</li><li><code>core/chaincode/handler.go#serialSendAsync</code>å¼‚æ­¥å¤„ç†ï¼Œå®é™…ä¸Šå³å¯ç”¨go routineè°ƒç”¨<code>handler#serialSend</code>ï¼Œä½¿ç”¨handler.chatStreamå‘é€ï¼Œæ­¤å¤„ä¹Ÿæ˜¯grpcè°ƒç”¨ã€‚é”™è¯¯ä»¥åŠç»“æœéƒ½å‘é€åˆ°<code>txctx.ResponseNotifie</code>è¿™ä¸ªchanå†…(rpcç»“æœé€šè¿‡è°ƒç”¨<code>handler#Notify</code>)ã€‚ç”±äºæ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œå‡½æ•°ç«‹å³è¿”å›ï¼Œå¤„ç†ç»“æœåœ¨å¤–å±‚<code>handler.Execute</code>ç­‰å¾…ä»è¿™ä¸ªchanè¯»å–æ•°æ®ï¼Œè¿™é‡Œä¹ŸåŠ ä¸Šäº†è¶…æ—¶çš„æœºåˆ¶ã€‚è¿™é‡Œçš„lsccçš„è°ƒç”¨åé¢å†åˆ†æã€‚</li></ol><p>å¦‚æœè¿™é‡Œè°ƒç”¨ä¸€åˆ‡æ­£å¸¸ï¼Œæµç¨‹å°†é€€å›åˆ°<code>callChaincode</code>ç»§ç»­å¾€ä¸‹èµ°,ç„¶åæ»¡è¶³â€œlsccâ€ï¼Œå‚æ•°ä¸ºâ€œdeployâ€çš„æ¡ä»¶ï¼Œæ‰€ä»¥ä»cisé‡Œçš„Inputå‚æ•°è·å–cdså¹¶ååºåˆ—åŒ–æˆ<code>ChaincodeDeploymentSpec</code>å¯¹è±¡ï¼Œé‡å¤åˆšæ‰çš„æ­¥éª¤ã€‚è¿™é‡Œç¨å¾®æœ‰äº›ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„<code>pb.ChaincodeMessage</code>ç±»å‹ä¸º<code>pb.ChaincodeMessage_INIT</code>(cds)ï¼Œå¹¶ä¸”è¿™ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„application chaincodeéœ€è¦launchã€‚<br></p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Launch starts executing chaincode if it is not already running. This method</span></span><br><span class="line"><span class="comment">// blocks until the peer side handler gets into ready state or encounters a fatal</span></span><br><span class="line"><span class="comment">// error. If the chaincode is already running, it simply returns.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cs *ChaincodeSupport)</span> <span class="title">Launch</span><span class="params">(ctx context.Context, cccid *ccprovider.CCContext, spec ccprovider.ChaincodeSpecGetter)</span> <span class="title">error</span></span> {</span><br><span class="line">    cname := cccid.GetCanonicalName()</span><br><span class="line">    <span class="keyword">if</span> cs.HandlerRegistry.Handler(cname) != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// UserRunsCCå€¼ä¸€ç›´å›æº¯åˆ° node.start#registerChaincodeSupport é‡Œçš„ userRunsCC := chaincode.IsDevMode()</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå€¼å®é™…ä¸Šæ˜¯é…ç½®æ–‡ä»¶ core.yaml é‡Œçš„ peer.mode : netï¼Œé…ç½®æ–‡ä»¶çš„æè¿°å¦‚ä¸‹</span></span><br><span class="line">    <span class="comment">//  # In dev mode, user runs the chaincode after starting peer from command line on local machine.</span></span><br><span class="line">    <span class="comment">//  # In net mode, peer will run chaincode in a docker container.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cs.UserRunsCC &amp;&amp; !cccid.Syscc {</span><br><span class="line">        chaincodeLogger.Error(</span><br><span class="line">            <span class="string">"You are attempting to perform an action other than Deploy on Chaincode that is not ready and you are in developer mode."</span>,</span><br><span class="line">        )</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The only user of this context value is the in-process controller used to support system chaincode. </span></span><br><span class="line">    <span class="comment">// contextåŠ å…¥â€œCCHANDLERâ€ : ChaincodeSupport</span></span><br><span class="line">    ctx = context.WithValue(ctx, ccintf.GetCCHandlerKey(), cs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cs.Launcher.Launch(ctx, cccid, spec)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// core/chaincode/runtime_launcher.go</span></span><br><span class="line"><span class="comment">// Launch chaincode with the appropriate runtime.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RuntimeLauncher)</span> <span class="title">Launch</span><span class="params">(ctx context.Context, cccid *ccprovider.CCContext, spec ccprovider.ChaincodeSpecGetter)</span> <span class="title">error</span></span> {</span><br><span class="line">    chaincodeID := spec.GetChaincodeSpec().ChaincodeId</span><br><span class="line">    cds, _ := spec.(*pb.ChaincodeDeploymentSpec)</span><br><span class="line">    <span class="keyword">if</span> cds == <span class="literal">nil</span> {</span><br><span class="line">        cds, err = r.getDeploymentSpec(ctx, cccid, chaincodeID)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cds.CodePackage == <span class="literal">nil</span> &amp;&amp; cds.ExecEnv != pb.ChaincodeDeploymentSpec_SYSTEM {</span><br><span class="line">        ccpack, err := r.PackageProvider.GetChaincode(chaincodeID.Name, chaincodeID.Version)</span><br><span class="line">        cds = ccpack.GetDepSpec()</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    err := r.start(ctx, cccid, cds)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><br>è¿™é‡Œéœ€è¦éƒ¨ç½²chaincodeéœ€è¦ä»£ç codeï¼Œåœ¨instantiateçš„cdsé‡Œå‚æ•°<code>CodePackage</code>ä¸ºnil,åŒæ—¶<code>ExecEnv</code>=<code>pb.ChaincodeDeploymentSpec_DOCKER</code>ã€‚è¿™é‡Œæ˜¯é€šè¿‡<code>r.PackageProvider.GetChaincode(chaincodeID.Name, chaincodeID.Version)</code>è·å–å…·ä½“çš„ä»£ç ï¼Œå®é™…ä¸Šæ˜¯<code>core/common/ccprovider/ccprovider.go#GetChaincodeFromPath</code>ä»æœ¬åœ°è·¯å¾„è·å–ï¼Œè€Œè¿™äº›codeæ˜¯åœ¨<code>peer chaincode install</code>æ—¶ç”±lsccæ”¾åˆ°æœ¬åœ°ç›®å½•ä¸‹ï¼Œåœ¨<code>instantiate</code>æ—¶æŒ‰ç…§chaincodeNameå’ŒchaincodeVersionå–å‡ºã€‚è¿™é‡Œçš„pathä¸º<code>chaincodeInstallPath</code>,è¿™ä¸ªæ˜¯peerå¯åŠ¨æ—¶ä»é…ç½®æ–‡ä»¶<code>core.yaml</code>é‡Œè¯»å–çš„ï¼Œé…ç½®é¡¹ä¸º<code>peer.fileSystemPath</code>.<p></p><p>ç„¶åæ‰§è¡Œ<code>r.start(ctx, cccid, cds)</code>ç”¨è¿™éƒ¨åˆ†ä»£ç å¯åŠ¨ã€‚<code>HandlerRegistry.Launching(cname)</code>å…ˆæ³¨å†ŒlaunchingçŠ¶æ€ï¼Œé˜²æ­¢è¢«é‡å¤éƒ¨ç½²ã€‚æ¥ç€å¯åŠ¨go routineæ‰§è¡Œ<code>r.Runtime.Start(ctx, cccid, cds)</code>ã€‚è¿™é‡Œé¦–å…ˆè·å–å®¹å™¨å¯åŠ¨å‚æ•°è®¾ç½®ï¼Œç¯å¢ƒå˜é‡ç­‰é…ç½®ï¼Œè¿™äº›é…ç½®å°†ä½œç”¨äºåç»­å¯åŠ¨çš„å®¹å™¨ã€‚è¿™é‡Œéœ€è¦ç•™æ„çš„æ˜¯ï¼Œè®¾ç½®äº†<code>lc.Args = []string{"chaincode", fmt.Sprintf("-peer.address=%s", c.PeerAddress)}</code>ï¼Œè¿™é‡Œæ˜¯chaincodeå®¹å™¨å¯åŠ¨çš„æ‰§è¡Œå‘½ä»¤ã€‚ç„¶åæ ¹æ®cdsçš„ExecEnvè®¾ç½®é€‰æ‹©å®¹å™¨ç±»å‹ï¼Œè¿™é‡Œå…±æœ‰ä¸¤ç§ç±»å‹ï¼ŒSYSTEMå’ŒDOCKERï¼Œç”¨æˆ·å®šä¹‰çš„chaincodeæ˜¯å¯åŠ¨åœ¨dockerå®¹å™¨é‡Œçš„ã€‚ç„¶åå¼€å§‹å¯åŠ¨å®¹å™¨çš„æ­¥éª¤<code>c.Processor.Process(ctxt, vmtype, scr);</code>ã€‚å…ˆå¯¹å®¹å™¨ååŠ é”<code>vmc.lockContainer(ccid.GetName())</code>é˜²æ­¢åŒæ—¶æ‰§è¡Œåˆ›å»ºå®¹å™¨æ“ä½œï¼Œç„¶åæ‰§è¡Œ<code>container.StartContainerReq</code>çš„<code>Do</code>æ–¹æ³•ã€‚è¿™é‡Œçš„<code>dockercontroller.Start</code>æ–¹æ³•æ˜¯çœŸæ­£åˆ›å»ºå®¹å™¨çš„åœ°æ–¹ã€‚</p><ol><li>æ„é€ é•œåƒåï¼ˆéœ€è¦ä¿è¯å”¯ä¸€æ€§ï¼‰å’Œå®¹å™¨åï¼Œåœæ­¢é‡åçš„å®¹å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼Œstop,kill,removeï¼‰ï¼Œç„¶åä½¿ç”¨è¯¥é•œåƒåˆ›å»ºå®¹å™¨ã€‚åˆ›å»ºè¿‡ç¨‹é‡åˆ°<code>err == docker.ErrNoSuchImage</code>ï¼Œäº‹å®ä¸Šè¿™æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºè¦ä¿è¯æ˜¯ç¬¬ä¸€æ¬¡éƒ¨ç½²ï¼Œå½“å‰ç¯å¢ƒæ²¡æœ‰è¯¥é•œåƒã€‚å…¥å‚æä¾›äº†<code>container.Builder</code>ï¼Œæ­¤å¤„å°è¯•é‡æ–°æ„å»ºå’Œéƒ¨ç½²é•œåƒï¼Œç„¶åé‡æ–°åˆ›å»ºå®¹å™¨ã€‚å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œåˆ™æ’é™¤äº†é•œåƒä¸å­˜åœ¨çš„é”™è¯¯åŸå› ï¼Œç›´æ¥è¿”å›é”™è¯¯ç»“æœã€‚</li><li>è¿™é‡Œï¼Œå­˜åœ¨<code>attachStdout := viper.GetBool("vm.docker.attachStdout")</code>è¿™ä¸ªé…ç½®ï¼Œå°†å®¹å™¨çš„è¾“å‡ºç›´æ¥åˆ°æ§åˆ¶å°ï¼Œæ–¹ä¾¿å¼€å‘è°ƒè¯•ã€‚</li><li>å°†éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ä¼ åˆ°å®¹å™¨é‡Œï¼Œè¿™é‡Œçš„æ–‡ä»¶æ˜¯å„ç§é…ç½®ï¼Œä¾‹å¦‚TLSçš„keyå’Œcertã€‚</li><li>ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“fsouza/go-dockerclientæ¥å¯åŠ¨dockerå®¹å™¨<code>err = client.StartContainer(containerName, nil)</code>.</li><li>ç”±äºå¯åŠ¨å®¹å™¨æ˜¯å¼‚æ­¥æ“ä½œï¼Œé©¬ä¸Šè¿”å›åˆ°<code>runtime_launcher.start</code>ï¼Œè¿™é‡Œæ˜¯<code>select-cast</code>,ç­‰å¾…å¯åŠ¨å®Œæˆçš„chanä¿¡å·ï¼Œæˆ–è€…å¼‚å¸¸ï¼Œæˆ–è€…è¶…æ—¶ã€‚å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œåˆ™åœæ­¢å®¹å™¨ï¼Œå–æ¶ˆæ³¨å†Œ<code>RuntimeLauncher.Registry</code>é‡Œåˆ°handlerä»¥åŠlaunchStateçŠ¶æ€ã€‚</li></ol><p>åœ¨<code>core/container/dockercontroller/dockercontroller.go:preFormatImageName</code>å®šä¹‰äº†dockeré•œåƒå’Œå®¹å™¨åï¼Œå…¶ä¸­ï¼Œé•œåƒåä¸º<code>${NetworkID}-${PeerId}-${ChaincodeName}-${Version}-${Hash}</code>ï¼Œå®¹å™¨åä¸º<code>${NetworkID}-${PeerId}-${ChaincodeName}-${Version}</code>ï¼Œå…¶ä¸­NetworkIDä»é…ç½®æ–‡ä»¶core.ymlé‡Œçš„<code>peer.NetworkId</code>é…ç½®é¡¹ã€‚</p><p><em>è¿™éƒ¨åˆ†dockerç›¸å…³æ¯”è¾ƒç¹çï¼Œæš‚æ—¶æ²¡æœ‰æ—¶é—´ç²¾åŠ›æ·±å…¥å­¦ä¹ å’Œåˆ†ææºç ï¼Œå¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/idsuf698987/article/details/78353481">fabricæºç è§£æ20â€”â€”ACCçš„éƒ¨ç½²</a></em></p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode instantiate(2) peerç«¯çš„è°ƒç”¨æµç¨‹</title>
      <link href="//articles/fabric-source-chaincode-instantiate-peer/"/>
      <url>//articles/fabric-source-chaincode-instantiate-peer/</url>
      
        <content type="html"><![CDATA[<p>æ¥ä¸‹æ¥å…·ä½“æ‰§è¡Œ<code>env, err := instantiate(cmd, cf)</code>ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°å…¥å‚æ˜¯<code>cobra.Command</code>å’Œåˆšåˆšåˆå§‹åŒ–çš„<code>ChaincodeCmdFactory</code>,ç»“æœæ˜¯æäº¤ç»™Ordererçš„Envelope message<code>protos/common.Envelope</code>.</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//instantiate the command via Endorser</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">instantiate</span><span class="params">(cmd *cobra.Command, cf *ChaincodeCmdFactory)</span> <span class="params">(*protcommon.Envelope, error)</span></span> {</span><br><span class="line"></span><br><span class="line">    spec, err := getChaincodeSpec(cmd)</span><br><span class="line">    cds, err := getChaincodeDeploymentSpec(spec, <span class="literal">false</span>)</span><br><span class="line">    creator, err := cf.Signer.Serialize()   </span><br><span class="line">    prop, _, err := utils.CreateDeployProposalFromCDS(channelID, cds, creator, policyMarshalled, []<span class="keyword">byte</span>(escc), []<span class="keyword">byte</span>(vscc), collectionConfigBytes)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> signedProp *pb.SignedProposal</span><br><span class="line">    signedProp, err = utils.GetSignedProposal(prop, cf.Signer)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// instantiate is currently only supported for one peer</span></span><br><span class="line">    proposalResponse, err := cf.EndorserClients[<span class="number">0</span>].ProcessProposal(context.Background(), signedProp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> proposalResponse != <span class="literal">nil</span> {</span><br><span class="line">        <span class="comment">// assemble a signed transaction (it's an Envelope message)</span></span><br><span class="line">        env, err := utils.CreateSignedTx(prop, cf.Signer, proposalResponse)</span><br><span class="line">        <span class="keyword">return</span> env, <span class="literal">nil</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol><li><code>getChaincodeSpec</code>å’Œ<code>getChaincodeDeploymentSpec</code>ä»æäº¤çš„commandé‡Œè·å–ç›¸åº”çš„å‚æ•°ï¼Œæ£€æŸ¥ä»¥åŠè®¾ç½®å‚æ•°ï¼ˆä¾‹å¦‚æ˜¯å¦æŒ‡å®šescc(endorsement system chaincode), vscc(verification system chaincode), ConstructorJSON æ„é€ å‚æ•°ï¼‰ï¼Œè¿›è€Œæ„é€ chaincodeæè¿°ç»“æ„ä½“<code>pb.ChaincodeSpec</code>å’Œéƒ¨ç½²ç»“æ„ä½“<code>pb.ChaincodeDeploymentSpec</code>ã€‚<br><code>pb.ChaincodeSpec</code>(cs)é‡ŒæŒ‡å®šäº†<code>ChaincodeSpec_Type</code>è¯­è¨€ç±»å‹ï¼Œé»˜è®¤ä¸ºgoï¼Œ<code>ChaincodeID</code>ï¼Œchaincodeçš„æ ‡è¯†ï¼ˆåŒ…æ‹¬è·¯å¾„Pathï¼Œåç§°Nameï¼Œç‰ˆæœ¬Versionï¼‰ï¼Œä»¥åŠInputï¼ˆå³ConstructorJSON æ„é€ å‚æ•°ï¼Œåˆå§‹åŒ–çš„å€¼ï¼Œå‘½ä»¤è¡Œé‡Œ-cå‚æ•°å€¼ï¼Œä¾‹å­é‡Œçš„â€™{â€œArgsâ€:[â€œinitâ€,â€aâ€, â€œ100â€, â€œbâ€,â€200â€]}â€™ï¼‰ã€‚<br><code>pb.ChaincodeDeploymentSpec</code>(cds)é‡ŒåŒ…è£¹<code>ChaincodeSpec</code>ï¼Œä»¥åŠ<code>CodePackage</code>ï¼Œæ‰“åŒ…åç”¨äºå®‰è£…éƒ¨ç½²çš„ä»£ç ï¼Œ<code>ExecEnv</code>ï¼ŒæŒ‡å®šè¿è¡ŒäºåŒä¸€ç³»ç»Ÿä¸­æˆ–è€…dockerå®¹å™¨ã€‚<code>getChaincodeDeploymentSpec</code>å…¥å‚åŒºåˆ†æ˜¯å¦å½“å‰æ˜¯devå¼€å‘æ¨¡å¼ï¼Œè€Œä¸”æ˜¯å¦éœ€è¦æ„é€ CodePackageã€‚æ„é€ æ‰“åŒ…æ˜¯åœ¨installå®‰è£…æ—¶è¿›è¡Œçš„ï¼Œåé¢åˆ†æinstallæ—¶è¯¦è¿°ã€‚</li></ol><span id="more"></span><ol><li><p><code>CreateDeployProposalFromCDS</code>ä»ä¸Šé¢æ„é€ çš„éƒ¨ç½²ç»“æ„ä½“å¾—åˆ°<code>peer.ChaincodeInvocationSpec</code>(cis),è¿›è€Œå¾—åˆ°<code>peer.Proposal</code>,ç„¶åä½¿ç”¨åˆå§‹åŒ–æ—¶å€™å¾—åˆ°çš„signerå¯¹è¿™ä¸ªææ¡ˆè¿›è¡Œç­¾åï¼Œè¿™ä¸ªæ­¥éª¤ä¸åˆå§‹åŒ–æ—¶å€™éå¸¸ç›¸ä¼¼ã€‚</p><blockquote><p>Transactionçš„ç»“æ„å¯ä»¥å‚çœ‹æ€»ç»“<a href="https://blockchain-fabric.blogspot.com/2017/04/hyperledger-fabric-v10-block-structure.html">Hyperledger Fabric V1.0: Block Structure</a> </p></blockquote><p><code>pb.ChaincodeInvokeSpec</code>(cis)é‡ŒæŒ‡å®š<code>Type</code>ä¸ºgolangï¼Œ<code>ChaincodeID</code>æŒ‡å®šä¸ºlsccï¼ˆlifecycle system chaincodeï¼‰ï¼Œç„¶åå°†ä¸Šé¢æ„é€ çš„cdsåºåˆ—åŒ–åœ¨[]byteä½œä¸º<code>Input</code>å­—æ®µã€‚<br><code>CreateDeployProposalFromCDS</code>è¿™ä¸ªæ–¹æ³•ä»éƒ¨ç½²ç»“æ„ä½“cdså‡ºå‘ï¼Œç”Ÿæˆéšæœºå­—ç¬¦ä¸²<code>NONCE</code>ï¼Œä½¿ç”¨ç­¾åç”Ÿæˆ<code>ProposalTxID</code>; æŒ‡å®šç±»å‹<code>Type</code>ä¸º<code>HeaderType_ENDORSER_TRANSACTION</code>(æ­¤å¤„å¤šè¡¥å……ä¸€å¥ï¼Œåˆå§‹åŒ–æ—¶è·å–é…ç½®çš„ç±»å‹ä¸º<code>HeaderType_CONFIG</code>),æŒ‡å®š<code>channelId</code>ï¼Œ<code>chaincodeID</code>(åŒ…æ‹¬chaincodeçš„versionï¼Œpathï¼Œname)ã€‚è¿™é‡Œçš„<code>chaincodeID</code>æ˜¯æ„é€ çš„<code>peer.ChaincodeInvocationSpec</code>çš„å‚æ•°ï¼ŒæŒ‡å®šäº†Nameä¸ºlsccï¼Œlifecycle systme chaincodeã€‚æ­¤å¤–ï¼Œè¿˜æœ‰åˆå§‹åŒ–è¿‡ç¨‹MSPè·å–çš„<code>creator</code>(å³åºåˆ—åŒ–åçš„signer)è¡¨æ˜èº«ä»½ä»¥åŠåˆ›å»ºæ—¶é—´<code>Timestamp</code>ç­‰ã€‚è¿™äº›æ„æˆäº†transactionçš„header,è¿åŒåºåˆ—åŒ–åçš„<code>ChaincodeInvocationSpec</code>å¯¹è±¡ä½œä¸ºpayload,å…±åŒç»„æˆäº†<code>peer.Proposal{Header: hdrBytes, Payload: ccPropPayloadBytes}</code>.æœ€åä½¿ç”¨signerè¿›è¡Œç­¾åã€‚</p></li><li><p>rpcè°ƒç”¨ã€‚åˆå§‹åŒ–æ—¶å€™æ„å»ºäº†endorser clientç»„ï¼ˆå®é™…ä¸Šinstantiateåªå…è®¸æœ‰ä¸€ä¸ªï¼‰ã€‚ä½¿ç”¨è¯¥clientå‘é€è¯·æ±‚<code>grpc.Invoke(ctx, "/protos.Endorser/ProcessProposal", in, out, c.cc, opts...)</code>ï¼Œè¿™é‡Œctxä¼ å…¥äº†golangçš„<code>context.Background()</code>ï¼Œåé¢çš„rpcè°ƒç”¨æ´¾ç”Ÿè‡ªè¯¥é¡¶å±‚contextã€‚æœåŠ¡ç«¯çš„å¤„ç†åé¢å†è¯¦è¿°ã€‚æ³¨æ„è¿™é‡Œæ˜¯åŒæ­¥è°ƒç”¨ã€‚endorser rpcçš„æ•°æ®ç»“æ„<code>SignedProposal</code>å¦‚ä¸‹</p></li></ol><pre><code class="lang-json">// peer.SignedProposal:{    "ProposalBytes": "${propBytes}",     "Signature": "${signature}" // signature, err := signer.Sign(propBytes)}// peer.Proposal : {    "Header": "${hdrBytes}",     "Payload": "${ccPropPayloadBytes}"}// common.Header(hdrBytes) :{    "ChannelHeader" : { // common.ChannelHeader        "Type" : "HeaderType_ENDORSER_TRANSACTION", // common.HeaderType        "TxId" : "#ComputeProposalTxID(nonce, creator)",        "Timestamp": "timestamp",   // util.CreateUtcTimestamp()        "ChannelId": "${chainID}",         "Extension": "${ccHdrExtBytes}",        "Epoch":     "epoch" // always 0    },    "SignatureHeader" : {   // common.SignatureHeader        "Nonce": "nonce",   // nonce, err := crypto.GetRandomNonce()        "Creator": "creator"  // creator, err := cf.Signer.Serialize()    }}// peer.ChaincodeProposalPayload(ccPropPayload){    "Input": "cisBytes",    "TransientMap": nil}// peer.ChaincodeHeaderExtension(ccHdrExtBytes) :{    "ChaincodeId" : "${cis.ChaincodeSpec.ChaincodeId}"}// peer.ChaincodeInvokeSpec(cis){    "ChaincodeInvokeSpec" : {        "ChaincodeSpec" : { // pb.ChaincodeSpec            "Type" : "ChaincodeSpec_GOLANG",            "ChaincodeId" : {                "Name" : "lscc"            },            "Input" : {                "Args" : ["deploy", "${channelId}", "${chaincodDeploySpec}"]            }            }    }}// pb.chaincodDeploySpec(cds){    "ChaincodeSpec": {        "Type" : "ChaincodeSpec_GOLANG",        "ChaincodeId" : {            "Path" : "${chaincodePath}",            "Name" : "${chaincodeName}",            "Version" : "${chaincodeVersion}"        },        "Input" : {            "Args" : ["init","a", "100", "b","200"]        }       },    "CodePackage": nil}</code></pre><ol><li>æ”¶é›†endorserçš„responseï¼Œç„¶åæ„å»ºç­¾ååçš„transactionã€‚ä¸‹é¢çš„æ–¹æ³•æ˜¯æ™®é€‚çš„ã€‚</li></ol><pre><code class="lang-go">// CreateSignedTx assembles an Envelope message from proposal, endorsements, and a signer.// This function should be called by a client when it has collected enough endorsements// for a proposal to create a transaction and submit it to peers for orderingfunc CreateSignedTx(proposal *peer.Proposal, signer msp.SigningIdentity, resps ...*peer.ProposalResponse) (*common.Envelope, error) {    // the original header    hdr, err := GetHeader(proposal.Header)    // the original payload    pPayl, err := GetChaincodeProposalPayload(proposal.Payload)    shdr, err := GetSignatureHeader(hdr.SignatureHeader)    // get header extensions so we have the visibility field    hdrExt, err := GetChaincodeHeaderExtension(hdr)    // ensure that all actions are bitwise equal and that they are successful     // æ¯”è¾ƒæ‰€æœ‰çš„responseè¿”å›çš„ç»“æœæ˜¯ä¸€è‡´çš„    var a1 []byte    for n, r := range resps {        if n == 0 {            a1 = r.Payload            if r.Response.Status != 200 {                return nil, fmt.Errorf("Proposal response was not successful, error code %d, msg %s", r.Response.Status, r.Response.Message)            }            continue        }        if bytes.Compare(a1, r.Payload) != 0 {            return nil, fmt.Errorf("ProposalResponsePayloads do not match")        }    }    // fill endorsements    endorsements := make([]*peer.Endorsement, len(resps))    for n, r := range resps {        endorsements[n] = r.Endorsement    }    // æ„é€ å„çº§æ•°æ®ç»“æ„å¹¶åºåˆ—åŒ–ï¼ŒåŒ…å«åŸå§‹çš„proposalçš„payloadï¼Œheaderç­‰ä¿¡æ¯ï¼Œ    // ä»¥åŠrepsponseçš„payloadï¼Œå„ä¸ªrespç›¸åº”çš„endorsementï¼Œ    // æ„é€ äº†æ–°çš„peer.Transactionï¼Œç„¶åä½¿ç”¨signerè¿›è¡Œç­¾åã€‚    // æœ€åå°†åºåˆ—åŒ–åçš„transactionå’Œç­¾åç»„è£…æˆcommon.Envelopeå¹¶è¿”å›ã€‚ }</code></pre><p>æœ€åï¼Œåˆå§‹åŒ–æ—¶å€™å¾—åˆ°çš„<code>cf.BroadcastClient.Send(env)</code>.è‡³æ­¤ï¼Œå®Œæˆäº†chaincode instantiateåœ¨peerç«¯çš„æ‰€æœ‰æ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric 1.4æºç åˆ†æ - chaincode instantiate(1ï¼‰peerç«¯çš„åˆå§‹åŒ–è¿‡ç¨‹</title>
      <link href="//articles/fabric-source-chaincode-instantiate-initcmdfactory/"/>
      <url>//articles/fabric-source-chaincode-instantiate-initcmdfactory/</url>
      
        <content type="html"><![CDATA[<p>æ¨èå‚è€ƒä¸¤ä¸ªåšå®¢ï¼š  </p><ul><li><a href="https://blog.csdn.net/idsuf698987/article/details/74907281">fabricæºç è§£æâ€”â€”åº</a> : å›½å†…åŒé“çš„æºç åˆ†æç³»åˆ—ï¼Œæ¨¡å—åŒ–  </li><li><a href="https://www.chaindesk.cn/witbook/30/467">Hyperledger Fabricæºç æ·±åº¦è§£æ</a> : å¯¹MSPï¼ŒBCCSPçš„ä»‹ç»åˆ°ä½ </li><li><a href="https://blockchain-fabric.blogspot.com/">To know the internals of certain permissioned blockchain platform</a> : IBMå‘˜å·¥ï¼Œå‚ä¸HFé¡¹ç›®çš„æ¦‚å¿µæ€»ç»“æ–‡ç« ç³»åˆ—</li></ul><p><em>é€‰æ‹©peer chaincode instantiateä½œä¸ºå¼€ç¯‡ï¼Œæ˜¯å› ä¸ºç¬”è€…å­¦ä¹ å®˜ç½‘è¿‡ç¨‹ä¸­æ²¡æœ‰å®Œå…¨ç†è§£installä¸instantiateçš„åŒºåˆ«ï¼Œæ‰€ä»¥é€‰æ‹©æ·±å…¥æºç å­¦ä¹ æ¥åŠ æ·±ç†è§£</em></p><p>å®˜ç½‘<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/build_network.html">Building Your First Network</a>ä¾‹å­ä¸­ï¼Œå‘½ä»¤ä¸º  </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode instantiate -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n mycc -v 1.0 -c '{"Args":["init","a", "100", "b","200"]}' -P "AND ('Org1MSP.peer','Org2MSP.peer')"</span><br></pre></td></tr></tbody></table></figure><p>æ­¤å‰ï¼Œéœ€è¦å…ˆè®¾ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">CORE_PEER_ADDRESS=peer0.org2.example.com:7051</span><br><span class="line">CORE_PEER_LOCALMSPID="Org2MSP"</span><br><span class="line">CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br></pre></td></tr></tbody></table></figure><p>å®¢æˆ·ç«¯è°ƒç”¨<code>peer chaincode instatiate</code>å‘½ä»¤éƒ¨ç½²chaincodeï¼Œä»£ç åœ¨â€˜peer/chaincode/instantiate.goâ€™è¿™ä¸ªæ–‡ä»¶ä¸‹ï¼Œå‘½ä»¤å…³è”çš„æ–¹æ³•æ˜¯<code>chaincodeDeploy</code>(ä½¿ç”¨äº†æµè¡Œçš„ç¬¬ä¸‰æ–¹å‘½ä»¤è¡Œcobraåº“ï¼Œå…·ä½“å¯è‡ªè¡Œå­¦ä¹ )ã€‚</p><span id="more"></span><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chaincodeDeploy</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>, cf *ChaincodeCmdFactory)</span> <span class="title">error</span></span> {</span><br><span class="line">    <span class="keyword">if</span> cf == <span class="literal">nil</span> {</span><br><span class="line">        cf, err = InitCmdFactory(cmd.Name(), <span class="literal">true</span>, <span class="literal">true</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">defer</span> cf.BroadcastClient.Close()</span><br><span class="line"></span><br><span class="line">    env, err := instantiate(cmd, cf)</span><br><span class="line"></span><br><span class="line">    err = cf.BroadcastClient.Send(env)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¸»è¦åˆ†ä¸º3ä¸ªæ­¥éª¤ï¼ˆæºç åªåˆ—å‡ºå…³é”®æ­¥éª¤ï¼Œçœç•¥åˆ¤æ–­é€»è¾‘åŠé”™è¯¯å¤„ç†ç­‰ï¼Œä¸‹åŒï¼‰ã€‚  </p><ol><li>å…¥å‚<code>cf *ChaincodeCmdFactory</code>ä¸ºnilï¼Œæœªåˆå§‹åŒ–ã€‚ï¼ˆå¯å›æº¯åˆ°peerå¯åŠ¨<code>peer/main.go#main</code>æ—¶çœ‹åˆ°<code>mainCmd.AddCommand(chaincode.Cmd(nil))</code>ï¼‰ã€‚åˆå§‹åŒ–chaincodeå‘½ä»¤å·¥å‚ï¼ŒåŒ…å«å®¢æˆ·ç«¯åŠè¾…åŠ©ç±»ã€‚è¿™ä¸ªæ–¹æ³•åœ¨æ‰€æœ‰çš„chaincodeå‘½ä»¤å‰éƒ½å…ˆæ‰§è¡Œï¼Œå…¥å‚æœ‰æ‰€ä¸åŒã€‚<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ChaincodeCmdFactory holds the clients used by ChaincodeCmd</span></span><br><span class="line"><span class="keyword">type</span> ChaincodeCmdFactory <span class="keyword">struct</span> {</span><br><span class="line">    EndorserClients []pb.EndorserClient     <span class="comment">// ä¸endorseräº¤äº’çš„å®¢æˆ·ç«¯</span></span><br><span class="line">    DeliverClients  []api.PeerDeliverClient     <span class="comment">// </span></span><br><span class="line">    Certificate     tls.Certificate     <span class="comment">//</span></span><br><span class="line">    Signer          msp.SigningIdentity        </span><br><span class="line">    BroadcastClient common.BroadcastClient      <span class="comment">// ä¸ordereräº¤äº’çš„å®¢æˆ·ç«¯</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>ä¸‹é¢å…³æ³¨ä¸‹åˆå§‹åŒ–çš„è¿‡ç¨‹<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// peer/chaincode/common.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitCmdFactory</span><span class="params">(cmdName <span class="keyword">string</span>, isEndorserRequired, isOrdererRequired <span class="keyword">bool</span>)</span> <span class="params">(*ChaincodeCmdFactory, error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> isEndorserRequired {</span><br><span class="line">        <span class="keyword">if</span> err = validatePeerConnectionParameters(cmdName); err != <span class="literal">nil</span> {} </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i, address := <span class="keyword">range</span> peerAddresses {</span><br><span class="line">            endorserClient, err := common.GetEndorserClientFnc(address, tlsRootCertFile)</span><br><span class="line">            endorserClients = <span class="built_in">append</span>(endorserClients, endorserClient)</span><br><span class="line">            </span><br><span class="line">            deliverClient, err := common.GetPeerDeliverClientFnc(address, tlsRootCertFile)</span><br><span class="line">            deliverClients = <span class="built_in">append</span>(deliverClients, deliverClient)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    certificate, err := common.GetCertificateFnc()</span><br><span class="line"></span><br><span class="line">    signer, err := common.GetDefaultSignerFnc()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> broadcastClient common.BroadcastClient</span><br><span class="line">    <span class="keyword">if</span> isOrdererRequired {</span><br><span class="line">        endorserClient := endorserClients[<span class="number">0</span>]</span><br><span class="line">        orderingEndpoints, err := common.GetOrdererEndpointOfChainFnc(channelID, signer, endorserClient)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// override viper env</span></span><br><span class="line">        viper.Set(<span class="string">"orderer.address"</span>, orderingEndpoints[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        broadcastClient, err = common.GetBroadcastClientFnc()</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;ChaincodeCmdFactory{</span><br><span class="line">        EndorserClients: endorserClients,</span><br><span class="line">        DeliverClients:  deliverClients,</span><br><span class="line">        Signer:          signer,</span><br><span class="line">        BroadcastClient: broadcastClient,</span><br><span class="line">        Certificate:     certificate,</span><br><span class="line">    }, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li>å…¥å‚ä¸º<code>cmdName(å‘½ä»¤å) string(å‘½ä»¤å), isEndorserRequiredï¼ˆæ˜¯å¦éœ€è¦åˆå§‹åŒ–endorser clientï¼‰, isOrdererRequiredï¼ˆæ˜¯å¦éœ€è¦åˆå§‹åŒ–orderer broadcast clientï¼‰ bool</code>ã€‚è¿™ä¸ªæ˜¯æ ¹æ®å‘½ä»¤ä¼ å‚ï¼Œä¾‹å¦‚instantiateéƒ¨ç½²chaincodeæ—¢éœ€è¦endorserèƒŒä¹¦ï¼Œä¹Ÿéœ€è¦ordereræ’åºæ‰“åŒ…å¹¶ä¸”æ‰©æ•£å…¨ç½‘ï¼Œè€Œinstallå®‰è£…åˆ™åªéœ€è¦èƒŒä¹¦ã€‚</li><li>instantiateéœ€è¦èƒŒä¹¦ï¼Œ<code>isEndorserRequired=true</code>ã€‚<code>validatePeerConnectionParameters</code>æ ¡éªŒå‘½ä»¤å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæ ¡éªŒpeerAddressesä¸ªæ•°åŠç›¸åº”çš„tlsRootCertFilesåŒ¹é…ã€‚æ³¨æ„ï¼Œè¿™é‡Œæœ‰<code>// currently only support multiple peer addresses for invoke</code>æ³¨é‡Šï¼Œå¯¹éinvokeæ–¹æ³•åªèƒ½ä¼ å…¥ä¸€ä¸ªpeerAddressï¼Œå¦‚installï¼Œinstantiateã€‚è¿™ä¹Ÿè¯´æ˜ï¼Œè¿™äº›æ“ä½œåªèƒ½ä½œç”¨äºå•ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸”ä¸‹é¢ä¹Ÿå¯ä»¥çœ‹åˆ°åªéœ€è¦å•ä¸ªèŠ‚ç‚¹çš„èƒŒä¹¦ã€‚</li><li><p><code>GetEndorserClientFnc</code>å’Œ<code>GetPeerDeliverClientFnc</code>æ–¹æ³•éå¸¸ç±»ä¼¼ã€‚éƒ½æ˜¯æ„é€ ä»¥ä¸‹è¿™ä¸ªclient(ä¸»è¦æ˜¯grpc client, hyperledger fabricä½¿ç”¨grpcä½œä¸ºrpcæ–¹æ¡ˆ)ï¼Œæ•°æ®ç»“æ„å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯åç»­çš„ç”¨é€”æœ‰æ‰€ä¸åŒã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetEndorserClient returns a new endorser client. If the both the address and</span></span><br><span class="line"><span class="comment">// tlsRootCertFile are not provided, the target values for the client are taken</span></span><br><span class="line"><span class="comment">// from the configuration settings for "peer.address" and</span></span><br><span class="line"><span class="comment">// "peer.tls.rootcert.file"</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetEndorserClient</span><span class="params">(address, tlsRootCertFile <span class="keyword">string</span>)</span> <span class="params">(pb.EndorserClient, error)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> address != <span class="string">""</span> {</span><br><span class="line">        <span class="comment">// ä»å‘½ä»¤è¡Œä¼ å…¥peer address, --peerAddresses, --tlsRootCertFiles</span></span><br><span class="line">        peerClient, err = NewPeerClientForAddress(address, tlsRootCertFile)</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// ä»ç¯å¢ƒå˜é‡è¯»å–peer address</span></span><br><span class="line">        peerClient, err = NewPeerClientFromEnv()</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> peerClient.Endorser()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">&amp;PeerClient{</span><br><span class="line">    commonClient: commonClient{</span><br><span class="line">        GRPCClient: gClient,    <span class="comment">// grpc client. å·¥ç¨‹ä½¿ç”¨grpcä½œä¸ºèŠ‚ç‚¹é—´çš„è¿œç¨‹è°ƒç”¨æ–¹æ¡ˆ</span></span><br><span class="line">        address:    address,    <span class="comment">// â€œpeer.addressâ€</span></span><br><span class="line">        sn:         override   <span class="comment">// "peer.tls.serverhostoverride"</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå‘½ä»¤é‡Œå¹¶æ²¡æœ‰æä¾›<code>peerAddress</code>å’Œ<code>tlsRootCertFile</code>è¿™ä¸¤ä¸ªå‚æ•°ï¼Œå› æ­¤ä»ç¯å¢ƒå˜é‡é‡Œè¯»å–ã€‚åœ¨æºç ä¸­ï¼Œä½¿ç”¨äº†æµè¡Œçš„ç¬¬ä¸‰æ–¹åº“viperæ¥è¿›è¡Œé…ç½®åŠ è½½å’Œç®¡ç†ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦å…ˆè®¾ç½®çš„å˜é‡<code>CORE_PEER_ADDRESS</code>å’Œ<code>CORE_PEER_TLS_ROOTCERT_FILE</code>ã€‚</p></li><li><p>ç”Ÿæˆå®¢æˆ·ç«¯X509è¯ä¹¦<code>GetCertificateFnc</code>ã€‚å®¢æˆ·ç«¯é€šä¿¡æ—¶æ˜¯å¦éœ€è¦æ ¡éªŒX509è¯ä¹¦æ˜¯ç”±ç¯å¢ƒå˜é‡<code>peer.tls.enabled</code>å’Œ<code>peer.tls.clientAuthRequired</code>è¿™ä¸¤ä¸ªå‚æ•°å†³å®šçš„ã€‚åœ¨è¯¥tutorialä¾‹å­ä¸­å¹¶æ²¡æœ‰è®¾ç½®ã€‚å¦‚æœéœ€è¦æ ¡éªŒï¼Œåˆ™å¦å¤–éœ€è¦æä¾›ä¸¤ä¸ªå‚æ•°<code>peer.tls.clientKey.file</code>å’Œ<code>peer.tls.clientCert.file</code>ï¼Œåˆ†åˆ«å¯¹åº”èŠ‚ç‚¹çš„public/private keyæ–‡ä»¶ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨å‰é¢æ„é€ çš„endorseClientå’ŒpeerDeliverClientè¿‡ç¨‹ä¸­ï¼Œä¹Ÿå·²ç»è¯»å–è¿™ä¸¤ä¸ªå‚æ•°å’Œæ–‡ä»¶ï¼Œç”ŸæˆX509 key pairï¼Œå¯ä»¥è¿›è¡Œtlsé€šä¿¡ã€‚è¿™é‡Œçš„æ–¹æ³•ä¹Ÿæ˜¯æ„å»ºpeerClientï¼Œè·å–è¯¥key pairã€‚ï¼ˆTODOï¼šä»¥åä¸“é¢˜åˆ†æåŠ å¯†ï¼‰</p></li><li><p><code>GetDefaultSignerFnc</code>è°ƒç”¨æœ¬åœ°MSP<code>mspmgmt.GetLocalMSP().GetDefaultSigningIdentity()</code>è·å–signerï¼Œåç»­ç”¨äºå‘é€çš„proposalè¿›è¡Œç­¾åï¼Œæ„é€ signedProposalã€‚ï¼ˆTODOï¼šä»¥åä¸“é¢˜åˆ†æmspæˆå‘˜ç®¡ç†æœåŠ¡ï¼‰</p></li><li><p><code>isOrdererRequired</code>è¿™ä¸ªå‚æ•°åˆå§‹åŒ–æ—¶å€™ä¼ å…¥ï¼Œæ ¹æ®åç»­æ“ä½œæ˜¯å¦éœ€è¦ä¸ordereräº¤äº’ä¹ƒè‡³å…¨ç½‘åŒæ­¥è€Œæ˜¯å¦é€‰æ‹©åˆå§‹åŒ–ã€‚chaincode instantiateéœ€è¦å…¨ç½‘åŒæ­¥ï¼Œå› æ­¤éœ€è¦åˆå§‹åŒ–ã€‚å‘½ä»¤è¡Œ<code>-o</code>å‚æ•°æŒ‡å®šordereråœ°å€ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™é€šè¿‡<code>GetOrdererEndpointOfChainFnc</code>è·å–ordereråœ°å€ã€‚è¿™ä¸ªæ˜¯é€šè¿‡è°ƒç”¨csccï¼ˆconfiguration system chaincodeï¼Œé…ç½®ç³»ç»Ÿé“¾ç ï¼‰çš„GetConfigBlockæ–¹æ³•ï¼ˆå‚æ•°ä¸ºchannelIdï¼‰å®ç°çš„ã€‚æµç¨‹ä¸ä¸€èˆ¬çš„chaincodeè°ƒç”¨ç›¸ä¼¼ã€‚</p><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetOrdererEndpointOfChain</span><span class="params">(chainID <span class="keyword">string</span>, signer msp.SigningIdentity, endorserClient pb.EndorserClient)</span> <span class="params">([]<span class="keyword">string</span>, error)</span></span> {</span><br><span class="line"><span class="comment">// query cscc for chain config block</span></span><br><span class="line">invocation := &amp;pb.ChaincodeInvocationSpec{</span><br><span class="line">ChaincodeSpec: &amp;pb.ChaincodeSpec{</span><br><span class="line">Type:        pb.ChaincodeSpec_Type(pb.ChaincodeSpec_Type_value[<span class="string">"GOLANG"</span>]),</span><br><span class="line">ChaincodeId: &amp;pb.ChaincodeID{Name: <span class="string">"cscc"</span>},</span><br><span class="line">Input:       &amp;pb.ChaincodeInput{Args: [][]<span class="keyword">byte</span>{[]<span class="keyword">byte</span>(cscc.GetConfigBlock), []<span class="keyword">byte</span>(chainID)}},</span><br><span class="line">},</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">creator, err := signer.Serialize()</span><br><span class="line">prop, _, err := putils.CreateProposalFromCIS(pcommon.HeaderType_CONFIG, <span class="string">""</span>, invocation, creator)</span><br><span class="line">signedProp, err := putils.GetSignedProposal(prop, signer)</span><br><span class="line"></span><br><span class="line">proposalResp, err := endorserClient.ProcessProposal(context.Background(), signedProp)</span><br><span class="line"></span><br><span class="line"><span class="comment">// parse config block</span></span><br><span class="line">block, err := putils.GetBlockFromBlockBytes(proposalResp.Response.Payload)</span><br><span class="line">envelopeConfig, err := putils.ExtractEnvelope(block, <span class="number">0</span>)</span><br><span class="line">bundle, err := channelconfig.NewBundleFromEnvelope(envelopeConfig)</span><br><span class="line"><span class="keyword">return</span> bundle.ChannelConfig().OrdererAddresses(), <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ol><ul><li>æ„é€ <code>ChaincodeInvocationSpec</code>cisæè¿°è¯¥chaincodeè¯·æ±‚ï¼ŒåŒ…å«è¯·æ±‚çš„è¯­è¨€ï¼ˆGOLANDï¼‰ï¼ŒchaincodeIdï¼ˆâ€œcsccâ€ï¼‰ï¼Œå…·ä½“è¯·æ±‚Inputï¼ˆcscc.GetConfigBlockï¼‰ç­‰ã€‚è¿™ä¸ªè¯·æ±‚ä½“æ ¼å¼é€šç”¨äºæ‰€æœ‰çš„ç³»ç»ŸåŠæ™®é€šchaincodeã€‚ç„¶åï¼Œæ„é€ proplsalï¼Œå¹¶é€šè¿‡ä¸Šé¢MSPè·å–çš„signerè¿›è¡Œç­¾åï¼Œåœ¨è¢«è°ƒç”¨æ–¹éœ€è¦ä¾æ¬¡åˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦æœ‰æƒé™è°ƒç”¨chaincodeã€‚  </li><li>æ¥ç€ï¼Œé€šè¿‡ä¸Šé¢æ„å»ºç­‰endorserClientè¿›è¡Œgrpcè°ƒç”¨<code>grpc.Invoke(ctx, "/protos.Endorser/ProcessProposal", in, out, c.cc, opts...)</code>ï¼Œç®€å•ä»‹ç»ä¸‹å‚æ•°(ctx context.Contextï¼Œin *SignedProposal, opts â€¦grpc.CallOption, out ProposalResponse, c.cc endorser.grpc.ClientConn)ã€‚æ­¤å¤„grpcè°ƒç”¨çš„æ–¹æ³•æ˜¯<code>/protos.Endorser/ProcessProposal</code>ï¼Œendorserç«¯æ ¡éªŒï¼Œè°ƒç”¨csccï¼Œå¾—åˆ°ç»“æœProposalResponseè¿”å›ã€‚è¿™ä¸ªåé¢è¯¦è¿°ã€‚  </li><li>æœ€åï¼Œä»rpcè°ƒç”¨çš„ç»“æœbytesä¾æ¬¡ååºåˆ—åŒ–æˆblockï¼Œè·å–å¹¶ååºåˆ—åŒ–blockä¸­ç¬¬ä¸€ä¸ªenvelopeï¼ŒæŠŠenvelopeçš„payloadååºåˆ—åŒ–æˆconfigtxï¼Œå¹¶ä¸”è·å–ç›¸åº”çš„ä¿¡æ¯channelConfigï¼Œæœ€åä»channelConfigä¸­è·å–åˆ°OrdererAddressesã€‚ï¼ˆè¿™é‡Œçš„ç»“æ„å¤„ç†æ˜¯æ ¹æ®csccçš„GetConfigBlockè°ƒç”¨ç»“æœï¼‰é€‰æ‹©ç¬¬ä¸€ä¸ªordererçš„åœ°å€é‡å†™ä¸ºç³»ç»Ÿå˜é‡<code>orderer.address</code>ã€‚(TODOï¼šè¿™é‡Œæ˜¯å¦ä¼šæŠŠæ‰€æœ‰çš„è¯·æ±‚éƒ½é›†ä¸­åˆ°ç¬¬ä¸€ä¸ªordereræœ‰å¾…ç ”ç©¶csccçš„æ–¹æ³•)  </li></ul><ol><li><code>GetBroadcastClientFnc</code>ä¸ä¸Šé¢çš„<code>GetEndorserClient</code>ä¸»è¦æµç¨‹éå¸¸ç›¸ä¼¼ï¼Œä¸»è¦åŒºåˆ«æœ‰ä¸¤ç‚¹ã€‚ç¬¬ä¸€ï¼Œ<code>GetEndorserClient</code>æ„å»ºçš„clientï¼Œä½¿ç”¨çš„æ˜¯peerçš„è®¾ç½®ï¼Œè€Œ<code>GetBroadcastClientFnc</code>è·å–çš„æ˜¯ordererçš„è®¾ç½®ï¼Œä»ç¯å¢ƒå˜é‡é‡Œè·å–æ„é€ å‚æ•°ï¼Œ<code>configFromEnv("orderer")</code>ï¼Œè¿™é‡Œ<code>orderer.address</code>è¿™ä¸ªå‚æ•°æ­£æ˜¯ä¸Šé¢çš„æ–¹æ³•ä»chaincode config blocké‡Œè·å–å¹¶è®¾ç½®ä¸ºç¯å¢ƒå˜é‡çš„ã€‚ç¬¬äºŒï¼Œè°ƒç”¨äº†<code>orderClient.Broadcast()</code>ï¼Œè¿™é‡Œ<code>grpc.NewClientStream(ctx, &amp;_AtomicBroadcast_serviceDesc.Streams[0], c.cc, "/orderer.AtomicBroadcast/Broadcast", opts...)</code>ç›´æ¥æŒ‡æ˜äº†grpcçš„è¿œç¨‹è°ƒç”¨æ–¹æ³•ä¸º<code>"/orderer.AtomicBroadcast/Broadcast"</code>.</li></ol><p>è‡³æ­¤ï¼Œå®Œæˆäº†chaincodeè°ƒç”¨çš„åˆå§‹åŒ–æ„é€ è¿‡ç¨‹ã€‚åç»­çš„chaincodeè°ƒç”¨å°±å¯ä»¥ç›´æ¥ä½¿ç”¨æ­¤è¿‡ç¨‹ä¸­æ„å»ºçš„clientåŠsignerç­‰æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Hyperledger Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hyperledger Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èµ·æ‰‹å¼</title>
      <link href="//articles/foreword/"/>
      <url>//articles/foreword/</url>
      
        <content type="html"><![CDATA[<h3 id="å…³äºåšå®¢"><a href="#å…³äºåšå®¢" class="headerlink" title="å…³äºåšå®¢"></a>å…³äºåšå®¢</h3><p>åˆ›å»ºè¿™ä¸ªåšå®¢çš„ç¼˜ç”±æ˜¯ä»Šå¹´åœ¨å­¦ä¹ åŒºå—é“¾çš„çŸ¥è¯†ï¼Œæƒ³è®°å½•å’Œåˆ†äº«ä¸‹å­¦ä¹ å’Œè¿›æ­¥çš„è¿‡ç¨‹ï¼Œä¸ºäº†éšæ—¶å¯ä»¥ç¿»çœ‹å’Œè¡¥å……ä¿®æ­£ã€‚æ­¤å¤–ï¼Œè®°å½•ä¸‹å¹³æ—¶å·¥ä½œï¼ˆå¤§æ•°æ®å¼€å‘ï¼‰è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œè¸©è¿‡çš„å‘ã€‚å¦‚æœåœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿˜èƒ½åšåˆ°çŸ¥è¯†è¾“å‡ºï¼Œæˆ–è€…èƒ½åšåˆ°åˆ†äº«è®©å¤§å®¶äº’ç›¸å­¦ä¹ å’ŒæŒ‡æ­£ï¼Œé‚£å°±ç®—å–œå‡ºæœ›å¤–äº†ã€‚</p><h3 id="å…³äºåŒºå—é“¾"><a href="#å…³äºåŒºå—é“¾" class="headerlink" title="å…³äºåŒºå—é“¾"></a>å…³äºåŒºå—é“¾</h3><p>æµªæ½®è¿‡å»åæ‰èƒ½çœ‹å‡ºè°åœ¨è£¸æ³³ã€‚åŒºå—é“¾çš„çƒ­åº¦å»å¹´éšç€éŸ­èœé£æ³¢è¿‡å»åï¼Œè¿›å…¥æŠ€æœ¯çš„æ²‰æ·€æœŸã€‚å§‹ç»ˆè®¤ä¸ºåŒºå—é“¾åªæ˜¯ä¸€é—¨æŠ€æœ¯ï¼Œè€Œä¸”è¿˜æ˜¯æ²¡æœ‰æ€æ‰‹çº§åº”ç”¨ï¼Œè¿˜ä¸æˆç†Ÿçš„æŠ€æœ¯ï¼Œæ›´ä¸åº”è¯¥ä¸Šå‡åˆ°ä¿¡ä»°çš„é«˜åº¦ã€‚ä¸€é¡¹æ–°æŠ€æœ¯åœ¨çŸ­æœŸå†…ä¼šè¢«é«˜ä¼°ï¼Œåœ¨é•¿æœŸåˆ™è¢«ä½ä¼°ã€‚é€‰æ‹©è¿™ä¸ªäººå°‘çš„æ–¹å‘ï¼Œä¹Ÿæ„å‘³ç€å†’æ›´å¤§çš„é£é™©ï¼Œæ— ä»ä¼°è®¡ä¸‰å¹´åçš„å‘å±•ï¼Œä¹Ÿæ„å‘³ç€å¯èƒ½ä¼šä¸€ç›´ç¢Œç¢Œæ— ä¸ºã€‚æˆ‘å¸Œæœ›åƒç«¹å­ä¸€æ ·ï¼Œç”¨ä¸‰å¹´æ—¶é—´å¥½å¥½æ‰æ ¹æ²‰æ·€ï¼Œé™å¾…ç ´åœŸã€‚<br><span id="more"></span></p><h3 id="å…³äºHyperledger-Fabricå­¦ä¹ "><a href="#å…³äºHyperledger-Fabricå­¦ä¹ " class="headerlink" title="å…³äºHyperledger Fabricå­¦ä¹ "></a>å…³äºHyperledger Fabricå­¦ä¹ </h3><p>æˆ‘ä»æœªä»äº‹è¿‡åŒºå—é“¾ç›¸å…³å¼€å‘å·¥ä½œï¼Œç”šè‡³ä¹Ÿæœªæ›¾å·¥ä½œä¸­ä½¿ç”¨è¿‡goè¯­è¨€ã€‚å­¦ä¹ åŒºå—é“¾çº¯å±å‡ºäºä¸ªäººå…´è¶£ï¼Œè€Œé€‰æ‹©Hyperledger Fabricåˆ™æ˜¯é€‰æ‹©è”ç›Ÿé“¾é‡Œæœ€ç«çƒ­çš„æ¡†æ¶ã€‚é¢˜å¤–è¯ï¼Œæˆ‘ç›®å‰è¿˜ä¸äº†è§£çœ‹ä¸æ¸…å…¬æœ‰é“¾DAPPçš„å‘å±•ï¼Œè¿˜æ˜¯ä¸“æ³¨äºè”ç›Ÿé“¾çš„å­¦ä¹ ã€‚Fabricçš„å­¦ä¹ ï¼Œä¸»è¦æ˜¯ä»å®˜ç½‘è·å¾—æ¦‚å¿µï¼Œä»¥æºç åˆ†ææ¥è¡¥å……å’ŒåŠ æ·±ç†è§£ç»†èŠ‚ã€‚ å› ä¸ºç¼ºä¹é¡¹ç›®ç»éªŒï¼Œå°šä¸”æ— æ³•é«˜å±‹å»ºç“´çš„å»æ¨¡å—åŒ–åˆ†æå’Œæ¦‚æ‹¬æ•´ä¸ªæ¡†æ¶ï¼Œè€Œæ›´å¤šçš„é€‰æ‹©ä»ç‚¹åŠé¢çš„å»¶ä¼¸æ€§å­¦ä¹ ã€‚å› æ­¤ï¼Œä½ å¯èƒ½æ— æ³•ä»æˆ‘çš„åšå®¢é‡Œè·å¾—éå¸¸ç³»ç»Ÿçš„å­¦ä¹ ï¼Œç”šè‡³äºä¹Ÿæ— æ³•ä¿è¯åšå®¢å†…å®¹çš„å®Œæ•´æ€§å’Œç™¾åˆ†ç™¾çš„å‡†ç¡®æ€§ï¼Œæˆ‘åªæ˜¯è®°å½•ç€è‡ªå·±å­¦ä¹ Hyperledger Fabricï¼ˆåŸºäºv1.4ï¼‰çš„å†ç¨‹ï¼Œä»¥åŠä¸åŒé“äº¤æµã€‚å¸Œæœ›ä»¥æ­¤ç£ä¿ƒè‡ªå·±åšæŒä¸‹å»ï¼Œå·¥ä½œä¸šä½™æ—¶é—´èƒ½æ·±å…¥å»å­¦ä¹ å’Œåˆ†äº«ï¼Œå®šæœŸæ¥æ›´æ–°ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
