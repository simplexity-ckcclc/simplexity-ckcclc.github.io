<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">



  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=7.0.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="之前分享过Fabric官网Commercial Paper案例chaincode的golang实现，现在基于官网Building Your First Network再次记录过程，同时添加部分新操作及分析，以此作为以后的进阶实战基础。  使用命令./byfn.sh up启动网络  查看配置文件/fabric-samples/first-network/docker-compose-cli.yaml">
<meta name="keywords" content="Hyperledger Fabric">
<meta property="og:type" content="article">
<meta property="og:title" content="Fabric实战（1） - 基础篇，基于byfn的Commercial Paper案例">
<meta property="og:url" content="https://simplexity.cn/2019/10/23/fabric-inpractice-commercialpaper-byfn/index.html">
<meta property="og:site_name" content="Simplexity">
<meta property="og:description" content="之前分享过Fabric官网Commercial Paper案例chaincode的golang实现，现在基于官网Building Your First Network再次记录过程，同时添加部分新操作及分析，以此作为以后的进阶实战基础。  使用命令./byfn.sh up启动网络  查看配置文件/fabric-samples/first-network/docker-compose-cli.yaml">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-10-28T01:59:15.294Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fabric实战（1） - 基础篇，基于byfn的Commercial Paper案例">
<meta name="twitter:description" content="之前分享过Fabric官网Commercial Paper案例chaincode的golang实现，现在基于官网Building Your First Network再次记录过程，同时添加部分新操作及分析，以此作为以后的进阶实战基础。  使用命令./byfn.sh up启动网络  查看配置文件/fabric-samples/first-network/docker-compose-cli.yaml">






  <link rel="canonical" href="https://simplexity.cn/2019/10/23/fabric-inpractice-commercialpaper-byfn/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Fabric实战（1） - 基础篇，基于byfn的Commercial Paper案例 | Simplexity</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Simplexity</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://simplexity.cn/2019/10/23/fabric-inpractice-commercialpaper-byfn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Travis Wong">
      <meta itemprop="description" content="Simple is Complex">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simplexity">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Fabric实战（1） - 基础篇，基于byfn的Commercial Paper案例

              
            
          </h1>
        

        <div class="post-meta">
          

          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-10-23 18:13:46" itemprop="dateCreated datePublished" datetime="2019-10-23T18:13:46+08:00">2019-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-10-28 09:59:15" itemprop="dateModified" datetime="2020-10-28T09:59:15+08:00">2020-10-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Hyperledger-Fabric/" itemprop="url" rel="index"><span itemprop="name">Hyperledger Fabric</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2019/10/23/fabric-inpractice-commercialpaper-byfn/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2019/10/23/fabric-inpractice-commercialpaper-byfn/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             Views:  
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>之前分享过<a href="https://simplexity.cn/2019/04/19/fabric-commercial-paper-go/">Fabric官网Commercial Paper案例chaincode的golang实现</a>，现在基于官网<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/build_network.html" target="_blank" rel="noopener">Building Your First Network</a>再次记录过程，同时添加部分新操作及分析，以此作为以后的进阶实战基础。</p>
<ol>
<li><p>使用命令<code>./byfn.sh up</code>启动网络</p>
</li>
<li><p>查看配置文件<code>/fabric-samples/first-network/docker-compose-cli.yaml</code>,可见cli的挂载volume设置  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli:</span><br><span class="line">  volume:</span><br><span class="line">    - ./../chaincode/:/opt/gopath/src/github.com/chaincode</span><br></pre></td></tr></table></figure>
</li>
<li><p>将编写的chaincode源文件放置在该挂载的路径<code>/chaincode/go</code>下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp commercial_paper.go /chaincode/go</span><br><span class="line">cp paper.go /chaincode/go</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>docker exec -it cli bash</code>登入容器cli</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- 执行peer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go</span><br><span class="line">- 执行echo $CORE_PEER_MSPCONFIGPATH。可见当前角色为admin</span><br><span class="line">    ---</span><br><span class="line">    /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">- 执行peer chaincode list -C mychannel --installed</span><br><span class="line">    ---</span><br><span class="line">    Get installed chaincodes on peer:</span><br><span class="line">    Name: commercialpaper, Version: 0, Path: github.com/chaincode/commercial_paper/go, Id: f033307bf72f876fb5a95883d53ed5209e6639386e21361eed65f459d8a9f276</span><br></pre></td></tr></table></figure>
</li>
</ol>
<a id="more"></a>
<ol>
<li><p>登入peer0.org1.example.com(容器cli内CORE_PEER_ADDRESS=peer0.org1.example.com:7051，也就是其endorser节点)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 执行ll var/hyperledger/production/chaincodes，存在文件commercialpaper.0（即$&#123;chaincodeName&#125;.$&#123;version&#125;）</span><br><span class="line">- 执行peer chaincode list -C mychannel --installed</span><br><span class="line">    ---</span><br><span class="line">    Error: Bad response: 500 - access denied for [getinstalledchaincodes]: Failed verifying that proposal&apos;s creator satisfies local MSP principal during channelless check policy with policy [Admins]: [This identity is not an admin]</span><br></pre></td></tr></table></figure>
<p> 实际上，<code>docker inspect peer0.org1.example.com</code>：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;HostConfig&quot;: &#123;</span><br><span class="line">    &quot;Binds&quot;: [</span><br><span class="line">        &quot;/Users/meitu/Project/github/fabric-samples/first-network/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls:rw&quot;,</span><br><span class="line">        &quot;/Users/meitu/Project/github/fabric-samples/first-network/crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp:rw&quot;,</span><br><span class="line">        &quot;/var/run:/host/var/run:rw&quot;,</span><br><span class="line">        &quot;net_peer0.org1.example.com:/var/hyperledger/production:rw&quot;</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 没有将Admin@org1.example.com/msp挂载进来，当然可以修改启动配置文件<code>base/docker-compose-base.yaml</code>，或者后续添加到挂载的volume上，设置$CORE_PEER_MSPCONFIGPATH指向挂载的路径也可以赋予权限访问  </p>
</li>
<li><p>查看<code>/fabric-samples/first-network/scripts/</code>路径下<code>script.sh</code>和<code>util.sh</code>，包含设置CORE_PEER_LOCALMSPID=(“Org1MSP”/“Org2MSP”)</p>
</li>
<li><p>cli执行<code>chaincode instantiate</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode instantiate -n commercialpaper -v 0 -c &apos;&#123;&quot;Args&quot;:[]&#125;&apos; -C mychannel -P &quot;AND (&apos;Org1MSP.member&apos;)&quot; \</span><br><span class="line">--tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line"></span><br><span class="line">env</span><br><span class="line">---</span><br><span class="line">OLDPWD=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts</span><br><span class="line"></span><br><span class="line">peer0.org1.example.com:</span><br><span class="line">2019-10-22 14:28:19.931 UTC [endorser] callChaincode -&gt; INFO 1e62ef [mychannel][3156a1b7] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-10-22 14:28:19.936 UTC [endorser] callChaincode -&gt; INFO 1e630e [mychannel][3156a1b7] Exit chaincode: name:&quot;lscc&quot;  (5ms)</span><br><span class="line">2019-10-22 14:28:19.940 UTC [comm.grpc.server] 1 -&gt; INFO 1e631b unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T14:28:19.927Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:51012&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;12.4301ms&quot;&#125;</span><br><span class="line">2019-10-22 14:28:21.993 UTC [gossip.privdata] StoreBlock -&gt; INFO 1e647d [mychannel] Received block [5] from buffer</span><br><span class="line">2019-10-22 14:28:22.022 UTC [committer.txvalidator] Validate -&gt; INFO 1e64c9 [mychannel] Validated block [5] in 28ms</span><br><span class="line">2019-10-22 14:28:22.033 UTC [cceventmgmt] HandleStateUpdates -&gt; INFO 1e64db Channel [mychannel]: Handling deploy or update of chaincode [commercialpaper]</span><br><span class="line">2019-10-22 14:28:22.065 UTC [kvledger] CommitWithPvtData -&gt; INFO 1e6506 [mychannel] Committed block [5] with 1 transaction(s) in 40ms (state_validation=15ms block_commit=18ms state_commit=4ms)</span><br><span class="line">2019-10-22 14:28:31.257 UTC [endorser] callChaincode -&gt; INFO 1e6ed6 [mychannel][b206b359] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-10-22 14:28:31.262 UTC [endorser] callChaincode -&gt; INFO 1e6efc [mychannel][b206b359] Exit chaincode: name:&quot;lscc&quot;  (4ms)</span><br><span class="line">2019-10-22 14:28:31.263 UTC [comm.grpc.server] 1 -&gt; INFO 1e6f09 unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T14:28:31.255Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.4:55986&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;7.5554ms&quot;&#125;</span><br><span class="line"></span><br><span class="line">peer1.org1.example.com:</span><br><span class="line">2019-10-22 14:28:22.009 UTC [gossip.privdata] StoreBlock -&gt; INFO 1e0540 [mychannel] Received block [5] from buffer</span><br><span class="line">2019-10-22 14:28:22.011 UTC [committer.txvalidator] Validate -&gt; INFO 1e0588 [mychannel] Validated block [5] in 2ms</span><br><span class="line">2019-10-22 14:28:22.017 UTC [cceventmgmt] HandleStateUpdates -&gt; INFO 1e05a0 Channel [mychannel]: Handling deploy or update of chaincode [commercialpaper]</span><br><span class="line">2019-10-22 14:28:22.018 UTC [ccprovider] ExtractStatedbArtifactsForChaincode -&gt; INFO 1e05a3 Error while loading installation package for ccname=commercialpaper, ccversion=0. Err=open /var/hyperledger/production/chaincodes/commercialpaper.0: no such file or directory</span><br><span class="line">2019-10-22 14:28:22.018 UTC [cceventmgmt] HandleChaincodeDeploy -&gt; INFO 1e05a4 Channel [mychannel]: Chaincode [Name=commercialpaper, Version=0, Hash=[]byte&#123;0xf0, 0x33, 0x30, 0x7b, 0xf7, 0x2f, 0x87, 0x6f, 0xb5, 0xa9, 0x58, 0x83, 0xd5, 0x3e, 0xd5, 0x20, 0x9e, 0x66, 0x39, 0x38, 0x6e, 0x21, 0x36, 0x1e, 0xed, 0x65, 0xf4, 0x59, 0xd8, 0xa9, 0xf2, 0x76&#125;] is not installed hence no need to create chaincode artifacts for endorsement</span><br><span class="line">2019-10-22 14:28:22.041 UTC [kvledger] CommitWithPvtData -&gt; INFO 1e05c1 [mychannel] Committed block [5] with 1 transaction(s) in 27ms (state_validation=5ms block_commit=13ms state_commit=6ms)</span><br><span class="line"></span><br><span class="line">orderer：</span><br><span class="line">2019-10-22 14:28:19.969 UTC [comm.grpc.server] 1 -&gt; INFO 027 streaming call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T14:28:19.947Z&quot;, &quot;grpc.service&quot;: &quot;orderer.AtomicBroadcast&quot;, &quot;grpc.method&quot;: &quot;Broadcast&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:53034&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;23.1002ms&quot;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>peer1.org1.example.com上没有install这个chaincode</li>
</ul>
<ol>
<li><p>cli执行<code>peer chaincode invoke -c &#39;{&quot;Args&quot;:[&quot;issue&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;, &quot;2020-05-31&quot;, &quot;2020-11-30&quot;, &quot;5000000&quot;]}&#39; -C mychannel -n commercialpaper&quot;</code>，失败。看日志是cli与orderer之间tls失败</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cli:</span><br><span class="line">Error: error sending transaction for invoke: could not send: EOF - proposal response: version:1 response:&lt;status:200 payload:&quot;&#123;\&quot;PaperNumber\&quot;:\&quot;00004\&quot;,\&quot;Issuer\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;Owner\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;IssueDateTime\&quot;:\&quot;2020-05-31\&quot;,\&quot;MaturityDateTime\&quot;:\&quot;2020-11-30\&quot;,\&quot;FaceValue\&quot;:5000000,\&quot;Status\&quot;:0&#125;&quot; &gt; payload:&quot;\n /!\373\020OI\024\270_1\267\251\332\337\037 $\370\347\356\004aEXZ\345\332/\366|&apos;7\022\306\003\n\204\002\022\340\001\n\017commercialpaper\022\314\001\n\022\n\020MagnetoCorp00004\032\265\001\n\020MagnetoCorp00004\032\240\001&#123;\&quot;PaperNumber\&quot;:\&quot;00004\&quot;,\&quot;Issuer\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;Owner\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;IssueDateTime\&quot;:\&quot;2020-05-31\&quot;,\&quot;MaturityDateTime\&quot;:\&quot;2020-11-30\&quot;,\&quot;FaceValue\&quot;:5000000,\&quot;Status\&quot;:0&#125;\022\037\n\004lscc\022\027\n\025\n\017commercialpaper\022\002\010\005\032\246\001\010\310\001\032\240\001&#123;\&quot;PaperNumber\&quot;:\&quot;00004\&quot;,\&quot;Issuer\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;Owner\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;IssueDateTime\&quot;:\&quot;2020-05-31\&quot;,\&quot;MaturityDateTime\&quot;:\&quot;2020-11-30\&quot;,\&quot;FaceValue\&quot;:5000000,\&quot;Status\&quot;:0&#125;\&quot;\024\022\017commercialpaper\032\0010&quot; endorsement:&lt;endorser:&quot;\n\007Org1MSP\022\252\006-----BEGIN CERTIFICATE-----\nMIICKDCCAc6gAwIBAgIQbaczcznil/PbPlby6iZKsjAKBggqhkjOPQQDAjBzMQsw\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\nYW5jaXNjbzEZMBcGA1UEChMQb3JnMS5leGFtcGxlLmNvbTEcMBoGA1UEAxMTY2Eu\nb3JnMS5leGFtcGxlLmNvbTAeFw0xOTEwMjIwODU0MDBaFw0yOTEwMTkwODU0MDBa\nMGoxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1T\nYW4gRnJhbmNpc2NvMQ0wCwYDVQQLEwRwZWVyMR8wHQYDVQQDExZwZWVyMC5vcmcx\nLmV4YW1wbGUuY29tMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAESYh6SwhdBrUf\nsekjyFVukFQXI4q5O4DCnaTwARTlHffruISr0wnM1UkCI/OlrApnr/1Y3jagLiko\nkgwZbeVrgqNNMEswDgYDVR0PAQH/BAQDAgeAMAwGA1UdEwEB/wQCMAAwKwYDVR0j\nBCQwIoAgnPSDYZGp0kd3Lamn88Z/R0vxSeMxwJp/FKSVeVOsmsMwCgYIKoZIzj0E\nAwIDSAAwRQIhAO3ASI59+lSdlcY9RgDUlRWMe3qzXwI870wWI+ozpscLAiBf4MIV\nUcGoLpoB5GPnRxOY++CabOCmYDBZMfYAE+SKlA==\n-----END CERTIFICATE-----\n&quot; signature:&quot;0E\002!\000\257D\303\234\024\210C&gt;\203\215-\204\257 \304*\367sL9\223\207\233\312\351\277\270LR\231\236&amp;\002 )\331\334\006\025\214\337\355\262\252\305\345\214\315ae\3527\317y\274\336\352oX\037F\220\3036%\025&quot; &gt;</span><br><span class="line"></span><br><span class="line">orderer: </span><br><span class="line">2019-10-22 15:58:14.380 UTC [core.comm] ServerHandshake -&gt; ERRO 034 TLS handshake failed with error tls: first record does not look like a TLS handshake &#123;&quot;server&quot;: &quot;Orderer&quot;, &quot;remote address&quot;: &quot;172.25.0.7:53104&quot;&#125;</span><br><span class="line">2019-10-22 15:58:15.383 UTC [core.comm] ServerHandshake -&gt; ERRO 035 TLS handshake failed with error tls: first record does not look like a TLS handshake &#123;&quot;server&quot;: &quot;Orderer&quot;, &quot;remote address&quot;: &quot;172.25.0.7:53106&quot;&#125;</span><br><span class="line"></span><br><span class="line">peer0.org1.example.com:</span><br><span class="line">2019-10-22 15:58:15.391 UTC [endorser] callChaincode -&gt; INFO 2c3af6 [mychannel][89d96407] Entry chaincode: name:&quot;commercialpaper&quot;</span><br><span class="line">2019-10-22 15:58:15.398 UTC [endorser] callChaincode -&gt; INFO 2c3b04 [mychannel][89d96407] Exit chaincode: name:&quot;commercialpaper&quot;  (7ms)</span><br><span class="line">2019-10-22 15:58:15.398 UTC [comm.grpc.server] 1 -&gt; INFO 2c3b11 unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T15:58:15.389Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:51082&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;9.4211ms&quot;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>cli执行<code>chaincode invoke</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -c &apos;&#123;&quot;Args&quot;:[&quot;issue&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;, &quot;2020-05-31&quot;, &quot;2020-11-30&quot;, &quot;5000000&quot;]&#125;&apos; -C mychannel -n commercialpaper \</span><br><span class="line">--tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line"></span><br><span class="line">cli:</span><br><span class="line">2019-10-22 15:55:07.564 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 0c9 Chaincode invoke successful. result: status:200 payload:&quot;&#123;\&quot;PaperNumber\&quot;:\&quot;00003\&quot;,\&quot;Issuer\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;Owner\&quot;:\&quot;MagnetoCorp\&quot;,\&quot;IssueDateTime\&quot;:\&quot;2020-05-31\&quot;,\&quot;MaturityDateTime\&quot;:\&quot;2020-11-30\&quot;,\&quot;FaceValue\&quot;:5000000,\&quot;Status\&quot;:0&#125;&quot;</span><br><span class="line"></span><br><span class="line">peer0.org1.example.com:</span><br><span class="line">2019-10-22 15:55:07.497 UTC [endorser] callChaincode -&gt; INFO 2ba6d0 [][7b225797] Entry chaincode: name:&quot;cscc&quot;</span><br><span class="line">2019-10-22 15:55:07.502 UTC [endorser] callChaincode -&gt; INFO 2ba6ec [][7b225797] Exit chaincode: name:&quot;cscc&quot;  (5ms)</span><br><span class="line">2019-10-22 15:55:07.502 UTC [comm.grpc.server] 1 -&gt; INFO 2ba6ef unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T15:55:07.494Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:51076&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;7.6522ms&quot;&#125;</span><br><span class="line">2019-10-22 15:55:07.553 UTC [endorser] callChaincode -&gt; INFO 2ba716 [mychannel][443bff3e] Entry chaincode: name:&quot;commercialpaper&quot;</span><br><span class="line">2019-10-22 15:55:07.557 UTC [endorser] callChaincode -&gt; INFO 2ba724 [mychannel][443bff3e] Exit chaincode: name:&quot;commercialpaper&quot;  (4ms)</span><br><span class="line">2019-10-22 15:55:07.559 UTC [comm.grpc.server] 1 -&gt; INFO 2ba731 unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T15:55:07.545Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:51076&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;14.7305ms&quot;&#125;</span><br><span class="line">2019-10-22 15:55:09.574 UTC [gossip.privdata] StoreBlock -&gt; INFO 2ba941 [mychannel] Received block [8] from buffer</span><br><span class="line">2019-10-22 15:55:09.584 UTC [committer.txvalidator] Validate -&gt; INFO 2ba96b [mychannel] Validated block [8] in 9ms</span><br><span class="line">2019-10-22 15:55:09.619 UTC [kvledger] CommitWithPvtData -&gt; INFO 2ba99e [mychannel] Committed block [8] with 1 transaction(s) in 33ms (state_validation=19ms block_commit=7ms state_commit=5ms)</span><br><span class="line"></span><br><span class="line">orderer:</span><br><span class="line">2019-10-22 15:55:07.569 UTC [orderer.common.broadcast] Handle -&gt; WARN 032 Error reading from 172.25.0.7:53098: rpc error: code = Canceled desc = context canceled</span><br><span class="line">2019-10-22 15:55:07.569 UTC [comm.grpc.server] 1 -&gt; INFO 033 streaming call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-22T15:55:07.545Z&quot;, &quot;grpc.service&quot;: &quot;orderer.AtomicBroadcast&quot;, &quot;grpc.method&quot;: &quot;Broadcast&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:53098&quot;, &quot;error&quot;: &quot;rpc error: code = Canceled desc = context canceled&quot;, &quot;grpc.code&quot;: &quot;Canceled&quot;, &quot;grpc.call_duration&quot;: &quot;24.1982ms&quot;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p>从peer0.org1.example.com日志可见，先后调用了cscc（system chaincode。 调用GetConfigBlock方法，获取channel config，从而获取orderer地址提供给cli建立orderer client）和commercialpaper。后续收到orderer传来的block后再验证和提交本地。</p>
</li>
<li><p><code>docker network inspect net_byfn</code>,发现 172.25.0.7 &lt;-&gt; cli<br>登入cli，<code>netstat -anp</code>如下。估计是端口过早关闭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 127.0.0.11:35373        0.0.0.0:*               LISTEN      -</span><br><span class="line">udp        0      0 127.0.0.11:36128        0.0.0.0:*</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li><p>peer0.org1.example.com/cli执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode list -C mychannel --instantiated</span><br><span class="line">---</span><br><span class="line">Get instantiated chaincodes on channel mychannel:</span><br><span class="line">Name: commercialpaper, Version: 0, Path: github.com/chaincode/commercial_paper/go, Escc: escc, Vscc: vscc</span><br></pre></td></tr></table></figure>
</li>
<li><p>cli执行<code>chaincode query</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;]&#125;&apos; -C mychannel -n commercialpaper</span><br></pre></td></tr></table></figure>
</li>
<li><p>当前commeicialpaper只install在peer0.org1.example.com，此时cli执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CORE_PEER_ADDRESS=peer1.org1.example.com:8051</span><br><span class="line">peer chaincode query -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;]&#125;&apos; -C mychannel -n commercialpaper</span><br><span class="line">---</span><br><span class="line">Error: endorsement failure during query. response: status:500 message:&quot;cannot retrieve package for chaincode commercialpaper/0, error open /var/hyperledger/production/chaincodes/commercialpaper.0: no such file or directory&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>cli在peer1.org1.example.com:8051上<code>chaincode install</code>，并且<code>chaincode query</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;]&#125;&apos; -C mychannel -n commercialpaper \</span><br><span class="line">--peerAddresses peer1.org1.example.com:8051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.crt</span><br><span class="line">或者（`CORE_PEER_TLS_ROOTCERT_FILE`可不修改，因为同org相同的ca证书）</span><br><span class="line">CORE_PEER_ADDRESS=peer1.org1.example.com:8051</span><br><span class="line">CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt</span><br><span class="line">peer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go</span><br><span class="line">peer chaincode query -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;MagnetoCorp&quot;, &quot;00001&quot;]&#125;&apos; -C mychannel -n commercialpaper</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">&#123;&quot;PaperNumber&quot;:&quot;00001&quot;,&quot;Issuer&quot;:&quot;MagnetoCorp&quot;,&quot;Owner&quot;:&quot;MagnetoCorp&quot;,&quot;IssueDateTime&quot;:&quot;2020-05-31&quot;,&quot;MaturityDateTime&quot;:&quot;2020-11-30&quot;,&quot;FaceValue&quot;:5000000,&quot;Status&quot;:0&#125;</span><br><span class="line"></span><br><span class="line">peer1.org1.example.com:</span><br><span class="line">2019-10-23 04:43:39.847 UTC [endorser] callChaincode -&gt; INFO 5078dd [][e21cf78b] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-10-23 04:43:39.891 UTC [lscc] executeInstall -&gt; INFO 5078ea Installed Chaincode [commercialpaper] Version [0] to peer</span><br><span class="line">2019-10-23 04:43:39.892 UTC [endorser] callChaincode -&gt; INFO 5078ee [][e21cf78b] Exit chaincode: name:&quot;lscc&quot;  (45ms)</span><br><span class="line">2019-10-23 04:43:39.892 UTC [comm.grpc.server] 1 -&gt; INFO 5078f1 unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-23T04:43:39.846Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:50220&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;46.0634ms&quot;&#125;</span><br><span class="line">2019-10-23 04:43:54.861 UTC [endorser] callChaincode -&gt; INFO 5084f7 [mychannel][b060b92a] Entry chaincode: name:&quot;commercialpaper&quot;</span><br><span class="line">2019-10-23 04:43:54.914 UTC [chaincode.platform.golang] GenerateDockerBuild -&gt; INFO 508508 building chaincode with ldflagsOpt: &apos;-ldflags &quot;-linkmode external -extldflags &apos;-static&apos;&quot;&apos;</span><br><span class="line">2019-10-23 04:44:19.578 UTC [endorser] callChaincode -&gt; INFO 509732 [mychannel][b060b92a] Exit chaincode: name:&quot;commercialpaper&quot;  (24751ms)</span><br><span class="line">2019-10-23 04:44:19.581 UTC [comm.grpc.server] 1 -&gt; INFO 50973f unary call completed &#123;&quot;grpc.start_time&quot;: &quot;2019-10-23T04:43:54.857Z&quot;, &quot;grpc.service&quot;: &quot;protos.Endorser&quot;, &quot;grpc.method&quot;: &quot;ProcessProposal&quot;, &quot;grpc.peer_address&quot;: &quot;172.25.0.7:50224&quot;, &quot;grpc.code&quot;: &quot;OK&quot;, &quot;grpc.call_duration&quot;: &quot;24.7588062s&quot;&#125;</span><br><span class="line"></span><br><span class="line">orderer日志无变化</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p>此时<code>docker ps</code>，新启动了容器<code>dev-peer1.org1.example.com-commercialpaper-0</code>。</p>
<blockquote>
<p><strong><em>Fabric Documents</em></strong>: If you want additional peers to interact with ledger, then you will need to join them to the channel, and install the same name, version and language of the chaincode source onto the appropriate peer’s filesystem. <strong>A chaincode container will be launched for each peer as soon as they try to interact with that specific chaincode.</strong> Again, be cognizant of the fact that the Node.js images will be slower to compile.</p>
</blockquote>
</li>
</ul>
<ol>
<li>以下对peer0.org2.example.com节点重复实验（从属不同的org）。在cli容器install/invoke chaincode。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go \ </span><br><span class="line">--peerAddresses peer0.org2.example.com:9051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt</span><br><span class="line">* 指定--peerAddresses和--tlsRootCertFiles参数。或者修改环境变量（对应关系）</span><br><span class="line">CORE_PEER_ADDRESS=peer0.org2.example.com:9051</span><br><span class="line">CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">peer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go</span><br><span class="line"></span><br><span class="line">---报错</span><br><span class="line">Error: error getting channel (mychannel) orderer endpoint: error endorsing GetConfigBlock: rpc error: code = Unknown desc = access denied: channel [] creator org [Org1MSP]</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>这是因为<code>CORE_PEER_LOCALMSPID</code>和<code>CORE_PEER_MSPCONFIGPATH</code>这两个参数的设置使当前cli的msp证书从属于Org1。修改使用Org2的msp以及Admin或者User角色即可<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/User1@org2.example.com/msp</span><br><span class="line">peer chaincode install -n commercialpaper -v 0 -p github.com/chaincode/commercial_paper/go \ </span><br><span class="line">--peerAddresses peer0.org2.example.com:9051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Ref"><a href="#Ref" class="headerlink" title="Ref."></a>Ref.</h4><blockquote>
<p><a href="https://www.ibm.com/developerworks/cn/cloud/library/cl-lo-hyperledger-fabric-practice-analysis/index.html?ca=drs-#icomments" target="_blank" rel="noopener">分步详解 Fabric 区块链网络的部署</a> : IBM员工，相当棒的系列实践文章</p>
</blockquote>

      
    </div>

    

    
    
    

    <div>
      
        <div>
    
        <div style="text-align:right;color:#C0C0C0;font-size:12px;"><a href="https://simplexity.cn/copyright/">@原创版权所有，转载请注明出处</a></div>
    
</div>
      
    </div>

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Hyperledger-Fabric/" rel="tag"><i class="fa fa-tag"></i> Hyperledger Fabric</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/10/19/fabric-chaincode-lifecycle-uml/" rel="next" title="Fabric 1.4 chaincode lifecycle(install & instantiate)">
                <i class="fa fa-chevron-left"></i> Fabric 1.4 chaincode lifecycle(install & instantiate)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/11/02/fabric-inpractice-commercialpaper-java-sdk/" rel="prev" title="Fabric实战（2）- Commercial Paper的Fabric-Java-SDK客户端">
                Fabric实战（2）- Commercial Paper的Fabric-Java-SDK客户端 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpeg" alt="Travis Wong">
            
              <p class="site-author-name" itemprop="name">Travis Wong</p>
              <p class="site-description motion-element" itemprop="description">Simple is Complex</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/simplexity-ckcclc" title="GitHub &rarr; https://github.com/simplexity-ckcclc" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://blog.csdn.net/ckcclc" title="CSDN &rarr; https://blog.csdn.net/ckcclc" rel="noopener" target="_blank"><i class="fa fa-fw fa-csdn"></i>CSDN</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Ref"><span class="nav-number">1.</span> <span class="nav-text">Ref.</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Travis Wong</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.0.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="Total Visitors">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="Total Views">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  


  
    <!-- LOCAL: You can save these files to your site and update links -->

  
  <script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitmint.browser.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.css">
<!-- END LOCAL -->

<style>
#gitment-container a {
  border-bottom: none;
}

</style>

<script>
  function renderGitment() {
    var gitment = new Gitmint({
      id: '1571825626000',
      owner: 'simplexity-ckcclc',
      repo: 'gitment-comments',
      
        lang: '' || navigator.language || navigator.systemLanguage || navigator.userLanguage,
      
      oauth: {
      
      
        client_secret: 'ab2011234194ade1678b2b4d771b0aa55e768632',
      
        client_id: 'd91524ebfcf0e898c853'
      }
    });
    gitment.render('gitment-container');
  }

  
    renderGitment();
  
</script>

  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'; 
      }
      else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
